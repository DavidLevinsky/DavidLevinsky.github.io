/*! Copyright (c) 2017 Melown Technologies SE
 *  For terms of use, see accompanying vts-core.min.js.LICENSE file.
 *  For 3rd party libraries licenses, see 3rdpartylicenses.txt.
 */
var vts=function(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=203)}([function(e,t,r){"use strict";r.d(t,"h",function(){return i}),r.d(t,"i",function(){return a}),r.d(t,"l",function(){return s}),r.d(t,"k",function(){return n}),r.d(t,"f",function(){return o}),r.d(t,"a",function(){return h}),r.d(t,"m",function(){return l}),r.d(t,"n",function(){return u}),r.d(t,"o",function(){return c}),r.d(t,"d",function(){return d}),r.d(t,"g",function(){return p}),r.d(t,"j",function(){return f}),r.d(t,"b",function(){return m}),r.d(t,"e",function(){return g}),r.d(t,"c",function(){return v});var i=1,a=2,s=4,n=5,o=484813681109536e-20,h=Math.PI/2,l=.16666666666666666,u=.04722222222222222,c=.022156084656084655,d=void 0===Number.EPSILON?1e-10:Number.EPSILON,p=.017453292519943295,f=57.29577951308232,m=Math.PI/4,g=2*Math.PI,v=3.14159265359},function(e,t,r){"use strict";var i=r(0),a=r(10);t.a=function(e){return Math.abs(e)<=i.c?e:e-r.i(a.a)(e)*i.e}},function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"b",function(){return s}),r.d(t,"c",function(){return a}),r.d(t,"d",function(){return n}),r.d(t,"e",function(){return o});var i={};i.create=function(e){var t=new Array(2);return e&&(t[0]=e[0],t[1]=e[1]),t};var a={};a.create=function(e){var t=new Array(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},a.dot2=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},a.dot3=function(e,t,r,i,a,s){return e[0]*(t[r]-i)+e[1]*(t[r+1]-a)+e[2]*(t[r+2]-s)+e[3]};var s={};s.create=function(e){var t=new Array(3);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2]),t},s.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},s.add=function(e,t,r){return r&&e!=r?(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},s.subtract=function(e,t,r){return r&&e!=r?(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},s.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},s.scale=function(e,t,r){return r&&e!=r?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r):(e[0]*=t,e[1]*=t,e[2]*=t,e)},s.normalize=function(e,t){t||(t=e);var r=e[0],i=e[1],a=e[2],s=Math.sqrt(r*r+i*i+a*a);return s?1==s?(t[0]=r,t[1]=i,t[2]=a,t):(s=1/s,t[0]=r*s,t[1]=i*s,t[2]=a*s,t):(t[0]=0,t[1]=0,t[2]=0,t)},s.normalize2=function(e,t,r){var i=e[t],a=e[t+1],s=e[t+2],n=Math.sqrt(i*i+a*a+s*s);return n?1==n?(r[0]=i,r[1]=a,r[2]=s,r):(n=1/n,r[0]=i*n,r[1]=a*n,void(r[2]=s*n)):(r[0]=0,r[1]=0,r[2]=0,r)},s.normalize3=function(e,t,r,i){var a=e[t],s=e[t+1],n=e[t+2],o=Math.sqrt(a*a+s*s+n*n);return o?1==o?(r[i]=a,r[i+1]=s,r[i+2]=n,r):(o=1/o,r[i]=a*o,r[i+1]=s*o,void(r[i+2]=n*o)):(r[i]=0,r[i+1]=0,r[i+2]=0,r)},s.normalize4=function(e,t){t||(t=e);var r=e[0],i=e[1],a=e[2],s=Math.sqrt(r*r+i*i+a*a);if(!s)return t[0]=0,t[1]=0,t[2]=0,t;if(1==s)return t[0]=r,t[1]=i,t[2]=a,t;var n=s;return s=1/s,t[0]=r*s,t[1]=i*s,t[2]=a*s,n},s.cross=function(e,t,r){r||(r=e);var i=e[0],a=e[1];e=e[2];var s=t[0],n=t[1];return t=t[2],r[0]=a*t-e*n,r[1]=e*s-i*t,r[2]=i*n-a*s,r},s.length=function(e){var t=e[0],r=e[1];return e=e[2],Math.sqrt(t*t+r*r+e*e)},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},s.dot2=function(e,t,r){return e[0]*t[r]+e[1]*t[r+1]+e[2]*t[r+2]},s.dot3=function(e,t,r,i){return e[t]*r[i]+e[t+1]*r[i+1]+e[t+2]*r[i+2]},s.squareDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2];return r*r+i*i+a*a},s.direction=function(e,t,r){r||(r=e);var i=e[0]-t[0],a=e[1]-t[1];return e=e[2]-t[2],(t=Math.sqrt(i*i+a*a+e*e))?(t=1/t,r[0]=i*t,r[1]=a*t,r[2]=e*t,r):(r[0]=0,r[1]=0,r[2]=0,r)},s.lerp=function(e,t,r,i){return i||(i=e),i[0]=e[0]+r*(t[0]-e[0]),i[1]=e[1]+r*(t[1]-e[1]),i[2]=e[2]+r*(t[2]-e[2]),i},s.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var n={};n.create=function(e){var t=new Array(9);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9]),t},n.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.transpose=function(e,t){if(!t||e==t){var r=e[1],i=e[2],a=e[5];return e[1]=e[3],e[2]=e[6],e[3]=r,e[5]=e[7],e[6]=i,e[7]=a,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},n.toMat4=function(e,t){return t||(t=o.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.multiplyVec3=function(e,t,r){r||(r=t);var i=t[0],a=t[1];return t=t[2],r[0]=e[0]*i+e[3]*a+e[6]*t,r[1]=e[1]*i+e[4]*a+e[7]*t,r[2]=e[2]*i+e[5]*a+e[8]*t,r},n.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"};var o={};o.create=function(e){var t=new Array(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},o.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},o.transpose=function(e,t){if(!t||e==t){var r=e[1],i=e[2],a=e[3],s=e[6],n=e[7],o=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=r,e[6]=e[9],e[7]=e[13],e[8]=i,e[9]=s,e[11]=e[14],e[12]=a,e[13]=n,e[14]=o,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},o.determinant=function(e){var t=e[0],r=e[1],i=e[2],a=e[3],s=e[4],n=e[5],o=e[6],h=e[7],l=e[8],u=e[9],c=e[10],d=e[11],p=e[12],f=e[13],m=e[14];return e=e[15],p*u*o*a-l*f*o*a-p*n*c*a+s*f*c*a+l*n*m*a-s*u*m*a-p*u*i*h+l*f*i*h+p*r*c*h-t*f*c*h-l*r*m*h+t*u*m*h+p*n*i*d-s*f*i*d-p*r*o*d+t*f*o*d+s*r*m*d-t*n*m*d-l*n*i*e+s*u*i*e+l*r*o*e-t*u*o*e-s*r*c*e+t*n*c*e},o.inverse=function(e,t){t||(t=e);var r=e[0],i=e[1],a=e[2],s=e[3],n=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=r*o-i*n,b=r*h-a*n,x=r*l-s*n,M=i*h-a*o,S=i*l-s*o,w=a*l-s*h,A=u*m-c*f,T=u*g-d*f,C=u*v-p*f,P=c*g-d*m,F=c*v-p*m,L=d*v-p*g,E=1/(y*L-b*F+x*P+M*C-S*T+w*A);return t[0]=(o*L-h*F+l*P)*E,t[1]=(-i*L+a*F-s*P)*E,t[2]=(m*w-g*S+v*M)*E,t[3]=(-c*w+d*S-p*M)*E,t[4]=(-n*L+h*C-l*T)*E,t[5]=(r*L-a*C+s*T)*E,t[6]=(-f*w+g*x-v*b)*E,t[7]=(u*w-d*x+p*b)*E,t[8]=(n*F-o*C+l*A)*E,t[9]=(-r*F+i*C-s*A)*E,t[10]=(f*S-m*x+v*y)*E,t[11]=(-u*S+c*x-p*y)*E,t[12]=(-n*P+o*T-h*A)*E,t[13]=(r*P-i*T+a*A)*E,t[14]=(-f*M+m*b-g*y)*E,t[15]=(u*M-c*b+d*y)*E,t},o.toRotationMat=function(e,t){return t||(t=o.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.toMat3=function(e,t){return t||(t=n.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.toInverseMat3=function(e,t){var r=e[0],i=e[1],a=e[2],s=e[4],o=e[5],h=e[6],l=e[8],u=e[9],c=e[10],d=c*o-h*u,p=-c*s+h*l,f=u*s-o*l,m=r*d+i*p+a*f;return m?(m=1/m,t||(t=n.create()),t[0]=d*m,t[1]=(-c*i+a*u)*m,t[2]=(h*i-a*o)*m,t[3]=p*m,t[4]=(c*r-a*l)*m,t[5]=(-h*r+a*s)*m,t[6]=f*m,t[7]=(-u*r+i*l)*m,t[8]=(o*r-i*s)*m,t):null},o.multiply=function(e,t,r){r||(r=e);var i=e[0],a=e[1],s=e[2],n=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],v=e[14];e=e[15];var y=t[0],b=t[1],x=t[2],M=t[3],S=t[4],w=t[5],A=t[6],T=t[7],C=t[8],P=t[9],F=t[10],L=t[11],E=t[12],I=t[13],N=t[14];return t=t[15],r[0]=y*i+b*o+x*c+M*m,r[1]=y*a+b*h+x*d+M*g,r[2]=y*s+b*l+x*p+M*v,r[3]=y*n+b*u+x*f+M*e,r[4]=S*i+w*o+A*c+T*m,r[5]=S*a+w*h+A*d+T*g,r[6]=S*s+w*l+A*p+T*v,r[7]=S*n+w*u+A*f+T*e,r[8]=C*i+P*o+F*c+L*m,r[9]=C*a+P*h+F*d+L*g,r[10]=C*s+P*l+F*p+L*v,r[11]=C*n+P*u+F*f+L*e,r[12]=E*i+I*o+N*c+t*m,r[13]=E*a+I*h+N*d+t*g,r[14]=E*s+I*l+N*p+t*v,r[15]=E*n+I*u+N*f+t*e,r},o.multiplyVec3=function(e,t,r){r||(r=t);var i=t[0],a=t[1];return t=t[2],r[0]=e[0]*i+e[4]*a+e[8]*t+e[12],r[1]=e[1]*i+e[5]*a+e[9]*t+e[13],r[2]=e[2]*i+e[6]*a+e[10]*t+e[14],r},o.multiplyVec4=function(e,t,r){r||(r=t);var i=t[0],a=t[1],s=t[2];return t=t[3],r[0]=e[0]*i+e[4]*a+e[8]*s+e[12]*t,r[1]=e[1]*i+e[5]*a+e[9]*s+e[13]*t,r[2]=e[2]*i+e[6]*a+e[10]*s+e[14]*t,r[3]=e[3]*i+e[7]*a+e[11]*s+e[15]*t,r},o.translate=function(e,t,r){var i=t[0],a=t[1];if(t=t[2],!r||e==r)return e[12]=e[0]*i+e[4]*a+e[8]*t+e[12],e[13]=e[1]*i+e[5]*a+e[9]*t+e[13],e[14]=e[2]*i+e[6]*a+e[10]*t+e[14],e[15]=e[3]*i+e[7]*a+e[11]*t+e[15],e;var s=e[0],n=e[1],o=e[2],h=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=e[9],m=e[10],g=e[11];return r[0]=s,r[1]=n,r[2]=o,r[3]=h,r[4]=l,r[5]=u,r[6]=c,r[7]=d,r[8]=p,r[9]=f,r[10]=m,r[11]=g,r[12]=s*i+l*a+p*t+e[12],r[13]=n*i+u*a+f*t+e[13],r[14]=o*i+c*a+m*t+e[14],r[15]=h*i+d*a+g*t+e[15],r},o.scale=function(e,t,r){var i=t[0],a=t[1];return t=t[2],r&&e!=r?(r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r):(e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e[4]*=a,e[5]*=a,e[6]*=a,e[7]*=a,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e)},o.rotate=function(e,t,r,i){var a=r[0],s=r[1];r=r[2];var n=Math.sqrt(a*a+s*s+r*r);if(!n)return null;1!=n&&(n=1/n,a*=n,s*=n,r*=n);var o=Math.sin(t),h=Math.cos(t),l=1-h;t=e[0],n=e[1];var u=e[2],c=e[3],d=e[4],p=e[5],f=e[6],m=e[7],g=e[8],v=e[9],y=e[10],b=e[11],x=a*a*l+h,M=s*a*l+r*o,S=r*a*l-s*o,w=a*s*l-r*o,A=s*s*l+h,T=r*s*l+a*o,C=a*r*l+s*o;return a=s*r*l-a*o,s=r*r*l+h,i?e!=i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=t*x+d*M+g*S,i[1]=n*x+p*M+v*S,i[2]=u*x+f*M+y*S,i[3]=c*x+m*M+b*S,i[4]=t*w+d*A+g*T,i[5]=n*w+p*A+v*T,i[6]=u*w+f*A+y*T,i[7]=c*w+m*A+b*T,i[8]=t*C+d*a+g*s,i[9]=n*C+p*a+v*s,i[10]=u*C+f*a+y*s,i[11]=c*C+m*a+b*s,i},o.rotateX=function(e,t,r){var i=Math.sin(t);t=Math.cos(t);var a=e[4],s=e[5],n=e[6],o=e[7],h=e[8],l=e[9],u=e[10],c=e[11];return r?e!=r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[4]=a*t+h*i,r[5]=s*t+l*i,r[6]=n*t+u*i,r[7]=o*t+c*i,r[8]=a*-i+h*t,r[9]=s*-i+l*t,r[10]=n*-i+u*t,r[11]=o*-i+c*t,r},o.rotateY=function(e,t,r){var i=Math.sin(t);t=Math.cos(t);var a=e[0],s=e[1],n=e[2],o=e[3],h=e[8],l=e[9],u=e[10],c=e[11];return r?e!=r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=a*t+h*-i,r[1]=s*t+l*-i,r[2]=n*t+u*-i,r[3]=o*t+c*-i,r[8]=a*i+h*t,r[9]=s*i+l*t,r[10]=n*i+u*t,r[11]=o*i+c*t,r},o.rotateZ=function(e,t,r){var i=Math.sin(t);t=Math.cos(t);var a=e[0],s=e[1],n=e[2],o=e[3],h=e[4],l=e[5],u=e[6],c=e[7];return r?e!=r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=a*t+h*i,r[1]=s*t+l*i,r[2]=n*t+u*i,r[3]=o*t+c*i,r[4]=a*-i+h*t,r[5]=s*-i+l*t,r[6]=n*-i+u*t,r[7]=o*-i+c*t,r},o.frustum=function(e,t,r,i,a,s,n){n||(n=o.create());var h=t-e,l=i-r,u=s-a;return n[0]=2*a/h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*a/l,n[6]=0,n[7]=0,n[8]=(t+e)/h,n[9]=(i+r)/l,n[10]=-(s+a)/u,n[11]=-1,n[12]=0,n[13]=0,n[14]=-s*a*2/u,n[15]=0,n},o.perspective=function(e,t,r,i,a){return e=r*Math.tan(e*Math.PI/360),t*=e,o.frustum(-t,t,-e,e,r,i,a)},o.ortho=function(e,t,r,i,a,s,n){n||(n=o.create());var h=t-e,l=i-r,u=s-a;return n[0]=2/h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-2/u,n[11]=0,n[12]=-(e+t)/h,n[13]=-(i+r)/l,n[14]=-(s+a)/u,n[15]=1,n},o.lookAt=function(e,t,r,i){i||(i=o.create());var a=e[0],s=e[1];e=e[2];var n=r[0],h=r[1],l=r[2];r=t[1];var u=t[2];if(a==t[0]&&s==r&&e==u)return o.identity(i);var c,d,p,f;return r=a-t[0],u=s-t[1],t=e-t[2],f=1/Math.sqrt(r*r+u*u+t*t),r*=f,u*=f,t*=f,c=h*t-l*u,l=l*r-n*t,n=n*u-h*r,f=Math.sqrt(c*c+l*l+n*n),f?(f=1/f,c*=f,l*=f,n*=f):n=l=c=0,h=u*n-t*l,d=t*c-r*n,p=r*l-u*c,f=Math.sqrt(h*h+d*d+p*p),f?(f=1/f,h*=f,d*=f,p*=f):p=d=h=0,i[0]=c,i[1]=h,i[2]=r,i[3]=0,i[4]=l,i[5]=d,i[6]=u,i[7]=0,i[8]=n,i[9]=p,i[10]=t,i[11]=0,i[12]=-(c*a+l*s+n*e),i[13]=-(h*a+d*s+p*e),i[14]=-(r*a+u*s+t*e),i[15]=1,i},o.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"};var h={};h.create=function(e){var t=new Array(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},h.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},h.calculateW=function(e,t){var r=e[0],i=e[1],a=e[2];return t&&e!=t?(t[0]=r,t[1]=i,t[2]=a,t[3]=-Math.sqrt(Math.abs(1-r*r-i*i-a*a)),t):(e[3]=-Math.sqrt(Math.abs(1-r*r-i*i-a*a)),e)},h.inverse=function(e,t){return t&&e!=t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=1,e[1]*=1,e[2]*=1,e)},h.length=function(e){var t=e[0],r=e[1],i=e[2];return e=e[3],Math.sqrt(t*t+r*r+i*i+e*e)},h.normalize=function(e,t){t||(t=e);var r=e[0],i=e[1],a=e[2],s=e[3],n=Math.sqrt(r*r+i*i+a*a+s*s);return 0==n?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(n=1/n,t[0]=r*n,t[1]=i*n,t[2]=a*n,t[3]=s*n,t)},h.multiply=function(e,t,r){r||(r=e);var i=e[0],a=e[1],s=e[2];e=e[3];var n=t[0],o=t[1],h=t[2];return t=t[3],r[0]=i*t+e*n+a*h-s*o,r[1]=a*t+e*o+s*n-i*h,r[2]=s*t+e*h+i*o-a*n,r[3]=e*t-i*n-a*o-s*h,r},h.multiplyVec3=function(e,t,r){r||(r=t);var i=t[0],a=t[1],s=t[2];t=e[0];var n=e[1],o=e[2];e=e[3];var h=e*i+n*s-o*a,l=e*a+o*i-t*s,u=e*s+t*a-n*i;return i=-t*i-n*a-o*s,r[0]=h*e+i*-t+l*-o-u*-n,r[1]=l*e+i*-n+u*-t-h*-o,r[2]=u*e+i*-o+h*-n-l*-t,r},h.toMat3=function(e,t){t||(t=n.create());var r=e[0],i=e[1],a=e[2],s=e[3],o=r+r,h=i+i,l=a+a,u=r*o,c=r*h;r*=l;var d=i*h;return i*=l,a*=l,o*=s,h*=s,s*=l,t[0]=1-(d+a),t[1]=c-s,t[2]=r+h,t[3]=c+s,t[4]=1-(u+a),t[5]=i-o,t[6]=r-h,t[7]=i+o,t[8]=1-(u+d),t},h.toMat4=function(e,t){t||(t=o.create());var r=e[0],i=e[1],a=e[2],s=e[3],n=r+r,h=i+i,l=a+a,u=r*n,c=r*h;r*=l;var d=i*h;return i*=l,a*=l,n*=s,h*=s,s*=l,t[0]=1-(d+a),t[1]=c-s,t[2]=r+h,t[3]=0,t[4]=c+s,t[5]=1-(u+a),t[6]=i-n,t[7]=0,t[8]=r-h,t[9]=i+n,t[10]=1-(u+d),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.slerp=function(e,t,r,i){i||(i=e);var a=r;return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]<0&&(a=-1*r),i[0]=1-r*e[0]+a*t[0],i[1]=1-r*e[1]+a*t[1],i[2]=1-r*e[2]+a*t[2],i[3]=1-r*e[3]+a*t[3],i},h.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}},function(e,t,r){"use strict";var i=r(2);r.d(t,"a",function(){return s});var a=i.e,s={};s.isEqual=function(e,t,r){return Math.abs(e-t)<r},s.clamp=function(e,t,r){return e<t?e=t:e>r&&(e=r),e},s.radians=function(e){return e*Math.PI/180},s.degrees=function(e){return e/Math.PI*180},s.mix=function(e,t,r){return e+(t-e)*r},s.frustumMatrix=function(e,t,r,i,s,n){var o=t-e,h=i-r,l=n-s,u=a.create([2*s/o,0,(t+e)/o,0,0,2*s/h,(i+r)/h,0,0,0,-(n+s)/l,-2*n*s/l,0,0,-1,0]);return a.transpose(u),u},s.perspectiveMatrix=function(e,t,r,i){var a=r*Math.tan(e*Math.PI/180),n=a*t;return s.frustumMatrix(-n,n,-a,a,r,i)},s.orthographicMatrix=function(e,t,r,i){var s=.5*e*t,n=.5*e,o=i-r,h=a.create([1/s,0,0,0,0,1/n,0,0,0,0,-2/o,-(i+r)/o,0,0,0,1]);return a.transpose(h),h},s.rotationMatrix=function(e,t){var r=Math.cos(t),i=Math.sin(t);switch(e){case 0:return[1,0,0,0,0,r,i,0,0,-i,r,0,0,0,0,1];case 1:return[r,0,i,0,0,1,0,0,-i,0,r,0,0,0,0,1];default:return[r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1]}},s.scaleMatrix=function(e,t,r){return[e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1]},s.scaleMatrixf=function(e){return s.scaleMatrix(e,e,e)},s.translationMatrix=function(e,t,r){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1]},s.translationMatrix2f=function(e){return s.translationMatrix(e[0],e[1],0)},s.translationMatrix3f=function(e){return s.translationMatrix(e[0],e[1],e[2])}},function(e,t,r){"use strict";var i=r(3),a=r(12);r.d(t,"a",function(){return o});var s=i.a,n=a.a,o={};o.useCredentials=!1,o.instanceCounter=0,o.validateBool=function(e,t){return"boolean"==typeof e?e:t},o.validateNumber=function(e,t,r,i){return"number"==typeof e?s.clamp(e,t,r):i},o.validateNumberArray=function(e,t,r,i,a){if(Array.isArray(e)&&e.length==t){for(var n=0;n<t;n++)e[n]=s.clamp(e[n],r[n],i[n]);return e}return a},o.validateString=function(e,t){return"string"==typeof e?e:t},o.padNumber=function(e,t){return e<0?(e=-e+"",t--,e.length>=t?"-"+e:"-"+(new Array(t-e.length+1).join("0")+e)):(e+="",e.length>=t?e:new Array(t-e.length+1).join("0")+e)},o.decodeFloat16=function(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)},o.simpleFmtObj=function(e,t){return e&&""!=e?e.replace(/\{([$a-zA-Z0-9][$a-zA-Z0-9]*)\}/g,function(e,r){return r in t?t[r]:e}):""},o.simpleWikiLinks=function(e,t){return e&&""!=e?o.simpleFmtObj(e,{copy:"&copy;",Y:(new Date).getFullYear()}).replace(/\[([^\]]*)\]/g,function(e,r){r=r.trim();var i=r.split(" ");return-1!=i[0].indexOf("//")?t?i.length>1?""+r.substring(i[0].length):""+i[0]:i.length>1?"<a href="+i[0]+' target="blank">'+r.substring(i[0].length)+"</a>":"<a href="+i[0]+' target="blank">'+i[0]+"</a>":r}):""},o.simpleFmtObjOrCall=function(e,t,r){return e&&""!=e?e.replace(/\{([$a-zA-Z(-9][$a-zA-Z(-9]*)\}/g,function(e,i){return i in t?t[i]:r(i)}):""},o.getABGRFromHexaCode=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[4],16),parseInt(t[3],16),parseInt(t[2],16),parseInt(t[1],16)]:[0,0,0,255]},o.stringifyFunction=function(e){return"("+e+").call(self);"},o.isPowerOfTwo=function(e){return 0==(e&e-1)&&0!==e},o.nearestPowerOfTwo=function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},o.fitToPowerOfTwo=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},o.getHash=function(e){if(!e||0===e.length)return 0;for(var t,r=0,i=0,a=e.length;i<a;i++)t=e.charCodeAt(i),r=(r<<5)-r+t,r|=0;return r},o.loadText=function(e,t,r,i,a){o.loadJSON(e,t,r,!0,i,a)},o.loadXML=function(e,t,r,i,a){var s=function(e){e=(new DOMParser).parseFromString(e,"text/xml"),t&&t(e)};o.loadJSON(e,s,r,!0,i,a)},o.loadJSON=function(e,t,r,i,a,s){var n=new XMLHttpRequest;n.onreadystatechange=function(){switch(n.readyState){case 0:case 1:case 2:case 3:break;case 4:if(n.status>=400||0==n.status){r&&r(n.status);break}var a=n.response,s=a;if(!i)try{s=JSON.parse(a)}catch(t){return console.log("JSON Parse Error ("+e+"): "+(t.message?t.message:"")),void(r&&r(n.status))}t&&t(s)}}.bind(this),n.open("GET",e,!0),n.withCredentials=a,s&&s.token&&n.setRequestHeader("Accept","token/"+s.token+", */*"),s&&s.charset&&n.overrideMimeType("text/xml; charset="+s.charset),n.send("")},o.loadBinary=function(e,t,r,i,a,s){var n=new XMLHttpRequest;n.onreadystatechange=function(){switch(n.readyState){case 0:case 1:case 2:case 3:break;case 4:if(n.status>=400||0==n.status){r&&r(n.status);break}var e=n.response;if(!e){r&&r();break}t&&t(e);break;default:r&&r()}}.bind(this),n.open("GET",e,!0),n.responseType=s||"arraybuffer",n.withCredentials=i,a&&a.token&&n.setRequestHeader("Accept","token/"+a.token+", */*"),n.send("")},o.headRequest=function(e,t,r,i,a){var s=new XMLHttpRequest;s.onreadystatechange=function(){switch(s.readyState){case 0:case 1:case 2:case 3:break;case 4:null!=t&&t(s.getAllResponseHeaders(),s.status);break;default:null!=r&&r()}}.bind(this),s.onerror=function(){null!=r&&r()}.bind(this),s.open("HEAD",e,!0),s.withCredentials=i,a&&a.token&&s.setRequestHeader("Accept","token/"+a.token+", */*"),s.send("")},o.loadImage=function(e,t,r,i,a){var s=new Image;return s.onerror=r,s.onload=t,a||(s.crossOrigin=i?"use-credentials":"anonymous"),s.src=e,s},o.getParamsFromUrl=function(e){return n.getParamsFromUrl(e)}},function(e,t,r){"use strict";var i=function(e,t,r,i,a,s){this.min=[],this.max=[],this.min[0]=null!=e?e:Number.POSITIVE_INFINITY,this.min[1]=null!=t?t:Number.POSITIVE_INFINITY,this.min[2]=null!=r?r:Number.POSITIVE_INFINITY,this.max[0]=null!=i?i:Number.NEGATIVE_INFINITY,this.max[1]=null!=a?a:Number.NEGATIVE_INFINITY,this.max[2]=null!=s?s:Number.NEGATIVE_INFINITY,this.updateMaxSize()};i.prototype.clone=function(){return new i(this.min[0],this.min[1],this.min[2],this.max[0],this.max[1],this.max[2])},i.prototype.side=function(e){return this.max[e]-this.min[e]},i.prototype.updateMaxSize=function(){this.maxSize=Math.abs(Math.max(this.max[0]-this.min[0],this.max[1]-this.min[1],this.max[2]-this.min[2]))},i.prototype.center=function(e){return null!=e?(e[0]=.5*(this.min[0]+this.max[0]),e[1]=.5*(this.min[1]+this.max[1]),e):(this.middle||(this.middle=[.5*(this.min[0]+this.max[0]),.5*(this.min[1]+this.max[1]),.5*(this.min[2]+this.max[2])],isNaN(this.middle[0])&&(this.middle[0]=0),isNaN(this.middle[1])&&(this.middle[1]=0),isNaN(this.middle[2])&&(this.middle[2]=0)),this.middle)},i.prototype.translateXY=function(e){return new i(this.min[0]-e[0],this.min[1]-e[1],this.min[2],this.max[0]-e[0],this.max[1]-e[1],this.max[2])},t.a=i},function(e,t,r){"use strict";var i=r(4),a=i.a,s=function(e,t,r,i,a,s,n,o,h,l){this.gpu=e,this.gl=e.gl,this.texture=null,this.framebuffer=null,this.size=0,this.fileSize=i,this.width=0,this.height=0,this.repeat=s||!1,this.filter=n||"linear",this.image=null,this.loaded=!1,this.trilinear=!1,this.core=r,null!=t&&this.load(t,h,l,a,o)};s.prototype.kill=function(){this.gl.deleteTexture(this.texture),this.texture=null},s.prototype.size=function(){return this.size},s.prototype.createFromData=function(e,t,r,i,a){var s=this.gl;this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),a?(a=s.REPEAT,this.repeat=!0):a=s.CLAMP_TO_EDGE,s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,a),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,a);var n=!1;switch(i){case"linear":s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR);break;case"trilinear":s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),n=!0;break;default:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST)}s.pixelStorei(s.UNPACK_ALIGNMENT,1),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,r),n&&s.generateMipmap(s.TEXTURE_2D),s.bindTexture(s.TEXTURE_2D,null),this.width=e,this.height=t,this.size=e*t*4,this.loaded=!0},s.prototype.createFromImage=function(e,t,r,i){var s=this.gl,n=e.naturalWidth,o=e.naturalHeight,h=e;this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),r?(r=s.REPEAT,this.repeat=!0):r=s.CLAMP_TO_EDGE,s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,r);var l=!1;switch(this.filter=t,t){case"linear":s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR);break;case"trilinear":s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),l=!0;break;default:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST)}if((this.repeat||l)&&(!a.isPowerOfTwo(n)||!a.isPowerOfTwo(o))){n=a.nearestPowerOfTwo(n),o=a.nearestPowerOfTwo(o);var u=document.createElement("canvas");u.width=n,u.height=o;u.getContext("2d").drawImage(e,0,0,n,o),h=u}var c=this.gpu;c.anisoLevel&&s.texParameterf(s.TEXTURE_2D,c.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,c.anisoLevel),!0!==c.noTextures&&(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,h),l&&s.generateMipmap(s.TEXTURE_2D)),s.bindTexture(s.TEXTURE_2D,null),this.width=n,this.height=o,this.size=n*o*4,this.loaded=!0},s.prototype.load=function(e,t,r,i,s){this.image=a.loadImage(e,function(){null!=this.core&&this.core.killed||(this.createFromImage(this.image,this.filter,this.repeat),s||(this.image=null),t?t():this.core.map&&this.core.map.markDirty&&this.core.map.markDirty())}.bind(this),function(){null!=this.core&&this.core.killed||r&&r()}.bind(this),null,i)},s.prototype.createFramebufferFromData=function(e,t,r){var i=this.gl,a=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,a),a.width=e,a.height=t;var s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,r);var n=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n),this.width=e,this.height=t,this.size=e*t*4,this.texture=s,this.renderbuffer=n,this.framebuffer=a,i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null)},s.prototype.createFramebuffer=function(e,t){if(null!=this.texture){var r=this.gl,i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),i.width=e,i.height=t,r.bindTexture(r.TEXTURE_2D,this.texture);var a=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,a),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,a),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),this.framebuffer=i,this.renderbuffer=a}},s.prototype.readFramebufferPixels=function(e,t,r,i){if(null!=this.texture){this.gpu.bindTexture(this),this.gpu.setFramebuffer(this);var a=this.gl,s=new Uint8Array(r*i*4);return a.readPixels(e,t,r,i,a.RGBA,a.UNSIGNED_BYTE,s),this.gpu.setFramebuffer(null),s}},t.a=s},function(e,t,r){"use strict";t.a=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}},function(e,t,r){"use strict";t.a=function(e,t,r){var i=e*t;return r/Math.sqrt(1-i*i)}},function(e,t,r){"use strict";var i=r(0),a=r(10);t.a=function(e){return Math.abs(e)<i.a?e:e-r.i(a.a)(e)*Math.PI}},function(e,t,r){"use strict";t.a=function(e){return e<0?-1:1}},,function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={};i.isSameOrigin=function(e){if("string"!=typeof e)return!1;var t=document.location.hostname;return i.parse(e).hostname===t},i.parse=function(e){if("string"!=typeof e)return null;var t=document.createElement("a");return t.href=e,t},i.getParamsFromUrl=function(e){var t=i.parse(e),r={},a=t.search.substring(1),s=a.split("&");if(1!=s.length||""!=s[0])for(var n=0;n<s.length;n++){var o=s[n].split("=");if(void 0===r[o[0]])r[o[0]]=o[1];else if("string"==typeof r[o[0]]){var h=[r[o[0]],o[1]];r[o[0]]=h}else r[o[0]].push(o[1])}return r},i.getHost=function(e){var t=document.createElement("a");return t.href=e,t.hostname},i.getSchema=function(e){if(-1!=e.indexOf("http://"))return"http:";if(-1!=e.indexOf("https://"))return"https:";var t=document.createElement("a");return t.href=e,t.protocol},i.getOrigin=function(e){var t=document.createElement("a");return t.href=e,t.origin?t.origin:t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")},i.getBase=function(e){return e.split("?")[0].split("/").slice(0,-1).join("/")+"/"},i.getProcessUrl=function(e,t){if(!e||!t)return e;e=e.trim(),t=t.trim();var r=i.getBase(t),a=i.getSchema(t),s=i.getOrigin(t);return-1!=e.indexOf("://")?e:0==e.indexOf("//")?a+e:0==e.indexOf("/")?s+e:r+e}},function(e,t,r){"use strict";function i(e){return(e?"Core: ":"")+"2.16.5"}function a(){w.init();var e=document.createElement("canvas");if(null==e)return!1;if(e.width=1024,e.height=768,null==e.getContext)return!1;var t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){return!1}return!!t}var s=r(21),n=r(140),o=r(120),h=r(167),l=r(165),u=r(31),c=r(138),d=r(4),p=r(12),f=r(22);r.d(t,"c",function(){return A}),r.d(t,"a",function(){return i}),r.d(t,"b",function(){return a});var m=n.a,g=o.a,v=h.a,y=l.a,b=u.a,x=c.a,M=d.a,S=p.a,w=f.a,A=function(e,t,r){var i=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage;this.killed=!1,this.config={map:null,mapCache:1100,mapGPUCache:600,mapMetatileCache:60,mapTexelSizeFit:1.1,mapMaxHiresLodLevels:2,mapLowresBackground:0,mapDownloadThreads:20,mapMaxProcessingTime:2e4,mapMobileMode:!1,mapMobileModeAutodect:!0,mapMobileDetailDegradation:1,mapNavSamplesPerViewExtent:4,mapIgnoreNavtiles:!1,mapVirtualSurfaces:!0,mapAllowHires:!0,mapAllowLowres:!0,mapAllowSmartSwitching:!0,mapDisableCulling:!1,mapPreciseCulling:!0,mapHeightLodBlend:!0,mapHeightNodeBlend:!0,mapBasicTileSequence:!1,mapPreciseBBoxTest:!1,mapPreciseDistanceTest:!1,mapHeightfiledWhenUnloaded:!0,mapForceMetatileV3:!1,mapSmartNodeParsing:!0,mapLoadErrorRetryTime:3e3,mapLoadErrorMaxRetryCount:3,mapLoadMode:"topdown",mapGeodataLoadMode:"fit",mapGridMode:"linear",mapGridSurrogatez:!1,mapXhrImageLoad:!0,mapStoreLoadStats:!1,mapRefreshCycles:3,mapFeatureGridCells:31,mapFeaturesPerSquareInch:.25,mapFeaturesSortByTop:!1,mapFeaturesReduceMode:"scr-count5",mapFeaturesReduceParams:null,mapFeaturesReduceFactor:1,mapDegradeHorizon:!1,mapDegradeHorizonParams:[1,1500,97500,3500],mapDefaultFont:"//cdn.melown.com/libs/vtsjs/fonts/noto-basic/1.0.0/noto.fnt",mapFog:!0,mapNoTextures:!1,mapMetricUnits:!("en"==i||0==i.indexOf("en-")),mapForceFrameTime:0,mapForcePipeline:0,rendererAnisotropic:0,rendererAntialiasing:!0,rendererAllowScreenshots:!1,inspector:!0,authorization:null,mario:!1},this.configStorage={},this.element=e,this.coreInterface=r,this.ready=!1,this.listeners=[],this.listenerCounter=0,this.tokenCookieHost=null,this.tokenIFrame=null,this.xhrParams={},this.inspector=null!=g?new g(this):null,this.setConfigParams(t),this.map=null,this.mapInterface=null,this.renderer=new v(this,this.element,null,this.onResize.bind(this),this.config),this.rendererInterface=new y(this.renderer),this.proj4=s.a,w.init(),this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},window.performance=window.performance||{},performance.now=function(){return performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()}}(),this.loadMap(this.config.map),this.requestAnimFrame.call(window,this.onUpdate.bind(this))};A.prototype.onResize=function(){null!=this.map&&this.map.markDirty()},A.prototype.loadMap=function(e){if(null!=this.map&&this.destroyMap(),null!=e){e=S.getProcessUrl(e,window.location.href),this.tokenCookieLoaded=!0,this.mapConfigData=null,this.tokenExpiration=null,this.tokenExpirationCallback=null,this.tokenExpirationLoop=!1,this.tokenCanBeSkiped=!0,this.mapRunnig=!1;var t=function(){if((this.tokenCookieLoaded||this.tokenCanBeSkiped)&&this.mapConfigData&&!this.mapRunnig){this.mapRunnig=!0;var t=this.mapConfigData;this.callListener("map-mapconfig-loaded",t),this.map=new m(this,t,e,this.config),this.mapInterface=new x(this.map),this.setConfigParams(this.map.browserOptions),this.setConfigParams(this.configStorage),this.config.position&&(this.map.setPosition(this.config.position),this.config.position=null),this.config.view&&(this.map.setView(this.config.view),this.config.view=null)}}.bind(this),r=function(e){this.mapConfigData=e,t()}.bind(this),i=function(){}.bind(this),a=function(t){if(!t||t&&t.status)return void(this.tokenCanBeSkiped&&o(e));this.tokenLoaded=!0,this.xhrParams.token=t.token,this.xhrParams.tokenHeader=t.header,this.tokenExpiration=1e3*t.expires,this.tokenExpirationCallback=function(){this.tokenExpiration=null,this.tokenExpirationLoop=!0,"string"==typeof this.config.authorization?M.loadJSON(this.config.authorization,a,s,null,M.useCredentials,this.xhrParams):this.config.authorization(a)}.bind(this),this.tokenExpirationLoop||o(e),"string"==typeof this.config.authorization?h(t.cookieInjector,this.config.authorization):h(t.cookieInjector,e)}.bind(this),s=function(){console.log("auth token not loaded"),this.tokenCanBeSkiped&&o(e)}.bind(this),n=function(){document.body.removeChild(this.tokenIFrame),this.tokenIFrame=null,this.tokenCookieLoaded=!0,t()}.bind(this),o=function(e){M.loadJSON(e,r,i,null,M.useCredentials,this.xhrParams)}.bind(this),h=function(e,t){e=S.getProcessUrl(e,t),this.tokenCookieHost=S.getHost(e);var r=document.createElement("iframe");this.tokenIFrame=r,r.onload=n,r.src=e,r.style.display="none",document.body.appendChild(r)}.bind(this);this.config.authorization?(this.tokenCookieLoaded=!1,"string"==typeof this.config.authorization?M.loadJSON(this.config.authorization,a,s,null,M.useCredentials,this.xhrParams):this.config.authorization(a)):o(e)}},A.prototype.destroy=function(){this.killed||(this.destroyMap(),this.renderer&&this.renderer.kill(),this.element=null,this.killed=!0)},A.prototype.destroyMap=function(){this.map&&(this.map.kill(),this.map=null,this.mapInterface=null,this.callListener("map-unloaded",{}))},A.prototype.getMap=function(){return this.map},A.prototype.getMapInterface=function(){return this.mapInterface},A.prototype.getRenderer=function(){return this.renderer},A.prototype.getRendererInterface=function(){return this.rendererInterface},A.prototype.getProj4=function(){return this.proj4},A.prototype.getOption=function(){},A.prototype.setOption=function(){},A.prototype.on=function(e,t,r,i){if(!this.killed&&null!=t)return this.listenerCounter++,this.listeners.push({name:e,listener:t,id:this.listenerCounter,once:i,wait:r||0}),function(e){this.removeListener(e)}.bind(this,this.listenerCounter)},A.prototype.once=function(e,t,r){this.on(e,t,r,!0)},A.prototype.callListener=function(e,t,r){for(var i=0;i<this.listeners.length;i++)if(this.listeners[i].name==e){var a=this.listeners[i];a.wait>0?a.wait--:(a.listener(t),a.once&&(this.listeners.splice(i,1),i--))}r&&console.log("event "+e+": "+JSON.stringify(t))},A.prototype.removeListener=function(e){for(var t=0;t<this.listeners.length;t++)if(this.listeners[t].id==e)return void this.listeners.splice(t,1)},A.prototype.markDirty=function(){null!=this.map&&this.map.markDirty()},A.prototype.onUpdate=function(){this.killed||(null!=this.map&&(!this.map.srsReady&&this.map.isReferenceFrameReady()&&(this.map.srsReady=!0,this.callListener("map-loaded",{browserOptions:this.map.browserOptions})),this.map.update()),this.callListener("tick",{}),this.requestAnimFrame.call(window,this.onUpdate.bind(this)))},A.prototype.setConfigParams=function(e){if("object"==typeof e&&null!==e)for(var t in e)this.setConfigParam(t,e[t])},A.prototype.setConfigParam=function(e,t){"pos"==e||"position"==e||"view"==e?this.getMap()?("view"==e?this.getMap().setView(t):this.getMap().setPosition(new b(t)),this.configStorage[e]&&delete this.configStorage[e]):this.configStorage[e]=t:"map"==e?this.config.map=M.validateString(t,null):"mapVirtualSurfaces"==e?this.config.mapVirtualSurfaces=M.validateBool(t,!0):"mapForcePipeline"==e?this.config.mapForcePipeline=M.validateNumber(t,-1,Number.MAXINTEGER,0):"inspector"==e?this.config.inspector=M.validateBool(t,!0):"authorization"==e?this.config.authorization="string"==typeof t||"function"==typeof t?t:null:(0!=e.indexOf("map")&&"mario"!=e||(this.configStorage[e]=t,null!=this.getMap()&&this.getMap().setConfigParam(e,t)),0==e.indexOf("renderer")&&this.setRendererConfigParam(e,t),0==e.indexOf("debug")&&(this.configStorage[e]=t,null!=this.getMap()&&this.inspector.setParameter(e,t)))},A.prototype.getConfigParam=function(e){return"map"==e?this.config.map:"inspector"==e?this.config.inspector:0==e.indexOf("map")&&null!=this.getMap()?this.getMap().getConfigParam(e):0==e.indexOf("renderer")?this.getRendererConfigParam(e):void 0},A.prototype.setRendererConfigParam=function(e,t){switch(e){case"rendererAnisotropic":this.config.rendererAnisotropic=M.validateNumber(t,-1,2048,0);break;case"rendererAntialiasing":this.config.rendererAntialiasing=M.validateBool(t,!0);break;case"rendererAllowScreenshots":this.config.rendererAllowScreenshots=M.validateBool(t,!1)}},A.prototype.getRendererConfigParam=function(e){switch(e){case"rendererAnisotropic":return this.config.rendererAnisotropic;case"rendererAntialiasing":return this.config.rendererAntialiasing;case"rendererAllowScreenshots":return this.config.rendererAllowScreenshots}}},function(e,t,r){"use strict";t.a=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))}},function(e,t,r){"use strict";t.a=function(e){return.375*e*(1+.25*e*(1+.46875*e))}},function(e,t,r){"use strict";t.a=function(e){return.05859375*e*e*(1+.75*e)}},function(e,t,r){"use strict";t.a=function(e){return e*e*e*(35/3072)}},function(e,t,r){"use strict";t.a=function(e,t,r,i,a){return e*a-t*Math.sin(2*a)+r*Math.sin(4*a)-i*Math.sin(6*a)}},function(e,t,r){"use strict";var i=r(0);t.a=function(e,t){for(var r,a,s=.5*e,n=i.a-2*Math.atan(t),o=0;o<=15;o++)if(r=e*Math.sin(n),a=i.a-2*Math.atan(t*Math.pow((1-r)/(1+r),s))-n,n+=a,Math.abs(a)<=1e-10)return n;return-9999}},function(e,t,r){"use strict";var i=r(0);t.a=function(e,t,r){var a=e*r,s=.5*e;return a=Math.pow((1-a)/(1+a),s),Math.tan(.5*(i.a-t))/a}},function(e,t,r){"use strict";var i=r(75),a=r(24),s=r(60),n=r(40),o=r(42),h=r(45),l=r(35),u=r(111),c=r(113);i.a.defaultDatum="WGS84",i.a.Proj=a.a,i.a.WGS84=new i.a.Proj("WGS84"),i.a.Point=s.a,i.a.toPoint=n.a,i.a.defs=o.a,i.a.transform=h.a,i.a.mgrs=l.a,i.a.version=u.a,r.i(c.a)(i.a),t.a=i.a},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={initialized:!1,init:function(){var e=i;e.browser=e.searchString(e.dataBrowser)||"An unknown browser",e.version=e.searchVersion(navigator.userAgent.toLowerCase())||e.searchVersion(navigator.appVersion)||"an unknown version",e.OS=e.searchString(e.dataOS)||"an unknown os: ua: "+navigator.userAgent+" pl: "+navigator.platform,e.mobile="iphone/ipod"==e.OS||"android"==e.OS||"ipad"==e.OS||"windows ce"==e.OS||"windows phone"==e.OS||"kindle"==e.OS,e.mobileAndroid="android"==e.OS,e.initialized=!0},getBrowser:function(){return i.initialized||i.init(),i.browser},getBrowserVersion:function(){return i.initialized||i.init(),i.browser},getOS:function(){return i.initialized||i.init(),i.browser},isMobile:function(){return i.initialized||i.init(),i.mobile},isAndroid:function(){return i.initialized||i.init(),i.mobileAndroid},searchString:function(e){for(var t=i,r=0;r<e.length;r++){var a=e[r].string,s=e[r].prop;if(t.versionSearchString=e[r].versionSearch||e[r].identity,a){if(-1!=a.toLowerCase().indexOf(e[r].subString))return null!=e[r].version&&(t.version=e[r].version),e[r].identity}else if(s)return e[r].identity}},searchVersion:function(e){var t=i;if(null!=t.version)return t.version;var r=e.indexOf(t.versionSearchString);if(-1!=r)return parseFloat(e.substring(r+t.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"chrome",identity:"chrome"},{string:navigator.userAgent,subString:"firefox",identity:"firefox"},{string:navigator.vendor,subString:"apple",identity:"safari",versionSearch:"version"},{prop:window.opera,identity:"opera",versionSearch:"version"},{string:navigator.vendor,subString:"icab",identity:"icab"},{string:navigator.vendor,subString:"kde",identity:"konqueror"},{string:navigator.vendor,subString:"camino",identity:"camino"},{string:navigator.userAgent,subString:"netscape",identity:"netscape"},{string:navigator.userAgent,subString:"msie",identity:"explorer",versionSearch:"msie"},{string:navigator.userAgent,subString:"trident/",identity:"explorer",version:"11"},{string:navigator.userAgent,subString:"edge/",identity:"explorer",version:"12"},{string:navigator.userAgent,subString:"omniweb",versionSearch:"omniweb/",identity:"omniweb"},{string:navigator.userAgent,subString:"silk",versionSearch:"silk/",identity:"silk"},{string:navigator.userAgent,subString:"gecko",identity:"mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"mozilla",identity:"netscape",versionSearch:"mozilla"}],dataOS:[{string:navigator.userAgent,subString:"windows ce",identity:"windows ce"},{string:navigator.userAgent,subString:"windows phone",identity:"windows phone"},{string:navigator.platform,subString:"win",identity:"windows"},{string:navigator.platform,subString:"mac",identity:"mac"},{string:navigator.userAgent,subString:"iphone",identity:"iphone/ipod"},{string:navigator.userAgent,subString:"ipod",identity:"iphone/ipod"},{string:navigator.userAgent,subString:"ipad",identity:"ipad"},{string:navigator.userAgent,subString:"android",identity:"android"},{string:navigator.userAgent,subString:"silk",identity:"kindle"},{string:navigator.userAgent,subString:"blackberry",identity:"blackberry"},{string:navigator.platform,subString:"linux",identity:"linux"}]}},function(e,t,r){var i,a;!function(r){"use strict";var s={};s.Constants={},s.Math={},s.Accumulator={},function(e){e.WGS84={a:6378137,f:1/298.257223563},e.version={major:1,minor:48,patch:0},e.version_string="1.48"}(s.Constants),function(e){e.digits=53,e.epsilon=Math.pow(.5,e.digits-1),e.degree=Math.PI/180,e.sq=function(e){return e*e},e.hypot=function(e,t){var r,i;return e=Math.abs(e),t=Math.abs(t),r=Math.max(e,t),i=Math.min(e,t)/(r||1),r*Math.sqrt(1+i*i)},e.cbrt=function(e){var t=Math.pow(Math.abs(e),1/3);return e<0?-t:t},e.log1p=function(e){var t=1+e,r=t-1;return 0===r?e:e*Math.log(t)/r},e.atanh=function(t){var r=Math.abs(t);return r=e.log1p(2*r/(1-r))/2,t<0?-r:r},e.copysign=function(e,t){return Math.abs(e)*(t<0||0===t&&1/t<0?-1:1)},e.sum=function(e,t){var r,i=e+t,a=i-t,s=i-a;return a-=e,s-=t,r=-(a+s),{s:i,t:r}},e.polyval=function(e,t,r,i){for(var a=e<0?0:t[r++];--e>=0;)a=a*i+t[r++];return a},e.AngRound=function(e){if(0===e)return e;var t=1/16,r=Math.abs(e);return r=r<t?t-(t-r):r,e<0?-r:r},e.AngNormalize=function(e){return e%=360,e<=-180?e+360:e<=180?e:e-360},e.LatFix=function(e){return Math.abs(e)>90?Number.NaN:e},e.AngDiff=function(t,r){var i=e.sum(e.AngNormalize(-t),e.AngNormalize(r)),a=e.AngNormalize(i.s),s=i.t;return e.sum(180===a&&s>0?-180:a,s)},e.sincosd=function(e){var t,r,i,a,s,n;switch(t=e%360,r=Math.floor(t/90+.5),t-=90*r,t*=this.degree,i=Math.sin(t),a=Math.cos(t),3&r){case 0:s=i,n=a;break;case 1:s=a,n=-i;break;case 2:s=-i,n=-a;break;default:s=-a,n=i}return e&&(s+=0,n+=0),{s:s,c:n}},e.atan2d=function(e,t){var r,i,a=0;switch(Math.abs(e)>Math.abs(t)&&(r=t,t=e,e=r,a=2),t<0&&(t=-t,++a),i=Math.atan2(e,t)/this.degree,a){case 1:i=(e>=0?180:-180)-i;break;case 2:i=90-i;break;case 3:i=-90+i}return i}}(s.Math),function(e,t){e.Accumulator=function(e){this.Set(e)},e.Accumulator.prototype.Set=function(t){t||(t=0),t.constructor===e.Accumulator?(this._s=t._s,this._t=t._t):(this._s=t,this._t=0)},e.Accumulator.prototype.Add=function(e){var r=t.sum(e,this._t),i=t.sum(r.s,this._s);r=r.t,this._s=i.s,this._t=i.t,0===this._s?this._s=r:this._t+=r},e.Accumulator.prototype.Sum=function(t){var r;return t?(r=new e.Accumulator(this),r.Add(t),r._s):this._s},e.Accumulator.prototype.Negate=function(){this._s*=-1,this._t*=-1}}(s.Accumulator,s.Math),s.Geodesic={},s.GeodesicLine={},s.PolygonArea={},function(e,t,r,i,a){var s,n,o,h,l,u,c,d,p,f,m,g=20+i.digits+10,v=i.epsilon,y=200*v,b=Math.sqrt(v),x=v*y,M=1e3*b;e.tiny_=Math.sqrt(Number.MIN_VALUE),e.nC1_=6,e.nC1p_=6,e.nC2_=6,e.nC3_=6,e.nC4_=6,s=e.nC3_*(e.nC3_-1)/2,n=e.nC4_*(e.nC4_+1)/2,e.CAP_C1=1,e.CAP_C1p=2,e.CAP_C2=4,e.CAP_C3=8,e.CAP_C4=16,e.NONE=0,e.ARC=64,e.LATITUDE=128,e.LONGITUDE=256|e.CAP_C3,e.AZIMUTH=512,e.DISTANCE=1024|e.CAP_C1,e.STANDARD=e.LATITUDE|e.LONGITUDE|e.AZIMUTH|e.DISTANCE,e.DISTANCE_IN=2048|e.CAP_C1|e.CAP_C1p,e.REDUCEDLENGTH=4096|e.CAP_C1|e.CAP_C2,e.GEODESICSCALE=8192|e.CAP_C1|e.CAP_C2,e.AREA=16384|e.CAP_C4,e.ALL=32671,e.LONG_UNROLL=32768,e.OUT_MASK=32640|e.LONG_UNROLL,e.SinCosSeries=function(e,t,r,i){var a=i.length,s=a-(e?1:0),n=2*(r-t)*(r+t),o=1&s?i[--a]:0,h=0;for(s=Math.floor(s/2);s--;)h=n*o-h+i[--a],o=n*h-o+i[--a];return e?2*t*r*o:r*(o-h)},o=function(e,t){var r,a,s,n,o,h,l,u,c,d,p,f,m=i.sq(e),g=i.sq(t),v=(m+g-1)/6;return 0===g&&v<=0?r=0:(a=m*g/4,s=i.sq(v),n=v*s,o=a*(a+2*n),h=v,o>=0?(l=a+n,l+=l<0?-Math.sqrt(o):Math.sqrt(o),u=i.cbrt(l),h+=u+(0!==u?s/u:0)):(c=Math.atan2(Math.sqrt(-o),-(a+n)),h+=2*v*Math.cos(c/3)),d=Math.sqrt(i.sq(h)+g),p=h<0?g/(d-h):h+d,f=(p-g)/(2*d),r=p/(Math.sqrt(p+i.sq(f))+f)),r},h=[1,4,64,0,256],e.A1m1f=function(e){var t=Math.floor(3);return(i.polyval(t,h,0,i.sq(e))/h[t+1]+e)/(1-e)},l=[-1,6,-16,32,-9,64,-128,2048,9,-16,768,3,-5,512,-7,1280,-7,2048],e.C1f=function(t,r){var a,s,n=i.sq(t),o=t,h=0;for(a=1;a<=e.nC1_;++a)s=Math.floor((e.nC1_-a)/2),r[a]=o*i.polyval(s,l,h,n)/l[h+s+1],h+=s+2,o*=t},u=[205,-432,768,1536,4005,-4736,3840,12288,-225,116,384,-7173,2695,7680,3467,7680,38081,61440],e.C1pf=function(t,r){var a,s,n=i.sq(t),o=t,h=0;for(a=1;a<=e.nC1p_;++a)s=Math.floor((e.nC1p_-a)/2),r[a]=o*i.polyval(s,u,h,n)/u[h+s+1],h+=s+2,o*=t},c=[-11,-28,-192,0,256],e.A2m1f=function(e){var t=Math.floor(3);return(i.polyval(t,c,0,i.sq(e))/c[t+1]-e)/(1+e)},d=[1,2,16,32,35,64,384,2048,15,80,768,7,35,512,63,1280,77,2048],e.C2f=function(t,r){var a,s,n=i.sq(t),o=t,h=0;for(a=1;a<=e.nC2_;++a)s=Math.floor((e.nC2_-a)/2),r[a]=o*i.polyval(s,d,h,n)/d[h+s+1],h+=s+2,o*=t},e.Geodesic=function(e,t){if(this.a=e,this.f=t,this._f1=1-this.f,this._e2=this.f*(2-this.f),this._ep2=this._e2/i.sq(this._f1),this._n=this.f/(2-this.f),this._b=this.a*this._f1,this._c2=(i.sq(this.a)+i.sq(this._b)*(0===this._e2?1:(this._e2>0?i.atanh(Math.sqrt(this._e2)):Math.atan(Math.sqrt(-this._e2)))/Math.sqrt(Math.abs(this._e2))))/2,this._etol2=.1*b/Math.sqrt(Math.max(.001,Math.abs(this.f))*Math.min(1,1-this.f/2)/2),!(isFinite(this.a)&&this.a>0))throw new Error("Equatorial radius is not positive");if(!(isFinite(this._b)&&this._b>0))throw new Error("Polar semi-axis is not positive");this._A3x=new Array(6),this._C3x=new Array(s),this._C4x=new Array(n),this.A3coeff(),this.C3coeff(),this.C4coeff()},p=[-3,128,-2,-3,64,-1,-3,-1,16,3,-1,-2,8,1,-1,2,1,1],e.Geodesic.prototype.A3coeff=function(){var e,t,r=0,a=0;for(e=5;e>=0;--e)t=Math.min(6-e-1,e),this._A3x[a++]=i.polyval(t,p,r,this._n)/p[r+t+1],r+=t+2},f=[3,128,2,5,128,-1,3,3,64,-1,0,1,8,-1,1,4,5,256,1,3,128,-3,-2,3,64,1,-3,2,32,7,512,-10,9,384,5,-9,5,192,7,512,-14,7,512,21,2560],e.Geodesic.prototype.C3coeff=function(){var t,r,a,s=0,n=0;for(t=1;t<e.nC3_;++t)for(r=e.nC3_-1;r>=t;--r)a=Math.min(e.nC3_-r-1,r),this._C3x[n++]=i.polyval(a,f,s,this._n)/f[s+a+1],s+=a+2},m=[97,15015,1088,156,45045,-224,-4784,1573,45045,-10656,14144,-4576,-858,45045,64,624,-4576,6864,-3003,15015,100,208,572,3432,-12012,30030,45045,1,9009,-2944,468,135135,5792,1040,-1287,135135,5952,-11648,9152,-2574,135135,-64,-624,4576,-6864,3003,135135,8,10725,1856,-936,225225,-8448,4992,-1144,225225,-1440,4160,-4576,1716,225225,-136,63063,1024,-208,105105,3584,-3328,1144,315315,-128,135135,-2560,832,405405,128,99099],e.Geodesic.prototype.C4coeff=function(){var t,r,a,s=0,n=0;for(t=0;t<e.nC4_;++t)for(r=e.nC4_-1;r>=t;--r)a=e.nC4_-r-1,this._C4x[n++]=i.polyval(a,m,s,this._n)/m[s+a+1],s+=a+2},e.Geodesic.prototype.A3f=function(e){return i.polyval(5,this._A3x,0,e)},e.Geodesic.prototype.C3f=function(t,r){var a,s,n=1,o=0;for(a=1;a<e.nC3_;++a)s=e.nC3_-a-1,n*=t,r[a]=n*i.polyval(s,this._C3x,o,t),o+=s+1},e.Geodesic.prototype.C4f=function(t,r){var a,s,n=1,o=0;for(a=0;a<e.nC4_;++a)s=e.nC4_-a-1,r[a]=n*i.polyval(s,this._C4x,o,t),o+=s+1,n*=t},e.Geodesic.prototype.Lengths=function(t,r,i,a,s,n,o,h,l,u,c,d,p){c&=e.OUT_MASK;var f,m,g,v,y,b={},x=0,M=0,S=0,w=0;if(c&(e.DISTANCE|e.REDUCEDLENGTH|e.GEODESICSCALE)&&(S=e.A1m1f(t),e.C1f(t,d),c&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(w=e.A2m1f(t),e.C2f(t,p),x=S-w,w=1+w),S=1+S),c&e.DISTANCE)f=e.SinCosSeries(!0,n,o,d)-e.SinCosSeries(!0,i,a,d),b.s12b=S*(r+f),c&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(m=e.SinCosSeries(!0,n,o,p)-e.SinCosSeries(!0,i,a,p),M=x*r+(S*f-w*m));else if(c&(e.REDUCEDLENGTH|e.GEODESICSCALE)){for(g=1;g<=e.nC2_;++g)p[g]=S*d[g]-w*p[g];M=x*r+(e.SinCosSeries(!0,n,o,p)-e.SinCosSeries(!0,i,a,p))}return c&e.REDUCEDLENGTH&&(b.m0=x,b.m12b=h*(a*n)-s*(i*o)-a*o*M),c&e.GEODESICSCALE&&(v=a*o+i*n,y=this._ep2*(l-u)*(l+u)/(s+h),b.M12=v+(y*n-o*M)*i/s,b.M21=v-(y*i-a*M)*n/h),b},e.Geodesic.prototype.InverseStart=function(t,r,a,s,n,h,l,u,c,d,p){var f,m,g,v,b,x,S,w,A,T,C,P,F,L,E,I,N,B,_,R,k,z,U,D={},G=s*r-n*t,V=n*r+s*t;return D.sig12=-1,f=s*r,f+=n*t,m=V>=0&&G<.5&&n*l<.5,m?(v=i.sq(t+s),v/=v+i.sq(r+n),D.dnm=Math.sqrt(1+this._ep2*v),g=l/(this._f1*D.dnm),b=Math.sin(g),x=Math.cos(g)):(b=u,x=c),D.salp1=n*b,D.calp1=x>=0?G+n*t*i.sq(b)/(1+x):f-n*t*i.sq(b)/(1-x),w=i.hypot(D.salp1,D.calp1),A=t*s+r*n*x,m&&w<this._etol2?(D.salp2=r*b,D.calp2=G-r*s*(x>=0?i.sq(b)/(1+x):1-x),S=i.hypot(D.salp2,D.calp2),D.salp2/=S,D.calp2/=S,D.sig12=Math.atan2(w,A)):Math.abs(this._n)>.1||A>=0||w>=6*Math.abs(this._n)*Math.PI*i.sq(r)||(U=Math.atan2(-u,-c),this.f>=0?(L=i.sq(t)*this._ep2,E=L/(2*(1+Math.sqrt(1+L))+L),P=this.f*r*this.A3f(E)*Math.PI,F=P*r,T=U/P,C=f/F):(I=n*r-s*t,N=Math.atan2(f,I),R=this.Lengths(this._n,Math.PI+N,t,-r,a,s,n,h,r,n,e.REDUCEDLENGTH,d,p),B=R.m12b,_=R.m0,T=B/(r*n*_*Math.PI)-1,F=T<-.01?f/T:-this.f*i.sq(r)*Math.PI,P=F/r,C=l/P),C>-y&&T>-1-M?this.f>=0?(D.salp1=Math.min(1,-T),D.calp1=-Math.sqrt(1-i.sq(D.salp1))):(D.calp1=Math.max(T>-y?0:-1,T),D.salp1=Math.sqrt(1-i.sq(D.calp1))):(k=o(T,C),z=P*(this.f>=0?-T*k/(1+k):-C*(1+k)/k),b=Math.sin(z),x=-Math.cos(z),D.salp1=n*b,D.calp1=f-n*t*i.sq(b)/(1-x))),D.salp1<=0?(D.salp1=1,D.calp1=0):(S=i.hypot(D.salp1,D.calp1),D.salp1/=S,D.calp1/=S),D},e.Geodesic.prototype.Lambda12=function(t,r,a,s,n,o,h,l,u,c,d,p,f,m){var g,v,y,b,x,M,S,w,A,T,C,P,F,L={};return 0===t&&0===l&&(l=-e.tiny_),v=h*r,y=i.hypot(l,h*t),L.ssig1=t,b=v*t,L.csig1=x=l*r,g=i.hypot(L.ssig1,L.csig1),L.ssig1/=g,L.csig1/=g,L.salp2=n!==r?v/n:h,L.calp2=n!==r||Math.abs(s)!==-t?Math.sqrt(i.sq(l*r)+(r<-t?(n-r)*(r+n):(t-s)*(t+s)))/n:Math.abs(l),L.ssig2=s,M=v*s,L.csig2=S=L.calp2*n,g=i.hypot(L.ssig2,L.csig2),L.ssig2/=g,L.csig2/=g,L.sig12=Math.atan2(Math.max(0,L.csig1*L.ssig2-L.ssig1*L.csig2),L.csig1*L.csig2+L.ssig1*L.ssig2),w=Math.max(0,x*M-b*S),A=x*S+b*M,C=Math.atan2(w*c-A*u,A*c+w*u),P=i.sq(y)*this._ep2,L.eps=P/(2*(1+Math.sqrt(1+P))+P),this.C3f(L.eps,m),T=e.SinCosSeries(!0,L.ssig2,L.csig2,m)-e.SinCosSeries(!0,L.ssig1,L.csig1,m),L.domg12=-this.f*this.A3f(L.eps)*v*(L.sig12+T),L.lam12=C+L.domg12,d&&(0===L.calp2?L.dlam12=-2*this._f1*a/t:(F=this.Lengths(L.eps,L.sig12,L.ssig1,L.csig1,a,L.ssig2,L.csig2,o,r,n,e.REDUCEDLENGTH,p,f),L.dlam12=F.m12b,L.dlam12*=this._f1/(L.calp2*n))),L},e.Geodesic.prototype.Inverse=function(t,r,a,s,n){var o,h;return n||(n=e.STANDARD),n===e.LONG_UNROLL&&(n|=e.STANDARD),n&=e.OUT_MASK,o=this.InverseInt(t,r,a,s,n),h=o.vals,n&e.AZIMUTH&&(h.azi1=i.atan2d(o.salp1,o.calp1),h.azi2=i.atan2d(o.salp2,o.calp2)),h},e.Geodesic.prototype.InverseInt=function(t,r,a,s,n){var o,h,l,u,c,d,p,f,m,y,b,M,S,w,A,T,C,P,F,L,E,I,N,B,_,R,k,z,U,D,G,V,O,j,H,q,J,X,W,Y,Z,Q,K,$,ee,te,re,ie,ae,se,ne,oe,he,le,ue,ce,de,pe,fe,me,ge,ve,ye,be,xe,Me={};if(Me.lat1=t=i.LatFix(t),Me.lat2=a=i.LatFix(a),t=i.AngRound(t),a=i.AngRound(a),o=i.AngDiff(r,s),h=o.t,o=o.s,n&e.LONG_UNROLL?(Me.lon1=r,Me.lon2=r+o+h):(Me.lon1=i.AngNormalize(r),Me.lon2=i.AngNormalize(s)),l=o>=0?1:-1,o=l*i.AngRound(o),h=i.AngRound(180-o-l*h),A=o*i.degree,u=i.sincosd(o>90?h:o),T=u.s,C=(o>90?-1:1)*u.c,c=Math.abs(t)<Math.abs(a)?-1:1,c<0&&(l*=-1,u=t,t=a,a=u),d=t<0?1:-1,t*=d,a*=d,u=i.sincosd(t),p=this._f1*u.s,f=u.c,u=i.hypot(p,f),p/=u,f/=u,f=Math.max(e.tiny_,f),u=i.sincosd(a),m=this._f1*u.s,y=u.c,u=i.hypot(m,y),m/=u,y/=u,y=Math.max(e.tiny_,y),f<-p?y===f&&(m=m<0?p:-p):Math.abs(m)===-p&&(y=f),S=Math.sqrt(1+this._ep2*i.sq(p)),w=Math.sqrt(1+this._ep2*i.sq(m)),N=new Array(e.nC1_+1),B=new Array(e.nC2_+1),_=new Array(e.nC3_),R=-90===t||0===T,R&&(F=C,L=T,E=1,I=0,z=p,U=F*f,D=m,G=E*y,P=Math.atan2(Math.max(0,U*D-z*G),U*G+z*D),k=this.Lengths(this._n,P,z,U,S,D,G,w,f,y,n|e.DISTANCE|e.REDUCEDLENGTH,N,B),b=k.s12b,M=k.m12b,0!=(n&e.GEODESICSCALE)&&(Me.M12=k.M12,Me.M21=k.M21),P<1||M>=0?(P<3*e.tiny_&&(P=M=b=0),M*=this._b,b*=this._b,Me.a12=P/i.degree):R=!1),de=2,!R&&0===p&&(this.f<=0||h>=180*this.f))F=E=0,L=I=1,b=this.a*A,P=O=A/this._f1,M=this._b*Math.sin(P),n&e.GEODESICSCALE&&(Me.M12=Me.M21=Math.cos(P)),Me.a12=o/this._f1;else if(!R)if(k=this.InverseStart(p,f,S,m,y,w,A,T,C,N,B),P=k.sig12,L=k.salp1,F=k.calp1,P>=0)I=k.salp2,E=k.calp2,j=k.dnm,b=P*this._b*j,M=i.sq(j)*this._b*Math.sin(P/j),n&e.GEODESICSCALE&&(Me.M12=Me.M21=Math.cos(P/j)),Me.a12=P/i.degree,O=A/(this._f1*j);else{for(H=0,q=e.tiny_,J=1,X=e.tiny_,W=-1,Y=!1,Z=!1;H<g&&(k=this.Lambda12(p,f,S,m,y,w,L,F,T,C,H<20,N,B,_),Q=k.lam12,I=k.salp2,E=k.calp2,P=k.sig12,z=k.ssig1,U=k.csig1,D=k.ssig2,G=k.csig2,V=k.eps,fe=k.domg12,K=k.dlam12,!Z&&Math.abs(Q)>=(Y?8:1)*v);++H)Q>0&&(H<20||F/L>W/X)?(X=L,W=F):Q<0&&(H<20||F/L<J/q)&&(q=L,J=F),H<20&&K>0&&($=-Q/K,ee=Math.sin($),te=Math.cos($),(re=L*te+F*ee)>0&&Math.abs($)<Math.PI)?(F=F*te-L*ee,L=re,u=i.hypot(L,F),L/=u,F/=u,Y=Math.abs(Q)<=16*v):(L=(q+X)/2,F=(J+W)/2,u=i.hypot(L,F),L/=u,F/=u,Y=!1,Z=Math.abs(q-L)+(J-F)<x||Math.abs(L-X)+(F-W)<x);ie=n|(n&(e.REDUCEDLENGTH|e.GEODESICSCALE)?e.DISTANCE:e.NONE),k=this.Lengths(V,P,z,U,S,D,G,w,f,y,ie,N,B),b=k.s12b,M=k.m12b,0!=(n&e.GEODESICSCALE)&&(Me.M12=k.M12,Me.M21=k.M21),M*=this._b,b*=this._b,Me.a12=P/i.degree,n&e.AREA&&(be=Math.sin(fe),xe=Math.cos(fe),de=T*xe-C*be,pe=C*xe+T*be)}return n&e.DISTANCE&&(Me.s12=0+b),n&e.REDUCEDLENGTH&&(Me.m12=0+M),n&e.AREA&&(ae=L*f,se=i.hypot(F,L*p),0!==se&&0!==ae?(z=p,U=F*f,D=m,G=E*y,oe=i.sq(se)*this._ep2,V=oe/(2*(1+Math.sqrt(1+oe))+oe),he=i.sq(this.a)*se*ae*this._e2,u=i.hypot(z,U),z/=u,U/=u,u=i.hypot(D,G),D/=u,G/=u,le=new Array(e.nC4_),this.C4f(V,le),ue=e.SinCosSeries(!1,z,U,le),ce=e.SinCosSeries(!1,D,G,le),Me.S12=he*(ce-ue)):Me.S12=0,!R&&de>1&&(de=Math.sin(O),pe=Math.cos(O)),!R&&pe>-.7071&&m-p<1.75?(fe=1+pe,me=1+f,ge=1+y,ne=2*Math.atan2(de*(p*ge+m*me),fe*(p*m+me*ge))):(ve=I*F-E*L,ye=E*F+I*L,0===ve&&ye<0&&(ve=e.tiny_*F,ye=-1),ne=Math.atan2(ve,ye)),Me.S12+=this._c2*ne,Me.S12*=c*l*d,Me.S12+=0),c<0&&(u=L,L=I,I=u,u=F,F=E,E=u,n&e.GEODESICSCALE&&(u=Me.M12,Me.M12=Me.M21,Me.M21=u)),L*=c*l,F*=c*d,I*=c*l,E*=c*d,{vals:Me,salp1:L,calp1:F,salp2:I,calp2:E}},e.Geodesic.prototype.GenDirect=function(r,i,a,s,n,o){var h;return o?o===e.LONG_UNROLL&&(o|=e.STANDARD):o=e.STANDARD,s||(o|=e.DISTANCE_IN),h=new t.GeodesicLine(this,r,i,a,o),h.GenPosition(s,n,o)},e.Geodesic.prototype.Direct=function(e,t,r,i,a){return this.GenDirect(e,t,r,!1,i,a)},e.Geodesic.prototype.ArcDirect=function(e,t,r,i,a){return this.GenDirect(e,t,r,!0,i,a)},e.Geodesic.prototype.Line=function(e,r,i,a){return new t.GeodesicLine(this,e,r,i,a)},e.Geodesic.prototype.DirectLine=function(e,t,r,i,a){return this.GenDirectLine(e,t,r,!1,i,a)},e.Geodesic.prototype.ArcDirectLine=function(e,t,r,i,a){return this.GenDirectLine(e,t,r,!0,i,a)},e.Geodesic.prototype.GenDirectLine=function(r,i,a,s,n,o){var h;return o||(o=e.STANDARD|e.DISTANCE_IN),s||(o|=e.DISTANCE_IN),h=new t.GeodesicLine(this,r,i,a,o),h.GenSetDistance(s,n),h},e.Geodesic.prototype.InverseLine=function(r,a,s,n,o){var h,l,u;return o||(o=e.STANDARD|e.DISTANCE_IN),h=this.InverseInt(r,a,s,n,e.ARC),u=i.atan2d(h.salp1,h.calp1),o&e.OUT_MASK&e.DISTANCE_IN&&(o|=e.DISTANCE),l=new t.GeodesicLine(this,r,a,u,o,h.salp1,h.calp1),l.SetArc(h.vals.a12),l},e.Geodesic.prototype.Polygon=function(e){return new r.PolygonArea(this,e)},e.WGS84=new e.Geodesic(a.WGS84.a,a.WGS84.f)}(s.Geodesic,s.GeodesicLine,s.PolygonArea,s.Math,s.Constants),function(e,t,r){t.GeodesicLine=function(t,i,a,s,n,o,h){var l,u,c,d,p,f;n||(n=e.STANDARD|e.DISTANCE_IN),this.a=t.a,this.f=t.f,this._b=t._b,this._c2=t._c2,this._f1=t._f1,this.caps=n|e.LATITUDE|e.AZIMUTH|e.LONG_UNROLL,this.lat1=r.LatFix(i),this.lon1=a,void 0===o||void 0===h?(this.azi1=r.AngNormalize(s),l=r.sincosd(r.AngRound(this.azi1)),this.salp1=l.s,this.calp1=l.c):(this.azi1=s,this.salp1=o,this.calp1=h),l=r.sincosd(r.AngRound(this.lat1)),c=this._f1*l.s,u=l.c,l=r.hypot(c,u),c/=l,u/=l,u=Math.max(e.tiny_,u),this._dn1=Math.sqrt(1+t._ep2*r.sq(c)),this._salp0=this.salp1*u,this._calp0=r.hypot(this.calp1,this.salp1*c),this._ssig1=c,this._somg1=this._salp0*c,this._csig1=this._comg1=0!==c||0!==this.calp1?u*this.calp1:1,l=r.hypot(this._ssig1,this._csig1),this._ssig1/=l,this._csig1/=l,this._k2=r.sq(this._calp0)*t._ep2,d=this._k2/(2*(1+Math.sqrt(1+this._k2))+this._k2),this.caps&e.CAP_C1&&(this._A1m1=e.A1m1f(d),this._C1a=new Array(e.nC1_+1),e.C1f(d,this._C1a),this._B11=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C1a),p=Math.sin(this._B11),f=Math.cos(this._B11),this._stau1=this._ssig1*f+this._csig1*p,this._ctau1=this._csig1*f-this._ssig1*p),this.caps&e.CAP_C1p&&(this._C1pa=new Array(e.nC1p_+1),e.C1pf(d,this._C1pa)),this.caps&e.CAP_C2&&(this._A2m1=e.A2m1f(d),this._C2a=new Array(e.nC2_+1),e.C2f(d,this._C2a),this._B21=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C2a)),this.caps&e.CAP_C3&&(this._C3a=new Array(e.nC3_),t.C3f(d,this._C3a),this._A3c=-this.f*this._salp0*t.A3f(d),this._B31=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C3a)),this.caps&e.CAP_C4&&(this._C4a=new Array(e.nC4_),t.C4f(d,this._C4a),this._A4=r.sq(this.a)*this._calp0*this._salp0*t._e2,this._B41=e.SinCosSeries(!1,this._ssig1,this._csig1,this._C4a)),this.a13=this.s13=Number.NaN},t.GeodesicLine.prototype.GenPosition=function(t,i,a){var s,n,o,h,l,u,c,d,p,f,m,g,v,y,b,x,M,S,w,A,T,C,P,F,L,E,I,N,B,_={};return a?a===e.LONG_UNROLL&&(a|=e.STANDARD):a=e.STANDARD,a&=this.caps&e.OUT_MASK,_.lat1=this.lat1,_.azi1=this.azi1,_.lon1=a&e.LONG_UNROLL?this.lon1:r.AngNormalize(this.lon1),t?_.a12=i:_.s12=i,t||this.caps&e.DISTANCE_IN&e.OUT_MASK?(h=0,l=0,t?(s=i*r.degree,E=r.sincosd(i),n=E.s,o=E.c):(d=i/(this._b*(1+this._A1m1)),p=Math.sin(d),f=Math.cos(d),h=-e.SinCosSeries(!0,this._stau1*f+this._ctau1*p,this._ctau1*f-this._stau1*p,this._C1pa),s=d-(h-this._B11),n=Math.sin(s),o=Math.cos(s),Math.abs(this.f)>.01&&(u=this._ssig1*o+this._csig1*n,c=this._csig1*o-this._ssig1*n,h=e.SinCosSeries(!0,u,c,this._C1a),m=(1+this._A1m1)*(s+(h-this._B11))-i/this._b,s-=m/Math.sqrt(1+this._k2*r.sq(u)),n=Math.sin(s),o=Math.cos(s))),u=this._ssig1*o+this._csig1*n,c=this._csig1*o-this._ssig1*n,C=Math.sqrt(1+this._k2*r.sq(u)),a&(e.DISTANCE|e.REDUCEDLENGTH|e.GEODESICSCALE)&&((t||Math.abs(this.f)>.01)&&(h=e.SinCosSeries(!0,u,c,this._C1a)),l=(1+this._A1m1)*(h-this._B11)),x=this._calp0*u,M=r.hypot(this._salp0,this._calp0*c),0===M&&(M=c=e.tiny_),A=this._salp0,T=this._calp0*c,t&&a&e.DISTANCE&&(_.s12=this._b*((1+this._A1m1)*s+l)),a&e.LONGITUDE&&(S=this._salp0*u,w=c,b=r.copysign(1,this._salp0),g=a&e.LONG_UNROLL?b*(s-(Math.atan2(u,c)-Math.atan2(this._ssig1,this._csig1))+(Math.atan2(b*S,w)-Math.atan2(b*this._somg1,this._comg1))):Math.atan2(S*this._comg1-w*this._somg1,w*this._comg1+S*this._somg1),v=g+this._A3c*(s+(e.SinCosSeries(!0,u,c,this._C3a)-this._B31)),y=v/r.degree,_.lon2=a&e.LONG_UNROLL?this.lon1+y:r.AngNormalize(r.AngNormalize(this.lon1)+r.AngNormalize(y))),a&e.LATITUDE&&(_.lat2=r.atan2d(x,this._f1*M)),a&e.AZIMUTH&&(_.azi2=r.atan2d(A,T)),a&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(P=e.SinCosSeries(!0,u,c,this._C2a),F=(1+this._A2m1)*(P-this._B21),L=(this._A1m1-this._A2m1)*s+(l-F),a&e.REDUCEDLENGTH&&(_.m12=this._b*(C*(this._csig1*u)-this._dn1*(this._ssig1*c)-this._csig1*c*L)),a&e.GEODESICSCALE&&(E=this._k2*(u-this._ssig1)*(u+this._ssig1)/(this._dn1+C),_.M12=o+(E*u-c*L)*this._ssig1/this._dn1,_.M21=o-(E*this._ssig1-this._csig1*L)*u/C)),a&e.AREA&&(I=e.SinCosSeries(!1,u,c,this._C4a),0===this._calp0||0===this._salp0?(N=A*this.calp1-T*this.salp1,B=T*this.calp1+A*this.salp1):(N=this._calp0*this._salp0*(o<=0?this._csig1*(1-o)+n*this._ssig1:n*(this._csig1*n/(1+o)+this._ssig1)),B=r.sq(this._salp0)+r.sq(this._calp0)*this._csig1*c),_.S12=this._c2*Math.atan2(N,B)+this._A4*(I-this._B41)),t||(_.a12=s/r.degree),_):(_.a12=Number.NaN,_)},t.GeodesicLine.prototype.Position=function(e,t){return this.GenPosition(!1,e,t)},t.GeodesicLine.prototype.ArcPosition=function(e,t){return this.GenPosition(!0,e,t)},t.GeodesicLine.prototype.GenSetDistance=function(e,t){e?this.SetArc(t):this.SetDistance(t)},t.GeodesicLine.prototype.SetDistance=function(t){var r;this.s13=t,r=this.GenPosition(!1,this.s13,e.ARC),this.a13=0+r.a12},t.GeodesicLine.prototype.SetArc=function(t){var r;this.a13=t,r=this.GenPosition(!0,this.a13,e.DISTANCE),this.s13=0+r.s12}}(s.Geodesic,s.GeodesicLine,s.Math),function(e,t,r,i){var a,s;a=function(e,t){var i;return e=r.AngNormalize(e),t=r.AngNormalize(t),i=r.AngDiff(e,t).s,e<=0&&t>0&&i>0?1:t<=0&&e>0&&i<0?-1:0},s=function(e,t){return e%=720,t%=720,(t>=0&&t<360||t<-360?0:1)-(e>=0&&e<360||e<-360?0:1)},e.PolygonArea=function(e,r){this._geod=e,this.a=this._geod.a,this.f=this._geod.f,this._area0=4*Math.PI*e._c2,this.polyline=r||!1,this._mask=t.LATITUDE|t.LONGITUDE|t.DISTANCE|(this.polyline?t.NONE:t.AREA|t.LONG_UNROLL),this.polyline||(this._areasum=new i.Accumulator(0)),this._perimetersum=new i.Accumulator(0),this.Clear()},e.PolygonArea.prototype.Clear=function(){this.num=0,this._crossings=0,this.polyline||this._areasum.Set(0),this._perimetersum.Set(0),this._lat0=this._lon0=this.lat=this.lon=Number.NaN},e.PolygonArea.prototype.AddPoint=function(e,t){var r;0===this.num?(this._lat0=this.lat=e,this._lon0=this.lon=t):(r=this._geod.Inverse(this.lat,this.lon,e,t,this._mask),this._perimetersum.Add(r.s12),this.polyline||(this._areasum.Add(r.S12),this._crossings+=a(this.lon,t)),this.lat=e,this.lon=t),++this.num},e.PolygonArea.prototype.AddEdge=function(e,t){var r;this.num&&(r=this._geod.Direct(this.lat,this.lon,e,t,this._mask),this._perimetersum.Add(t),this.polyline||(this._areasum.Add(r.S12),this._crossings+=s(this.lon,r.lon2)),this.lat=r.lat2,this.lon=r.lon2),++this.num},e.PolygonArea.prototype.Compute=function(e,t){var r,s,n,o={number:this.num};return this.num<2?(o.perimeter=0,this.polyline||(o.area=0),o):this.polyline?(o.perimeter=this._perimetersum.Sum(),o):(r=this._geod.Inverse(this.lat,this.lon,this._lat0,this._lon0,this._mask),o.perimeter=this._perimetersum.Sum(r.s12),s=new i.Accumulator(this._areasum),s.Add(r.S12),n=this._crossings+a(this.lon,this._lon0),1&n&&s.Add((s.Sum()<0?1:-1)*this._area0/2),e||s.Negate(),t?s.Sum()>this._area0/2?s.Add(-this._area0):s.Sum()<=-this._area0/2&&s.Add(+this._area0):s.Sum()>=this._area0?s.Add(-this._area0):s<0&&s.Add(-this._area0),o.area=s.Sum(),o)},e.PolygonArea.prototype.TestPoint=function(e,t,r,i){var s,n,o,h,l={number:this.num+1};if(0===this.num)return l.perimeter=0,this.polyline||(l.area=0),l;for(l.perimeter=this._perimetersum.Sum(),n=this.polyline?0:this._areasum.Sum(),o=this._crossings,h=0;h<(this.polyline?1:2);++h)s=this._geod.Inverse(0===h?this.lat:e,0===h?this.lon:t,0!==h?this._lat0:e,0!==h?this._lon0:t,this._mask),l.perimeter+=s.s12,this.polyline||(n+=s.S12,o+=a(0===h?this.lon:t,0!==h?this._lon0:t));return this.polyline?l:(1&o&&(n+=(n<0?1:-1)*this._area0/2),r||(n*=-1),i?n>this._area0/2?n-=this._area0:n<=-this._area0/2&&(n+=this._area0):n>=this._area0?n-=this._area0:n<0&&(n+=this._area0),l.area=n,l)},e.PolygonArea.prototype.TestEdge=function(e,t,r,i){var n,o,h,l={number:this.num?this.num+1:0};return 0===this.num?l:(l.perimeter=this._perimetersum.Sum()+t,this.polyline?l:(o=this._areasum.Sum(),h=this._crossings,n=this._geod.Direct(this.lat,this.lon,e,t,this._mask),o+=n.S12,h+=s(this.lon,n.lon2),n=this._geod.Inverse(n.lat2,n.lon2,this._lat0,this._lon0,this._mask),l.perimeter+=n.s12,o+=n.S12,h+=a(n.lon2,this._lon0),1&h&&(o+=(o<0?1:-1)*this._area0/2),r||(o*=-1),i?o>this._area0/2?o-=this._area0:o<=-this._area0/2&&(o+=this._area0):o>=this._area0?o-=this._area0:o<0&&(o+=this._area0),l.area=o,l))}}(s.PolygonArea,s.Geodesic,s.Math,s.Accumulator),s.DMS={},function(e){var t,r,i,a,s="SNWE",n="°'\"",o=["degrees","minutes","seconds"];t=function(e,t){return e.indexOf(t.toUpperCase())},r=function(e,t){return String("0000").substr(0,Math.max(0,Math.min(4,t-e.length)))+e},e.NONE=0,e.LATITUDE=1,e.LONGITUDE=2,e.AZIMUTH=3,e.DEGREE=0,e.MINUTE=1,e.SECOND=2,e.Decode=function(r){var a,n,o,h,l,u,c,d,p=r,f=0,m=0,g=e.NONE;for(p=p.replace(/\u00b0/g,"d").replace(/\u00ba/g,"d").replace(/\u2070/g,"d").replace(/\u02da/g,"d").replace(/\u2032/g,"'").replace(/\u00b4/g,"'").replace(/\u2019/g,"'").replace(/\u2033/g,'"').replace(/\u201d/g,'"').replace(/\u2212/g,"-").replace(/''/g,'"').trim(),a=p.length,u=0;u<a;u=d,++m)if(c=u,0===m&&t(s,p.charAt(c))>=0&&++c,(m>0||c<a&&t("-+",p.charAt(c))>=0)&&++c,n=p.substr(c,a-c).indexOf("-"),o=p.substr(c,a-c).indexOf("+"),n<0?n=a:n+=c,o<0?o=a:o+=c,d=Math.min(n,o),h=i(p.substr(u,d-u)),f+=h.val,l=h.ind,g==e.NONE)g=l;else if(l!=e.NONE&&g!=l)throw new Error("Incompatible hemisphere specifies in "+p.substr(0,d));if(0===m)throw new Error("Empty or incomplete DMS string "+p);return{val:f,ind:g}},i=function(r){var i,n,h,l,u,c,d,p,f,m,g,v,y,b,x,M,S={},w="";do{if(i=1,n=0,h=r.length,l=e.NONE,u=-1,h>n&&(u=t(s,r.charAt(n)))>=0&&(l=2&u?e.LONGITUDE:e.LATITUDE,i=1&u?1:-1,++n),h>n&&(u=t(s,r.charAt(h-1)))>=0&&u>=0){if(l!==e.NONE){w=r.charAt(n-1).toUpperCase()===r.charAt(h-1).toUpperCase()?"Repeated hemisphere indicators "+r.charAt(n-1)+" in "+r.substr(n-1,h-n+1):"Contradictory hemisphere indicators "+r.charAt(n-1)+" and "+r.charAt(h-1)+" in "+r.substr(n-1,h-n+1);break}l=2&u?e.LONGITUDE:e.LATITUDE,i=1&u?1:-1,--h}if(h>n&&(u=t("-+",r.charAt(n)))>=0&&u>=0&&(i*=u?1:-1,++n),h===n){w="Empty or incomplete DMS string "+r;break}for(c=[0,0,0],d=[0,0,0],p=0,f=0,m=0,g=0,v=n,y=!1,b=0,x=0;v<h;)if(M=r.charAt(v++),(u=t("0123456789",M))>=0)++g,b>0?++b:(f=10*f+u,++x);else if("."===M){if(y){w="Multiple decimal points in "+r.substr(n,h-n);break}y=!0,b=1}else{if(!((u=t("D'\":",M))>=0)){if(t("-+",M)>=0){w="Internal sign in DMS string "+r.substr(n,h-n);break}w="Illegal character "+M+" in DMS string "+r.substr(n,h-n);break}if(u>=3){if(v===h){w="Illegal for colon to appear at the end of "+r.substr(n,h-n);break}u=p}if(u===p-1){w="Repeated "+o[u]+" component in "+r.substr(n,h-n);break}if(u<p){w=o[u]+" component follows "+o[p-1]+" component in "+r.substr(n,h-n);break}if(0===g){w="Missing numbers in "+o[u]+" component of "+r.substr(n,h-n);break}b>0&&(m=parseFloat(r.substr(v-x-b-1,x+b)),f=0),c[u]=f,d[u]=f+m,v<h&&(p=u+1,f=m=0,g=b=x=0)}if(w.length)break;if(t("D'\":",r.charAt(v-1))<0){if(p>=3){w="Extra text following seconds in DMS string "+r.substr(n,h-n);break}if(0===g){w="Missing numbers in trailing component of "+r.substr(n,h-n);break}b>0&&(m=parseFloat(r.substr(v-x-b,x+b)),f=0),c[p]=f,d[p]=f+m}if(y&&0===b){w="Decimal point in non-terminal component of "+r.substr(n,h-n);break}if(c[1]>=60||d[1]>60){w="Minutes "+d[1]+" not in range [0,60)";break}if(c[2]>=60||d[2]>60){w="Seconds "+d[2]+" not in range [0,60)";break}return S.ind=l,S.val=i*(d[2]?(60*(60*d[0]+d[1])+d[2])/3600:d[1]?(60*d[0]+d[1])/60:d[0]),S}while(!1);if(S.val=a(r),0===S.val)throw new Error(w);return S.ind=e.NONE,S},a=function(e){var t,r,i,a;return e.length<3?0:(t=e.toUpperCase().replace(/0+$/,""),r="-"===t.charAt(0)?-1:1,i="-"===t.charAt(0)||"+"===t.charAt(0)?1:0,(a=t.length-1)+1<i+3?0:(t=t.substr(i,a+1-i),"NAN"===t||"1.#QNAN"===t||"1.#SNAN"===t||"1.#IND"===t||"1.#R"===t?Number.NaN:"INF"===t||"1.#INF"===t?r*Number.POSITIVE_INFINITY:0))},e.DecodeLatLon=function(t,r,i){var a,s,n={},o=e.Decode(t),h=e.Decode(r),l=o.val,u=o.ind,c=h.val,d=h.ind;if(i||(i=!1),u===e.NONE&&d===e.NONE?(u=i?e.LONGITUDE:e.LATITUDE,d=i?e.LATITUDE:e.LONGITUDE):u===e.NONE?u=e.LATITUDE+e.LONGITUDE-d:d===e.NONE&&(d=e.LATITUDE+e.LONGITUDE-u),u===d)throw new Error("Both "+t+" and "+r+" interpreted as "+(u===e.LATITUDE?"latitudes":"longitudes"));if(a=u===e.LATITUDE?l:c,s=u===e.LATITUDE?c:l,Math.abs(a)>90)throw new Error("Latitude "+a+" not in [-90,90]");return n.lat=a,n.lon=s,n},e.DecodeAngle=function(t){var r=e.Decode(t),i=r.val;if(r.ind!==e.NONE)throw new Error("Arc angle "+t+" includes a hemisphere N/E/W/S");return i},e.DecodeAzimuth=function(t){var r=e.Decode(t),i=r.val;if(r.ind===e.LATITUDE)throw new Error("Azimuth "+t+" has a latitude hemisphere N/S");return i},e.Encode=function(t,i,a,o){var h,l,u,c,d,p,f,m,g,v=1;if(o||(o=e.NONE),!isFinite(t))return t<0?String("-inf"):t>0?String("inf"):String("nan");for(a=Math.min(15-2*i,a),h=0;h<i;++h)v*=60;for(h=0;h<a;++h)v*=10;for(o===e.AZIMUTH&&(t-=360*Math.floor(t/360)),l=t<0?-1:1,t*=l,u=Math.floor(t),c=(t-u)*v+.5,d=Math.floor(c),c=d==c&&1&d?d-1:d,c/=v,c=Math.floor((t-u)*v+.5)/v,c>=1&&(u+=1,c-=1),p=[c,0,0],h=1;h<=i;++h)f=Math.floor(p[h-1]),m=p[h-1]-f,p[h]=60*m,p[h-1]=f;switch(p[0]+=u,g="",o===e.NONE&&l<0&&(g+="-"),i){case e.DEGREE:g+=r(p[0].toFixed(a),o===e.NONE?0:1+Math.min(o,2)+a+(a?1:0))+n.charAt(0);break;default:switch(g+=r(p[0].toFixed(0),o===e.NONE?0:1+Math.min(o,2))+n.charAt(0),i){case e.MINUTE:g+=r(p[1].toFixed(a),2+a+(a?1:0))+n.charAt(1);break;case e.SECOND:g+=r(p[1].toFixed(0),2)+n.charAt(1),g+=r(p[2].toFixed(a),2+a+(a?1:0))+n.charAt(2)}}return o!==e.NONE&&o!==e.AZIMUTH&&(g+=s.charAt((o===e.LATITUDE?0:2)+(l<0?0:1))),g}}(s.DMS),function(r){"object"==typeof e&&e.exports?e.exports=r:(i=[],void 0!==(a=function(){return r}.apply(t,i))&&(e.exports=a))}(s)}()},function(e,t,r){"use strict";function i(e,t){if(!(this instanceof i))return new i(e);t=t||function(e){if(e)throw e};var n=r.i(a.a)(e);if("object"!=typeof n)return void t(e);var c=i.projections.get(n.projName);if(!c)return void t(e);if(n.datumCode&&"none"!==n.datumCode){var d=r.i(u.a)(h.a,n.datumCode);d&&(n.datum_params=d.towgs84?d.towgs84.split(","):null,n.ellps=d.ellipse,n.datumName=d.datumName?d.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84";var p=r.i(o.a)(n.a,n.b,n.rf,n.ellps,n.sphere),f=r.i(o.b)(p.a,p.b,p.rf,n.R_A),m=n.datum||r.i(l.a)(n.datumCode,n.datum_params,p.a,p.b,f.es,f.ep2);r.i(s.a)(this,n),r.i(s.a)(this,c),this.a=p.a,this.b=p.b,this.rf=p.rf,this.sphere=p.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=m,this.init(),t(null,this)}var a=r(81),s=r(79),n=r(82),o=r(78),h=r(71),l=r(76),u=r(29);i.projections=n.a,i.projections.start(),t.a=i},function(e,t,r){"use strict";t.a=function(e,t,r){var i=t*r;return e/Math.sqrt(1-i*i)}},function(e,t,r){"use strict";t.a=function(e,t,r,i,a){var s,n;s=e/t;for(var o=0;o<15;o++)if(n=(e-(t*s-r*Math.sin(2*s)+i*Math.sin(4*s)-a*Math.sin(6*s)))/(t-2*r*Math.cos(2*s)+4*i*Math.cos(4*s)-6*a*Math.cos(6*s)),s+=n,Math.abs(n)<=1e-10)return s;return NaN}},function(e,t,r){"use strict";t.a=function(e,t,r,i){return r*=t,t*=t,i[0]*e-r*(i[1]+t*(i[2]+t*(i[3]+t*i[4])))}},function(e,t,r){"use strict";t.a=function(e,t){var r;return e>1e-7?(r=e*t,(1-e*e)*(t/(1-r*r)-.5/e*Math.log((1-r)/(1+r)))):2*t}},function(e,t,r){"use strict";function i(e,t){if(e[t])return e[t];for(var r,i=Object.keys(e),s=t.toLowerCase().replace(a,""),n=-1;++n<i.length;)if(r=i[n],r.toLowerCase().replace(a,"")===s)return e[r]}t.a=i;var a=/[\s_\-\/\(\)]/g},function(e,t,r){"use strict";var i=r(4),a=i.a,s=function(e,t){this.map=e,this.id=t.id||null,this.notice=t.notice||null,this.copyrighted=t.copyrighted||!0,this.url=t.url||null,this.html=a.simpleWikiLinks(this.notice),this.plain=a.simpleWikiLinks(this.notice)};s.prototype.getInfo=function(){return{id:this.id,notice:this.notice,html:this.html,plain:this.plain}},t.a=s},function(e,t,r){"use strict";var i=r(3),a=i.a,s=function(e){e instanceof s?this.pos=e.pos.slice():(null!=e&&e instanceof Array?this.pos=e.slice():this.pos=[],this.validate())};s.prototype.clone=function(){return new s(this.pos)},s.prototype.getCoords=function(){return[this.pos[1],this.pos[2],this.pos[4]]},s.prototype.getCoords2=function(){return[this.pos[1],this.pos[2]]},s.prototype.setCoords=function(e){return this.pos[1]=e[0],this.pos[2]=e[1],this.pos[4]=e[2],this},s.prototype.setCoords2=function(e){return this.pos[1]=e[0],this.pos[2]=e[1],this},s.prototype.getHeight=function(){return this.pos[4]},s.prototype.setHeight=function(e){return this.pos[4]=e,this},s.prototype.getOrientation=function(){return[this.pos[5],this.pos[6],this.pos[7]]},s.prototype.setOrientation=function(e){return this.pos[5]=e[0],this.pos[6]=e[1],this.pos[7]=e[2],this},s.prototype.getFov=function(){return this.pos[9]},s.prototype.setFov=function(e){return this.pos[9]=e,this},s.prototype.getViewExtent=function(){return this.pos[8]},s.prototype.setViewExtent=function(e){return this.pos[8]=e,this},s.prototype.getViewDistance=function(){return.5*this.getViewExtent()/Math.tan(a.radians(.5*this.getFov()))},s.prototype.getViewMode=function(){return this.pos[0]},s.prototype.getHeightMode=function(){return this.pos[3]},s.prototype.check=function(){this.getViewMode(),this.pos[6]=a.clamp(this.pos[6],-90,90),this.pos[5]=this.pos[5]%360,this.pos[7]=this.pos[7]%360},s.prototype.isSame=function(e){return e=e.pos,this.pos[0]==e[0]&&a.isEqual(this.pos[1],e[1],1e-7)&&a.isEqual(this.pos[2],e[2],1e-7)&&this.pos[3]==e[3]&&a.isEqual(this.pos[4],e[4],.001)&&a.isEqual(this.pos[5],e[5],.001)&&a.isEqual(this.pos[6],e[6],.001)&&a.isEqual(this.pos[7],e[7],.001)&&a.isEqual(this.pos[8],e[8],.001)&&a.isEqual(this.pos[9],e[9],.001)},s.prototype.validate=function(){var e=this.pos;"fixed"==e[0]&&(e[0]="obj",e[9]=e[8],e[8]=e[7],e[7]=e[6],e[6]=e[5],e[5]=e[4],e[4]=e[3],e[3]="fix"),e[0]="obj"==e[0]||"subj"==e[0]?e[0]:"obj",e[1]=null!=e[1]?e[1]:0,e[2]=null!=e[2]?e[2]:0,e[3]="fix"==e[3]||"fixed"==e[3]||"float"==e[3]?e[3]:"float",e[4]=null!=e[4]?e[4]:0,e[5]=null!=e[5]?e[5]:0,e[6]=null!=e[6]?e[6]:-90,e[7]=null!=e[7]?e[7]:0,e[8]=null!=e[8]?e[8]:900,e[9]=null!=e[9]?e[9]:45,e[3]="fixed"==e[3]?"fix":e[3]},s.prototype.toString=function(){var e=this.pos;return e[0]+", "+e[1].toFixed(0)+", "+e[2].toFixed(0)+", "+e[3]+", "+e[4].toFixed(0)+", "+e[5].toFixed(0)+", "+e[6].toFixed(0)+", "+e[7].toFixed(0)+", , "+e[8].toFixed(0)+", "+e[9].toFixed(0)},s.prototype.toArray=function(){return this.pos.slice()},t.a=s},function(e,t,r){"use strict";var i=function(e,t,r,i){this.gpu=e,this.gl=e.gl,this.bbox=t.bbox,this.fileSize=r,this.core=i,this.vertexBuffer=null,this.uvBuffer=null,this.uv2Buffer=null;var a=t.vertices,s=t.uvs,n=t.uvs2,o=t.vertexSize||3,h=t.uvSize||2,l=t.uv2Size||2,u=this.gl;a&&u&&(this.vertexBuffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,this.vertexBuffer),u.bufferData(u.ARRAY_BUFFER,new Float32Array(a),u.STATIC_DRAW),this.vertexBuffer.itemSize=o,this.vertexBuffer.numItems=a.length/o,null!=s&&(this.uvBuffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,this.uvBuffer),u.bufferData(u.ARRAY_BUFFER,new Float32Array(s),u.STATIC_DRAW),this.uvBuffer.itemSize=h,this.uvBuffer.numItems=s.length/h),null!=n&&(this.uv2Buffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,this.uv2Buffer),u.bufferData(u.ARRAY_BUFFER,new Float32Array(n),u.STATIC_DRAW),this.uv2Buffer.itemSize=l,this.uv2Buffer.numItems=n.length/l),this.size=this.vertexBuffer.numItems*o*4,this.size+=null==s?0:this.uvBuffer.numItems*h*4,this.size+=null==n?0:this.uv2Buffer.numItems*l*4,this.polygons=this.vertexBuffer.numItems/3,this.valid=!0)};i.prototype.kill=function(){this.gl&&this.valid&&(this.vertexBuffer&&this.gl.deleteBuffer(this.vertexBuffer),this.uvBuffer&&this.gl.deleteBuffer(this.uvBuffer),this.uv2Buffer&&this.gl.deleteBuffer(this.uv2Buffer),this.vertexBuffer=null,this.uvBuffer=null,this.uv2Buffer=null)},i.prototype.draw=function(e,t,r,i,a){var s=this.gl;if(null!=s&&this.valid){var n=e.getAttribute(t);if(s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(n,this.vertexBuffer.itemSize,s.FLOAT,!1,0,0),this.uvBuffer&&r){var o=e.getAttribute(r);s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(o,this.uvBuffer.itemSize,s.FLOAT,!1,0,0)}if(this.uv2Buffer&&i){var h=e.getAttribute(i);s.bindBuffer(s.ARRAY_BUFFER,this.uv2Buffer),s.vertexAttribPointer(h,this.uv2Buffer.itemSize,s.FLOAT,!1,0,0)}if(a&&a){var l=e.getAttribute(a);-1!=l&&(s.bindBuffer(s.ARRAY_BUFFER,this.gpu.barycentricBuffer),s.vertexAttribPointer(l,this.gpu.barycentricBuffer.itemSize,s.FLOAT,!1,0,0))}s.drawArrays(s.TRIANGLES,0,this.vertexBuffer.numItems)}},i.prototype.size=function(){return this.size},i.prototype.bbox=function(){return this.bbox},i.prototype.getPolygons=function(){return this.polygons},t.a=i},function(e,t,r){"use strict";var i=function(e,t,r){this.gpu=e,this.gl=e.gl,this.vertex=t,this.fragment=r,this.program=null,this.uniformLocationCache=[],this.attributeLocationCache=[],this.m=new Float32Array(16),this.ready=!1,this.createProgram(t,r)};i.prototype.createShader=function(e,t){var r=this.gl;if(!e||!r)return null;var i;if(i=!0!==t?r.createShader(r.FRAGMENT_SHADER):r.createShader(r.VERTEX_SHADER),r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS)){var a=r.getShaderInfoLog(i);return console.log("An error occurred compiling the shaders: "+a),this.gpu.renderer.core.callListener("renderer-shader-error",{where:"compilation",info:a}),null}return i},i.prototype.createProgram=function(e,t){var r=this.gl;if(null!=r){var i=this.createShader(e,!0),a=this.createShader(t,!1);if(i&&a){var s=r.createProgram();r.attachShader(s,i),r.attachShader(s,a),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||(console.log("Unable to initialize the shader program."),this.gpu.renderer.core.callListener("renderer-shader-error",{where:"linking"})),r.useProgram(s),this.program=s,this.ready=!0}}},i.prototype.setSampler=function(e,t){var r=this.gl;if(null!=r&&null!=this.program){var i=this.getUniform(e);null!=i&&r.uniform1i(i,t)}},i.prototype.isReady=function(e,t){return this.ready},i.prototype.setMat4=function(e,t,r){var i=this.gl;if(null!=i&&null!=this.program){var a=this.getUniform(e);if(null!=a)if(r){r=2*(1+r)-1;var s=this.m;s[0]=t[0],s[1]=t[1],s[2]=t[2]*r,s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6]*r,s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10]*r,s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14]*r,s[15]=t[15],i.uniformMatrix4fv(a,!1,s)}else i.uniformMatrix4fv(a,!1,t)}},i.prototype.setMat3=function(e,t){var r=this.gl;if(null!=r&&null!=this.program){var i=this.getUniform(e);null!=i&&r.uniformMatrix3fv(i,!1,t)}},i.prototype.setVec2=function(e,t){var r=this.gl;if(null!=r&&null!=this.program){var i=this.getUniform(e);null!=i&&r.uniform2fv(i,t)}},i.prototype.setVec3=function(e,t){var r=this.gl;if(null!=r&&null!=this.program){var i=this.getUniform(e);null!=i&&r.uniform3fv(i,t)}},i.prototype.setVec4=function(e,t){var r=this.gl;if(null!=r&&null!=this.program){var i=this.getUniform(e);null!=i&&r.uniform4fv(i,t)}},i.prototype.setFloat=function(e,t){var r=this.gl;if(null!=r&&null!=this.program){var i=this.getUniform(e);null!=i&&r.uniform1f(i,t)}},i.prototype.setFloatArray=function(e,t){var r=this.gl;if(null!=r&&null!=this.program){var i=this.getUniform(e);null!=i&&r.uniform1fv(i,t)}},i.prototype.getAttribute=function(e){var t=this.gl;if(null!=t&&null!=this.program){if(null==this.attributeLocationCache[e]){var r=t.getAttribLocation(this.program,e);return this.attributeLocationCache[e]=r,r}return this.attributeLocationCache[e]}},i.prototype.getUniform=function(e){var t=this.gl;if(null!=t&&null!=this.program){if(null==this.uniformLocationCache[e]){var r=t.getUniformLocation(this.program,e);return this.uniformLocationCache[e]=r,r}return this.uniformLocationCache[e]}},t.a=i},function(e,t,r){"use strict";function i(e,t,r){r=r||2;var i=t&&t.length,s=i?t[0]*r:e.length,o=a(e,0,s,r,!0),h=[];if(!o)return h;var l,u,d,p,f,m,g;if(i&&(o=c(e,t,o,r)),e.length>80*r){l=d=e[0],u=p=e[1];for(var v=r;v<s;v+=r)f=e[v],m=e[v+1],f<l&&(l=f),m<u&&(u=m),f>d&&(d=f),m>p&&(p=m);g=Math.max(d-l,p-u)}return n(o,h,r,l,u,g),h}function a(e,t,r,i,a){var s,n;if(a===I(e,t,r,i)>0)for(s=t;s<r;s+=i)n=F(s,e[s],e[s+1],n);else for(s=r-i;s>=t;s-=i)n=F(s,e[s],e[s+1],n);return n&&S(n,n.next)&&(L(n),n=n.next),n}function s(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!S(i,i.next)&&0!==M(i.prev,i,i.next))i=i.next;else{if(L(i),(i=t=i.prev)===i.next)return null;r=!0}}while(r||i!==t);return t}function n(e,t,r,i,a,c,d){if(e){!d&&c&&m(e,i,a,c);for(var p,f,g=e;e.prev!==e.next;)if(p=e.prev,f=e.next,c?h(e,i,a,c):o(e))t.push(p.i/r),t.push(e.i/r),t.push(f.i/r),L(e),e=f.next,g=f.next;else if((e=f)===g){d?1===d?(e=l(e,t,r),n(e,t,r,i,a,c,2)):2===d&&u(e,t,r,i,a,c):n(s(e),t,r,i,a,c,1);break}}}function o(e){var t=e.prev,r=e,i=e.next;if(M(t,r,i)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(b(t.x,t.y,r.x,r.y,i.x,i.y,a.x,a.y)&&M(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function h(e,t,r,i){var a=e.prev,s=e,n=e.next;if(M(a,s,n)>=0)return!1;for(var o=a.x<s.x?a.x<n.x?a.x:n.x:s.x<n.x?s.x:n.x,h=a.y<s.y?a.y<n.y?a.y:n.y:s.y<n.y?s.y:n.y,l=a.x>s.x?a.x>n.x?a.x:n.x:s.x>n.x?s.x:n.x,u=a.y>s.y?a.y>n.y?a.y:n.y:s.y>n.y?s.y:n.y,c=v(o,h,t,r,i),d=v(l,u,t,r,i),p=e.nextZ;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&b(a.x,a.y,s.x,s.y,n.x,n.y,p.x,p.y)&&M(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=e.prevZ;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&b(a.x,a.y,s.x,s.y,n.x,n.y,p.x,p.y)&&M(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function l(e,t,r){var i=e;do{var a=i.prev,s=i.next.next;!S(a,s)&&w(a,i,i.next,s)&&T(a,s)&&T(s,a)&&(t.push(a.i/r),t.push(i.i/r),t.push(s.i/r),L(i),L(i.next),i=e=s),i=i.next}while(i!==e);return i}function u(e,t,r,i,a,o){var h=e;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&x(h,l)){var u=P(h,l);return h=s(h,h.next),u=s(u,u.next),n(h,t,r,i,a,o),void n(u,t,r,i,a,o)}l=l.next}h=h.next}while(h!==e)}function c(e,t,r,i){var n,o,h,l,u,c=[];for(n=0,o=t.length;n<o;n++)h=t[n]*i,l=n<o-1?t[n+1]*i:e.length,u=a(e,h,l,i,!1),u===u.next&&(u.steiner=!0),c.push(y(u));for(c.sort(d),n=0;n<c.length;n++)p(c[n],r),r=s(r,r.next);return r}function d(e,t){return e.x-t.x}function p(e,t){if(t=f(e,t)){var r=P(t,e);s(r,r.next)}}function f(e,t){var r,i=t,a=e.x,s=e.y,n=-1/0;do{if(s<=i.y&&s>=i.next.y){var o=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=a&&o>n){if(n=o,o===a){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(a===n)return r.prev;var h,l=r,u=r.x,c=r.y,d=1/0;for(i=r.next;i!==l;)a>=i.x&&i.x>=u&&b(s<c?a:n,s,u,c,s<c?n:a,s,i.x,i.y)&&((h=Math.abs(s-i.y)/(a-i.x))<d||h===d&&i.x>r.x)&&T(i,e)&&(r=i,d=h),i=i.next;return r}function m(e,t,r,i){var a=e;do{null===a.z&&(a.z=v(a.x,a.y,t,r,i)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,g(a)}function g(e){var t,r,i,a,s,n,o,h,l=1;do{for(r=e,e=null,s=null,n=0;r;){for(n++,i=r,o=0,t=0;t<l&&(o++,i=i.nextZ);t++);for(h=l;o>0||h>0&&i;)0===o?(a=i,i=i.nextZ,h--):0!==h&&i?r.z<=i.z?(a=r,r=r.nextZ,o--):(a=i,i=i.nextZ,h--):(a=r,r=r.nextZ,o--),s?s.nextZ=a:e=a,a.prevZ=s,s=a;r=i}s.nextZ=null,l*=2}while(n>1);return e}function v(e,t,r,i,a){return e=32767*(e-r)/a,t=32767*(t-i)/a,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function y(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function b(e,t,r,i,a,s,n,o){return(a-n)*(t-o)-(e-n)*(s-o)>=0&&(e-n)*(i-o)-(r-n)*(t-o)>=0&&(r-n)*(s-o)-(a-n)*(i-o)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!A(e,t)&&T(e,t)&&T(t,e)&&C(e,t)}function M(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function S(e,t){return e.x===t.x&&e.y===t.y}function w(e,t,r,i){return!!(S(e,t)&&S(r,i)||S(e,i)&&S(r,t))||M(e,t,r)>0!=M(e,t,i)>0&&M(r,i,e)>0!=M(r,i,t)>0}function A(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&w(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function T(e,t){return M(e.prev,e,e.next)<0?M(e,t,e.next)>=0&&M(e,e.prev,t)>=0:M(e,t,e.prev)<0||M(e,e.next,t)<0}function C(e,t){var r=e,i=!1,a=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&a<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function P(e,t){var r=new E(e.i,e.x,e.y),i=new E(t.i,t.x,t.y),a=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function F(e,t,r,i){var a=new E(e,t,r);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function L(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,r,i){for(var a=0,s=t,n=r-i;s<r;s+=i)a+=(e[n]-e[s])*(e[s+1]+e[n+1]),n=s;return a}e.exports=i,i.deviation=function(e,t,r,i){var a=t&&t.length,s=a?t[0]*r:e.length,n=Math.abs(I(e,0,s,r));if(a)for(var o=0,h=t.length;o<h;o++){var l=t[o]*r,u=o<h-1?t[o+1]*r:e.length;n-=Math.abs(I(e,l,u,r))}var c=0;for(o=0;o<i.length;o+=3){var d=i[o]*r,p=i[o+1]*r,f=i[o+2]*r;c+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===n&&0===c?0:Math.abs((c-n)/n)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,a=0;a<e.length;a++){for(var s=0;s<e[a].length;s++)for(var n=0;n<t;n++)r.vertices.push(e[a][s][n]);a>0&&(i+=e[a-1].length,r.holes.push(i))}return r}},function(e,t,r){"use strict";function i(e,t){return t=t||5,c(h({lat:e[1],lon:e[0]}),t)}function a(e){var t=l(m(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function s(e){var t=l(m(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function n(e){return e*(Math.PI/180)}function o(e){return e/Math.PI*180}function h(e){var t,r,i,a,s,o,h,l,c,d=e.lat,p=e.lon,f=6378137,m=n(d),g=n(p);c=Math.floor((p+180)/6)+1,180===p&&(c=60),d>=56&&d<64&&p>=3&&p<12&&(c=32),d>=72&&d<84&&(p>=0&&p<9?c=31:p>=9&&p<21?c=33:p>=21&&p<33?c=35:p>=33&&p<42&&(c=37)),t=6*(c-1)-180+3,l=n(t),r=.006739496752268451,i=f/Math.sqrt(1-.00669438*Math.sin(m)*Math.sin(m)),a=Math.tan(m)*Math.tan(m),s=r*Math.cos(m)*Math.cos(m),o=Math.cos(m)*(g-l),h=f*(.9983242984503243*m-.002514607064228144*Math.sin(2*m)+2639046602129982e-21*Math.sin(4*m)-3.418046101696858e-9*Math.sin(6*m));var v=.9996*i*(o+(1-a+s)*o*o*o/6+(5-18*a+a*a+72*s-58*r)*o*o*o*o*o/120)+5e5,y=.9996*(h+i*Math.tan(m)*(o*o/2+(5-a+9*s+4*s*s)*o*o*o*o/24+(61-58*a+a*a+600*s-330*r)*o*o*o*o*o*o/720));return d<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(v),zoneNumber:c,zoneLetter:u(d)}}function l(e){var t=e.northing,r=e.easting,i=e.zoneLetter,a=e.zoneNumber;if(a<0||a>60)return null;var s,n,h,u,c,d,p,f,m,g,v=6378137,y=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),b=r-5e5,x=t;i<"N"&&(x-=1e7),f=6*(a-1)-180+3,s=.006739496752268451,p=x/.9996,m=p/6367449.145945056,g=m+(3*y/2-27*y*y*y/32)*Math.sin(2*m)+(21*y*y/16-55*y*y*y*y/32)*Math.sin(4*m)+151*y*y*y/96*Math.sin(6*m),n=v/Math.sqrt(1-.00669438*Math.sin(g)*Math.sin(g)),h=Math.tan(g)*Math.tan(g),u=s*Math.cos(g)*Math.cos(g),c=.99330562*v/Math.pow(1-.00669438*Math.sin(g)*Math.sin(g),1.5),d=b/(.9996*n);var M=g-n*Math.tan(g)/c*(d*d/2-(5+3*h+10*u-4*u*u-9*s)*d*d*d*d/24+(61+90*h+298*u+45*h*h-252*s-3*u*u)*d*d*d*d*d*d/720);M=o(M);var S=(d-(1+2*h+u)*d*d*d/6+(5-2*u+28*h-3*u*u+8*s+24*h*h)*d*d*d*d*d/120)/Math.cos(g);S=f+o(S);var w;if(e.accuracy){var A=l({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});w={top:A.lat,right:A.lon,bottom:M,left:S}}else w={lat:M,lon:S};return w}function u(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function c(e,t){var r="00000"+e.easting,i="00000"+e.northing;return e.zoneNumber+e.zoneLetter+d(e.easting,e.northing,e.zoneNumber)+r.substr(r.length-5,t)+i.substr(i.length-5,t)}function d(e,t,r){var i=p(r);return f(Math.floor(e/1e5),Math.floor(t/1e5)%20,i)}function p(e){var t=e%b;return 0===t&&(t=b),t}function f(e,t,r){var i=r-1,a=x.charCodeAt(i),s=M.charCodeAt(i),n=a+e-1,o=s+t,h=!1;return n>C&&(n=n-C+S-1,h=!0),(n===w||a<w&&n>w||(n>w||a<w)&&h)&&n++,(n===A||a<A&&n>A||(n>A||a<A)&&h)&&++n===w&&n++,n>C&&(n=n-C+S-1),o>T?(o=o-T+S-1,h=!0):h=!1,(o===w||s<w&&o>w||(o>w||s<w)&&h)&&o++,(o===A||s<A&&o>A||(o>A||s<A)&&h)&&++o===w&&o++,o>T&&(o=o-T+S-1),String.fromCharCode(n)+String.fromCharCode(o)}function m(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,r=e.length,i=null,a="",s=0;!/[A-Z]/.test(t=e.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+e;a+=t,s++}var n=parseInt(a,10);if(0===s||s+3>r)throw"MGRSPoint bad conversion from: "+e;var o=e.charAt(s++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+e;i=e.substring(s,s+=2);for(var h=p(n),l=g(i.charAt(0),h),u=v(i.charAt(1),h);u<y(o);)u+=2e6;var c=r-s;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var d,f,m,b,x,M=c/2,S=0,w=0;return M>0&&(d=1e5/Math.pow(10,M),f=e.substring(s,s+M),S=parseFloat(f)*d,m=e.substring(s+M),w=parseFloat(m)*d),b=S+l,x=w+u,{easting:b,northing:x,zoneLetter:o,zoneNumber:n,accuracy:d}}function g(e,t){for(var r=x.charCodeAt(t-1),i=1e5,a=!1;r!==e.charCodeAt(0);){if(r++,r===w&&r++,r===A&&r++,r>C){if(a)throw"Bad character: "+e;r=S,a=!0}i+=1e5}return i}function v(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var r=M.charCodeAt(t-1),i=0,a=!1;r!==e.charCodeAt(0);){if(r++,r===w&&r++,r===A&&r++,r>T){if(a)throw"Bad character: "+e;r=S,a=!0}i+=1e5}return i}function y(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}t.c=i,t.b=s;var b=6,x="AJSAJS",M="AFAFAF",S=65,w=73,A=79,T=86,C=90;t.a={forward:i,inverse:a,toPoint:s}},function(e,t,r){"use strict";t.a=function(e,t){e=Math.abs(e),t=Math.abs(t);var r=Math.max(e,t),i=Math.min(e,t)/(r||1);return r*Math.sqrt(1+Math.pow(i,2))}},function(e,t,r){"use strict";var i=.01068115234375;t.a=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(.01953125+e*i))),t[1]=e*(.75-e*(.046875+e*(.01953125+e*i)));var r=e*e;return t[2]=r*(.46875-e*(.013020833333333334+.007120768229166667*e)),r*=e,t[3]=r*(.3645833333333333-.005696614583333333*e),t[4]=r*e*.3076171875,t}},function(e,t,r){"use strict";var i=r(27),a=r(0);t.a=function(e,t,s){for(var n=1/(1-t),o=e,h=20;h;--h){var l=Math.sin(o),u=1-t*l*l;if(u=(r.i(i.a)(o,l,Math.cos(o),s)-e)*(u*Math.sqrt(u))*n,o-=u,Math.abs(u)<a.d)return o}return o}},function(e,t,r){"use strict";t.a=function(e){var t=Math.exp(e);return t=(t-1/t)/2}},function(e,t,r){"use strict";t.a=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}},function(e,t,r){"use strict";function i(e,t){return e.datum_type===t.datum_type&&(!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(e.datum_type===h.h?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type!==h.i||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]))}function a(e,t,r){var i,a,s,n,o=e.x,l=e.y,u=e.z?e.z:0;if(l<-h.a&&l>-1.001*h.a)l=-h.a;else if(l>h.a&&l<1.001*h.a)l=h.a;else if(l<-h.a||l>h.a)return null;return o>Math.PI&&(o-=2*Math.PI),a=Math.sin(l),n=Math.cos(l),s=a*a,i=r/Math.sqrt(1-t*s),{x:(i+u)*n*Math.cos(o),y:(i+u)*n*Math.sin(o),z:(i*(1-t)+u)*a}}function s(e,t,r,i){var a,s,n,o,l,u,c,d,p,f,m,g,v,y,b,x,M=e.x,S=e.y,w=e.z?e.z:0;if(a=Math.sqrt(M*M+S*S),s=Math.sqrt(M*M+S*S+w*w),a/r<1e-12){if(y=0,s/r<1e-12)return b=h.a,x=-i,{x:e.x,y:e.y,z:e.z}}else y=Math.atan2(S,M);n=w/s,o=a/s,l=1/Math.sqrt(1-t*(2-t)*o*o),d=o*(1-t)*l,p=n*l,v=0;do{v++,c=r/Math.sqrt(1-t*p*p),x=a*d+w*p-c*(1-t*p*p),u=t*c/(c+x),l=1/Math.sqrt(1-u*(2-u)*o*o),f=o*(1-u)*l,m=n*l,g=m*d-f*p,d=f,p=m}while(g*g>1e-24&&v<30);return b=Math.atan(m/Math.abs(f)),{x:y,y:b,z:x}}function n(e,t,r){if(t===h.h)return{x:e.x+r[0],y:e.y+r[1],z:e.z+r[2]};if(t===h.i){var i=r[0],a=r[1],s=r[2],n=r[3],o=r[4],l=r[5],u=r[6];return{x:u*(e.x-l*e.y+o*e.z)+i,y:u*(l*e.x+e.y-n*e.z)+a,z:u*(-o*e.x+n*e.y+e.z)+s}}}function o(e,t,r){if(t===h.h)return{x:e.x-r[0],y:e.y-r[1],z:e.z-r[2]};if(t===h.i){var i=r[0],a=r[1],s=r[2],n=r[3],o=r[4],l=r[5],u=r[6],c=(e.x-i)/u,d=(e.y-a)/u,p=(e.z-s)/u;return{x:c+l*d-o*p,y:-l*c+d+n*p,z:o*c-n*d+p}}}var h=r(0);t.c=i,t.b=a,t.a=s,t.d=n,t.e=o},function(e,t,r){"use strict";function i(e){var t=this;if(2===arguments.length){var a=arguments[1];"string"==typeof a?"+"===a.charAt(0)?i[e]=r.i(s.a)(arguments[1]):i[e]=r.i(n.a)(arguments[1]):i[e]=a}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?i.apply(t,e):i(e)});if("string"==typeof e){if(e in i)return i[e]}else"EPSG"in e?i["EPSG:"+e.EPSG]=e:"ESRI"in e?i["ESRI:"+e.ESRI]=e:"IAU2000"in e?i["IAU2000:"+e.IAU2000]=e:console.log(e);return}}var a=r(80),s=r(43),n=r(46);r.i(a.a)(i),t.a=i},function(e,t,r){"use strict";var i=r(0),a=r(73),s=r(74),n=r(29);t.a=function(e){var t,o,h,l={},u=e.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var r=t.split("=");return r.push(!0),e[r[0].toLowerCase()]=r[1],e},{}),c={proj:"projName",datum:"datumCode",rf:function(e){l.rf=parseFloat(e)},lat_0:function(e){l.lat0=e*i.g},lat_1:function(e){l.lat1=e*i.g},lat_2:function(e){l.lat2=e*i.g},lat_ts:function(e){l.lat_ts=e*i.g},lon_0:function(e){l.long0=e*i.g},lon_1:function(e){l.long1=e*i.g},lon_2:function(e){l.long2=e*i.g},alpha:function(e){l.alpha=parseFloat(e)*i.g},lonc:function(e){l.longc=e*i.g},x_0:function(e){l.x0=parseFloat(e)},y_0:function(e){l.y0=parseFloat(e)},k_0:function(e){l.k0=parseFloat(e)},k:function(e){l.k0=parseFloat(e)},a:function(e){l.a=parseFloat(e)},b:function(e){l.b=parseFloat(e)},r_a:function(){l.R_A=!0},zone:function(e){l.zone=parseInt(e,10)},south:function(){l.utmSouth=!0},towgs84:function(e){l.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){l.to_meter=parseFloat(e)},units:function(e){l.units=e;var t=r.i(n.a)(s.a,e);t&&(l.to_meter=t.to_meter)},from_greenwich:function(e){l.from_greenwich=e*i.g},pm:function(e){var t=r.i(n.a)(a.a,e);l.from_greenwich=(t||parseFloat(e))*i.g},nadgrids:function(e){"@null"===e?l.datumCode="none":l.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(l.axis=e)}};for(t in u)o=u[t],t in c?(h=c[t],"function"==typeof h?h(o):l[h]=o):l[t]=o;return"string"==typeof l.datumCode&&"WGS84"!==l.datumCode&&(l.datumCode=l.datumCode.toLowerCase()),l}},function(e,t,r){"use strict";function i(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),i=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),i*=t,this.cgb[1]=i*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),i*=t,this.cgb[2]=i*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=i*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),i*=t,this.cgb[3]=i*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=i*(1237/630+t*(t*(-24832/14175)-2.4)),i*=t,this.cgb[4]=i*(4174/315+t*(-144838/6237)),this.cbg[4]=i*(-734/315+t*(109598/31185)),i*=t,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+i*(.25+i*(1/64+i/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=i*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=i*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),i*=t,this.utg[2]=i*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=i*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),i*=t,this.utg[3]=i*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=i*(49561/161280+t*(-179/168+t*(6601661/7257600))),i*=t,this.utg[4]=i*(-4583/161280+t*(108847/3991680)),this.gtu[4]=i*(34729/80640+t*(-3418889/1995840)),i*=t,this.utg[5]=-.03233083094085698*i,this.gtu[5]=.6650675310896665*i;var a=r.i(l.a)(this.cbg,this.lat0);this.Zb=-this.Qn*(a+r.i(u.a)(this.gtu,2*a))}function a(e){var t=r.i(d.a)(e.x-this.long0),i=e.y;i=r.i(l.a)(this.cbg,i);var a=Math.sin(i),s=Math.cos(i),n=Math.sin(t),u=Math.cos(t);i=Math.atan2(a,u*s),t=Math.atan2(n*s,r.i(o.a)(a,s*u)),t=r.i(h.a)(Math.tan(t));var p=r.i(c.a)(this.gtu,2*i,2*t);i+=p[0],t+=p[1];var f,m;return Math.abs(t)<=2.623395162778?(f=this.a*(this.Qn*t)+this.x0,m=this.a*(this.Qn*i+this.Zb)+this.y0):(f=1/0,m=1/0),e.x=f,e.y=m,e}function s(e){var t=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,t/=this.Qn;var a,s;if(Math.abs(t)<=2.623395162778){var h=r.i(c.a)(this.utg,2*i,2*t);i+=h[0],t+=h[1],t=Math.atan(r.i(n.a)(t));var u=Math.sin(i),p=Math.cos(i),f=Math.sin(t),m=Math.cos(t);i=Math.atan2(u*m,r.i(o.a)(f,m*p)),t=Math.atan2(f,m*p),a=r.i(d.a)(t+this.long0),s=r.i(l.a)(this.cgb,i)}else a=1/0,s=1/0;return e.x=a,e.y=s,e}var n=r(39),o=r(36),h=r(63),l=r(67),u=r(64),c=r(65),d=r(1),p=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"];t.a={init:i,forward:a,inverse:s,names:p}},function(e,t,r){"use strict";function i(e,t){return(e.datum.datum_type===s.h||e.datum.datum_type===s.i)&&"WGS84"!==t.datumCode||(t.datum.datum_type===s.h||t.datum.datum_type===s.i)&&"WGS84"!==e.datumCode}function a(e,t,c){var d;return Array.isArray(c)&&(c=r.i(u.a)(c)),e.datum&&t.datum&&i(e,t)&&(d=new l.a("WGS84"),c=a(e,d,c),e=d),"enu"!==e.axis&&(c=r.i(h.a)(e,!1,c)),"longlat"===e.projName?(c.x*=s.g,c.y*=s.g):e.isGeocent?(e.to_meter&&(c.x*=e.to_meter,c.y*=e.to_meter,c.z*=e.to_meter),c=r.i(o.a)(c,t.es,t.a,t.b)):(e.to_meter&&(c.x*=e.to_meter,c.y*=e.to_meter),c=e.inverse(c)),e.from_greenwich&&(c.x+=e.from_greenwich),c=r.i(n.a)(e.datum,t.datum,c),t.from_greenwich&&(c.x-=t.from_greenwich),"longlat"===t.projName?(c.x*=s.j,c.y*=s.j):t.isGeocent?(c=r.i(o.b)(c,t.es,t.a),t.to_meter&&(c.x/=t.to_meter,c.y/=t.to_meter,c.z/=t.to_meter)):(t.forward(c),t.to_meter&&(c.x/=t.to_meter,c.y/=t.to_meter)),"enu"!==t.axis?r.i(h.a)(t,!0,c):c}var s=r(0),n=r(77),o=r(41),h=r(61),l=r(24),u=r(40);t.a=a},function(e,t,r){"use strict";function i(e,t){var r=t[0],i=t[1];!(r in e)&&i in e&&(e[r]=e[i],3===t.length&&(e[r]=t[2](e[r])))}function a(e){return e*h}function s(e){function t(t){return t*(e.to_meter||1)}"GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var r=e.GEOGCS;"GEOGCS"===e.type&&(r=e),r&&(r.DATUM?e.datumCode=r.DATUM.name.toLowerCase():e.datumCode=r.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"===e.datumCode&&("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(e.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=r.DATUM.SPHEROID.a,e.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",a],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",a],["x0","false_easting",t],["y0","false_northing",t],["long0","central_meridian",a],["lat0","latitude_of_origin",a],["lat0","standard_parallel_1",a],["lat1","standard_parallel_1",a],["lat2","standard_parallel_2",a],["alpha","azimuth",a],["srsCode","name"]].forEach(function(t){return i(e,t)}),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=a(e.lat1>0?90:-90),e.lat_ts=e.lat1)}var n=r(114),o=r(115),h=.017453292519943295;t.a=function(e){var t=r.i(n.a)(e),i=t.shift(),a=t.shift();t.unshift(["name",a]),t.unshift(["type",i]);var h={};return r.i(o.a)(t,h),s(h),h}},function(e,t,r){"use strict";var i=r(30),a=r(4),s=r(12),n=a.a,o=s.a,h=i.a,l=function(e,t,r){if(this.map=e,this.id=r,this.currentAlpha=1,this.tileSize=[256,256],this.lodRange=[0,100],this.credits=[],this.tileRange=[[0,0],[0,0]],this.jsonUrl=null,this.baseUrl=this.map.url.baseUrl,this.baseUrlSchema=this.map.url.baseUrlSchema,this.baseUrlOrigin=this.map.url.baseUrlOrigin,this.ready=!1,this.dataType=0,"esri-world-imagery"==r&&(t.availability={type:"negative-size",size:2521}),"string"==typeof t){this.jsonUrl=this.map.url.processUrl(t),this.baseUrl=o.getBase(this.jsonUrl),this.baseUrlSchema=o.getSchema(this.jsonUrl),this.baseUrlOrigin=o.getOrigin(this.jsonUrl);var i=function(e){this.parseJson(e),this.ready=!0,this.map.refreshView()}.bind(this),a=function(){}.bind(this);n.loadJSON(this.jsonUrl,i,a,null,!!n.useCredentials&&-1!=this.jsonUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)}else this.parseJson(t),this.ready=!0};l.prototype.parseJson=function(e){switch(this.numberId=e.id||null,this.type=e.type||"raster",this.url=this.processUrl(e.url,""),this.tileSize=e.tileSize||[256,256],this.lodRange=e.lodRange||[0,0],this.tileRange=e.tileRange||[[0,0],[0,0]],this.metaUrl=this.processUrl(e.metaUrl),this.maskUrl=this.processUrl(e.maskUrl),this.isTransparent=e.isTransparent||!1,this.shaderFilter=e.shaderFilter||null,this.credits=e.credits||[],this.creditsUrl=null,e.dataType){default:case"color":this.dataType=0;break;case"height":this.dataType=1;break;case"classification":this.dataType=2}if(this.specificity=Math.pow(2,this.lodRange[0])/((this.tileRange[1][0]-this.tileRange[1][0]+1)*(this.tileRange[1][1]-this.tileRange[1][1]+1)),this.availability=e.availability?{}:null,this.availability){var t=e.availability;switch(t.type){case"negative-type":this.availability.type=2;break;case"negative-code":this.availability.type=3;break;case"negative-size":this.availability.type=4}this.availability.mime=t.mime,this.availability.codes=t.codes,this.availability.size=t.size}switch(this.metaUrl&&this.maskUrl&&(this.availability={type:1}),typeof this.credits){case"string":this.creditsUrl=this.credits,this.credits=[];break;case"object":if(!Array.isArray(this.credits)){var r=this.credits;this.credits=[];for(var i in r)this.map.addCredit(i,new h(this.map,r[i])),this.credits.push(i)}}},l.prototype.kill=function(){},l.prototype.setOptions=function(){},l.prototype.getOptions=function(){return this.getInfo()},l.prototype.getInfo=function(){return{type:this.type,url:this.url,tileSize:this.tileSize,credits:this.credits,lodRange:this.lodRange,tileRange:this.tileRange,mataUrl:this.metaUrl,maskUrl:this.maskUrl,isTransparent:this.isTransparent}},l.prototype.processUrl=function(e,t){return e?(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},l.prototype.hasTile=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var r=e[1]>>t,i=e[2]>>t;return!(e[0]<this.lodRange[0]||e[0]>this.lodRange[1]||r<this.tileRange[0][0]||r>this.tileRange[1][0]||i<this.tileRange[0][1]||i>this.tileRange[1][1])},l.prototype.hasTileOrInfluence=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var r=e[1]>>t,i=e[2]>>t;return r<this.tileRange[0][0]||r>this.tileRange[1][0]||i<this.tileRange[0][1]||i>this.tileRange[1][1]?0:e[0]>this.lodRange[1]?1:2},l.prototype.getUrl=function(e,t){return this.map.url.makeUrl(this.url,{lod:e[0],ix:e[1],iy:e[2]},null,t)},l.prototype.getMetatileUrl=function(e,t){return this.map.url.makeUrl(this.metaUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},l.prototype.getMaskUrl=function(e,t){return this.map.url.makeUrl(this.maskUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},t.a=l},function(e,t,r){"use strict";var i=r(2),a=r(3),s=r(162),n=r(137),o=i.e,h=a.a,l=s.a,u=n.a,c=function(e,t,r){if(this.map=e,this.stats=e.stats,this.geodata=t,this.gpu=this.map.renderer.gpu,this.renderer=this.map.renderer,this.gpuGroups=[],this.currentGpuGroup=null,this.tile=r.tile,this.surface=r.surface,this.surface.geodataProcessor)this.surface.styleChanged&&(this.surface.geodataProcessor.setStylesheet(this.surface.stylesheet),this.surface.styleChanged=!1);else{var i=new u(this,this.onGeodataProcessorMessage.bind(this));i.setStylesheet(this.surface.stylesheet),this.surface.geodataProcessor=i,this.map.geodataProcessors.push(i)}this.geodataProcessor=this.surface.geodataProcessor,this.statsCounter=0,this.size=0,this.killed=!1,this.killedByCache=!1,this.ready=!1,this.isReady()};c.prototype.kill=function(){this.killed=!0,this.geodata=null,this.killGeodataView(!1)},c.prototype.killGeodataView=function(e){this.killedByCache=e;for(var t=0,r=this.gpuGroups.length;t<r;t++)this.gpuGroups[t].kill();this.gpuGroups=[],!0!==e&&null!=this.gpuCacheItem&&this.map.gpuCache.remove(this.gpuCacheItem),this.stats.gpuGeodata-=this.size,this.stats.graphsFluxGeodata[1][0]++,this.stats.graphsFluxGeodata[1][1]+=this.size,this.ready=!1,this.size=0,this.gpuCacheItem=null},c.prototype.onGeodataProcessorMessage=function(e,t,r){if(!this.killed&&!this.killedByCache)switch(e){case"beginGroup":r?(this.currentGpuGroup=new l(t.id,t.bbox,t.origin,this.gpu,this.renderer),this.gpuGroups.push(this.currentGpuGroup)):(this.map.markDirty(),this.map.addProcessingTask(this.onGeodataProcessorMessage.bind(this,e,t,!0)));break;case"addRenderJob":if(r){if(this.currentGpuGroup){var i=performance.now();this.currentGpuGroup.addRenderJob(t,this.tile),this.stats.renderBuild+=performance.now()-i}}else this.map.markDirty(),this.map.addProcessingTask(this.onGeodataProcessorMessage.bind(this,e,t,!0));break;case"endGroup":r?this.currentGpuGroup&&(this.size+=this.currentGpuGroup.size):(this.map.markDirty(),this.map.addProcessingTask(this.onGeodataProcessorMessage.bind(this,e,t,!0)));break;case"allProcessed":this.geodataProcessor.busy=!1,r?(this.map.markDirty(),this.gpuCacheItem=this.map.gpuCache.insert(this.killGeodataView.bind(this,!0),this.size),this.stats.gpuGeodata+=this.size,this.stats.graphsFluxGeodata[0][0]++,this.stats.graphsFluxGeodata[0][1]+=this.size,this.ready=!0):(this.map.markDirty(),this.map.addProcessingTask(this.onGeodataProcessorMessage.bind(this,e,t,!0)));break;case"ready":this.map.markDirty()}},c.prototype.isReady=function(e,t,r){if(this.killed)return!1;var i=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;return e=e||i,this.ready||e||!this.surface.stylesheet.isReady()||this.geodata.isReady(e,t,r)&&this.geodataProcessor.isReady()&&(this.killedByCache=!1,this.geodataProcessor.setListener(this.onGeodataProcessorMessage.bind(this)),this.geodataProcessor.sendCommand("processGeodata",this.geodata.geodata,this.tile,window.devicePixelRatio||1),this.geodataProcessor.busy=!0),!e&&this.gpuCacheItem&&this.map.gpuCache.updateItem(this.gpuCacheItem),this.ready},c.prototype.getWorldMatrix=function(e,t,r){var i=r;return null!=i||(i=o.create(),o.multiply(h.translationMatrix(e.min[0]-t[0],e.min[1]-t[1],e.min[2]-t[2]),h.scaleMatrix(1,1,1),i)),i},c.prototype.draw=function(e){if(this.ready){for(var t=this.renderer,r=this.tile?Math.abs(this.tile.tiltAngle):t.cameraTiltFator,i=0,a=this.gpuGroups.length;i<a;i++){var s=this.gpuGroups[i];if(s.jobs.length){var n=o.create(),h=o.create();o.multiply(t.camera.getModelviewMatrix(),this.getWorldMatrix(s.bbox,e),h);var l=t.camera.getProjectionMatrix();o.multiply(l,h,n),s.draw(h,n,null,r,this.tile?this.tile.texelSize:1),this.stats.drawnFaces+=s.polygons,this.stats.drawCalls+=s.jobs.length}}this.statsCoutner!=this.stats.counter&&(this.statsCoutner=this.stats.counter,this.stats.gpuRenderUsed+=this.size)}return this.ready},t.a=c},function(e,t,r){"use strict";var i=r(5),a=r(4),s=i.a,n=a.a,o=function(e,t,r){this.map=e,this.stats=e.stats,this.mapLoaderUrl=t,this.extraInfo=r,this.bbox=new s,this.size=0,this.fileSize=0,this.geodata=null,this.cacheItem=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.map.markDirty()};o.prototype.kill=function(){this.bbox=null,this.killGeodata()},o.prototype.killGeodata=function(e){this.geodata&&(this.geodata=null),!0!==e&&null!=this.cacheItem&&this.map.resourcesCache.remove(this.cacheItem),this.loadState=0,this.size=0,this.fileSize=0,this.cacheItem=null},o.prototype.isReady=function(e,t){var r=this.map.stats.gpuRenderUsed>=this.map.maxGpuUsed;if(e=e||r,2==this.loadState)return this.map.resourcesCache.updateItem(this.cacheItem),!0;if(0==this.loadState)if(e);else{if("object"==typeof this.mapLoaderUrl)return this.geodata=JSON.stringify(this.mapLoaderUrl),this.loadState=2,this.cacheItem=this.map.resourcesCache.insert(this.killGeodata.bind(this,!0),this.geodata.length),this.map.resourcesCache.updateItem(this.cacheItem),!0;this.scheduleLoad(t)}else 3==this.loadState&&this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(t);return!1},o.prototype.scheduleLoad=function(e){this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this),e,this.extraInfo.tile,"geodata")},o.prototype.onLoad=function(e,t,r){this.mapLoaderCallLoaded=t,this.mapLoaderCallError=r,this.loadState=1,n.loadJSON(e,this.onLoaded.bind(this),this.onLoadError.bind(this),!0,!!n.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)},o.prototype.onLoadError=function(){this.map.killed||(this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},o.prototype.onLoaded=function(e){if(!this.map.killed){var t=e.length;this.size=t,this.fileSize=t,this.geodata=e,this.cacheItem=this.map.resourcesCache.insert(this.killGeodata.bind(this,!0),t),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},t.a=o},function(e,t,r){"use strict";var i=r(55),a=r(3),s=r(23),n=r.n(s),o=i.a,h=a.a,l=n.a,u=function(e,t,r){if(this.map=e,this.id=t,this.proj4=e.proj4,this.comment=r.comment||null,this.srsDef=r.srsDef||null,this.srsModifiers=r.srsModifiers||[],this.type=r.type||"projected",this.vdatum=r.vdatum||"orthometric",this.srsDef=r.srsDefEllps||this.srsDef,this.periodicity=this.parsePeriodicity(r.periodicity),this.srsInfo=this.proj4(this.srsDef).info(),this.geoidGrid=null,this.geoidGridMap=null,this.srsProj4=this.proj4(this.srsDef,null,null,!0),this.latlonProj4=null,this.proj4Cache={},r.geoidGrid){var i=r.geoidGrid;if(this.geoidGrid={definition:i.definition||null,srsDefEllps:i.srsDefEllps||null,valueRange:i.valueRange||[0,1]},i.extents?this.geoidGrid.extents={ll:i.extents.ll,ur:i.extents.ur}:this.geoidGrid.extents={ll:[0,0],ur:[1,1]},this.geoidGrid.definition){var a=this.map.url.makeUrl(this.geoidGrid.definition,{},null);this.geoidGridMap=new o(this.map,a,!0)}this.geoidGrid.srsDefEllps&&(this.geoidGrid.srsProj4=this.proj4(this.geoidGrid.srsDefEllps,null,null,!0))}"geographic"==this.type&&(this.spheroid=r.spheroid||null,this.spheroid)};u.prototype.parsePeriodicity=function(e){return null==e?null:{type:e.type||"",period:e.period||0}},u.prototype.getInfo=function(){return{comment:this.comment,srsDef:this.srsDef,srsModifiers:this.srsModifiers,type:this.type,vdatum:this.vdatum,srsDefEllps:this.srsDef,a:this.srsInfo.a,b:this.srsInfo.b}},u.prototype.getSrsInfo=function(){return this.srsInfo},u.prototype.isReady=function(){return this.isGeoidGridReady()},u.prototype.isGeoidGridReady=function(){return null==this.geoidGrid||null!=this.geoidGridMap&&this.geoidGridMap.isReady()},u.prototype.isProjected=function(){return"projected"==this.type},u.prototype.getOriginalHeight=function(e){var t=e[2]||0;return t/=this.getVerticalAdjustmentFactor(e),t+=this.getGeoidGridDelta(e)},u.prototype.getFinalHeight=function(e){var t=e[2]||0;return t-=this.getGeoidGridDelta(e),t*=this.getVerticalAdjustmentFactor(e)},u.prototype.getGeoidGridDelta=function(e){if(null!=this.geoidGridMap&&this.isGeoidGridReady()){var t=this.proj4(this.srsProj4,this.geoidGrid.srsProj4,[e[0],e[1]]),r=t[0]-this.geoidGrid.extents.ll[0],i=this.geoidGrid.extents.ur[1]-t[1],a=this.geoidGridMap.getImageExtents();r*=a[0]/(this.geoidGrid.extents.ur[0]-this.geoidGrid.extents.ll[0]),i*=a[1]/(this.geoidGrid.extents.ur[1]-this.geoidGrid.extents.ll[1]),r=h.clamp(r,0,a[0]-2),i=h.clamp(i,0,a[1]-2);var s=Math.floor(r),n=Math.floor(i),o=r-s,l=i-n,u=this.geoidGridMap.getImageData(),c=n*a[0],d=c+a[0],p=u[4*(c+s)],f=u[4*(c+s+1)],m=u[4*(d+s)],g=u[4*(d+s+1)],v=p+(f-p)*o,y=m+(g-m)*o,b=v+(y-v)*l;return b=this.geoidGrid.valueRange[0]+b*((this.geoidGrid.valueRange[1]-this.geoidGrid.valueRange[0])/255)}return 0},u.prototype.getVerticalAdjustmentFactor=function(e){if(-1!=this.srsModifiers.indexOf("adjustVertical")){var t=this.getSrsInfo(),r="+proj=longlat  +alpha=0 +gamma=0 +a="+t.a+" +b="+t.b+" +x0=0 +y0=0";this.latlonProj4||(this.latlonProj4=this.proj4(r,null,null,!0));var i=this.proj4(this.srsProj4,this.latlonProj4,[e[0],e[1]]),a=new l.Geodesic.Geodesic(t.a,t.a/t.b-1),s=a.Direct(i[1],i[0],90,1e3);i=[s.lon2,s.lat2],i=this.proj4(this.latlonProj4,this.srsProj4,i);var n=i[0]-e[0],o=i[1]-e[1];return Math.sqrt(n*n+o*o)/1e3}return 1},u.prototype.convertCoordsTo=function(e,t,r){if(this.isReady(),"string"!=typeof t){if(t.id==this.id)return e.slice();t.isReady()}e=e.slice();var i="string"==typeof t;e[2]=this.getOriginalHeight(e);var a=i?t:t.srsProj4,s=i?t:t.srsDef,n=this.proj4Cache[s];n||(n=this.proj4(this.srsProj4,a),this.proj4Cache[s]=n);var o=n.forward(e);return r||i||(o[2]=t.getFinalHeight(o)),o},u.prototype.convertCoordsToFast=function(e,t,r,i,a,s){var n=t.srsProj4,o=t.srsDef,h=this.proj4Cache[o];h||(h=this.proj4(this.srsProj4,n),this.proj4Cache[o]=h);var l=h.forward(e);i[s]=l[0],i[s+1]=l[1],i[s+2]=l[2],t.geoidGrid&&(i[s+2]-=t.getGeoidGridDelta(e))},u.prototype.convertCoordsFrom=function(e,t){if(this.isReady(),"string"!=typeof t){if(t.id==this.id)return e.slice();t.isReady()}e=e.slice(),"string"!=typeof t&&(e[2]=t.getOriginalHeight(e));var r="string"==typeof t?t:t.srsProj4,i="string"==typeof t?t:t.srsDef,a=this.proj4Cache[i];a||(a=this.proj4(this.srsProj4,r),this.proj4Cache[i]=a);var s=a.inverse(e);return s[2]=this.getFinalHeight(s),s},u.prototype.phi2z=function(e,t){for(var r,i,a=.5*Math.PI,s=.5*e,n=a-2*Math.atan(t),o=0;o<=15;o++)if(r=e*Math.sin(n),i=a-2*Math.atan(t*Math.pow((1-r)/(1+r),s))-n,n+=i,Math.abs(i)<=1e-10)return n;return-9999},u.prototype.convertMercToWGS=function(e,t,r,i){var a=2*Math.PI,s=.5*Math.PI,n=this.srsProj4,o=e[r]-n.x0,h=e[r+1]-n.y0;if(n.sphere)t[i+1]=s-2*Math.atan(Math.exp(-h/(n.a*n.k0)));else{var l=Math.exp(-h/(n.a*n.k0)),u=this.phi2z(n.e,l);if(t[i+1]=u,-9999===u)return}o=n.long0+o/(n.a*n.k0);t[i]=Math.abs(o)<=3.14159265359?o:o-(o<0?-1:1)*a,t[i+2]=e[r+2]},u.prototype.convertWGSToGeocent=function(e,t,r,i,a){var s,n,o,h,l=t.datum,u=.5*Math.PI,c=e[i],d=e[i+1],p=e[i+2];if(d<-u&&d>-1.001*u)d=-u;else if(d>u&&d<1.001*u)d=u;else if(d<-u||d>u)return null;c>Math.PI&&(c-=2*Math.PI),n=Math.sin(d),h=Math.cos(d),o=n*n,s=l.a/Math.sqrt(1-l.es*o),r[a]=(s+p)*h*Math.cos(c),r[a+1]=(s+p)*h*Math.sin(c),r[a+2]=(s*(1-l.es)+p)*n},t.a=u},function(e,t,r){"use strict";var i=r(4),a=i.a,s=function(e,t,r,i){this.generateLines=!0,this.map=e,this.renderer=this.map.renderer,this.stats=e.stats,this.id=t,this.url=null,this.data=null,this.loadState=0,this.size=0,this.fileSize=0,this.freeLayer=i,this.fonts={},this.fontsReady=!1,"object"==typeof r?(this.data=r,this.setFonts(this.data),this.loadState=2,this.map.markDirty()):(this.freeLayer?this.url=this.freeLayer.processUrl(r,""):this.url=this.map.url.processUrl(r),a.loadJSON(this.url,this.onLoaded.bind(this),this.onLoadError.bind(this),null,!!a.useCredentials&&-1!=this.url.indexOf(this.map.url.baseUrl),this.map.core.xhrParams),this.loadState=1)};s.prototype.kill=function(){},s.prototype.setData=function(e){this.data=e,this.setFonts(e),this.loadState=2,this.checkFonts()},s.prototype.checkFonts=function(){var e=!0;for(var t in this.fonts)e=e&&this.renderer.getFont(this.fonts[t]).isReady();return this.fontsReady=e,e},s.prototype.isReady=function(e,t){return 2==this.loadState?!!this.fontsReady||this.checkFonts():(0==this.loadState&&(e||this.scheduleLoad(t)),!1)},s.prototype.scheduleLoad=function(e){this.map.loader.load(this.url,this.onLoad.bind(this),e)},s.prototype.onLoad=function(){this.loadState=1},s.prototype.onLoadError=function(){this.map.killed},s.prototype.setFonts=function(e){this.fonts=e.fonts||{},this.fonts["#default"]||(this.fonts["#default"]=this.map.core.config.mapDefaultFont)},s.prototype.onLoaded=function(e){this.map.killed||(this.data=e,this.setFonts(e),this.loadState=2,this.map.markDirty())},t.a=s},function(e,t,r){"use strict";var i=r(4),a=r(6),s=i.a,n=a.a,o=function(e,t,r,i,a){this.map=e,this.stats=e.stats,this.tile=i,this.internal=a,this.image=null,this.imageData=null,this.imageExtents=null,this.gpuTexture=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.neverReady=!1,this.mapLoaderUrl=t,this.type=r||!1,this.statsCounter=0,this.checkStatus=0,this.checkType=null,this.checkValue=null,this.fastHeaderCheck=!1,this.gpuSize=0,this.fileSize=0,this.cacheItem=null,this.gpuCacheItem=null};o.prototype.kill=function(){this.killImage(),this.killGpuTexture(),this.mask&&(this.mask.killImage(),this.mask.killGpuTexture())},o.prototype.killImage=function(e){this.image=null,this.imageData=null,!0!==e&&this.cacheItem&&this.map.resourcesCache.remove(this.cacheItem),this.mask&&this.mask.killImage(),this.gpuTexture||(this.loadState=0),this.cacheItem=null},o.prototype.killGpuTexture=function(e){null!=this.gpuTexture&&(this.stats.gpuTextures-=this.gpuTexture.size,this.gpuTexture.kill(),this.stats.graphsFluxTexture[1][0]++,this.stats.graphsFluxTexture[1][1]+=this.gpuTexture.size,this.mask&&this.mask.killGpuTexture()),this.gpuTexture=null,!0!==e&&this.gpuCacheItem&&this.map.gpuCache.remove(this.gpuCacheItem),this.image||this.imageData||(this.loadState=0),this.gpuCacheItem=null},o.prototype.isReady=function(e,t,r,i){var a=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;if(e=e||a,this.neverReady)return!1;switch(i.checkType){case 2:case 3:case 4:if(2!=this.checkStatus){if(this.checkType=i.checkType,this.checkValue=i.checkValue,0==this.checkStatus)this.scheduleHeadRequest(t,4==this.checkType);else if(3==this.checkStatus)this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleHeadRequest(t,4==this.checkType);else if(-1==this.checkStatus&&i.extraInfo)for(i.extraBound||(i.extraBound={tile:i.extraInfo.tile,layer:i.extraInfo.layer},i.setBoundTexture(i.extraBound.tile.parent,i.extraBound.layer));i.extraBound.texture.extraBound||-1==i.extraBound.texture.checkStatus;)i.setBoundTexture(i.extraBound.sourceTile.parent,i.extraBound.layer);return!1}}if(2==this.loadState){var s;if(!e&&this.cacheItem&&this.map.resourcesCache.updateItem(this.cacheItem),(1==this.type&&!this.imageData||1!=this.type&&!this.gpuTexture)&&this.stats.renderBuild>this.map.config.mapMaxProcessingTime)return this.map.markDirty(),!1;if(r)return 1==this.type&&(this.imageData||(s=performance.now(),this.buildHeightMap(),this.stats.renderBuild+=performance.now()-s)),!0;if(1==this.type)this.imageData||(s=performance.now(),this.buildHeightMap(),this.stats.renderBuild+=performance.now()-s);else{if(!this.gpuTexture){if(this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed)return!1;if(a)return!1;s=performance.now(),this.buildGpuTexture(),this.stats.renderBuild+=performance.now()-s}!e&&this.gpuCacheItem&&this.map.gpuCache.updateItem(this.gpuCacheItem)}return!0}return 0==this.loadState?e||this.scheduleLoad(t):3==this.loadState&&this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(t),!1},o.prototype.scheduleLoad=function(e,t){this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this,t),e,this.tile,this.internal?"texture-in":"texture-ex")},o.prototype.onLoad=function(e,t,r,i){this.mapLoaderCallLoaded=r,this.mapLoaderCallError=i;var a=this.onLoadError.bind(this),n=this.onLoaded.bind(this);e?this.checkStatus=1:this.loadState=1,this.map.config.mapXhrImageLoad?s.loadBinary(t,this.onBinaryLoaded.bind(this),a,!!s.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams,"blob"):this.image=s.loadImage(t,n,a,!!this.map.core.tokenCookieHost&&-1!=t.indexOf(this.map.core.tokenCookieHost))},o.prototype.onLoadError=function(e){this.map.killed||(e&&window.URL.revokeObjectURL(this.image.src),this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},o.prototype.onBinaryLoaded=function(e){if(this.fastHeaderCheck&&this.checkType&&1!=this.checkType&&(this.onHeadLoaded(null,e,null),-1==this.checkStatus))return void this.mapLoaderCallLoaded();var t=new Image;t.onerror=this.onLoadError.bind(this,!0),t.onload=this.onLoaded.bind(this,!0),this.image=t,t.src=window.URL.createObjectURL(e),this.fileSize=e.size},o.prototype.onLoaded=function(e){if(!this.map.killed){e&&window.URL.revokeObjectURL(this.image.src);var t=this.image.naturalWidth*this.image.naturalHeight*(this.heightMap,3);this.gpuSize=this.image.naturalWidth*this.image.naturalHeight*4,this.cacheItem=this.map.resourcesCache.insert(this.killImage.bind(this,!0),t),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},o.prototype.scheduleHeadRequest=function(e,t){this.map.config.mapXhrImageLoad&&this.fastHeaderCheck?this.scheduleLoad(e,!0):this.map.loader.load(this.mapLoaderUrl,this.onLoadHead.bind(this,t),e,this.tile,this.internal,this.internal?"texture-in":"texture-ex")},o.prototype.onLoadHead=function(e,t,r,i){this.mapLoaderCallLoaded=r,this.mapLoaderCallError=i;var a=this.onLoadHeadError.bind(this,e),n=this.onHeadLoaded.bind(this,e);this.checkStatus=1,e?s.loadBinary(t,n,a,!!s.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams,"blob"):s.headRequest(t,n,a,!!s.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams,"blob")},o.prototype.onLoadHeadError=function(){this.map.killed||(this.checkStatus=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},o.prototype.onHeadLoaded=function(e,t,r){if(!this.map.killed)if(this.checkStatus=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.map.config.mapXhrImageLoad&&this.fastHeaderCheck)switch(this.checkType){case 4:t&&t.size==this.checkValue&&(this.checkStatus=-1);break;case 2:t&&t.type==this.checkValue&&(this.checkStatus=-1);break;case 3:r&&-1!=this.checkValue.indexOf(r)&&(this.checkStatus=-1)}else{switch(this.checkType){case 4:t&&t.byteLength==this.checkValue&&(this.checkStatus=-1);break;case 2:t&&-1!=t.indexOf(this.checkValue)&&(this.checkStatus=-1);break;case 3:r&&-1!=this.checkValue.indexOf(r)&&(this.checkStatus=-1)}this.mapLoaderCallLoaded()}},o.prototype.buildGpuTexture=function(){this.gpuTexture=new n(this.map.renderer.gpu,null,this.map.core),this.gpuTexture.createFromImage(this.image,2==this.type?"nearest":"linear",!1),this.stats.gpuTextures+=this.gpuTexture.size,this.stats.graphsFluxTexture[0][0]++,this.stats.graphsFluxTexture[0][1]+=this.gpuTexture.size,this.gpuCacheItem=this.map.gpuCache.insert(this.killGpuTexture.bind(this,!0),this.gpuTexture.size),this.gpuSize=this.gpuTexture.size},o.prototype.buildHeightMap=function(){var e=document.createElement("canvas");e.width=this.image.naturalWidth,e.height=this.image.naturalHeight;var t=e.getContext("2d");t.drawImage(this.image,0,0),this.imageData=t.getImageData(0,0,this.image.naturalWidth,this.image.naturalHeight).data,this.imageExtents=[this.image.naturalWidth,this.image.naturalHeight],this.image=null},o.prototype.getGpuTexture=function(){return this.gpuTexture},o.prototype.getHeightMapValue=function(e,t){return this.imageData?this.imageData[4*(t*this.imageExtents[0]+e)]:0},t.a=o},function(e,t,r){"use strict";var i=r(152),a=i.a,s=function(e,t,r){this.map=e,this.camera=e.camera,this.rootId=[0,0,0],this.freeLayer=t,this.freeLayerSurface=r,this.metaBinaryOrder=this.map.referenceFrame.params.metaBinaryOrder,this.surfaceTree=new a(this.map,null,this.rootId),this.surfaceSequence=[],this.surfaceOnlySequence=[],this.config=this.map.config,this.cameraPos=[0,0,0],this.worldPos=[0,0,0],this.ndcToScreenPixel=1,this.counter=0};s.prototype.kill=function(){this.surfaceTree=null,this.metastorageTree=null,this.surfaceTracer=null,this.heightTracer=null},s.prototype.findSurfaceTile=function(e){for(var t=this.surfaceTree,r=e[0];r>0;r--){var i=1<<r-1,a=0;if(0!=(e[1]&i)&&(a+=1),0!=(e[2]&i)&&(a+=2),!(t=t.children[a]))return null}return t},s.prototype.findNavTile=function(e){var t=this.surfaceTree;if(0==e[0])return t.metanode&&t.metanode.hasNavtile()?t:null;for(var r=null,i=e[0];i>0;i--){var a=1<<i-1,s=0;if(0!=(e[1]&a)&&(s+=1),0!=(e[2]&a)&&(s+=2),!(t=t.children[s]))return r;t.metanode&&t.metanode.hasNavtile()&&(r=t)}return r},s.prototype.draw=function(e){this.cameraPos=[0,0,0],this.worldPos=[0,0,0];var t=this.map,r=t.draw;this.ndcToScreenPixel=r.ndcToScreenPixel;var i=t.getPhysicalSrs(),a=i.periodicity;if(!this.freeLayerSurface||!this.freeLayerSurface.geodata||0==r.drawChannel)if(null!=a)this.drawSurface([0,0,0]),"X"==a.type&&(this.drawSurface([a.period,0,0],e),this.drawSurface([-a.period,0,0],e));else{switch(this.freeLayerSurface&&this.freeLayerSurface.geodata?t.config.mapGeodataLoadMode:t.config.mapLoadMode){case"topdown":this.drawSurface([0,0,0],e);break;case"fit":this.drawSurfaceFit([0,0,0],e);break;case"fitonly":this.drawSurfaceFitOnly([0,0,0],e)}}},s.prototype.updateNodeHeightExtents=function(e,t){if(!t.heightReady&&t.metatile.useVersion<4){for(var r=e.parent;r;){var i=r.metanode;if(i.hasNavtile()){t.minHeight=i.minHeight,t.maxHeight=i.maxHeight,t.minZ=i.minZ,t.maxZ=i.maxZ,t.generateCullingHelpers();break}r=r.parent}t.heightReady=!0}},s.prototype.logTileInfo=function(e,t,r){if(e&&t){var i=e.bboxVisible(e.id,t.bbox,r,t);e.updateTexelSize(),console.log("tile: "+JSON.stringify(e.id)+" visible: "+i+" texelsize: "+e.texelSize+" center: "+JSON.stringify(t.diskPos)+" vec: "+t.diskNormal+"ang: "+t.diskAngle+" dist: "+t.diskDistance)}},s.prototype.drawSurface=function(e,t){this.counter++;var r=this.surfaceTree;if(r.isMetanodeReady(this,0)){var i=this.map,a=r.metanode,s=i.camera.position;if(r.bboxVisible(r.id,a.bbox,s,a)){r.updateTexelSize();var n=(this.freeLayerSurface,1),o=i.draw,h=o.drawTiles,l=o.drawBuffer,u=o.processBuffer,c=o.processBuffer2,d=0,p=0,f=0,m=0,g=0,v=0;u[0]=r,p=1;var y=o.texelSizeFit,b=o.replay,x=b.storeNodes||b.storeFreeNodes,M=b.nodeBuffer;o.drawCounter++;var S,w,A,T=1,C=1,P=1,F=o.drawCounter;do{var L=0;for(f=0,S=p-1;S>=0;S--)if(r=u[S],a=r.metanode,a&&(T++,a.metatile.drawCounter!=F&&(a.metatile.drawCounter=F,C++)),r.bboxVisible(r.id,a.bbox,s,a))if(P++,r.texelSize!=Number.POSITIVE_INFINITY&&r.texelSize>L&&(L=r.texelSize),x&&M.push(r),r.texelSize<=y)v=o.getDrawCommandsGpuSize(r.drawCommands[o.drawChannel]||r.lastRenderState.drawCommands[o.drawChannel]),m+=v,g+=v,r.drawCounter=o.drawCounter,l[d]=r,d++;else{v=o.getDrawCommandsGpuSize(r.drawCommands[o.drawChannel]||r.lastRenderState.drawCommands[o.drawChannel]),m+=v;var E=0,I=0,N=[];for(w=0;w<4;w++){var B=r.children[w];if(B&&(E++,B.isMetanodeReady(this,B.id[0]))){this.updateNodeHeightExtents(B,B.metanode),B.updateTexelSize(1);var _=B.id[0]*n*B.distance;r.surface&&B.metanode.hasGeometry()?h.drawSurfaceTile(B,B.metanode,s,B.texelSize,_,!0,!1,!0)&&(I++,N.push(B)):(I++,N.push(B))}}if(E>0&&E==I&&0!=E){do{var R=!0;for(w=0,A=N.length-1;w<A;w++)if(N[w].distance>N[w+1].distance){var k=N[w];N[w]=N[w+1],N[w+1]=k,R=!1}}while(!R);for(w=0,A=N.length;w<A;w++)c[f]=N[w],f++}else g+=v,r.drawCounter=o.drawCounter,l[d]=r,d++}var z=u;u=c,c=z,p=f}while(p>0);if(t)return void this.storeDrawBufferGeometry(d);0>o.bestMeshTexelSize&&(o.bestMeshTexelSize=0);var U=i.stats;if(U.usedNodes=P,U.processedNodes=T,U.processedMetatiles=C,U.gpuNeeded=m,b.storeTiles||b.storeFreeTiles){o.tileBuffer[0]||(o.tileBuffer[0]=[]);var D=o.tileBuffer[0];for(S=d-1;S>=0;S--)D.push(l[S])}for(i.gpuCache.skipCostCheck=!0,S=d-1;S>=0&&(r=l[S],!(U.gpuRenderUsed>=o.maxGpuUsed));S--)h.drawSurfaceTile(r,r.metanode,s,r.texelSize,0,!1,!1);i.gpuCache.skipCostCheck=!1,i.gpuCache.checkCost()}}},s.prototype.drawSurfaceFitOnly=function(e,t){this.counter++;var r=this.surfaceTree;if(r.isMetanodeReady(this,0)){var i=this.map,a=r.metanode,s=i.camera.position;if(r.bboxVisible(r.id,a.bbox,s,a)){r.updateTexelSize();var n=i.draw,o=n.drawTiles,h=n.drawBuffer,l=n.processBuffer,u=n.processBuffer2,c=0,d=0,p=0;l[0]=r,d=1;var f=n.texelSizeFit,m=i.draw.replay,g=m.storeNodes||m.storeFreeNodes,v=m.nodeBuffer;n.drawCounter++;var y,b,x,M=1,S=1,w=1,A=i.drawCounter;do{var T=0;for(p=0,y=d-1;y>=0;y--)if(r=l[y],a=r.metanode,a&&(S++,a.metatile.drawCounter!=A&&(a.metatile.drawCounter=A,w++)),r.bboxVisible(r.id,a.bbox,s,a))if(M++,g&&v.push(r),r.texelSize!=Number.POSITIVE_INFINITY&&r.texelSize>T&&(T=r.texelSize),r.texelSize<=f)r.drawCounter=n.drawCounter,h[c]=r,c++;else{var C=0,P=[];for(b=0;b<4;b++){var F=r.children[b];F&&(C++,F.isMetanodeReady(this,F.id[0])&&(this.updateNodeHeightExtents(F,F.metanode),F.updateTexelSize(),P.push(F)))}if(C>0){do{var L=!0;for(b=0,x=P.length-1;b<x;b++)if(P[b].distance>P[b+1].distance){var E=P[b];P[b]=P[b+1],P[b+1]=E,L=!1}}while(!L);for(b=0,x=P.length;b<x;b++)u[p]=P[b],p++}else r.drawCounter=n.drawCounter,h[c]=r,c++}var I=l;l=u,u=I,d=p}while(d>0);if(t)return void this.storeDrawBufferGeometry(c);var N=i.stats;if(N.usedNodes=M,N.processedNodes=S,N.processedMetatiles=w,m.storeTiles||m.storeFreeTiles){n.tileBuffer[0]||(n.tileBuffer[0]=[]);var B=n.tileBuffer[0];for(y=c-1;y>=0;y--)B.push(h[y])}for(i.gpuCache.skipCostCheck=!0,y=c-1;y>=0&&(r=h[y],!(N.gpuRenderUsed>=n.maxGpuUsed));y--)o.drawSurfaceTile(r,r.metanode,s,r.texelSize,0,!1,!1);i.gpuCache.skipCostCheck=!1,i.gpuCache.checkCost()}}},s.prototype.drawSurfaceFit=function(e,t){this.counter++;var r=this.surfaceTree;if(r.isMetanodeReady(this,0)){var i=this.map,a=r.metanode,s=i.camera.position;if(r.bboxVisible(r.id,a.bbox,s,a)){r.updateTexelSize();var n=r.surface?r.surface.geodata:null,o=r.surface?r.surface.free:null,h=!n&&!o&&i.config.mapHeightfiledWhenUnloaded,l=4,u=2e3;this.freeLayerSurface&&(l=0,u=.1);var c=i.draw,d=c.drawTiles,p=c.replay,f=c.drawBuffer,m=c.processBuffer,g=c.processBuffer2,v=0,y=0,b=0;m[0]=[r,0],y=1;var x=c.texelSizeFit,M=p.storeNodes||p.storeFreeNodes,S=p.nodeBuffer;c.drawCounter++;var w,A,T,C,P,F,L=1,E=1,I=1,N=c.drawCounter,B=i.config.mapMaxHiresLodLevels;do{var _=0;for(b=0,w=y-1;w>=0;w--){var R=m[w];r=R[0];var k=R[1];if(r.childrenReadyCount=0,k>=B){if(h){for(F=r,A=k;A>0&&(F.parent&&0==F.parent.childrenReadyCount);A--)F=F.parent;F.drawCounter!=c.drawCounter&&(F.drawCounter=c.drawCounter,f[v]=[F,!0],v++)}}else{if(a=r.metanode,a&&(E++,a.metatile.drawCounter!=N&&(a.metatile.drawCounter=N,I++)),r.bboxVisible(r.id,a.bbox,s,a)){L++,r.texelSize!=Number.POSITIVE_INFINITY&&r.texelSize>_&&(_=r.texelSize),M&&S.push(r);var z=b,U=v;if(!a.hasChildren()||r.texelSize<=x)if(P=(r.id[0]+l)*u*r.distance,a.hasChildren()&&!d.drawSurfaceTile(r,r.metanode,s,r.texelSize,P,!0,k>0,!0)){for(k++,A=0;A<4;A++)(C=r.children[A])&&C.isMetanodeReady(this,C.id[0],!0)&&(this.updateNodeHeightExtents(C,C.metanode),C.updateTexelSize(),d.drawSurfaceTile(C,C.metanode,s,C.texelSize,P,!0,k>0,!0)?(r.childrenReadyCount++,C.drawCounter=c.drawCounter,f[v]=[C,!1],v++):(g[b]=[C,k],b++));z==b&&U==v&&k--}else r.drawCounter=c.drawCounter,f[v]=[r,!1],v++;else if(0==k&&a.hasGeometry()&&r.texelSize<=2*x){var D=0,G=0,V=[];for(A=0;A<4;A++)(C=r.children[A])&&(D++,C.isMetanodeReady(this,C.id[0])&&(this.updateNodeHeightExtents(C,C.metanode),C.updateTexelSize(),P=(C.id[0]+l)*u*C.distance,d.drawSurfaceTile(C,C.metanode,s,C.texelSize,P,!0,!0,!0)&&(G++,V.push(C))));if(D>0&&D==G){do{var O=!0;for(A=0,T=V.length-1;A<T;A++)if(V[A].distance>V[A+1].distance){var j=V[A];V[A]=V[A+1],V[A+1]=j,O=!1}}while(!O);for(A=0,T=V.length;A<T;A++)g[b]=[V[A],k],b++}else if(P=(r.id[0]+l)*u*r.distance,d.drawSurfaceTile(r,r.metanode,s,r.texelSize,P,!0,!0,!0))for(r.drawCounter=c.drawCounter,f[v]=[r,!1],v++,A=0;A<4;A++)(C=r.children[A])&&C.isMetanodeReady(this,C.id[0])&&(P=(C.id[0]+l)*u*C.distance,d.drawSurfaceTile(C,C.metanode,s,C.texelSize,P,!0,!1,!0));else for(A=0;A<4;A++)(C=r.children[A])&&C.isMetanodeReady(this,C.id[0])&&(this.updateNodeHeightExtents(C,C.metanode),C.updateTexelSize(),g[b]=[C,k],b++)}else for(A=0;A<4;A++)(C=r.children[A])&&C.isMetanodeReady(this,C.id[0])&&(this.updateNodeHeightExtents(C,C.metanode),C.updateTexelSize(),g[b]=[C,k],b++)}if(h&&z==b&&U==v){for(F=r,A=k;A>0&&(F.parent&&0==F.parent.childrenReadyCount);A--)F=F.parent;F.drawCounter!=c.drawCounter&&(F.drawCounter=c.drawCounter,f[v]=[F,!0],v++)}}}var H=m;m=g,g=H,y=b}while(y>0);if(t)return void this.storeDrawBufferGeometry(v);var q=i.stats;if(q.usedNodes=L,q.processedNodes=E,q.processedMetatiles=I,p.storeTiles||p.storeFreeTiles){c.tileBuffer[0]||(c.tileBuffer[0]=[]);var J=c.tileBuffer[0];for(w=v-1;w>=0;w--)J.push(f[w])}for(i.gpuCache.skipCostCheck=!0,w=v-1;w>=0;w--){var X=f[w];r=X[0],h&&X[1]||q.gpuRenderUsed>=c.maxGpuUsed?(d.debug.drawBBoxes&&d.drawTileInfo(r,r.metanode,s),r.drawGrid(s)):X[1]||d.drawSurfaceTile(r,r.metanode,s,r.texelSize,0,!1,!1)}i.gpuCache.skipCostCheck=!1,i.gpuCache.checkCost()}}},s.prototype.storeDrawBufferGeometry=function(e){var t=this.map,r=t.draw.drawBuffer;this.storeGeometry(r,e)},s.prototype.storeGeometry=function(e,t){var r=this.map,i=e;r.storedTilesRes=new Array(t);for(var a=t-1;a>=0;a--){var s=i[a];if(s.metanode&&s.surface&&s.metanode.hasGeometry()&&s.surfaceMesh&&s.surfaceMesh.isReady(!0,0,!0)){for(var n=s.surfaceMesh,o=[],h=0,l=n.submeshes.length;h<l;h++){for(var u=n.submeshes[h],c=u.vertices.slice(),d=u.bbox.min,p=u.bbox.max,f=[p[0]-d[0],p[1]-d[1],p[2]-d[2]],m=0,g=c.length;m<g;m+=3)c[m]=c[m]*f[0]+d[0],c[m+1]=c[m+1]*f[1]+d[1],c[m+2]=c[m+2]*f[2]+d[2];o.push({bbox:[d.slice(),p.slice()],vertices:c})}r.storedTilesRes[a]={id:s.id.slice(),type:"mesh",submeshes:o}}}},s.prototype.traceHeight=function(e,t,r){if(e){this.params=t;var i=r?this.traceHeightTileByNodeOnly:this.traceHeightTileByMap;(1!=e.id[0]||(this.traceHeightTile(e.parent,0,!0),e.parent.metanode))&&this.traceHeightTile(e,0,!1,i)}},s.prototype.traceHeightTile=function(e,t,r,i){if(null!=e){if(!e.isMetanodeReady(this,0)||r)return void(this.params.waitingForNode=!0);e.metanode.metatile.used(),e.lastSurface&&e.lastSurface==e.surface&&(e.lastSurface=null,e.restoreLastState());if(i(e,this.params,t)){var a=this.traceHeightChild(e,this.params),s=e.children[a];s||(this.params.finalNode=!0),this.traceHeightTile(s,0,!1,i)}}},s.prototype.traceHeightChild=function(e,t){var r=t.coords,i=t.extents,a=[.5*(i.ll[0]+i.ur[0]),.5*(i.ll[1]+i.ur[1])],s=r[0]>=a[0],n=r[1]>=a[1];return s?(i.ll[0]=a[0],n?i.ll[1]=a[1]:i.ur[1]=a[1]):(i.ur[0]=a[0],n?i.ll[1]=a[1]:i.ur[1]=a[1]),s?n?1:3:n?0:2},s.prototype.traceHeightTileByMap=function(e,t){if(!e||e.id[0]>t.desiredLod&&t.heightMap)return!1;var r=e.metanode;if(!r)return!1;if(!r.hasNavtile())return t.heightMap||(t.metanode=r),!0;if(t.bestHeightMap=e.id[0],e.heightMap){if(e.heightMap.isReady(null,null,!0))return t.parent={metanode:t.metanode,heightMap:t.heightMap,heightMapExtents:t.heightMapExtents},t.metanode=r,t.heightMap=e.heightMap,t.heightMapExtents={ll:t.extents.ll.slice(),ur:t.extents.ur.slice()},e.id[0]!=t.desiredLod}else{if(!e.surface||!e.resourceSurface)return!1;if(!e.resourceSurface.getNavUrl)return!1;var i=e.resourceSurface.getNavUrl(e.id);e.heightMap=e.resources.getTexture(i,!0)}return!1},s.prototype.traceHeightTileByNodeOnly=function(e,t){if(!e||e.id[0]>t.desiredLod)return!1;var r=e.metanode;return!!r&&(t.parent={metanode:t.metanode},t.metanode=r,e.id[0]!=t.desiredLod)},s.prototype.getNodeById=function(e,t){var r=this.surfaceTree;if(null!=r){for(var i=e[0];i>0;i--){var a=1<<i-1,s=0;if(0!=(e[1]&a)&&(s+=1),0!=(e[2]&a)&&(s+=2),!r.children[s]){if(!r.isMetanodeReady(this,0,t))return null;if(!r.metanode.hasChild(s))return null;r.addChild(s)}r=r.children[s]}if(r&&r.isMetanodeReady(this,0,t)){var n=r.metanode;return r.metanode.metatile.used(),n}}},s.prototype.getRenderedNodeById=function(e,t){var r=this.surfaceTree;if(null!=r){if(r.drawCounter==t){if(!r.isMetanodeReady(this,0))return;return r.metanode}for(var i=e[0];i>0;i--){var a=1<<i-1,s=0;if(0!=(e[1]&a)&&(s+=1),0!=(e[2]&a)&&(s+=2),!r.children[s]){if(!r.isMetanodeReady(this,0))return;if(!r.metanode.hasChild(s))return}if(r=r.children[s],r.drawCounter==t){if(!r.isMetanodeReady(this,0))return;return r.metanode}}}},s.prototype.chekTileMesh=function(e){if(this.params.loadMeshes||this.params.loadTextures){var t=this.config.mapNoTextures;this.config.mapNoTextures=!this.params.loadTextures,this.map.draw.drawTiles.drawSurfaceTile(e,e.metanode,this.map.renderer.cameraPosition,e.texelSize,0,!0,!1,!0)||(this.params.loaded=!1),this.config.mapNoTextures=t}},s.prototype.traceAreaTiles=function(e,t,r){if(null!=e){if(!e.isMetanodeReady(this,0)||r)return this.params.loaded=!1,void e.isMetanodeReady(this,0);if(e.metanode.metatile.used(),e.lastSurface&&e.lastSurface==e.surface&&(e.lastSurface=null,e.restoreLastState()),e.insideCone(this.params.coneVec,this.params.coneAngle,e.metanode)){if("lod"==this.params.mode?e.id[0]>=this.params.limit:e.metanode.pixelSize<=this.params.limit)return this.chekTileMesh(e),void this.params.areaTiles.push(e);if(e.metanode.hasChildren())for(var i=0;i<4;i++)this.traceAreaTiles(e.children[i],t,r);else this.chekTileMesh(e),this.params.areaTiles.push(e)}}},t.a=s},function(e,t,r){"use strict";var i=r(30),a=r(51),s=r(53),n=r(5),o=r(4),h=r(12),l=i.a,u=a.a,c=s.a,d=n.a,p=o.a,f=h.a,m=function(e,t,r){if(this.map=e,this.id=null,this.type="basic",this.metaBinaryOrder=1,this.metaUrl="",this.navUrl="",this.navDelta=1,this.meshUrl="",this.textureUrl="",this.baseUrl=this.map.url.baseUrl,this.baseUrlSchema=this.map.url.baseUrlSchema,this.baseUrlOrigin=this.map.url.baseUrlOrigin,this.lodRange=[0,0],this.tileRange=[[0,0],[0,0]],this.textureLayer=null,this.boundLayerSequence=[],this.glue="glue"==r,this.free="free"==r,this.virtual=!1,this.zFactor=0,this.ready=!1,this.geodataProcessor=null,this.geodataCounter=0,this.geodataNavtileInfo=!1,this.monoGeodata=null,this.monoGeodataView=null,this.monoGeodataCounter=-1,this.creditsNumbers=[],this.style=null,this.stylesheet=null,this.originalStyle=null,this.originalStylesheet=null,this.styleChanged=!0,this.free?this.tree=new c(this.map,!0,this):this.tree=null,"string"==typeof t){this.jsonUrl=this.map.url.processUrl(t),this.baseUrl=f.getBase(this.jsonUrl),this.baseUrlSchema=f.getSchema(this.jsonUrl),this.baseUrlOrigin=f.getOrigin(this.jsonUrl);var i=function(e){this.parseJson(e),this.ready=!0,this.map.refreshView()}.bind(this),a=function(){}.bind(this);p.loadJSON(this.jsonUrl,i,a,null,!!p.useCredentials&&-1!=this.jsonUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)}else this.parseJson(t),this.ready=!0};m.prototype.parseJson=function(e){this.id=e.id||null,this.type=e.type||"basic",this.metaBinaryOrder=e.metaBinaryOrder||1,this.metaUrl=this.processUrl(e.metaUrl,""),this.navUrl=this.processUrl(e.navUrl,""),this.hmapUrl=this.processUrl(e.hmapUrl,e.navUrl+"00"),this.pipeline=this.map.config.mapForcePipeline?this.map.config.mapForcePipeline:e.pipeline,this.navDelta=e.navDelta||1,this.meshUrl=this.processUrl(e.meshUrl,""),this.textureUrl=this.processUrl(e.textureUrl,""),this.geodataUrl=this.processUrl(e.geodataUrl||e.geodata,""),this.lodRange=e.lodRange||[0,0],this.tileRange=e.tileRange||[[0,0],[0,0]],this.textureLayer=e.textureLayer||null,this.geodata="geodata"==this.type||"geodata-tiles"==this.type,this.credits=e.credits||[],this.creditsUrl=null,this.displaySize=e.displaySize||256;var t,r;if(e.extents){var i=e.extents.ll,a=e.extents.ur;this.extents=new d(i[0],i[1],i[2],a[0],a[1],a[2])}else this.extents=new d(0,0,0,1,1,1);switch(this.specificity=Math.pow(2,this.lodRange[0])/((this.tileRange[1][0]-this.tileRange[1][0]+1)*(this.tileRange[1][1]-this.tileRange[1][1]+1)),typeof this.credits){case"string":this.creditsUrl=this.credits,this.credits=[];break;case"object":if(!Array.isArray(this.credits)){var s=this.credits;this.credits=[];for(var n in s)this.map.addCredit(n,new l(this.map,s[n])),this.credits.push(n)}for(t=0,r=this.credits.length;t<r;t++){var o=this.map.getCreditById(this.credits[t]);this.creditsNumbers.push(o?o.id:null)}}if(this.geodataUrl&&"string"==typeof this.geodataUrl&&-1!=this.geodataUrl.indexOf("{geonavtile}")&&(this.geodataNavtileInfo=!1),this.geodata){var h=e.style;this.originalStyle=h,h&&(this.setStyle(h),this.originalStylesheet=this.stylesheet)}if(this.surfaceReference=[],this.glue)for(t=0,r=this.id.length;t<r;t++)this.surfaceReference.push(this.map.getSurface(this.id[t]))},m.prototype.kill=function(){this.geodataProcessor&&(this.geodataProcessor.kill(),this.geodataProcessor=null),this.geodataUrl=null,this.style=null,this.stylesheet=null,this.originalStyle=null,this.originalStylesheet=null},m.prototype.setOptions=function(){},m.prototype.getOptions=function(){return this.getInfo()},m.prototype.getInfo=function(){return this.geodata?{type:this.type,metaUrl:this.metaUrl,geodataUrl:this.geodataUrl,lodRange:this.lodRange,tileRange:this.tileRange,style:this.originalStyle}:{type:this.type,metaUrl:this.metaUrl,navUrl:this.navUrl,meshUrl:this.meshUrl,textureUrl:this.textureUrl,lodRange:this.lodRange,tileRange:this.tileRange,textureLayer:this.textureLayer}},m.prototype.processUrl=function(e,t){return e?"string"!=typeof e?e:(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},m.prototype.hasTile=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var r=e[1]>>t,i=e[2]>>t;return!(e[0]<this.lodRange[0]||e[0]>this.lodRange[1]||r<this.tileRange[0][0]||r>this.tileRange[1][0]||i<this.tileRange[0][1]||i>this.tileRange[1][1])},m.prototype.hasTile2=function(e){var t=e[0]-this.lodRange[0],r=t<0;if(e[0]<this.lodRange[0]){t=-t;var i=this.tileRange[0][0]>>t,a=this.tileRange[0][1]>>t,s=this.tileRange[1][0]>>t,n=this.tileRange[1][1]>>t;if(e[0]>this.lodRange[1]||e[1]<i||e[1]>s||e[2]<a||e[2]>n)return[!1,!1]}else{var o=e[1]>>t,h=e[2]>>t;if(e[0]>this.lodRange[1]||o<this.tileRange[0][0]||o>this.tileRange[1][0]||h<this.tileRange[0][1]||h>this.tileRange[1][1])return[!1,!1]}return[!0,r]},m.prototype.hasMetatile=function(e){if(e[0]>this.lodRange[1])return!1;var t=e[0]-this.lodRange[0];if(t>=0){var r=e[1]>>t,i=e[2]>>t;if(r<this.tileRange[0][0]||r>this.tileRange[1][0]||i<this.tileRange[0][1]||i>this.tileRange[1][1])return!1}else if(t=-t,e[1]<this.tileRange[0][0]>>t||e[1]>this.tileRange[1][0]>>t||e[2]<this.tileRange[0][1]>>t||e[2]>this.tileRange[1][1]>>t)return!1;return!0},m.prototype.setStyle=function(e){if(this.style!=e){var t=e;"object"!=typeof t?t=this.processUrl(t,""):(t=JSON.stringify(t),t=p.getHash(t),t="#obj#"+t.toString(16)),this.stylesheet=this.map.getStylesheet(t),this.stylesheet||(this.stylesheet=new u(this.map,t,e,this),this.map.addStylesheet(t,this.stylesheet)),this.style=e,this.styleChanged=!0,this.geodataCounter++,this.map.markDirty()}},m.prototype.getSurfaceReference=function(e){return this.surfaceReference[e-1]},m.prototype.getMetaUrl=function(e,t){return this.map.url.makeUrl(this.metaUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},m.prototype.getNavUrl=function(e,t){return this.map.url.makeUrl(this.navUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},m.prototype.getHMapUrl=function(e,t){return this.map.url.makeUrl(this.hmapUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},m.prototype.getMeshUrl=function(e,t){return this.map.url.makeUrl(this.meshUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},m.prototype.getTextureUrl=function(e,t,r){return this.map.url.makeUrl(this.textureUrl,{lod:e[0],ix:e[1],iy:e[2]},t,r)},m.prototype.getGeodataUrl=function(e,t,r){return this.map.url.makeUrl(this.geodataUrl,{lod:e[0],ix:e[1],iy:e[2]},t,r)},m.prototype.getMonoGeodataUrl=function(e,t){return this.map.url.makeUrl(this.geodataUrl,{},null,t)},t.a=m},function(e,t,r){"use strict";var i=r(52),a=i.a,s=function(e,t,r,i,s,n,o){if(this.map=e,this.stats=e.stats,this.tile=n,this.internal=o,this.mainTexture=n?n.resources.getSubtexture(this,t,r,n,o):new a(e,t,r,n,o),this.maskTexture=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.neverReady=!1,this.maskTexture=null,this.mapLoaderUrl=t,this.type=r||0,this.extraBound=i,this.extraInfo=s,this.statsCounter=0,this.checkStatus=0,this.checkType=null,this.checkValue=null,this.fastHeaderCheck=!1,this.fileSize=0,s&&s.layer){var h=s.layer;if(h.availability)switch(this.checkType=h.availability.type,this.checkType){case 2:this.checkValue=h.availability.mime;break;case 3:this.checkValue=h.availability.codes;break;case 4:this.checkValue=h.availability.size}}};s.prototype.kill=function(){this.mainTexture.killImage(),this.mainTexture.killGpuTexture(),this.mainTexture=null,this.maskTexture&&(this.maskTexture.killImage(),this.maskTexture.killGpuTexture())},s.prototype.killImage=function(){this.mainTexture.killImage(),this.maskTexture&&this.maskTexture.killImage()},s.prototype.killGpuTexture=function(){this.mainTexture.killGpuTexture(),this.maskTexture&&this.maskTexture.killGpuTexture()},s.prototype.setBoundTexture=function(e,t,r){if(e){if(r){if(this.extraBound.sourceTile=e,this.extraBound.hmap=r,!e.hmap){var i=e.resourceSurface.getHMapUrl(e.id,!0);e.hmap=e.resources.getTexture(i,null,null,{tile:e,hmap:r},this.tile,this.internal)}this.extraBound.texture=e.hmap}else if(t){if(this.extraBound.sourceTile=e,this.extraBound.layer=t,!e.boundTextures[t.id]){e.boundLayers[t.id]=t;var i=t.getUrl(e.id);e.boundTextures[t.id]=e.resources.getTexture(i,null,null,{tile:e,layer:t},this.tile,this.internal)}this.extraBound.texture=e.boundTextures[t.id]}this.extraBound.transform=this.map.draw.drawTiles.getTileTextureTransform(e,this.extraBound.tile),this.map.markDirty()}},s.prototype.isReady=function(e,t,r){var i=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;if(e=e||i,this.neverReady)return!1;var a;if(this.extraBound){if(this.extraBound.texture){for(;this.extraBound.texture.extraBound||-1==this.extraBound.texture.checkStatus;){if(a=this.extraBound.sourceTile.parent,this.extraBound.hmap){if(!a||a.id[0]<1)return this.neverReady=!0,this.extraBound.tile.resetDrawCommands=!0,this.map.markDirty(),!1}else if(this.extraBound.layer&&a.id[0]<this.extraBound.layer.lodRange[0])return this.neverReady=!0,this.extraBound.tile.resetDrawCommands=!0,this.map.markDirty(),!1;this.setBoundTexture(a,this.extraBound.layer)}var s=this.extraBound.texture.isReady(e,t,r);return s&&this.checkMask&&(this.extraBound.tile.resetDrawCommands=null!=this.extraBound.texture.getMaskTexture(),this.checkMask=!1),s}return this.setBoundTexture(this.extraBound.sourceTile,this.extraBound.layer,this.extraBound.hmap),!1}switch(this.checkType){case 1:if(2!=this.checkStatus){if(0==this.checkStatus&&this.extraInfo&&this.extraInfo.tile){var n=this.extraInfo.tile.boundmetaresources;n||(n=this.map.resourcesTree.findAgregatedNode(this.extraInfo.tile.id,8),this.extraInfo.tile.boundmetaresources=n);var o=this.extraInfo.layer,h=this.extraInfo.metaPath;this.extraInfo.metaPath||(h=o.getMetatileUrl(n.id),this.extraInfo.metaPath=h);var l=n.getTexture(h,!0,null,null,this.tile,this.internal);if(this.maskTexture)this.maskTexture.isReady(e,t,r,this)&&(this.checkStatus=2);else if(l.isReady(e,t,r)){var u=this.extraInfo.tile,c=l.getHeightMapValue(255&u.id[1],255&u.id[2]);this.checkStatus=128&c?2:-1,2==this.checkStatus&&(64&c||(h=o.getMaskUrl(u.id),this.maskTexture=u.resources.getTexture(h,null,null,null,this.tile,this.internal),this.checkStatus=0)),u.resetDrawCommands=!0,this.map.markDirty()}}if(-1==this.checkStatus){if(!this.extraBound){if(a=this.extraInfo.tile.parent,a.id[0]<this.extraInfo.layer.lodRange[0])return this.neverReady=!0,this.extraInfo.tile.resetDrawCommands=!0,this.map.markDirty(),!1;this.extraBound={tile:this.extraInfo.tile,layer:this.extraInfo.layer},this.setBoundTexture(this.extraBound.tile.parent,this.extraBound.layer),this.checkMask=!0}for(;this.extraBound.texture.extraBound||-1==this.extraBound.texture.checkStatus;){if(a=this.extraBound.sourceTile.parent,a.id[0]<this.extraBound.layer.lodRange[0])return this.neverReady=!0,this.extraBound.tile.resetDrawCommands=!0,this.map.markDirty(),!1;this.setBoundTexture(a,this.extraBound.layer)}}return!1}}var d=!0;return this.maskTexture&&(d=this.maskTexture.isReady(e,t,r,this)),this.mainTexture.isReady(e,t,r,this)&&d},s.prototype.isMaskPosible=function(){var e=this;return this.extraBound&&this.extraBound.texture&&(e=this.extraBound.texture),1==e.checkType},s.prototype.isMaskInfoReady=function(){var e=this;return this.extraBound&&this.extraBound.texture&&(e=this.extraBound.texture),1!=e.checkType||!(!this.maskTexture&&2!=e.checkStatus&&-1!=e.checkStatus)},s.prototype.getGpuTexture=function(){return this.extraBound?this.extraBound.texture?this.extraBound.texture.getGpuTexture():null:this.mainTexture.getGpuTexture()},s.prototype.getMaskTexture=function(){return this.extraBound&&this.extraBound.texture?this.extraBound.texture.getMaskTexture():this.maskTexture},s.prototype.getGpuMaskTexture=function(){return this.extraBound?this.extraBound.texture&&this.extraBound.texture.maskTexture?this.extraBound.texture.getGpuMaskTexture():null:this.maskTexture?this.maskTexture.getGpuTexture():null},s.prototype.getGpuSize=function(){return(this.mainTexture&&this.mainTexture.gpuSize?this.mainTexture.gpuSize:0)+(this.maskTexture&&this.maskTexture.gpuSize?this.maskTexture.gpuSize:0)},s.prototype.getImageData=function(){return this.mainTexture.imageData},s.prototype.getImageExtents=function(){return this.mainTexture.imageExtents},s.prototype.getHeightMapValue=function(e,t){return this.mainTexture.getHeightMapValue(e,t)},s.prototype.getTransform=function(){return this.extraBound?this.extraBound.texture?this.extraBound.transform:null:[1,1,0,0]},t.a=s},function(e,t,r){"use strict";var i=function(e,t){this.parse(t)};i.prototype.parse=function(e){if(this.description=e.description||"",this.freeLayers=e.freeLayers||{},this.surfaces={},e.surfaces){var t=e.surfaces;if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)this.surfaces[t[r]]=[];else this.surfaces=t}!this.freeLayers||Array.isArray(this.freeLayers)?this.freeLayers={}:this.freeLayers=JSON.parse(JSON.stringify(this.freeLayers)),this.surfaces=JSON.parse(JSON.stringify(this.surfaces))},i.prototype.getInfo=function(){return{description:JSON.parse(JSON.stringify(this.description)),surfaces:JSON.parse(JSON.stringify(this.surfaces)),freeLayers:JSON.parse(JSON.stringify(this.freeLayers))}},t.a=i},function(e,t,r){"use strict";var i=r(6),a=r(4),s=i.a,n=a.a,o=function(e,t,r,i,a){this.bbox=null,this.gpu=e,this.gl=e.gl,this.core=t,this.data=null,this.path=a,this.texture={width:256,height:256},this.textures=[],this.images=[],this.ready=!1,this.version=1,this.load(a)};o.prototype.kill=function(){},o.prototype.size=function(){return this.size},o.prototype.load=function(e){n.loadBinary(e,this.onLoaded.bind(this),this.onError.bind(this))},o.prototype.onLoaded=function(e){this.data=e,this.ready=!0,this.core.markDirty()},o.prototype.isReady=function(){return this.ready},o.prototype.onError=function(){},o.prototype.onFileLoaded=function(e,t){this.core.markDirty(),this.textures[e].createFromData(256,256,new Uint8Array(t),"linear")},o.prototype.onFileLoadError=function(){},o.prototype.areTexturesReady=function(e){for(var t=!0,r=0,i=e.length;r<i;r++){var a=e[r];this.textures[a]?t=t&&this.textures[a].loaded:(n.loadBinary(this.path+(a+2),this.onFileLoaded.bind(this,a),this.onFileLoadError.bind(this)),this.textures[a]=new s(this.gpu,null,this.core),t=!1)}return t},o.prototype.getTexture=function(e){return this.textures[e]},t.a=o},function(e,t,r){"use strict";var i={};i.bboxVertexShader="attribute vec3 aPosition;\nuniform mat4 uMVP;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\n}",i.bbox2VertexShader="attribute vec3 aPosition;\nuniform mat4 uMVP;\nuniform float uPoints[8*3];\nvoid main(){ \nint index = int(aPosition.z) * 3; \ngl_Position = uMVP * vec4(uPoints[index], uPoints[index+1], uPoints[index+2], 1.0);\n}",i.bboxFragmentShader="precision mediump float;\nvoid main() {\ngl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n}",i.lineVertexShader="attribute vec3 aPosition;\nuniform mat4 uMVP;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\n}",i.lineFragmentShader="precision mediump float;\nuniform vec4 uColor;\nvoid main() {\ngl_FragColor = uColor;\n}",i.lineWireframeVertexShader="attribute vec3 aPosition;\nattribute vec3 aBarycentric;\nvarying vec3 vBarycentric;\nuniform mat4 uMVP;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\nvBarycentric = aBarycentric;\n}",i.lineWireframeFragmentShader="precision mediump float;\n#extension GL_OES_standard_derivatives : enable\nuniform vec4 uColor;\nvarying vec3 vBarycentric;\nfloat edgeFactor(){\n#ifdef GL_OES_standard_derivatives\nvec3 d = fwidth(vBarycentric);\nvec3 a3 = smoothstep(vec3(0.0), d*1.0, vBarycentric);\nreturn min(min(a3.x, a3.y), a3.z);\n#else\nfloat a = min(min(vBarycentric.x, vBarycentric.y), vBarycentric.z);\nreturn a > 0.1 ? 1.0 : smoothstep(0.0,1.0,a*10.0);\n#endif\n}\nvoid main() {\ngl_FragColor = vec4( mix(vec3(0.0), uColor.rgb, edgeFactor()) , uColor.a);\n}",i.elineVertexShader="attribute vec3 aPosition;\nattribute float aElement;\nuniform mat4 uMVP;\nvarying float vElement;\nvoid main(){ \nvElement = aElement;\ngl_Position = uMVP * vec4(aPosition, 1.0);\n}",i.elineFragmentShader="precision mediump float;\nuniform vec4 uColor;\nvarying float vElement;\nvoid main() {\ngl_FragColor.xyz = fract(vec3(1.0/255.0, 1.0/65025.0, 1.0/16581375.0) * vElement) + (-0.5/255.0);\ngl_FragColor.w = 1.0;\n}",i.line3VertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nvoid main(){ \nvec4 pp0 = (uMVP * vec4(aPosition.xyz, 1.0));\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uScale.x*pp0.w, aNormal.y*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\nvec2 pp1 = pp0.xy / pp0.w;\nvec4 pp3 = (uMVP * vec4(aNormal.xyz, 1.0));\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uScale.x*aNormal.w*pp0.w, n.x*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n}",i.eline3VertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute float aElement;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nvarying float vElement;\nvoid main(){ \nvec4 pp0 = (uMVP * vec4(aPosition.xyz, 1.0));\nvElement = aElement;\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uScale.x*pp0.w, aNormal.y*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\nvec2 pp1 = pp0.xy / pp0.w;\nvec4 pp3 = (uMVP * vec4(aNormal.xyz, 1.0));\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uScale.x*aNormal.w*pp0.w, n.x*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n}",i.line4VertexShader="attribute vec3 aPosition;\nuniform mat4 uMVP;\nuniform vec3 uScale;\nuniform vec3 uPoints[32];\nvoid main(){ \nvec4 pp0 = (uMVP * vec4(uPoints[int(aPosition.x)], 1.0));\nif (aPosition.y < 0.0) {\nif (aPosition.y == -1.0) {\ngl_Position = pp0;\n} else {\ngl_Position = pp0 + vec4((vec3(-sin(aPosition.z)*uScale.x*uScale.z, cos(aPosition.z)*uScale.y*uScale.z, 0.0)), 0.0);\n}\n} else {\nvec2 pp1 = pp0.xy / pp0.w;\nvec4 pp3 = (uMVP * vec4(uPoints[int(aPosition.y)], 1.0));\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uScale.x*aPosition.z*uScale.z, n.x*uScale.y*aPosition.z*uScale.z, 0.0)), 0.0);\n}\n}",i.tlineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying vec2 vTexCoord;\nvoid main(){ \nvec4 p=vec4(aPosition.xyz, 1.0);\np.xyz+=aNormal.xyz*(abs(aNormal.w)*uParams[3]);\nif (aNormal.w < 0.0){\nvTexCoord=vec2(abs(aPosition.w)*uParams[0], (uParams[1]+uParams[2])*0.5);\n} else {\nvTexCoord=vec2(abs(aPosition.w)*uParams[0], aPosition.w < 0.0 ? uParams[1] : uParams[2]);\n}\ngl_Position = uMVP * p;\n}",i.rlineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvoid main(){ \nvec4 p=vec4(aPosition.xyz, 1.0);\np.xyz+=aNormal.xyz*(abs(aNormal.w)*uParams[3]);\ngl_Position = uMVP * p;\n}",i.erlineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute float aElement;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying float vElement;\nvoid main(){ \nvec4 p=vec4(aPosition.xyz, 1.0);\np.xyz+=aNormal.xyz*(abs(aNormal.w)*uParams[3]);\nvElement = aElement;\ngl_Position = uMVP * p;\n}",i.etlineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute float aElement;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying float vElement;\nvoid main(){ \nvec4 p=vec4(aPosition.xyz, 1.0);\np.xyz+=aNormal.xyz*(abs(aNormal.w)*uParams[3]);\nvElement = aElement;\ngl_Position = uMVP * p;\n}",i.tplineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying vec2 vTexCoord;\nvoid main(){ \nvec4 pp0 = (uMVP * vec4(aPosition.xyz, 1.0));\nvTexCoord=vec2(abs(aPosition.w)*uParams[0], aPosition.w < 0.0 ? uParams[1] : uParams[2]);\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uParams[3]*uScale.x*pp0.w, aNormal.y*uParams[3]*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\nvec2 pp1 = pp0.xy / pp0.w;\nvec4 pp3 = (uMVP * vec4(aNormal.xyz, 1.0));\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uParams[3]*uScale.x*aNormal.w*pp0.w, n.x*uParams[3]*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n}",i.etplineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute float aElement;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying float vElement;\nvoid main(){ \nvec4 pp0 = (uMVP * vec4(aPosition.xyz, 1.0));\nvElement = aElement;\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uParams[3]*uScale.x*pp0.w, aNormal.y*uParams[3]*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\nvec2 pp1 = pp0.xy / pp0.w;\nvec4 pp3 = (uMVP * vec4(aNormal.xyz, 1.0));\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uParams[3]*uScale.x*aNormal.w*pp0.w, n.x*uParams[3]*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n}",i.tlineFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 uColor2;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 c=texture2D(uSampler, vTexCoord)*uColor;\ngl_FragColor = c;\n}",i.tblineFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 uColor2;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 c1=texture2D(uSampler, vTexCoord)*uColor;\nvec4 c2=uColor2,c=c1;\nc.xyz*=c.w; c2.xyz*=c2.w;\nc=mix(c,c2,1.0-c.w);\nc.xyz/=(c.w+0.00001);\nc.w=max(c1.w,c2.w);\ngl_FragColor = c;\n}",i.polygonVertexShader="attribute vec3 aPosition;\nattribute vec3 aNormal;\nuniform mat4 uMVP;\nuniform mat4 uRot;\nuniform vec4 uColor;\nvarying vec4 vColor;\nvoid main(){ \nfloat l = dot((uRot*vec4(aNormal,1.0)).xyz, vec3(0.0,0.0,1.0)) * 0.5;\nvec3 c = uColor.xyz;\nc = (l > 0.0) ? mix(c,vec3(1.0,1.0,1.0),l) : mix(vec3(0.0,0.0,0.0),c,1.0+l);\nvColor = vec4(c, uColor.w);\ngl_Position = uMVP * vec4(aPosition, 1.0);\n}",i.polygonFragmentShader="precision mediump float;\nvarying vec4 vColor;\nvoid main() {\ngl_FragColor = vColor;\n}",i.textVertexShader="attribute vec4 aPosition;\nattribute vec4 aTexCoord;\nuniform mat4 uMVP;\nuniform vec4 uVec;\nvarying vec2 vTexCoord;\nvoid main(){ \nvTexCoord = aTexCoord.xy;\nif (dot(uVec.xyz, vec3(aTexCoord.z, aTexCoord.w, aPosition.w)) < 0.0) {\ngl_Position = uMVP * vec4(2.0, 0.0, 0.0, 1.0);\n}else{\ngl_Position = uMVP * vec4(aPosition.xyz, 1.0);\n}\n}",i.text2VertexShader="attribute vec4 aPosition;\nattribute vec4 aTexCoord;\nuniform mat4 uMVP;\nuniform vec4 uVec;\nuniform float uFile;\nvarying vec2 vTexCoord;\nvoid main(){ \nvTexCoord = aTexCoord.xy;\nif (dot(uVec.xyz, vec3(aTexCoord.z, aTexCoord.w, aPosition.w)) < 0.0) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\nfloat file = floor(aTexCoord.y/4.0);\nvTexCoord.y = mod(aTexCoord.y,4.0);\nif (file != floor(uFile)) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\ngl_Position = uMVP * vec4(aPosition.xyz, 1.0);\n}\n}\n}",i.iconVertexShader="attribute vec4 aPosition;\nattribute vec4 aTexCoord;\nattribute vec3 aOrigin;\nuniform mat4 uMVP;\nuniform vec4 uScale;\nvarying vec2 vTexCoord;\nvoid main(){ \nvTexCoord = aTexCoord.xy * uScale[2];\nvec4 pos = (uMVP * vec4(aOrigin, 1.0));\ngl_Position = pos + vec4(aPosition.x*uScale.x*pos.w, (aPosition.y+uScale.w)*uScale.y*pos.w, 0.0, 0.0);\n}",i.icon2VertexShader="attribute vec4 aPosition;\nattribute vec4 aTexCoord;\nattribute vec3 aOrigin;\nuniform mat4 uMVP;\nuniform vec4 uScale;\nuniform float uFile;\nvarying vec2 vTexCoord;\nvoid main(){ \nvTexCoord = aTexCoord.xy * uScale[2];\nfloat file = floor(aTexCoord.y/4.0);\nvTexCoord.y = mod(aTexCoord.y,4.0);\nif (file != floor(uFile)) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\nvec4 pos = (uMVP * vec4(aOrigin, 1.0));\ngl_Position = pos + vec4(aPosition.x*uScale.x*pos.w, (aPosition.y+uScale.w)*uScale.y*pos.w, 0.0, 0.0);\n}}",i.textFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 c=texture2D(uSampler, vTexCoord);\nif(c.w < 0.01){ discard; }\ngl_FragColor = c*uColor;\n}",i.text2FragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec2 uParams;\nconst vec4 uColor1 = vec4(1.0, 1.0, 1.0, 1.0);\nconst vec4 uColor2 = vec4(0.0, 0.0, 0.0, 1.0);\nvarying vec2 vTexCoord;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec4 mask;\nint i=int(floor(vTexCoord.y));\nif (i == 0) mask=vec4(1.0,0.0,0.0,0.0);else\nif (i == 1) mask=vec4(0.0,1.0,0.0,0.0);else\nif (i == 2) mask=vec4(0.0,0.0,1.0,0.0);\nif (i == 3) mask=vec4(0.0,0.0,0.0,1.0);\nvec2 uv=(vTexCoord);\nuv.y=fract(uv.y);\nvec4 c=vec4(dot(mask, texture2D(uSampler, uv)));\nfloat u_buffer = uParams[0];\nfloat u_gamma = uParams[1];\nfloat alpha = uColor.a * smoothstep(u_buffer - u_gamma, u_buffer + u_gamma, c.r);\nif(alpha < 0.01){ discard; }\ngl_FragColor = vec4(uColor.rgb, alpha);\n}",i.skydomeVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\nvTexCoord = aTexCoord;\n}",i.skydomeFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nconst vec4 gray = vec4(0.125, 0.125, 0.125, 1.0);\nvoid main() {\nfloat fade = smoothstep(0.51, 0.55, vTexCoord.t);\ngl_FragColor = mix(texture2D(uSampler, vTexCoord), gray, fade);\n}",i.stardomeFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uSampler, vTexCoord);\n}",i.atmoVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform mat3 uNorm;\nvarying vec3 vNormal;\nvarying vec4 vPosition;\nvoid main(){ \nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nvec4 c = uMV * vec4(aPosition, 1.0);\nvNormal = (aPosition.xyz - vec3(0.5));\nvPosition = camSpacePos;\n}",i.atmoFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uParams;\nuniform vec4 uParams2;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nuniform vec4 uFogColor;\nuniform vec4 uFogColor2;\nvoid main() {\nfloat l = dot(normalize(vNormal),-uParams2.xyz);\nl = (1.0-pow(abs(l),uParams.x));\nvec4 c = mix(uFogColor2, uFogColor, l);\ngl_FragColor = vec4(c.xyz, c.w*l);\n}",i.atmoFragmentShader2="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uNFactor;\nuniform vec2 uRadius;\nuniform vec3 uPos;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nuniform vec4 uFogColor;\nvoid main() {\nvec3 ldir = normalize(-vPosition.xyz);\nvec3 diff = uPos;\nfloat a = dot(ldir, ldir);\nfloat b = 2 * dot(ldir, diff);\nfloat c = dot(diff, diff) - (uRadius[0] * uRadius[0]);\nfloat i = 0;\nfloat discr = b * b - 4 * a * c;\nif (discr > 0.0) {}\n}\ngl_FragColor = uFogColor;\n}",i.atmoVertexShader3="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams2;\nvarying vec2 vTexcoords;\nvoid main(){ \ngl_Position = uProj * (uMV * vec4(aPosition, 1.0));\nvec3 position = (aPosition.xyz - vec3(0.5)) * vec3(uParams.w * 2.0);\nvec4 camPos = uParams2;\nfloat SurfaceRadius = uParams.x;\nfloat AtmosphereRadius = uParams.y;\nfloat StretchAmt = uParams.z;\nfloat camHeight = length(camPos.xyz);\nvec3 camToPos = position - camPos.xyz;\nfloat farDist = length(camToPos);\nfloat altitude = max(0.0,camHeight - SurfaceRadius);\nfloat horizonDist = sqrt((altitude*altitude) + (2.0 * SurfaceRadius * altitude));\nfloat maxDot = horizonDist / camHeight;\naltitude = max(0.0,camHeight - AtmosphereRadius);\nhorizonDist = sqrt((altitude*altitude) + (2.0 * AtmosphereRadius * altitude));\nfloat tweakAmount = 0.1;\nfloat minDot = max(tweakAmount,horizonDist / camHeight);\nfloat minDot2 = ((camHeight - SurfaceRadius) * (1.0 / (AtmosphereRadius  - SurfaceRadius))) - (1.0 - tweakAmount);\nminDot = min(minDot, minDot2);\nfloat posDot = dot(camToPos / farDist,-camPos.xyz / camHeight) - minDot;\nfloat height = posDot * (1.0 / (maxDot - minDot));\nvTexcoords.y = height;\nheight -= min(0.0,minDot2 + ((1.0 + StretchAmt) * minDot2));\nvTexcoords.x = height;\n}",i.atmoFragmentShader3="precision mediump float;\nvarying vec2 vTexcoords;\nuniform vec4 uParams3;\nuniform vec4 uFogColor;\nuniform vec4 uFogColor2;\nconst vec4 fogColor3 = vec4(0.0/255.0, 0.0/255.0, 0.0/255.0, 1.0);\nvoid main() {\nfloat l = vTexcoords.y;\nif (l > uParams3.z){ discard; } else {\nfloat l2 = clamp((l*l)*0.9+0.1, 0.0, 1.5);\nvec4 c = mix(uFogColor2, uFogColor, l2);\ngl_FragColor = vec4(c.xyz, c.w*l);\nif (l > uParams3.x){ gl_FragColor.xyz = mix(gl_FragColor.xyz, fogColor3.xyz, (l-uParams3.x)*uParams3.y); }\n}}",i.heightmapVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nuniform mat4 uGridMat;\nuniform float uGridStep1, uGridStep2;\nconst int HMSize = 5;\nconst float HMSize1 = float(HMSize-1);\nuniform float uHeight[HMSize*HMSize];\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec3 pos = aPosition;\nfloat z = uHeight[int(round(pos.y*HMSize1)*float(HMSize) + round(pos.x*HMSize1))];\nvec4 camSpacePos = uMV * vec4(pos.xy, z, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvec4 gridCoord = uGridMat * vec4(pos, 1.0);\nvTexCoord1 = aTexCoord;\nvTexCoord1 = gridCoord.xy * vec2(uGridStep1);\nvTexCoord2 = gridCoord.xy * vec2(uGridStep2);\n}",i.heightmapFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uGridBlend;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec4 gridColor = mix(texture2D(uSampler, vTexCoord1), texture2D(uSampler, vTexCoord2), uGridBlend);\ngl_FragColor = mix(uFogColor, gridColor, vFogFactor);\n}",i.heightmapDepthVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nuniform mat4 uGridMat;\nuniform float uGridStep1, uGridStep2;\nconst int HMSize = 5;\nconst float HMSize1 = float(HMSize-1);\nuniform float uHeight[HMSize*HMSize];\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vDepth;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec3 pos = aPosition;\nfloat z = uHeight[int(round(pos.y*HMSize1)*float(HMSize) + round(pos.x*HMSize1))];\nvec4 camSpacePos = uMV * vec4(pos.xy, z, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvDepth = camDist;\nvec4 gridCoord = uGridMat * vec4(pos, 1.0);\nvTexCoord1 = aTexCoord;\nvTexCoord1 = gridCoord.xy * vec2(uGridStep1);\nvTexCoord2 = gridCoord.xy * vec2(uGridStep2);\n}",i.heightmapDepthFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uGridBlend;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vDepth;\nvoid main() {\ngl_FragColor = fract(vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) * vDepth) + (-0.5/255.0);\n}",i.quadPoint="vec3 quadPoint(int i1, int i2, int i3, float t, float t2) {\nfloat p1x = uPoints[i1], p1y = uPoints[i1+1], p1z = uPoints[i1+2];\nfloat p3x = uPoints[i3], p3y = uPoints[i3+1], p3z = uPoints[i3+2];\nfloat p2x = 2.0*uPoints[i2]-p1x*0.5-p3x*0.5;\nfloat p2y = 2.0*uPoints[i2+1]-p1y*0.5-p3y*0.5;\nfloat p2z = 2.0*uPoints[i2+2]-p1z*0.5-p3z*0.5;\nreturn vec3(t2*t2*p1x+2.0*t2*t*p2x+t*t*p3x, t2*t2*p1y+2.0*t2*t*p2y+t*t*p3y, t2*t2*p1z+2.0*t2*t*p2z+t*t*p3z); }\n",i.planeVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams3;\nuniform float uPoints[9*3];\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\n"+i.quadPoint+"void main() {\nvec3 indices = aPosition;\nfloat t = aPosition.y * uParams[2];\nfloat t2 = (1.0-t);\nvec3 p1 = quadPoint(0, 3, 6, t, t2);\nvec3 p2 = quadPoint(9, 9+3, 9+6, t, t2);\nvec3 p3 = quadPoint(18, 18+3, 18+6, t, t2);\nt = aPosition.x * uParams[2];\nt2 = (1.0-t);\nfloat p2x = 2.0*p2.x-p1.x*0.5-p3.x*0.5;\nfloat p2y = 2.0*p2.y-p1.y*0.5-p3.y*0.5;\nfloat p2z = 2.0*p2.z-p1.z*0.5-p3.z*0.5;\nvec4 p = vec4(t2*t2*p1.x+2.0*t2*t*p2x+t*t*p3.x, t2*t2*p1.y+2.0*t2*t*p2y+t*t*p3.y, t2*t2*p1.z+2.0*t2*t*p2z+t*t*p3.z, 1);\nvec4 camSpacePos = uMV * p;\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uParams[1] * camDist);\nvec2 uv = aTexCoord;\nuv.x = uv.x * uParams3[2] + uParams3[0];\nuv.y = uv.y * uParams3[3] + uParams3[1];\nvTexCoord = uv;\n}",i.planeFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uParams2;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec4 c = mix(texture2D(uSampler, vTexCoord), texture2D(uSampler, vTexCoord*8.0), uParams2[2]);\ngl_FragColor = mix(uFogColor, c, vFogFactor);\n}",i.planeVertex2Shader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams3;\nuniform float uPoints[9*3];\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\n"+i.quadPoint+"void main() {\nvec3 indices = aPosition;\nfloat t = aPosition.y * uParams[2];\nfloat t2 = (1.0-t);\nvec3 p1 = quadPoint(0, 3, 6, t, t2);\nvec3 p2 = quadPoint(9, 9+3, 9+6, t, t2);\nvec3 p3 = quadPoint(18, 18+3, 18+6, t, t2);\nt = aPosition.x * uParams[2];\nt2 = (1.0-t);\nfloat p2x = 2.0*p2.x-p1.x*0.5-p3.x*0.5;\nfloat p2y = 2.0*p2.y-p1.y*0.5-p3.y*0.5;\nfloat p2z = 2.0*p2.z-p1.z*0.5-p3.z*0.5;\nvec4 p = vec4(t2*t2*p1.x+2.0*t2*t*p2x+t*t*p3.x, t2*t2*p1.y+2.0*t2*t*p2y+t*t*p3.y, t2*t2*p1.z+2.0*t2*t*p2z+t*t*p3.z, 1);\nvec4 camSpacePos = uMV * p;\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uParams[1] * camDist);\nvec2 uv = aTexCoord;\nuv.x = uv.x * uParams3[2] + uParams3[0];\nuv.y = uv.y * uParams3[3] + uParams3[1];\nvTexCoord = uv;\nvTexCoord2 = p.xy;\n}",i.planeFragment2Shader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uParams2;\nuniform vec4 uParams4;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nif (length(uParams4.xy - vTexCoord2.xy) > uParams4.z){ discard; }vec4 c = mix(texture2D(uSampler, vTexCoord), texture2D(uSampler, vTexCoord*8.0), uParams2[2]);\ngl_FragColor = mix(uFogColor, c, vFogFactor);\n}",i.planeVertex3Shader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams3;\nuniform float uPoints[9*3];\nuniform vec3 uVector;\nuniform float uHeights[9];\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\n"+i.quadPoint+"float linearHeight(float x, float y) {\nint ix = int(x);\nint iy = int(y);\nint index = (2-iy)*3+ix;\nint index2 = (2-(iy+1))*3+ix;\nfloat fx = fract(x);\nfloat fy = fract(y);\nfloat w0 = (uHeights[index] + (uHeights[index+1] - uHeights[index])*fx);\nfloat w1 = (uHeights[index2] + (uHeights[index2+1] - uHeights[index2])*fx);\nreturn (w0 + (w1 - w0)*fy);\n}\nvoid main() {\nvec3 indices = aPosition;\nfloat t = aPosition.y * uParams[2];\nfloat tt = t;\nfloat t2 = (1.0-t);\nvec3 p1 = quadPoint(0, 3, 6, t, t2);\nvec3 p2 = quadPoint(9, 9+3, 9+6, t, t2);\nvec3 p3 = quadPoint(18, 18+3, 18+6, t, t2);\nt = aPosition.x * uParams[2];\nfloat tt2 = t;\nt2 = (1.0-t);\nfloat p2x = 2.0*p2.x-p1.x*0.5-p3.x*0.5;\nfloat p2y = 2.0*p2.y-p1.y*0.5-p3.y*0.5;\nfloat p2z = 2.0*p2.z-p1.z*0.5-p3.z*0.5;\nvec4 p = vec4(t2*t2*p1.x+2.0*t2*t*p2x+t*t*p3.x, t2*t2*p1.y+2.0*t2*t*p2y+t*t*p3.y, t2*t2*p1.z+2.0*t2*t*p2z+t*t*p3.z, 1);\np.xyz += uVector * linearHeight(tt*2.0, tt2*2.0);\nvec4 camSpacePos = uMV * p;\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uParams[1] * camDist);\nvec2 uv = aTexCoord;\nuv.x = uv.x * uParams3[2] + uParams3[0];\nuv.y = uv.y * uParams3[3] + uParams3[1];\nvTexCoord = uv;\n}",i.getHFNormal="vec3 getHFNormal(vec2 uv, float texelSize, float heightDelta) {\nvec4 h;\nh[0] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0,-1.0))).r * heightDelta;\nh[1] = texture2D(uSampler2, uv + (texelSize * vec2(-1.0, 0.0))).r * heightDelta;\nh[2] = texture2D(uSampler2, uv + (texelSize * vec2( 1.0, 0.0))).r * heightDelta;\nh[3] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0, 1.0))).r * heightDelta;\nreturn normalize(vec3(h[1] - h[2], h[3] - h[0], 2.0));}\n",i.getHFNormal2="vec2 getHFNormal2(vec2 uv, float texelSize, float heightDelta) {\nvec4 h;\nh[0] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0,-1.0))).r * heightDelta;\nh[1] = texture2D(uSampler2, uv + (texelSize * vec2(-1.0, 0.0))).r * heightDelta;\nh[2] = texture2D(uSampler2, uv + (texelSize * vec2( 1.0, 0.0))).r * heightDelta;\nh[3] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0, 1.0))).r * heightDelta;\nreturn vec2(h[1] - h[2], h[3] - h[0]);}\n",i.planeVertex4Shader="#define newspace\nuniform sampler2D uSampler2;\nattribute vec3 aPosition;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams3;\nuniform float uPoints[9*3];\nuniform vec3 uVector;\nuniform vec3 uHeights;\nuniform vec4 uTransform;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvarying vec3 vBarycentric;\n#ifdef newspace\nvarying mat3 vTBN;\n#else\nvarying vec3 vNormal;\n#endif\nvarying float vFogFactor;\n"+i.quadPoint+i.getHFNormal+i.getHFNormal2+"void main() {\nvec3 indices = aPosition;\nfloat t = aPosition.y * uParams[2];\nfloat tt = t;\nfloat t2 = (1.0-t);\nvec3 p1 = quadPoint(0, 3, 6, t, t2);\nvec3 p2 = quadPoint(9, 9+3, 9+6, t, t2);\nvec3 p3 = quadPoint(18, 18+3, 18+6, t, t2);\nt = aPosition.x * uParams[2];\nfloat tt2 = t;\nt2 = (1.0-t);\nfloat p2x = 2.0*p2.x-p1.x*0.5-p3.x*0.5;\nfloat p2y = 2.0*p2.y-p1.y*0.5-p3.y*0.5;\nfloat p2z = 2.0*p2.z-p1.z*0.5-p3.z*0.5;\nvec4 p = vec4(t2*t2*p1.x+2.0*t2*t*p2x+t*t*p3.x, t2*t2*p1.y+2.0*t2*t*p2y+t*t*p3.y, t2*t2*p1.z+2.0*t2*t*p2z+t*t*p3.z, 1);\nvec2 uv2 = vec2(tt, 1.0-tt2);\nuv2 = vec2(uTransform[0] * uv2[0] + uTransform[2], uTransform[1] * uv2[1] + uTransform[3]);\np.xyz += uVector * (uHeights[0] + (uHeights[1]-uHeights[0])*texture2D(uSampler2, uv2).x);\nvec4 camSpacePos = uMV * p;\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uParams[1] * camDist);\nvec2 uv = vec2(tt, 1.0-tt2);\nuv.x = uv.x * uParams3[0] + uParams3[2];\nuv.y = uv.y * uParams3[1] + uParams3[3];\nvTexCoord = uv;\nvBarycentric = camSpacePos.xyz;\n#ifdef newspace\nvec2 d = getHFNormal2(uv2, 1.0/(128.0), (uHeights[1]-uHeights[0]) * uHeights[2]);\nvec3 T = vec3(2.0,0.0,-d.x); vec3 B = vec3(0.0,2.0,-d.y);\nvTBN = mat3(normalize(T), normalize(B), cross(T,B));\n#else\nvec3 n = getHFNormal(uv2, 1.0/(128.0), (uHeights[1]-uHeights[0]) * uHeights[2]);\nvNormal = normalize(n);\n#endif\n}",i.planeFragmentShader2="precision mediump float;\n#extension GL_OES_standard_derivatives : enable\n#define newspace\nuniform sampler2D uSampler;\nuniform vec4 uParams2;\nuniform mat3 uSpace;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nvarying vec3 vBarycentric;\n#ifdef newspace\nvarying mat3 vTBN;\n#else\nvarying vec3 vNormal;\n#endif\nuniform vec4 uFogColor;\nvoid main() {\nvec3 ldir = normalize(-vBarycentric);\n#ifdef flat\nvec3 nx = dFdx(vBarycentric);\nvec3 ny = dFdy(vBarycentric);\nvec3 normal2 = normalize(cross(nx,ny));\nvec4 c2 = vec4(vec3(max(0.0,normal2.z*(204.0/255.0))+(32.0/255.0)),1.0);\n#else\n#ifdef newspace\n#ifdef nmix\nvec3 normal = vTBN * normalize((texture2D(uSampler, vTexCoord).xyz-0.5)*2.0);\n#else\nvec3 normal = vTBN * vec3(0.0,0.0,1.0);\n#endif\n#else\nvec3 normal = vNormal;\n#endif\nnormal = normalize(uSpace * normal);\nvec3 eyeDir = ldir;\nvec3 refDir = reflect(-ldir, normal);\nfloat specW = min(1.0, pow(max(dot(refDir, eyeDir), 0.0), 90.0));\nfloat diffW = min(1.0, max(dot(normal, ldir), 0.0));\nfloat lcolor = (dot(normal, ldir) + 1.0) * 0.5;\n#ifdef normals\nvec4 c2 = vec4(normal*0.5+0.5,1.0);\n#else\nvec4 c2 = vec4(vec3(dot(vec3(0.0,0.0,1.0), normal)),1.0);\n#endif\n#endif\n#ifdef grid\nvec4 c = mix(texture2D(uSampler, vTexCoord), texture2D(uSampler, vTexCoord*8.0), uParams2[2]);\nc = mix(c, c2, 0.5);\n#else\n#ifdef exmap\nvec4 c = texture2D(uSampler, vTexCoord);\n#ifdef classmap\nint i = int(c.x*255.0);\nif (i == 1 || i == 2 || i == 5 || i == 6) c = vec4(146.0, 178.0, 144.0, 255.0);\nif (i == 3 || i == 4) c = vec4(94.0, 169.0, 133.0, 255.0);\nif (i == 8 || i == 11) c = vec4(238.0, 221.0, 185.0, 255.0);\nif (i == 7) c = vec4(226.0, 192.0, 154.0, 255.0);\nif (i == 9 || i == 10 || i == 12) c = vec4(250.0, 246.0, 167.0, 255.0);\nif (i == 13 || i == 16) c = vec4(245.0, 236.0, 211.0, 255.0);\nif (i == 14) c = vec4(139.0, 185.0, 166.0, 255.0);\nif (i == 15) c = vec4(199.0, 219.0, 155.0, 255.0);\nif (i == 17) c = vec4(149.0, 132.0, 162.0, 255.0);\nif (i == 18 || i == 0) c = vec4(188.0, 221.0, 255.0, 255.0);\nif (i == 19) c = vec4(255.0, 255.0, 255.0, 255.0);\nc = (c*(1.0/255.0)) * c2;\n#endif\n#else\nvec4 c = c2;\n#endif\n#endif\n#ifdef fog\ngl_FragColor = mix(uFogColor, c, vFogFactor);\n#else\ngl_FragColor = c;\n#endif\n}",i.tileVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uMV2, uProj;\nuniform vec4 uParams;\nuniform vec4 uCamVec;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\nvec4 worldPos = uMV2 * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = 1.0-exp(uParams[1] * camDist);\nvTexCoord = aTexCoord;\nfloat l = dot(normalize(worldPos.xyz),uCamVec.xyz);\nvFogFactor = clamp((1.0-abs(l))*uCamVec.w + vFogFactor, 0.0, 1.0);\n}",i.tileFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\ngl_FragColor = mix(texture2D(uSampler, vTexCoord), uFogColor, vFogFactor);\n}",i.tile2VertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord2;\nuniform mat4 uMV, uMV2, uProj;\nuniform vec4 uParams;\nuniform vec4 uCamVec;\nuniform vec4 uTransform;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\nvec4 worldPos = uMV2 * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = 1.0-exp(uParams[1] * camDist);\nvTexCoord = vec2(uTransform[0] * aTexCoord2[0] + uTransform[2], uTransform[1] * aTexCoord2[1] + uTransform[3]);\nfloat l = dot(normalize(worldPos.xyz),uCamVec.xyz);\nvFogFactor = clamp((1.0-abs(l))*uCamVec.w + vFogFactor, 0.0, 1.0);\n}",i.tile2FragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uAlpha;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec4 c = texture2D(uSampler, vTexCoord);\n__FILTER__vec4 cc = mix(c, uFogColor, vFogFactor);\ncc.w = c.w * uAlpha;\ngl_FragColor = cc;\n}",i.tile3FragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform sampler2D uSampler2;\nuniform float uAlpha;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec4 c = texture2D(uSampler, vTexCoord);\n__FILTER__vec4 c2 = texture2D(uSampler2, vTexCoord);\nvec4 cc = mix(c, uFogColor, vFogFactor);\ncc.w = c.w * uAlpha * c2.x;\ngl_FragColor = cc;\n}",i.fogTileVertexShader="attribute vec3 aPosition;\nuniform mat4 uMV, uMV2, uProj;\nuniform vec4 uParams;\nuniform vec4 uCamVec;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\nvec4 worldPos = uMV2 * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = 1.0-exp(uParams[1] * camDist);\nfloat l = dot(normalize(worldPos.xyz),uCamVec.xyz);\nvFogFactor = clamp((1.0-abs(l))*uCamVec.w + vFogFactor, 0.0, 1.0);\n}",i.fogTileFragmentShader="precision mediump float;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\ngl_FragColor = vec4(uFogColor.xyz, vFogFactor);\n}",i.tileTShadedVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nuniform mat4 uMV, uProj;\nuniform mat3 uNorm;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord;\nvPosition = camSpacePos;\nvNormal = aNormal * uNorm;\n}",i.tileTShadedFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nuniform mat4 uMaterial;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec3 ldir = normalize(-vPosition.xyz);\nvec3 normal = normalize(vNormal);\nvec3 eyeDir = ldir;\nvec3 refDir = reflect(-ldir, normal);\nfloat specW = min(1.0, pow(max(dot(refDir, eyeDir), 0.0), uMaterial[3][0]));\nfloat diffW = min(1.0, max(dot(normal, ldir), 0.0));\nvec4 lcolor = uMaterial[0]+(uMaterial[1]*diffW)+(uMaterial[2]*specW);\nvec4 tcolor = texture2D(uSampler, vTexCoord);\ngl_FragColor = mix(uFogColor, vec4(lcolor.xyz*(1.0/255.0), 1.0) * tcolor, vFogFactor); gl_FragColor.w *= uMaterial[3][1];\n}",i.tileShadedFragmentShader="precision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nuniform mat4 uMaterial;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec3 ldir = normalize(-vPosition.xyz);\nvec3 normal = normalize(vNormal);\nvec3 eyeDir = ldir;\nvec3 refDir = reflect(-ldir, normal);\nfloat specW = min(1.0,pow(max(dot(refDir, eyeDir), 0.0), uMaterial[3][0]));\nfloat diffW = min(1.0,max(dot(normal, ldir), 0.0));\nvec4 lcolor = uMaterial[0]+(uMaterial[1]*diffW)+(uMaterial[2]*specW);\ngl_FragColor = mix(uFogColor, vec4(lcolor.xyz*(1.0/255.0), 1.0), vFogFactor);  gl_FragColor.w = uMaterial[3][1];\n}",i.tileFlatShadeVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aBarycentric;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying vec3 vBarycentric;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord;\nvBarycentric = camSpacePos.xyz;\n}",i.tileFlatShadeFragmentShader="precision mediump float;\n#extension GL_OES_standard_derivatives : enable\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying vec3 vBarycentric;\nvarying float vFogFactor;\nvoid main() {\n#ifdef GL_OES_standard_derivatives\nvec3 nx = dFdx(vBarycentric);\nvec3 ny = dFdy(vBarycentric);\nvec3 normal=normalize(cross(nx,ny));\ngl_FragColor = vec4(vec3(max(0.0,normal.z*(204.0/255.0))+(32.0/255.0)),1.0);\n#else\ngl_FragColor = vec4(1.0,1.0,1.0,1.0);\n#endif\n}",i.tileWireframeVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aBarycentric;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying vec3 vBarycentric;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord;\nvBarycentric = aBarycentric;\n}",i.tileWireframeFragmentShader="precision mediump float;\n#extension GL_OES_standard_derivatives : enable\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying vec3 vBarycentric;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nfloat edgeFactor(){\n#ifdef GL_OES_standard_derivatives\nvec3 d = fwidth(vBarycentric);\nvec3 a3 = smoothstep(vec3(0.0), d*1.0, vBarycentric);\nreturn min(min(a3.x, a3.y), a3.z);\n#else\nfloat a = min(min(vBarycentric.x, vBarycentric.y), vBarycentric.z);\nreturn a > 0.1 ? 1.0 : smoothstep(0.0,1.0,a*10.0);\n#endif\n}\nvoid main() {\ngl_FragColor = mix(uFogColor, vec4( mix(vec3(0.0), texture2D(uSampler, vTexCoord).rgb, edgeFactor()) , 1.0), vFogFactor);\n}",i.tileWireframe2FragmentShader="precision mediump float;\n#extension GL_OES_standard_derivatives : enable\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvarying vec3 vBarycentric;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nfloat edgeFactor(){\n#ifdef GL_OES_standard_derivatives\nvec3 d = fwidth(vBarycentric);\nvec3 a3 = smoothstep(vec3(0.0), d*1.0, vBarycentric);\nreturn min(min(a3.x, a3.y), a3.z);\n#else\nfloat a = min(min(vBarycentric.x, vBarycentric.y), vBarycentric.z);\nreturn a > 0.1 ? 1.0 : smoothstep(0.0,1.0,a*10.0);\n#endif\n}\nvoid main() {\nif (edgeFactor() < 0.5){ gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0); } else { discard; }}",i.tileWireframe3VertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord2;\nattribute vec3 aBarycentric;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying vec3 vBarycentric;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord2;\nvBarycentric = aBarycentric;\n}",i.tileDepthVertexShader="attribute vec3 aPosition;\nuniform mat4 uMV, uProj;\nvarying float vDepth;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvDepth = camDist;\n}",i.tileDepthFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nvarying float vDepth;\nvoid main() {\ngl_FragColor = fract(vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) * vDepth) + (-0.5/255.0);\n}",i.imageVertexShader="\nattribute vec4 aPosition;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uData;\nuniform vec4 uColor;\nuniform float uDepth;\nvarying vec4 vColor;\nvarying vec2 vTexcoords;\nvoid main(void){\nint i=int(aPosition.x);\nif(i==0) gl_Position=uProjectionMatrix*vec4(floor(uData[0][0]+0.1),floor(uData[0][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[0][2], uData[0][3]);\nif(i==1) gl_Position=uProjectionMatrix*vec4(floor(uData[1][0]+0.1),floor(uData[1][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[1][2], uData[1][3]);\nif(i==2) gl_Position=uProjectionMatrix*vec4(floor(uData[2][0]+0.1),floor(uData[2][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[2][2], uData[2][3]);\nif(i==3) gl_Position=uProjectionMatrix*vec4(floor(uData[3][0]+0.1),floor(uData[3][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[3][2], uData[3][3]);\nvec4 c=uColor;\nc.w*=1.0;\nvColor=c;\n}",i.imageFragmentShader="precision mediump float;\nvarying vec4 vColor;\nvarying vec2 vTexcoords;\nuniform sampler2D uSampler;\nvoid main(void){\nvec4 c=texture2D(uSampler, vec2(vTexcoords.x, vTexcoords.y) );\nc*=vColor;\nif(c.w < 0.01){ discard; }\ngl_FragColor = c;\n}",t.a=i},function(e,t,r){"use strict";var i=r(21),a=r(34),s=r.n(a),n=r(13);r.d(t,"a",function(){return l});var o=n.c,h=i.a,l=function(e,t){this.core=new o(e,t,this),Object.defineProperty(this,"map",{get:function(){return this.core?this.core.getMapInterface():null}}),Object.defineProperty(this,"renderer",{get:function(){return this.core?this.core.getRendererInterface():null}}),Object.defineProperty(this,"proj4",{get:function(){return this.core?h:null}}),Object.defineProperty(this,"earcut",{get:function(){return this.core?s.a:null}})};l.prototype.destroy=function(){this.core.destroy(),this.core=null},l.prototype.loadMap=function(e){return this.core?this.core.loadMap(e):null},l.prototype.destroyMap=function(){return this.core?this.core.destroyMap():null},l.prototype.on=function(e,t){return this.core?this.core.on(e,t):null},l.prototype.once=function(e,t,r){return this.core?this.core.once(e,t,r):null},l.prototype.callListener=function(e,t){if(!this.core)return null;this.core.callListener(e,t)}},function(e,t,r){"use strict";function i(e,t,r){if(!(this instanceof i))return new i(e,t,r);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var a=e.split(",");this.x=parseFloat(a[0],10),this.y=parseFloat(a[1],10),this.z=parseFloat(a[2],10)||0}else this.x=e,this.y=t,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var a=r(35);i.fromMGRS=function(e){return new i(r.i(a.b)(e))},i.prototype.toMGRS=function(e){return r.i(a.c)([this.x,this.y],e)},t.a=i},function(e,t,r){"use strict";t.a=function(e,t,r){var i,a,s,n=r.x,o=r.y,h=r.z||0,l={};for(s=0;s<3;s++)if(!t||2!==s||void 0!==r.z)switch(0===s?(i=n,a="x"):1===s?(i=o,a="y"):(i=h,a="z"),e.axis[s]){case"e":l[a]=i;break;case"w":l[a]=-i;break;case"n":l[a]=i;break;case"s":l[a]=-i;break;case"u":void 0!==r[a]&&(l.z=i);break;case"d":void 0!==r[a]&&(l.z=-i);break;default:return null}return l}},function(e,t,r){"use strict";var i=r(1);t.a=function(e,t){if(void 0===e){if((e=Math.floor(30*(r.i(i.a)(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}},function(e,t,r){"use strict";var i=r(36),a=r(69);t.a=function(e){var t=Math.abs(e);return t=r.i(a.a)(t*(1+t/(r.i(i.a)(1,t)+1))),e<0?-t:t}},function(e,t,r){"use strict";t.a=function(e,t){for(var r,i=2*Math.cos(t),a=e.length-1,s=e[a],n=0;--a>=0;)r=i*s-n+e[a],n=s,s=r;return Math.sin(t)*r}},function(e,t,r){"use strict";var i=r(39),a=r(66);t.a=function(e,t,s){for(var n,o,h=Math.sin(t),l=Math.cos(t),u=r.i(i.a)(s),c=r.i(a.a)(s),d=2*l*c,p=-2*h*u,f=e.length-1,m=e[f],g=0,v=0,y=0;--f>=0;)n=v,o=g,v=m,g=y,m=d*v-n-p*g+e[f],y=p*v-o+d*g;return d=h*c,p=l*u,[d*m-p*y,d*y+p*m]}},function(e,t,r){"use strict";t.a=function(e){var t=Math.exp(e);return t=(t+1/t)/2}},function(e,t,r){"use strict";t.a=function(e,t){for(var r,i=2*Math.cos(2*t),a=e.length-1,s=e[a],n=0;--a>=0;)r=i*s-n+e[a],n=s,s=r;return t+r*Math.sin(2*t)}},function(e,t,r){"use strict";var i=r(0);t.a=function(e,t){var r=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-r)<1e-6)return t<0?-1*i.a:i.a;for(var a,s,n,o,h=Math.asin(.5*t),l=0;l<30;l++)if(s=Math.sin(h),n=Math.cos(h),o=e*s,a=Math.pow(1-o*o,2)/(2*n)*(t/(1-e*e)-s/(1-o*o)+.5/e*Math.log((1-o)/(1+o))),h+=a,Math.abs(a)<=1e-10)return h;return NaN}},function(e,t,r){"use strict";t.a=function(e){var t=1+e,r=t-1;return 0===r?e:e*Math.log(t)/r}},function(e,t,r){"use strict";t.a=function(e,t){return Math.pow((1-e)/(1+e),t)}},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={};i.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},i.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},i.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},i.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},i.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},i.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},i.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},i.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},i.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},i.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},i.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},i.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},i.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},i.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},i.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},i.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"b",function(){return a});var i={};i.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},i.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},i.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},i.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},i.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},i.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},i.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},i.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},i.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},i.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},i.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},i.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},i.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},i.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},i.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},i.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},i.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},i.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},i.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},i.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},i.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},i.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},i.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},i.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},i.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},i.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},i.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},i.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},i.hough={a:6378270,rf:297,ellipseName:"Hough"},i.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},i.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},i.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},i.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},i.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},i.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},i.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},i.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},i.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},i.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},i.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},i.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var a=i.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};i.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var i={};i.greenwich=0,i.lisbon=-9.131906111111,i.paris=2.337229166667,i.bogota=-74.080916666667,i.madrid=-3.687938888889,i.rome=12.452333333333,i.bern=7.439583333333,i.jakarta=106.807719444444,i.ferro=-17.666666666667,i.brussels=4.367975,i.stockholm=18.058277777778,i.athens=23.7163375,i.oslo=10.722916666667},function(e,t,r){"use strict";t.a={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}}},function(e,t,r){"use strict";function i(e,t,i){var a;return Array.isArray(i)?(a=r.i(o.a)(e,t,i),3===i.length?[a.x,a.y,a.z]:[a.x,a.y]):r.i(o.a)(e,t,i)}function a(e){return e instanceof n.a?e:e.oProj?e.oProj:r.i(n.a)(e)}function s(e,t,r,s){if(s)return e;e=a(e);var n,o=!1;return void 0===t?(t=e,e=h,o=!0):(void 0!==t.x||Array.isArray(t))&&(r=t,t=e,e=h,o=!0),t=a(t),r?i(e,t,r):(n={forward:function(r){return i(e,t,r)},inverse:function(r){return i(t,e,r)},info:function(){return{a:t.a,b:t.b,ra:t.R_A,"proj-name":t.projName}}},o&&(n.oProj=t),n)}var n=r(24),o=r(45),h=r.i(n.a)("WGS84");t.a=s},function(e,t,r){"use strict";function i(e,t,r,i,s,n){var o={};return o.datum_type=void 0===e||"none"===e?a.k:a.l,t&&(o.datum_params=t.map(parseFloat),0===o.datum_params[0]&&0===o.datum_params[1]&&0===o.datum_params[2]||(o.datum_type=a.h),o.datum_params.length>3&&(0===o.datum_params[3]&&0===o.datum_params[4]&&0===o.datum_params[5]&&0===o.datum_params[6]||(o.datum_type=a.i,o.datum_params[3]*=a.f,o.datum_params[4]*=a.f,o.datum_params[5]*=a.f,o.datum_params[6]=o.datum_params[6]/1e6+1))),o.a=r,o.b=i,o.es=s,o.ep2=n,o}var a=r(0);t.a=i},function(e,t,r){"use strict";function i(e){return e===a.h||e===a.i}var a=r(0),s=r(41);t.a=function(e,t,n){return r.i(s.c)(e,t)?n:e.datum_type===a.k||t.datum_type===a.k?n:e.es!==t.es||e.a!==t.a||i(e.datum_type)||i(t.datum_type)?(n=r.i(s.b)(n,e.es,e.a),i(e.datum_type)&&(n=r.i(s.d)(n,e.datum_type,e.datum_params)),i(t.datum_type)&&(n=r.i(s.e)(n,t.datum_type,t.datum_params)),r.i(s.a)(n,t.es,t.a,t.b)):n}},function(e,t,r){"use strict";function i(e,t,r,i){var a=e*e,n=t*t,o=(a-n)/a,h=0;return i?(e*=1-o*(s.m+o*(s.n+o*s.o)),a=e*e,o=0):h=Math.sqrt(o),{es:o,e:h,ep2:(a-n)/n}}function a(e,t,i,a,h){if(!e){var l=r.i(o.a)(n.a,a);l||(l=n.b),e=l.a,t=l.b,i=l.rf}return i&&!t&&(t=(1-1/i)*e),(0===i||Math.abs(e-t)<s.d)&&(h=!0,t=e),{a:e,b:t,rf:i,sphere:h}}var s=r(0),n=r(72),o=r(29);t.b=i,t.a=a},function(e,t,r){"use strict";t.a=function(e,t){e=e||{};var r,i;if(!t)return e;for(i in t)void 0!==(r=t[i])&&(e[i]=r);return e}},function(e,t,r){"use strict";t.a=function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}},function(e,t,r){"use strict";function i(e){return"string"==typeof e}function a(e){return e in h.a}function s(e){return c.some(function(t){return e.indexOf(t)>-1})}function n(e){return"+"===e[0]}function o(e){return i(e)?a(e)?h.a[e]:s(e)?r.i(l.a)(e):n(e)?r.i(u.a)(e):void 0:e}var h=r(42),l=r(46),u=r(43),c=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];t.a=o},function(e,t,r){"use strict";function i(e,t){var r=u.length;return e.names?(u[r]=e,e.names.forEach(function(e){l[e.toLowerCase()]=r}),this):(console.log(t),!0)}function a(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==l[t]&&u[l[t]]?u[l[t]]:void 0}function s(){h.forEach(i)}var n=r(96),o=r(95),h=[n.a,o.a],l={},u=[];t.a={start:s,add:i,get:a}},function(e,t,r){"use strict";function i(){Math.abs(this.lat1+this.lat2)<c.d||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=r.i(o.a)(this.e3,this.sin_po,this.cos_po),this.qs1=r.i(h.a)(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=r.i(o.a)(this.e3,this.sin_po,this.cos_po),this.qs2=r.i(h.a)(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=r.i(h.a)(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>c.d?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function a(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var a=r.i(h.a)(this.e3,this.sin_phi,this.cos_phi),s=this.a*Math.sqrt(this.c-this.ns0*a)/this.ns0,n=this.ns0*r.i(l.a)(t-this.long0),o=s*Math.sin(n)+this.x0,u=this.rh-s*Math.cos(n)+this.y0;return e.x=o,e.y=u,e}function s(e){var t,i,a,s,n,o;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),a=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),a=-1),s=0,0!==t&&(s=Math.atan2(a*e.x,a*e.y)),a=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-a*a)/(2*this.ns0)):(i=(this.c-a*a)/this.ns0,o=this.phi1z(this.e3,i)),n=r.i(l.a)(s/this.ns0+this.long0),e.x=n,e.y=o,e}function n(e,t){var i,a,s,n,o,h=r.i(u.a)(.5*t);if(e<c.d)return h;for(var l=e*e,d=1;d<=25;d++)if(i=Math.sin(h),a=Math.cos(h),s=e*i,n=1-s*s,o=.5*n*n/a*(t/(1-l)-i/n+.5/e*Math.log((1-s)/(1+s))),h+=o,Math.abs(o)<=1e-7)return h;return null}var o=r(8),h=r(28),l=r(1),u=r(7),c=r(0),d=["Albers_Conic_Equal_Area","Albers","aea"];t.a={init:i,forward:a,inverse:s,names:d,phi1z:n}},function(e,t,r){"use strict";function i(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function a(e){var t,i,a,s,f,m,g,v,y,b,x,M,S,w,A,T,C,P,F,L,E,I,N,B=e.x,_=e.y,R=Math.sin(e.y),k=Math.cos(e.y),z=r.i(n.a)(B-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=o.d?(e.x=this.x0+this.a*(o.a-_)*Math.sin(z),e.y=this.y0-this.a*(o.a-_)*Math.cos(z),e):Math.abs(this.sin_p12+1)<=o.d?(e.x=this.x0+this.a*(o.a+_)*Math.sin(z),e.y=this.y0+this.a*(o.a+_)*Math.cos(z),e):(P=this.sin_p12*R+this.cos_p12*k*Math.cos(z),T=Math.acos(P),C=T/Math.sin(T),e.x=this.x0+this.a*C*k*Math.sin(z),e.y=this.y0+this.a*C*(this.cos_p12*R-this.sin_p12*k*Math.cos(z)),e):(t=r.i(l.a)(this.es),i=r.i(u.a)(this.es),a=r.i(c.a)(this.es),s=r.i(d.a)(this.es),Math.abs(this.sin_p12-1)<=o.d?(f=this.a*r.i(h.a)(t,i,a,s,o.a),m=this.a*r.i(h.a)(t,i,a,s,_),e.x=this.x0+(f-m)*Math.sin(z),e.y=this.y0-(f-m)*Math.cos(z),e):Math.abs(this.sin_p12+1)<=o.d?(f=this.a*r.i(h.a)(t,i,a,s,o.a),m=this.a*r.i(h.a)(t,i,a,s,_),e.x=this.x0+(f+m)*Math.sin(z),e.y=this.y0+(f+m)*Math.cos(z),e):(g=R/k,v=r.i(p.a)(this.a,this.e,this.sin_p12),y=r.i(p.a)(this.a,this.e,R),b=Math.atan((1-this.es)*g+this.es*v*this.sin_p12/(y*k)),x=Math.atan2(Math.sin(z),this.cos_p12*Math.tan(b)-this.sin_p12*Math.cos(z)),F=0===x?Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):Math.abs(Math.abs(x)-Math.PI)<=o.d?-Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):Math.asin(Math.sin(z)*Math.cos(b)/Math.sin(x)),M=this.e*this.sin_p12/Math.sqrt(1-this.es),S=this.e*this.cos_p12*Math.cos(x)/Math.sqrt(1-this.es),w=M*S,A=S*S,L=F*F,E=L*F,I=E*F,N=I*F,T=v*F*(1-L*A*(1-A)/6+E/8*w*(1-2*A)+I/120*(A*(4-7*A)-3*M*M*(1-7*A))-N/48*w),e.x=this.x0+T*Math.sin(x),e.y=this.y0+T*Math.cos(x),e))}function s(e){e.x-=this.x0,e.y-=this.y0;var t,i,a,s,g,v,y,b,x,M,S,w,A,T,C,P,F,L,E,I,N,B,_;if(this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*o.a*this.a)return;return i=t/this.a,a=Math.sin(i),s=Math.cos(i),g=this.long0,Math.abs(t)<=o.d?v=this.lat0:(v=r.i(f.a)(s*this.sin_p12+e.y*a*this.cos_p12/t),y=Math.abs(this.lat0)-o.a,g=Math.abs(y)<=o.d?this.lat0>=0?r.i(n.a)(this.long0+Math.atan2(e.x,-e.y)):r.i(n.a)(this.long0-Math.atan2(-e.x,e.y)):r.i(n.a)(this.long0+Math.atan2(e.x*a,t*this.cos_p12*s-e.y*this.sin_p12*a))),e.x=g,e.y=v,e}return b=r.i(l.a)(this.es),x=r.i(u.a)(this.es),M=r.i(c.a)(this.es),S=r.i(d.a)(this.es),Math.abs(this.sin_p12-1)<=o.d?(w=this.a*r.i(h.a)(b,x,M,S,o.a),t=Math.sqrt(e.x*e.x+e.y*e.y),A=w-t,v=r.i(m.a)(A/this.a,b,x,M,S),g=r.i(n.a)(this.long0+Math.atan2(e.x,-1*e.y)),e.x=g,e.y=v,e):Math.abs(this.sin_p12+1)<=o.d?(w=this.a*r.i(h.a)(b,x,M,S,o.a),t=Math.sqrt(e.x*e.x+e.y*e.y),A=t-w,v=r.i(m.a)(A/this.a,b,x,M,S),g=r.i(n.a)(this.long0+Math.atan2(e.x,e.y)),e.x=g,e.y=v,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),P=Math.atan2(e.x,e.y),T=r.i(p.a)(this.a,this.e,this.sin_p12),F=Math.cos(P),L=this.e*this.cos_p12*F,E=-L*L/(1-this.es),I=3*this.es*(1-E)*this.sin_p12*this.cos_p12*F/(1-this.es),N=t/T,B=N-E*(1+E)*Math.pow(N,3)/6-I*(1+3*E)*Math.pow(N,4)/24,_=1-E*B*B/2-N*B*B*B/6,C=Math.asin(this.sin_p12*Math.cos(B)+this.cos_p12*Math.sin(B)*F),g=r.i(n.a)(this.long0+Math.asin(Math.sin(P)*Math.sin(B)/Math.cos(C))),v=Math.atan((1-this.es*_*this.sin_p12/Math.sin(C))*Math.tan(C)/(1-this.es)),e.x=g,e.y=v,e)}var n=r(1),o=r(0),h=r(18),l=r(14),u=r(15),c=r(16),d=r(17),p=r(25),f=r(7),m=r(26),g=["Azimuthal_Equidistant","aeqd"];t.a={init:i,forward:a,inverse:s,names:g}},function(e,t,r){"use strict";function i(){this.sphere||(this.e0=r.i(o.a)(this.es),this.e1=r.i(h.a)(this.es),this.e2=r.i(l.a)(this.es),this.e3=r.i(u.a)(this.es),this.ml0=this.a*r.i(n.a)(this.e0,this.e1,this.e2,this.e3,this.lat0))}function a(e){var t,i,a=e.x,s=e.y;if(a=r.i(d.a)(a-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(a)),i=this.a*(Math.atan2(Math.tan(s),Math.cos(a))-this.lat0);else{var o=Math.sin(s),h=Math.cos(s),l=r.i(c.a)(this.a,this.e,o),u=Math.tan(s)*Math.tan(s),p=a*Math.cos(s),f=p*p,m=this.es*h*h/(1-this.es),g=this.a*r.i(n.a)(this.e0,this.e1,this.e2,this.e3,s);t=l*p*(1-f*u*(1/6-(8-u+8*m)*f/120)),i=g-this.ml0+l*o/h*f*(.5+(5-u+6*m)*f/24)}return e.x=t+this.x0,e.y=i+this.y0,e}function s(e){e.x-=this.x0,e.y-=this.y0;var t,i,a=e.x/this.a,s=e.y/this.a;if(this.sphere){var n=s+this.lat0;t=Math.asin(Math.sin(n)*Math.cos(a)),i=Math.atan2(Math.tan(a),Math.cos(n))}else{var o=this.ml0/this.a+s,h=r.i(f.a)(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(h)-m.a)<=m.d)return e.x=this.long0,e.y=m.a,s<0&&(e.y*=-1),e;var l=r.i(c.a)(this.a,this.e,Math.sin(h)),u=l*l*l/this.a/this.a*(1-this.es),g=Math.pow(Math.tan(h),2),v=a*this.a/l,y=v*v;t=h-l*Math.tan(h)/u*v*v*(.5-(1+3*g)*v*v/24),i=v*(1-y*(g/3+(1+3*g)*g*y/15))/Math.cos(h)}return e.x=r.i(d.a)(i+this.long0),e.y=r.i(p.a)(t),e}var n=r(18),o=r(14),h=r(15),l=r(16),u=r(17),c=r(25),d=r(1),p=r(9),f=r(26),m=r(0),g=["Cassini","Cassini_Soldner","cass"];t.a={init:i,forward:a,inverse:s,names:g}},function(e,t,r){"use strict";function i(){this.sphere||(this.k0=r.i(h.a)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function a(e){var t,i,a=e.x,s=e.y,h=r.i(n.a)(a-this.long0);if(this.sphere)t=this.x0+this.a*h*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var l=r.i(o.a)(this.e,Math.sin(s));t=this.x0+this.a*this.k0*h,i=this.y0+this.a*l*.5/this.k0}return e.x=t,e.y=i,e}function s(e){e.x-=this.x0,e.y-=this.y0;var t,i;return this.sphere?(t=r.i(n.a)(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(i=r.i(l.a)(this.e,2*e.y*this.k0/this.a),t=r.i(n.a)(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=i,e}var n=r(1),o=r(28),h=r(8),l=r(68),u=["cea"];t.a={init:i,forward:a,inverse:s,names:u}},function(e,t,r){"use strict";function i(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function a(e){var t=e.x,i=e.y,a=r.i(n.a)(t-this.long0),s=r.i(o.a)(i-this.lat0);return e.x=this.x0+this.a*a*this.rc,e.y=this.y0+this.a*s,e}function s(e){var t=e.x,i=e.y;return e.x=r.i(n.a)(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=r.i(o.a)(this.lat0+(i-this.y0)/this.a),e}var n=r(1),o=r(9),h=["Equirectangular","Equidistant_Cylindrical","eqc"];t.a={init:i,forward:a,inverse:s,names:h}},function(e,t,r){"use strict";function i(){Math.abs(this.lat1+this.lat2)<m.d||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r.i(n.a)(this.es),this.e1=r.i(o.a)(this.es),this.e2=r.i(h.a)(this.es),this.e3=r.i(l.a)(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=r.i(u.a)(this.e,this.sinphi,this.cosphi),this.ml1=r.i(c.a)(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<m.d?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=r.i(u.a)(this.e,this.sinphi,this.cosphi),this.ml2=r.i(c.a)(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=r.i(c.a)(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function a(e){var t,i=e.x,a=e.y;if(this.sphere)t=this.a*(this.g-a);else{var s=r.i(c.a)(this.e0,this.e1,this.e2,this.e3,a);t=this.a*(this.g-s)}var n=this.ns*r.i(d.a)(i-this.long0),o=this.x0+t*Math.sin(n),h=this.y0+this.rh-t*Math.cos(n);return e.x=o,e.y=h,e}function s(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i,a,s;this.ns>=0?(i=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var n=0;if(0!==i&&(n=Math.atan2(t*e.x,t*e.y)),this.sphere)return s=r.i(d.a)(this.long0+n/this.ns),a=r.i(p.a)(this.g-i/this.a),e.x=s,e.y=a,e;var o=this.g-i/this.a;return a=r.i(f.a)(o,this.e0,this.e1,this.e2,this.e3),s=r.i(d.a)(this.long0+n/this.ns),e.x=s,e.y=a,e}var n=r(14),o=r(15),h=r(16),l=r(17),u=r(8),c=r(18),d=r(1),p=r(9),f=r(26),m=r(0),g=["Equidistant_Conic","eqdc"];t.a={init:i,forward:a,inverse:s,names:g}},function(e,t,r){"use strict";function i(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+o.b)/(Math.pow(Math.tan(.5*this.lat0+o.b),this.C)*r.i(n.a)(this.e*e,this.ratexp))}function a(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+o.b),this.C)*r.i(n.a)(this.e*Math.sin(i),this.ratexp))-o.a,e.x=this.C*t,e}function s(e){for(var t=e.x/this.C,i=e.y,a=Math.pow(Math.tan(.5*i+o.b)/this.K,1/this.C),s=h;s>0&&(i=2*Math.atan(a*r.i(n.a)(this.e*Math.sin(e.y),-.5*this.e))-o.a,!(Math.abs(i-e.y)<1e-14));--s)e.y=i;return s?(e.x=t,e.y=i,e):null}var n=r(70),o=r(0),h=20,l=["gauss"];t.a={init:i,forward:a,inverse:s,names:l}},function(e,t,r){"use strict";function i(){this.isGeocent=!0}function a(e){return e}var s=["geocent"];t.a={init:i,forward:a,inverse:a,names:s}},function(e,t,r){"use strict";function i(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function a(e){var t,i,a,s,o,l,u,c,d=e.x,p=e.y;return a=r.i(n.a)(d-this.long0),t=Math.sin(p),i=Math.cos(p),s=Math.cos(a),l=this.sin_p14*t+this.cos_p14*i*s,o=1,l>0||Math.abs(l)<=h.d?(u=this.x0+this.a*o*i*Math.sin(a)/l,c=this.y0+this.a*o*(this.cos_p14*t-this.sin_p14*i*s)/l):(u=this.x0+this.infinity_dist*i*Math.sin(a),c=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*s)),e.x=u,e.y=c,e}function s(e){var t,i,a,s,h,l;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(s=Math.atan2(t,this.rc),i=Math.sin(s),a=Math.cos(s),l=r.i(o.a)(a*this.sin_p14+e.y*i*this.cos_p14/t),h=Math.atan2(e.x*i,t*this.cos_p14*a-e.y*this.sin_p14*i),h=r.i(n.a)(this.long0+h)):(l=this.phic0,h=0),e.x=h,e.y=l,e}var n=r(1),o=r(7),h=r(0),l=["gnom"];t.a={init:i,forward:a,inverse:s,names:l}},function(e,t,r){"use strict";function i(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function a(e){var t,i,a,s,o,h,l,u=e.x,c=e.y,d=r.i(n.a)(u-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),a=-d*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(a)),o=Math.asin(Math.cos(i)*Math.sin(a)/Math.cos(s)),h=this.n*o,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),e.y=l*Math.cos(h)/1,e.x=l*Math.sin(h)/1,this.czech||(e.y*=-1,e.x*=-1),e}function s(e){var t,r,i,a,s,n,o,h,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),n=Math.sqrt(e.x*e.x+e.y*e.y),s=Math.atan2(e.y,e.x),a=s/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(a)),r=Math.asin(Math.cos(i)*Math.sin(a)/Math.cos(t)),e.x=this.long0-r/this.alfa,o=t,h=0;var u=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(h=1),o=e.y,u+=1}while(0===h&&u<15);return u>=15?null:e}var n=r(1),o=["Krovak","krovak"];t.a={init:i,forward:a,inverse:s,names:o}},function(e,t,r){"use strict";function i(){var e=Math.abs(this.lat0);if(Math.abs(e-h.a)<h.d?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<h.d?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=r.i(l.a)(this.e,1),this.mmf=.5/(1-this.es),this.apa=n(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=r.i(l.a)(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function a(e){var t,i,a,s,n,o,c,d,p,f,m=e.x,g=e.y;if(m=r.i(u.a)(m-this.long0),this.sphere){if(n=Math.sin(g),f=Math.cos(g),a=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+f*a:1+this.sinph0*n+this.cosph0*f*a)<=h.d)return null;i=Math.sqrt(2/i),t=i*f*Math.sin(m),i*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*f*a}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),Math.abs(g+this.phi0)<h.d)return null;i=h.b-.5*g,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),t=i*Math.sin(m),i*=a}}else{switch(c=0,d=0,p=0,a=Math.cos(m),s=Math.sin(m),n=Math.sin(g),o=r.i(l.a)(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(c=o/this.qp,d=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:p=1+this.sinb1*c+this.cosb1*d*a;break;case this.EQUIT:p=1+d*a;break;case this.N_POLE:p=h.a+g,o=this.qp-o;break;case this.S_POLE:p=g-h.a,o=this.qp+o}if(Math.abs(p)<h.d)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),i=this.mode===this.OBLIQ?this.ymf*p*(this.cosb1*c-this.sinb1*d*a):(p=Math.sqrt(2/(1+d*a)))*c*this.ymf,t=this.xmf*p*d*s;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(p=Math.sqrt(o))*s,i=a*(this.mode===this.S_POLE?p:-p)):t=i=0}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e}function s(e){e.x-=this.x0,e.y-=this.y0;var t,i,a,s,n,l,c,d=e.x/this.a,p=e.y/this.a;if(this.sphere){var f,m=0,g=0;if(f=Math.sqrt(d*d+p*p),(i=.5*f)>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(i),m=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(f)<=h.d?0:Math.asin(p*g/f),d*=g,p=m*f;break;case this.OBLIQ:i=Math.abs(f)<=h.d?this.phi0:Math.asin(m*this.sinph0+p*g*this.cosph0/f),d*=g*this.cosph0,p=(m-Math.sin(i)*this.sinph0)*f;break;case this.N_POLE:p=-p,i=h.a-i;break;case this.S_POLE:i-=h.a}t=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(d,p):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(d/=this.dd,p*=this.dd,(l=Math.sqrt(d*d+p*p))<h.d)return e.x=0,e.y=this.phi0,e;s=2*Math.asin(.5*l/this.rq),a=Math.cos(s),d*=s=Math.sin(s),this.mode===this.OBLIQ?(c=a*this.sinb1+p*s*this.cosb1/l,n=this.qp*c,p=l*this.cosb1*a-p*this.sinb1*s):(c=p*s/l,n=this.qp*c,p=l*a)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(n=d*d+p*p))return e.x=0,e.y=this.phi0,e;c=1-n/this.qp,this.mode===this.S_POLE&&(c=-c)}t=Math.atan2(d,p),i=o(Math.asin(c),this.apa)}return e.x=r.i(u.a)(this.long0+t),e.y=i,e}function n(e){var t,r=[];return r[0]=e*c,t=e*e,r[0]+=t*d,r[1]=t*f,t*=e,r[0]+=t*p,r[1]+=t*m,r[2]=t*g,r}function o(e,t){var r=e+e;return e+t[0]*Math.sin(r)+t[1]*Math.sin(r+r)+t[2]*Math.sin(r+r+r)}var h=r(0),l=r(28),u=r(1),c=.3333333333333333,d=.17222222222222222,p=.10257936507936508,f=.06388888888888888,m=.0664021164021164,g=.016415012942191543,v=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];t.a={init:i,forward:a,inverse:s,names:v,S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4}},function(e,t,r){"use strict";function i(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<c.d)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),a=r.i(n.a)(this.e,t,i),s=r.i(o.a)(this.e,this.lat1,t),h=Math.sin(this.lat2),l=Math.cos(this.lat2),u=r.i(n.a)(this.e,h,l),d=r.i(o.a)(this.e,this.lat2,h),p=r.i(o.a)(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>c.d?this.ns=Math.log(a/u)/Math.log(s/d):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=a/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(p,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function a(e){var t=e.x,i=e.y;Math.abs(2*Math.abs(i)-Math.PI)<=c.d&&(i=r.i(h.a)(i)*(c.a-2*c.d));var a,s,n=Math.abs(Math.abs(i)-c.a);if(n>c.d)a=r.i(o.a)(this.e,i,Math.sin(i)),s=this.a*this.f0*Math.pow(a,this.ns);else{if((n=i*this.ns)<=0)return null;s=0}var u=this.ns*r.i(l.a)(t-this.long0);return e.x=this.k0*(s*Math.sin(u))+this.x0,e.y=this.k0*(this.rh-s*Math.cos(u))+this.y0,e}function s(e){var t,i,a,s,n,o=(e.x-this.x0)/this.k0,h=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+h*h),i=1):(t=-Math.sqrt(o*o+h*h),i=-1);var d=0;if(0!==t&&(d=Math.atan2(i*o,i*h)),0!==t||this.ns>0){if(i=1/this.ns,a=Math.pow(t/(this.a*this.f0),i),-9999===(s=r.i(u.a)(this.e,a)))return null}else s=-c.a;return n=r.i(l.a)(d/this.ns+this.long0),e.x=n,e.y=s,e}var n=r(8),o=r(20),h=r(10),l=r(1),u=r(19),c=r(0),d=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"];t.a={init:i,forward:a,inverse:s,names:d}},function(e,t,r){"use strict";function i(){}function a(e){return e}var s=["longlat","identity"];t.a={init:i,forward:a,inverse:a,names:s}},function(e,t,r){"use strict";function i(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r.i(n.a)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function a(e){var t=e.x,i=e.y;if(i*u.j>90&&i*u.j<-90&&t*u.j>180&&t*u.j<-180)return null;var a,s;if(Math.abs(Math.abs(i)-u.a)<=u.d)return null;if(this.sphere)a=this.x0+this.a*this.k0*r.i(o.a)(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(u.b+.5*i));else{var n=Math.sin(i),l=r.i(h.a)(this.e,i,n);a=this.x0+this.a*this.k0*r.i(o.a)(t-this.long0),s=this.y0-this.a*this.k0*Math.log(l)}return e.x=a,e.y=s,e}function s(e){var t,i,a=e.x-this.x0,s=e.y-this.y0;if(this.sphere)i=u.a-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var n=Math.exp(-s/(this.a*this.k0));if(-9999===(i=r.i(l.a)(this.e,n)))return null}return t=r.i(o.a)(this.long0+a/(this.a*this.k0)),e.x=t,e.y=i,e}var n=r(8),o=r(1),h=r(20),l=r(19),u=r(0),c=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];t.a={init:i,forward:a,inverse:s,names:c}},function(e,t,r){"use strict";function i(){}function a(e){var t=e.x,i=e.y,a=r.i(n.a)(t-this.long0),s=this.x0+this.a*a,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return e.x=s,e.y=o,e}function s(e){e.x-=this.x0,e.y-=this.y0;var t=r.i(n.a)(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=i,e}var n=r(1),o=["Miller_Cylindrical","mill"];t.a={init:i,forward:a,inverse:s,names:o}},function(e,t,r){"use strict";function i(){}function a(e){for(var t=e.x,i=e.y,a=r.i(n.a)(t-this.long0),s=i,h=Math.PI*Math.sin(i),l=0;!0;l++){var u=-(s+Math.sin(s)-h)/(1+Math.cos(s));if(s+=u,Math.abs(u)<o.d)break}s/=2,Math.PI/2-Math.abs(i)<o.d&&(a=0);var c=.900316316158*this.a*a*Math.cos(s)+this.x0,d=1.4142135623731*this.a*Math.sin(s)+this.y0;return e.x=c,e.y=d,e}function s(e){var t,i;e.x-=this.x0,e.y-=this.y0,i=e.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),t=Math.asin(i);var a=r.i(n.a)(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));a<-Math.PI&&(a=-Math.PI),a>Math.PI&&(a=Math.PI),i=(2*t+Math.sin(2*t))/Math.PI,Math.abs(i)>1&&(i=1);var s=Math.asin(i);return e.x=a,e.y=s,e}var n=r(1),o=r(0),h=["Mollweide","moll"];t.a={init:i,forward:a,inverse:s,names:h}},function(e,t,r){"use strict";function i(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function a(e){var t,r=e.x,i=e.y,a=i-this.lat0,s=r-this.long0,o=a/n.f*1e-5,h=s,l=1,u=0;for(t=1;t<=10;t++)l*=o,u+=this.A[t]*l;var c,d,p=u,f=h,m=1,g=0,v=0,y=0;for(t=1;t<=6;t++)c=m*p-g*f,d=g*p+m*f,m=c,g=d,v=v+this.B_re[t]*m-this.B_im[t]*g,y=y+this.B_im[t]*m+this.B_re[t]*g;return e.x=y*this.a+this.x0,e.y=v*this.a+this.y0,e}function s(e){var t,r,i,a=e.x,s=e.y,o=a-this.x0,h=s-this.y0,l=h/this.a,u=o/this.a,c=1,d=0,p=0,f=0;for(t=1;t<=6;t++)r=c*l-d*u,i=d*l+c*u,c=r,d=i,p=p+this.C_re[t]*c-this.C_im[t]*d,f=f+this.C_im[t]*c+this.C_re[t]*d;for(var m=0;m<this.iterations;m++){var g,v,y=p,b=f,x=l,M=u;for(t=2;t<=6;t++)g=y*p-b*f,v=b*p+y*f,y=g,b=v,x+=(t-1)*(this.B_re[t]*y-this.B_im[t]*b),M+=(t-1)*(this.B_im[t]*y+this.B_re[t]*b);y=1,b=0;var S=this.B_re[1],w=this.B_im[1];for(t=2;t<=6;t++)g=y*p-b*f,v=b*p+y*f,y=g,b=v,S+=t*(this.B_re[t]*y-this.B_im[t]*b),w+=t*(this.B_im[t]*y+this.B_re[t]*b);var A=S*S+w*w;p=(x*S+M*w)/A,f=(M*S-x*w)/A}var T=p,C=f,P=1,F=0;for(t=1;t<=9;t++)P*=T,F+=this.D[t]*P;var L=this.lat0+F*n.f*1e5,E=this.long0+C;return e.x=E,e.y=L,e}var n=r(0),o=["New_Zealand_Map_Grid","nzmg"];t.a={init:i,forward:a,inverse:s,names:o}},function(e,t,r){"use strict";function i(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),i=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var a=r.i(n.a)(this.e,this.lat0,e),s=this.bl/t*Math.sqrt((1-this.es)/(1-i*i));s*s<1&&(s=1);var h,l;if(isNaN(this.longc)){var u=r.i(n.a)(this.e,this.lat1,Math.sin(this.lat1)),c=r.i(n.a)(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(s+Math.sqrt(s*s-1))*Math.pow(a,this.bl):this.el=(s-Math.sqrt(s*s-1))*Math.pow(a,this.bl);var d=Math.pow(u,this.bl),p=Math.pow(c,this.bl);h=this.el/d,l=.5*(h-1/h);var f=(this.el*this.el-p*d)/(this.el*this.el+p*d),m=(p-d)/(p+d),g=r.i(o.a)(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(f*Math.tan(.5*this.bl*g)/m)/this.bl,this.long0=r.i(o.a)(this.long0);var v=r.i(o.a)(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*v)/l),this.alpha=Math.asin(s*Math.sin(this.gamma0))}else h=this.lat0>=0?s+Math.sqrt(s*s-1):s-Math.sqrt(s*s-1),this.el=h*Math.pow(a,this.bl),l=.5*(h-1/h),this.gamma0=Math.asin(Math.sin(this.alpha)/s),this.long0=this.longc-Math.asin(l*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha))}function a(e){var t,i,a,s=e.x,h=e.y,u=r.i(o.a)(s-this.long0);if(Math.abs(Math.abs(h)-l.a)<=l.d)a=h>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(l.b+a*this.gamma0*.5)),t=-1*a*l.a*this.al/this.bl;else{var c=r.i(n.a)(this.e,h,Math.sin(h)),d=this.el/Math.pow(c,this.bl),p=.5*(d-1/d),f=.5*(d+1/d),m=Math.sin(this.bl*u),g=(p*Math.sin(this.gamma0)-m*Math.cos(this.gamma0))/f;i=Math.abs(Math.abs(g)-1)<=l.d?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-g)/(1+g))/this.bl,t=Math.abs(Math.cos(this.bl*u))<=l.d?this.al*this.bl*u:this.al*Math.atan2(p*Math.cos(this.gamma0)+m*Math.sin(this.gamma0),Math.cos(this.bl*u))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+i):(t-=this.uc,e.x=this.x0+i*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-i*Math.sin(this.alpha)),e}function s(e){var t,i;this.no_rot?(i=e.y-this.y0,t=e.x-this.x0):(i=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var a=Math.exp(-1*this.bl*i/this.al),s=.5*(a-1/a),n=.5*(a+1/a),u=Math.sin(this.bl*t/this.al),c=(u*Math.cos(this.gamma0)+s*Math.sin(this.gamma0))/n,d=Math.pow(this.el/Math.sqrt((1+c)/(1-c)),1/this.bl);return Math.abs(c-1)<l.d?(e.x=this.long0,e.y=l.a):Math.abs(c+1)<l.d?(e.x=this.long0,e.y=-1*l.a):(e.y=r.i(h.a)(this.e,d),e.x=r.i(o.a)(this.long0-Math.atan2(s*Math.cos(this.gamma0)-u*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e}var n=r(20),o=r(1),h=r(19),l=r(0),u=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"];t.a={init:i,forward:a,inverse:s,names:u}},function(e,t,r){"use strict";function i(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function a(e){var t,i,a,s,o,l,u,c,d=e.x,p=e.y;return a=r.i(n.a)(d-this.long0),t=Math.sin(p),i=Math.cos(p),s=Math.cos(a),l=this.sin_p14*t+this.cos_p14*i*s,o=1,(l>0||Math.abs(l)<=h.d)&&(u=this.a*o*i*Math.sin(a),c=this.y0+this.a*o*(this.cos_p14*t-this.sin_p14*i*s)),e.x=u,e.y=c,e}function s(e){var t,i,a,s,l,u,c;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),i=r.i(o.a)(t/this.a),a=Math.sin(i),s=Math.cos(i),u=this.long0,Math.abs(t)<=h.d?(c=this.lat0,e.x=u,e.y=c,e):(c=r.i(o.a)(s*this.sin_p14+e.y*a*this.cos_p14/t),l=Math.abs(this.lat0)-h.a,Math.abs(l)<=h.d?(u=this.lat0>=0?r.i(n.a)(this.long0+Math.atan2(e.x,-e.y)):r.i(n.a)(this.long0-Math.atan2(-e.x,e.y)),e.x=u,e.y=c,e):(u=r.i(n.a)(this.long0+Math.atan2(e.x*a,t*this.cos_p14*s-e.y*this.sin_p14*a)),e.x=u,e.y=c,e))}var n=r(1),o=r(7),h=r(0),l=["ortho"];t.a={init:i,forward:a,inverse:s,names:l}},function(e,t,r){"use strict";function i(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r.i(n.a)(this.es),this.e1=r.i(o.a)(this.es),this.e2=r.i(h.a)(this.es),this.e3=r.i(l.a)(this.es),this.ml0=this.a*r.i(d.a)(this.e0,this.e1,this.e2,this.e3,this.lat0)}function a(e){var t,i,a,s=e.x,n=e.y,o=r.i(u.a)(s-this.long0);if(a=o*Math.sin(n),this.sphere)Math.abs(n)<=p.d?(t=this.a*o,i=-1*this.a*this.lat0):(t=this.a*Math.sin(a)/Math.tan(n),i=this.a*(r.i(c.a)(n-this.lat0)+(1-Math.cos(a))/Math.tan(n)));else if(Math.abs(n)<=p.d)t=this.a*o,i=-1*this.ml0;else{var h=r.i(f.a)(this.a,this.e,Math.sin(n))/Math.tan(n);t=h*Math.sin(a),i=this.a*r.i(d.a)(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+h*(1-Math.cos(a))}return e.x=t+this.x0,e.y=i+this.y0,e}function s(e){var t,i,a,s,n,o,h,l,c;if(a=e.x-this.x0,s=e.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=p.d)t=r.i(u.a)(a/this.a+this.long0),i=0;else{o=this.lat0+s/this.a,h=a*a/this.a/this.a+o*o,l=o;var f;for(n=m;n;--n)if(f=Math.tan(l),c=-1*(o*(l*f+1)-l-.5*(l*l+h)*f)/((l-o)/f-1),l+=c,Math.abs(c)<=p.d){i=l;break}t=r.i(u.a)(this.long0+Math.asin(a*Math.tan(l)/this.a)/Math.sin(i))}else if(Math.abs(s+this.ml0)<=p.d)i=0,t=r.i(u.a)(this.long0+a/this.a);else{o=(this.ml0+s)/this.a,h=a*a/this.a/this.a+o*o,l=o;var g,v,y,b,x;for(n=m;n;--n)if(x=this.e*Math.sin(l),g=Math.sqrt(1-x*x)*Math.tan(l),v=this.a*r.i(d.a)(this.e0,this.e1,this.e2,this.e3,l),y=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),b=v/this.a,c=(o*(g*b+1)-b-.5*g*(b*b+h))/(this.es*Math.sin(2*l)*(b*b+h-2*o*b)/(4*g)+(o-b)*(g*y-2/Math.sin(2*l))-y),l-=c,Math.abs(c)<=p.d){i=l;break}g=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),t=r.i(u.a)(this.long0+Math.asin(a*g/this.a)/Math.sin(i))}return e.x=t,e.y=i,e}var n=r(14),o=r(15),h=r(16),l=r(17),u=r(1),c=r(9),d=r(18),p=r(0),f=r(25),m=20,g=["Polyconic","poly"];t.a={init:i,forward:a,inverse:s,names:g}},function(e,t,r){"use strict";function i(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=h.a-h.b/2?this.face=l.TOP:this.lat0<=-(h.a-h.b/2)?this.face=l.BOTTOM:Math.abs(this.long0)<=h.b?this.face=l.FRONT:Math.abs(this.long0)<=h.a+h.b?this.face=this.long0>0?l.RIGHT:l.LEFT:this.face=l.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function a(e){var t,r,i,a,s,c,d={x:0,y:0},p={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,r=e.x,this.face===l.TOP)a=h.a-t,r>=h.b&&r<=h.a+h.b?(p.value=u.AREA_0,i=r-h.a):r>h.a+h.b||r<=-(h.a+h.b)?(p.value=u.AREA_1,i=r>0?r-h.c:r+h.c):r>-(h.a+h.b)&&r<=-h.b?(p.value=u.AREA_2,i=r+h.a):(p.value=u.AREA_3,i=r);else if(this.face===l.BOTTOM)a=h.a+t,r>=h.b&&r<=h.a+h.b?(p.value=u.AREA_0,i=-r+h.a):r<h.b&&r>=-h.b?(p.value=u.AREA_1,i=-r):r<-h.b&&r>=-(h.a+h.b)?(p.value=u.AREA_2,i=-r-h.a):(p.value=u.AREA_3,i=r>0?-r+h.c:-r-h.c);else{var f,m,g,v,y,b,x;this.face===l.RIGHT?r=o(r,+h.a):this.face===l.BACK?r=o(r,+h.c):this.face===l.LEFT&&(r=o(r,-h.a)),v=Math.sin(t),y=Math.cos(t),b=Math.sin(r),x=Math.cos(r),f=y*x,m=y*b,g=v,this.face===l.FRONT?(a=Math.acos(f),i=n(a,g,m,p)):this.face===l.RIGHT?(a=Math.acos(m),i=n(a,g,-f,p)):this.face===l.BACK?(a=Math.acos(-f),i=n(a,g,-m,p)):this.face===l.LEFT?(a=Math.acos(-m),i=n(a,g,f,p)):(a=i=0,p.value=u.AREA_0)}return c=Math.atan(12/h.c*(i+Math.acos(Math.sin(i)*Math.cos(h.b))-h.a)),s=Math.sqrt((1-Math.cos(a))/(Math.cos(c)*Math.cos(c))/(1-Math.cos(Math.atan(1/Math.cos(i))))),p.value===u.AREA_1?c+=h.a:p.value===u.AREA_2?c+=h.c:p.value===u.AREA_3&&(c+=1.5*h.c),d.x=s*Math.cos(c),d.y=s*Math.sin(c),d.x=d.x*this.a+this.x0,d.y=d.y*this.a+this.y0,e.x=d.x,e.y=d.y,e}function s(e){var t,r,i,a,s,n,c,d,p,f={lam:0,phi:0},m={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?m.value=u.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(m.value=u.AREA_1,t-=h.a):e.x<0&&-e.x>=Math.abs(e.y)?(m.value=u.AREA_2,t=t<0?t+h.c:t-h.c):(m.value=u.AREA_3,t+=h.a),p=h.c/12*Math.tan(t),s=Math.sin(p)/(Math.cos(p)-1/Math.sqrt(2)),n=Math.atan(s),i=Math.cos(t),a=Math.tan(r),c=1-i*i*a*a*(1-Math.cos(Math.atan(1/Math.cos(n)))),c<-1?c=-1:c>1&&(c=1),this.face===l.TOP)d=Math.acos(c),f.phi=h.a-d,m.value===u.AREA_0?f.lam=n+h.a:m.value===u.AREA_1?f.lam=n<0?n+h.c:n-h.c:m.value===u.AREA_2?f.lam=n-h.a:f.lam=n;else if(this.face===l.BOTTOM)d=Math.acos(c),f.phi=d-h.a,m.value===u.AREA_0?f.lam=-n+h.a:m.value===u.AREA_1?f.lam=-n:m.value===u.AREA_2?f.lam=-n-h.a:f.lam=n<0?-n-h.c:-n+h.c;else{var g,v,y;g=c,p=g*g,y=p>=1?0:Math.sqrt(1-p)*Math.sin(n),p+=y*y,v=p>=1?0:Math.sqrt(1-p),m.value===u.AREA_1?(p=v,v=-y,y=p):m.value===u.AREA_2?(v=-v,y=-y):m.value===u.AREA_3&&(p=v,v=y,y=-p),this.face===l.RIGHT?(p=g,g=-v,v=p):this.face===l.BACK?(g=-g,v=-v):this.face===l.LEFT&&(p=g,g=v,v=-p),f.phi=Math.acos(-y)-h.a,f.lam=Math.atan2(v,g),this.face===l.RIGHT?f.lam=o(f.lam,-h.a):this.face===l.BACK?f.lam=o(f.lam,-h.c):this.face===l.LEFT&&(f.lam=o(f.lam,+h.a))}if(0!==this.es){var b,x,M;b=f.phi<0?1:0,x=Math.tan(f.phi),M=this.b/Math.sqrt(x*x+this.one_minus_f_squared),f.phi=Math.atan(Math.sqrt(this.a*this.a-M*M)/(this.one_minus_f*M)),b&&(f.phi=-f.phi)}return f.lam+=this.long0,e.x=f.lam,e.y=f.phi,e}function n(e,t,r,i){var a;return e<h.d?(i.value=u.AREA_0,a=0):(a=Math.atan2(t,r),Math.abs(a)<=h.b?i.value=u.AREA_0:a>h.b&&a<=h.a+h.b?(i.value=u.AREA_1,a-=h.a):a>h.a+h.b||a<=-(h.a+h.b)?(i.value=u.AREA_2,a=a>=0?a-h.c:a+h.c):(i.value=u.AREA_3,a+=h.a)),a}function o(e,t){var r=e+t;return r<-h.c?r+=h.e:r>+h.c&&(r-=h.e),r}var h=r(0),l={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},u={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},c=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];t.a={init:i,forward:a,inverse:s,names:c}},function(e,t,r){"use strict";function i(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=r.i(h.a)(this.es)}function a(e){var t,i,a=e.x,s=e.y;if(a=r.i(n.a)(a-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(s),h=p;h;--h){var u=(this.m*s+Math.sin(s)-o)/(this.m+Math.cos(s));if(s-=u,Math.abs(u)<c.d)break}else s=1!==this.n?Math.asin(this.n*Math.sin(s)):s;t=this.a*this.C_x*a*(this.m+Math.cos(s)),i=this.a*this.C_y*s}else{var d=Math.sin(s),f=Math.cos(s);i=this.a*r.i(l.a)(s,d,f,this.en),t=this.a*a*f/Math.sqrt(1-this.es*d*d)}return e.x=t,e.y=i,e}function s(e){var t,i,a,s;return e.x-=this.x0,a=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,a/=this.C_x*(this.m+Math.cos(t)),this.m?t=r.i(d.a)((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=r.i(d.a)(Math.sin(t)/this.n)),a=r.i(n.a)(a+this.long0),t=r.i(o.a)(t)):(t=r.i(u.a)(e.y/this.a,this.es,this.en),s=Math.abs(t),s<c.a?(s=Math.sin(t),i=this.long0+e.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),a=r.i(n.a)(i)):s-c.d<c.a&&(a=this.long0)),e.x=a,e.y=t,e}var n=r(1),o=r(9),h=r(37),l=r(27),u=r(38),c=r(0),d=r(7),p=20,f=["Sinusoidal","sinu"];t.a={init:i,forward:a,inverse:s,names:f}},function(e,t,r){"use strict";function i(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),r=this.a,i=this.rf,a=1/i,s=2*a-Math.pow(a,2),n=this.e=Math.sqrt(s);this.R=this.k0*r*Math.sqrt(1-s)/(1-s*Math.pow(t,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+n*t)/(1-n*t));this.K=o-this.alpha*h+this.alpha*n/2*l}function a(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),i=-this.alpha*(t+r)+this.K,a=2*(Math.atan(Math.exp(i))-Math.PI/4),s=this.alpha*(e.x-this.lambda0),n=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(s))),o=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(s));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*n+this.x0,e}function s(e){for(var t=e.x-this.x0,r=e.y-this.y0,i=t/this.R,a=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(a)+Math.sin(this.b0)*Math.cos(a)*Math.cos(i)),n=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(a))),o=this.lambda0+n/this.alpha,h=0,l=s,u=-1e3,c=0;Math.abs(l-u)>1e-7;){if(++c>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),u=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return e.x=o,e.y=l,e}var n=["somerc"];t.a={init:i,forward:a,inverse:s,names:n}},function(e,t,r){"use strict";function i(e,t,r){return t*=r,Math.tan(.5*(o.a+e))*Math.pow((1-t)/(1+t),.5*r)}function a(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o.d&&(this.k0=.5*(1+r.i(h.a)(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=o.d&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o.d&&(this.k0=.5*this.cons*r.i(l.a)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/r.i(u.a)(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=r.i(l.a)(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-o.a,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function s(e){var t,i,a,s,n,h,l=e.x,c=e.y,p=Math.sin(c),f=Math.cos(c),m=r.i(d.a)(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=o.d&&Math.abs(c+this.lat0)<=o.d?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*p+this.coslat0*f*Math.cos(m)),e.x=this.a*t*f*Math.sin(m)+this.x0,e.y=this.a*t*(this.coslat0*p-this.sinlat0*f*Math.cos(m))+this.y0,e):(i=2*Math.atan(this.ssfn_(c,p,this.e))-o.a,s=Math.cos(i),a=Math.sin(i),Math.abs(this.coslat0)<=o.d?(n=r.i(u.a)(this.e,c*this.con,this.con*p),h=2*this.a*this.k0*n/this.cons,e.x=this.x0+h*Math.sin(l-this.long0),e.y=this.y0-this.con*h*Math.cos(l-this.long0),e):(Math.abs(this.sinlat0)<o.d?(t=2*this.a*this.k0/(1+s*Math.cos(m)),e.y=t*a):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*s*Math.cos(m))),e.y=t*(this.cosX0*a-this.sinX0*s*Math.cos(m))+this.y0),e.x=t*s*Math.sin(m)+this.x0,e))}function n(e){e.x-=this.x0,e.y-=this.y0;var t,i,a,s,n,h=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(h/(.5*this.a*this.k0));return t=this.long0,(i=this.lat0,h<=o.d)?(e.x=t,e.y=i,e):(i=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/h),t=Math.abs(this.coslat0)<o.d?this.lat0>0?r.i(d.a)(this.long0+Math.atan2(e.x,-1*e.y)):r.i(d.a)(this.long0+Math.atan2(e.x,e.y)):r.i(d.a)(this.long0+Math.atan2(e.x*Math.sin(l),h*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=t,e.y=i,e)}if(Math.abs(this.coslat0)<=o.d){if(h<=o.d)return i=this.lat0,t=this.long0,e.x=t,e.y=i,e;e.x*=this.con,e.y*=this.con,a=h*this.cons/(2*this.a*this.k0),i=this.con*r.i(c.a)(this.e,a),t=this.con*r.i(d.a)(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else s=2*Math.atan(h*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,h<=o.d?n=this.X0:(n=Math.asin(Math.cos(s)*this.sinX0+e.y*Math.sin(s)*this.cosX0/h),t=r.i(d.a)(this.long0+Math.atan2(e.x*Math.sin(s),h*this.cosX0*Math.cos(s)-e.y*this.sinX0*Math.sin(s)))),i=-1*r.i(c.a)(this.e,Math.tan(.5*(o.a+n)));return e.x=t,e.y=i,e}var o=r(0),h=r(10),l=r(8),u=r(20),c=r(19),d=r(1),p=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"];t.a={init:a,forward:s,inverse:n,names:p,ssfn_:i}},function(e,t,r){"use strict";function i(){n.a.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function a(e){var t,i,a,s;return e.x=r.i(o.a)(e.x-this.long0),n.a.forward.apply(this,[e]),t=Math.sin(e.y),i=Math.cos(e.y),a=Math.cos(e.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*i*a),e.x=s*i*Math.sin(e.x),e.y=s*(this.cosc0*t-this.sinc0*i*a),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function s(e){var t,i,a,s,h;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,h=Math.sqrt(e.x*e.x+e.y*e.y)){var l=2*Math.atan2(h,this.R2);t=Math.sin(l),i=Math.cos(l),s=Math.asin(i*this.sinc0+e.y*t*this.cosc0/h),a=Math.atan2(e.x*t,h*this.cosc0*i-e.y*this.sinc0*t)}else s=this.phic0,a=0;return e.x=a,e.y=s,n.a.inverse.apply(this,[e]),e.x=r.i(o.a)(e.x+this.long0),e}var n=r(89),o=r(1),h=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"];t.a={init:i,forward:a,inverse:s,names:h}},function(e,t,r){"use strict";function i(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=r.i(n.a)(this.es),this.ml0=r.i(o.a)(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function a(e){var t,i,a,s=e.x,n=e.y,h=r.i(l.a)(s-this.long0),c=Math.sin(n),d=Math.cos(n);if(this.es){var p=d*h,f=Math.pow(p,2),m=this.ep2*Math.pow(d,2),g=Math.pow(m,2),v=Math.abs(d)>u.d?Math.tan(n):0,y=Math.pow(v,2),b=Math.pow(y,2);t=1-this.es*Math.pow(c,2),p/=Math.sqrt(t);var x=r.i(o.a)(n,c,d,this.en);i=this.a*(this.k0*p*(1+f/6*(1-y+m+f/20*(5-18*y+b+14*m-58*y*m+f/42*(61+179*b-b*y-479*y)))))+this.x0,a=this.a*(this.k0*(x-this.ml0+c*h*p/2*(1+f/12*(5-y+9*m+4*g+f/30*(61+b-58*y+270*m-330*y*m+f/56*(1385+543*b-b*y-3111*y))))))+this.y0}else{var M=d*Math.sin(h);if(Math.abs(Math.abs(M)-1)<u.d)return 93;if(i=.5*this.a*this.k0*Math.log((1+M)/(1-M))+this.x0,a=d*Math.cos(h)/Math.sqrt(1-Math.pow(M,2)),(M=Math.abs(a))>=1){if(M-1>u.d)return 93;a=0}else a=Math.acos(a);n<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return e.x=i,e.y=a,e}function s(e){var t,i,a,s,n=(e.x-this.x0)*(1/this.a),o=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,i=r.i(h.a)(t,this.es,this.en),Math.abs(i)<u.a){var d=Math.sin(i),p=Math.cos(i),f=Math.abs(p)>u.d?Math.tan(i):0,m=this.ep2*Math.pow(p,2),g=Math.pow(m,2),v=Math.pow(f,2),y=Math.pow(v,2);t=1-this.es*Math.pow(d,2);var b=n*Math.sqrt(t)/this.k0,x=Math.pow(b,2);t*=f,a=i-t*x/(1-this.es)*.5*(1-x/12*(5+3*v-9*m*v+m-4*g-x/30*(61+90*v-252*m*v+45*y+46*m-x/56*(1385+3633*v+4095*y+1574*y*v)))),s=r.i(l.a)(this.long0+b*(1-x/6*(1+2*v+m-x/20*(5+28*v+24*y+8*m*v+6*m-x/42*(61+662*v+1320*y+720*y*v))))/p)}else a=u.a*r.i(c.a)(o),s=0;else{var M=Math.exp(n/this.k0),S=.5*(M-1/M),w=this.lat0+o/this.k0,A=Math.cos(w);t=Math.sqrt((1-Math.pow(A,2))/(1+Math.pow(S,2))),a=Math.asin(t),o<0&&(a=-a),s=0===S&&0===A?0:r.i(l.a)(Math.atan2(S,A)+this.long0)}return e.x=s,e.y=a,e}var n=r(37),o=r(27),h=r(38),l=r(1),u=r(0),c=r(10),d=["Transverse_Mercator","Transverse Mercator","tmerc"];t.a={init:i,forward:a,inverse:s,names:d}},function(e,t,r){"use strict";function i(){var e=r.i(a.a)(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*n.g,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,s.a.init.apply(this),this.forward=s.a.forward,this.inverse=s.a.inverse}var a=r(62),s=r(44),n=r(0),o=["Universal Transverse Mercator System","utm"];t.a={init:i,names:o,dependsOn:"etmerc"}},function(e,t,r){"use strict";function i(){this.R=this.a}function a(e){var t,i,a=e.x,s=e.y,l=r.i(n.a)(a-this.long0);Math.abs(s)<=o.d&&(t=this.x0+this.R*l,i=this.y0);var u=r.i(h.a)(2*Math.abs(s/Math.PI));(Math.abs(l)<=o.d||Math.abs(Math.abs(s)-o.a)<=o.d)&&(t=this.x0,i=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*u):this.y0+Math.PI*this.R*-Math.tan(.5*u));var c=.5*Math.abs(Math.PI/l-l/Math.PI),d=c*c,p=Math.sin(u),f=Math.cos(u),m=f/(p+f-1),g=m*m,v=m*(2/p-1),y=v*v,b=Math.PI*this.R*(c*(m-y)+Math.sqrt(d*(m-y)*(m-y)-(y+d)*(g-y)))/(y+d);l<0&&(b=-b),t=this.x0+b;var x=d+m;return b=Math.PI*this.R*(v*x-c*Math.sqrt((y+d)*(d+1)-x*x))/(y+d),i=s>=0?this.y0+b:this.y0-b,e.x=t,e.y=i,e}function s(e){var t,i,a,s,h,l,u,c,d,p,f,m,g;return e.x-=this.x0,e.y-=this.y0,f=Math.PI*this.R,a=e.x/f,s=e.y/f,h=a*a+s*s,l=-Math.abs(s)*(1+h),u=l-2*s*s+a*a,c=-2*l+1+2*s*s+h*h,g=s*s/c+(2*u*u*u/c/c/c-9*l*u/c/c)/27,d=(l-u*u/3/c)/c,p=2*Math.sqrt(-d/3),f=3*g/d/p,Math.abs(f)>1&&(f=f>=0?1:-1),m=Math.acos(f)/3,i=e.y>=0?(-p*Math.cos(m+Math.PI/3)-u/3/c)*Math.PI:-(-p*Math.cos(m+Math.PI/3)-u/3/c)*Math.PI,t=Math.abs(a)<o.d?this.long0:r.i(n.a)(this.long0+Math.PI*(h-1+Math.sqrt(1+2*(a*a-s*s)+h*h))/2/a),e.x=t,e.y=i,e}var n=r(1),o=r(0),h=r(7),l=["Van_der_Grinten_I","VanDerGrinten","vandg"];t.a={init:i,forward:a,inverse:s,names:l}},function(e,t,r){"use strict";var i=r(112);r.n(i);r.o(i,"version")&&r.d(t,"a",function(){return i.version})},function(e,t){e.exports={_args:[[{raw:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",scope:null,escapedName:null,name:null,rawSpec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",spec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",type:"directory"},"g:\\code\\melown"]],_from:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",_id:"proj4@2.4.4-alpha",_inCache:!0,_location:"/proj4",_phantomChildren:{},_requested:{raw:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",scope:null,escapedName:null,name:null,rawSpec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",spec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",type:"directory"},_requiredBy:["#USER"],_resolved:"file:C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",_shasum:"762f64abdcff3ac4aaa425107b49b02cb4386ec6",_shrinkwrap:null,_spec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",_where:"g:\\code\\melown",author:"",bugs:{url:"https://github.com/proj4js/proj4js/issues"},contributors:[{name:"Mike Adair",email:"madair@dmsolutions.ca"},{name:"Richard Greenwood",email:"rich@greenwoodmap.com"},{name:"Calvin Metcalf",email:"calvin.metcalf@gmail.com"},{name:"Richard Marsden",url:"http://www.winwaed.com"},{name:"T. Mittan"},{name:"D. Steinwand"},{name:"S. Nelson"}],dependencies:{mgrs:"1.0.0","wkt-parser":"^1.1.3"},description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",devDependencies:{chai:"~1.8.1",curl:"git://github.com/cujojs/curl.git",grunt:"~0.4.2","grunt-cli":"~0.1.13","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~1.1.0","grunt-contrib-uglify":"~0.11.1","grunt-mocha-phantomjs":"~0.4.0","grunt-rollup":"^1.0.1",istanbul:"~0.2.4",mocha:"~1.17.1",rollup:"^0.41.4","rollup-plugin-json":"^2.0.1","rollup-plugin-node-resolve":"^2.0.0",tin:"~0.4.0"},directories:{test:"test",doc:"docs"},gitHead:"3494d52f2c543b2ee7bea04292924a771dbd3eb8",homepage:"https://github.com/proj4js/proj4js#readme",license:"MIT",main:"dist/proj4-src.js",module:"lib/index.js",name:"proj4",optionalDependencies:{},readme:'# PROJ4JS [![Build Status](https://travis-ci.org/proj4js/proj4js.svg)](https://travis-ci.org/proj4js/proj4js)\n\nProj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.\nOriginally a port of [PROJ.4](http://trac.osgeo.org/proj/) and [GCTCP C](http://edcftp.cr.usgs.gov/pub//software/gctpc) it is\na part of the [MetaCRS](http://wiki.osgeo.org/wiki/MetaCRS) group of projects.\n\n## Installing\n\nDepending on your preferences\n\n```bash\nnpm install proj4\nbower install proj4\ncomponent install proj4js/proj4js\n```\n\nor just manually grab the file `proj4.js` from the [latest release](https://github.com/proj4js/proj4js/releases)\'s `dist/` folder.\n\nif you do not want to download anything, Proj4js is also hosted on [cdnjs](http://www.cdnjs.com/libraries/proj4js) for direct use in your browser applications.\n\n## Using\n\nthe basic signature is:\n\n```javascript\nproj4(fromProjection[, toProjection, coordinates])\n```\n\nProjections can be proj or wkt strings.\n\nCoordinates may an object of the form `{x:x,y:y}` or an array of the form `[x,y]`.\n\nWhen all 3 arguments  are given, the result is that the coordinates are transformed from projection1 to projection 2. And returned in the same format that they were given in.\n\n```javascript\nvar firstProjection = \'PROJCS["NAD83 / Massachusetts Mainland",GEOGCS["NAD83",DATUM["North_American_Datum_1983",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.01745329251994328,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],UNIT["metre",1,AUTHORITY["EPSG","9001"]],PROJECTION["Lambert_Conformal_Conic_2SP"],PARAMETER["standard_parallel_1",42.68333333333333],PARAMETER["standard_parallel_2",41.71666666666667],PARAMETER["latitude_of_origin",41],PARAMETER["central_meridian",-71.5],PARAMETER["false_easting",200000],PARAMETER["false_northing",750000],AUTHORITY["EPSG","26986"],AXIS["X",EAST],AXIS["Y",NORTH]]\';\nvar secondProjection = "+proj=gnom +lat_0=90 +lon_0=0 +x_0=6300000 +y_0=6300000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";\n//I\'m not going to redefine those two in latter examples.\nproj4(firstProjection,secondProjection,[2,5]);\n// [-2690666.2977344505, 3662659.885459918]\n```\n\nIf only 1 projection is given then it is assumed that it is being projected *from* WGS84 (fromProjection is WGS84).\n\n```javascript\nproj4(firstProjection,[-71,41]);\n// [242075.00535055372, 750123.32090043]\n```\n\nIf no coordinates are given an object with two methods is returned, its methods are `forward` which projects from the first projection to the second and `inverse` which projects from the second to the first.\n\n```javascript\nproj4(firstProjection,secondProjection).forward([2,5]);\n// [-2690666.2977344505, 3662659.885459918]\nproj4(secondProjection,firstProjection).inverse([2,5]);\n// [-2690666.2977344505, 3662659.885459918]\n```\n\nand as above if only one projection is given, it\'s assumed to be coming from wgs84\n\n```javascript\nproj4(firstProjection).forward([-71,41]);\n// [242075.00535055372, 750123.32090043]\nproj4(firstProjection).inverse([242075.00535055372, 750123.32090043]);\n//[-71, 40.99999999999986]\n//the floating points to answer your question\n```\n\n## Named Projections\n\nIf you prefer to define a projection as a string and reference it that way, you may use the proj4.defs method which can be called 2 ways, with a name and projection:\n\n```js\nproj4.defs(\'WGS84\', "+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees");\n```\n\nor with an array\n\n```js\nproj4.defs([\n  [\n    \'EPSG:4326\',\n    \'+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees\'],\n  [\n    \'EPSG:4269\',\n    \'+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees\'\n  ]\n]);\n```\n\nyou can then do\n\n```js\nproj4(\'EPSG:4326\');\n```\n\ninstead of writing out the whole proj definition, by default proj4 has the following projections predefined:\n\n- \'EPSG:4326\', which has the following alias\n    - \'WGS84\'\n- \'EPSG:4269\'\n- \'EPSG:3857\', which has the following aliases\n    - \'EPSG:3785\'\n    - \'GOOGLE\'\n    - \'EPSG:900913\'\n    - \'EPSG:102113\'\n\ndefined projections can also be accessed through the proj4.defs function (`proj4.defs(\'EPSG:4326\')`).\n\nproj4.defs can also be used to define a named alias:\n\n```javascript\nproj4.defs(\'urn:x-ogc:def:crs:EPSG:4326\', proj4.defs(\'EPSG:4326\'));\n```\n\n## TypeScript\n\nTypeScript implementation was added to the [DefinitelyTyped repository](https://github.com/DefinitelyTyped/DefinitelyTyped).\n\n```bash\n$ npm install --save @types/proj4\n```\n\n## Developing\nto set up build tools make sure you have node and grunt-cli installed and then run `npm install`\n\nto do the complete build and browser tests run\n\n```bash\nnode_modules/.bin/grunt\n```\n\nto run node tests run\n\n```bash\nnpm test\n```\n\nto run node tests with coverage run\n\n```bash\nnpm test --coverage\n```\n\nto create a build with only default projections (latlon and Mercator) run\n\n```bash\nnode_modules/.bin/grunt build\n```\n\nto create a build with only custom projections include a comma separated list of projections codes (the file name in \'lib/projections\' without the \'.js\') after a colon, e.g.\n\n```bash\nnode_modules/.bin/grunt build:tmerc\n#includes transverse Mercator\nnode_modules/.bin/grunt build:lcc\n#includes lambert conformal conic\nnode_modules/.bin/grunt build:omerc,moll\n#includes oblique Mercator and Mollweide\n```\n',readmeFilename:"README.md",repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},scripts:{build:"grunt","build:tmerc":"grunt build:tmerc",test:"npm run build && istanbul test _mocha test/test.js"},version:"2.4.4-alpha"}},function(e,t,r){"use strict";var i=r(108),a=r(44),s=r(109),n=r(107),o=r(106),h=r(105),l=r(100),u=r(94),c=r(92),d=r(85),p=r(93),f=r(83),m=r(91),g=r(86),v=r(87),y=r(102),b=r(99),x=r(97),M=r(104),S=r(98),w=r(88),A=r(110),T=r(84),C=r(101),P=r(90),F=r(103);t.a=function(e){e.Proj.projections.add(i.a),e.Proj.projections.add(a.a),e.Proj.projections.add(s.a),e.Proj.projections.add(n.a),e.Proj.projections.add(o.a),e.Proj.projections.add(h.a),e.Proj.projections.add(l.a),e.Proj.projections.add(u.a),e.Proj.projections.add(c.a),e.Proj.projections.add(d.a),e.Proj.projections.add(p.a),e.Proj.projections.add(f.a),e.Proj.projections.add(m.a),e.Proj.projections.add(g.a),e.Proj.projections.add(v.a),e.Proj.projections.add(y.a),e.Proj.projections.add(b.a),e.Proj.projections.add(x.a),e.Proj.projections.add(M.a),e.Proj.projections.add(S.a),e.Proj.projections.add(w.a),e.Proj.projections.add(A.a),e.Proj.projections.add(T.a),e.Proj.projections.add(C.a),e.Proj.projections.add(P.a),e.Proj.projections.add(F.a)}},function(e,t,r){"use strict";function i(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=s}function a(e){return new i(e).output()}t.a=a;var s=1,n=/\s/,o=/[A-Za-z]/,h=/[A-Za-z84]/,l=/[,\]]/,u=/[\d\.E\-\+]/;i.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;n.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case s:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},i.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(l.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},i.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=s)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=s,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},i.prototype.number=function(e){if(u.test(e))return void(this.word+=e);if(l.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)},i.prototype.quoted=function(e){if('"'===e)return void(this.state=5);this.word+=e},i.prototype.keyword=function(e){if(h.test(e))return void(this.word+=e);if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=s)}if(l.test(e))return void this.afterItem(e);throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place)},i.prototype.neutral=function(e){if(o.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(u.test(e))return this.word=e,void(this.state=3);if(l.test(e))return void this.afterItem(e);throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place)},i.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)}},function(e,t,r){"use strict";function i(e,t,r){Array.isArray(t)&&(r.unshift(t),t=null);var i=t?{}:e,s=r.reduce(function(e,t){return a(t,e),e},i);t&&(e[t]=s)}function a(e,t){if(!Array.isArray(e))return void(t[e]=!0);var r=e.shift();if("PARAMETER"===r&&(r=e.shift()),1===e.length)return Array.isArray(e[0])?(t[r]={},void a(e[0],t[r])):void(t[r]=e[0]);if(!e.length)return void(t[r]=!0);if("TOWGS84"===r)return void(t[r]=e);Array.isArray(r)||(t[r]={});var s;switch(r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[r]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&a(e[2],t[r]));case"SPHEROID":case"ELLIPSOID":return t[r]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&a(e[3],t[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void i(t,r,e);default:for(s=-1;++s<e.length;)if(!Array.isArray(e[s]))return a(e,t[r]);return i(t,r,e)}}t.a=a},function(e,t){var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var i;try{var a=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;i=new a,i.append(e),i=i.getBlob()}catch(t){i=new Blob([e])}return new Worker(r.createObjectURL(i))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){e.exports=function(){return r(116)('/*! Copyright (c) 2017 Melown Technologies SE\n *  For terms of use, see accompanying a8d038ba969e9c877948.worker.js.LICENSE file.\n *  For 3rd party libraries licenses, see 3rdpartylicenses.txt.\n */\n!function(e){function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var t={};r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=9)}([function(e,r,t){"use strict";function a(e,r,t){return e<r&&(e=r),e>t&&(e=t),e}function n(e,r){r||(r=e);var t=e[0],a=e[1],n=e[2],s=Math.sqrt(t*t+a*a+n*n);return s?1==s?(r[0]=t,r[1]=a,r[2]=n,r):(s=1/s,r[0]=t*s,r[1]=a*s,r[2]=n*s,r):(r[0]=0,r[1]=0,r[2]=0,r)}function s(e){var r=e[0],t=e[1];return e=e[2],Math.sqrt(r*r+t*t+e*e)}function i(e,r,t){t||(t=e);var a=e[0],n=e[1];e=e[2];var s=r[0],i=r[1];return r=r[2],t[0]=n*r-e*i,t[1]=e*s-a*r,t[2]=a*i-n*s,t}t.d(r,"a",function(){return o}),t.d(r,"f",function(){return a}),t.d(r,"c",function(){return n}),t.d(r,"d",function(){return s}),t.d(r,"e",function(){return i}),t.d(r,"b",function(){return l});var o={stylesheetData:{},stylesheetLayers:{},stylesheetBitmaps:{},stylesheetFonts:{},stylesheetConstants:{},stylesheetVariables:{},fonts:{},fontsMap:{},fontsStorage:{},forceOrigin:!1,forceScale:[1,1,1],bboxMin:[0,0,0],bboxMax:[1,1,1],geocent:!1,tileX:0,tileY:0,tileLod:0,tileSize:1,hitState:0,pixelFactor:1,metricUnits:!0,groupOptimize:!0,groupOrigin:[0,0,0],messageBuffer:new Array(65536),messageBuffer2:new Array(65536),messageBufferIndex:0,messageBufferSize:65536,signatureCounter:0,autoLod:!1,featureType:null,groupId:null,disableLog:!1,reduceMode:"scr-count4",reduceParams:null},l=function(e,r){if(!e||""==e)return"";var t,a,n=e.indexOf("{");if(-1==n)return e;a=n>0?e.substring(0,n):"";var s=0,i=-1;for(t=e.length;n<t;n++){var o=e.charAt(n);"{"==o?(0==s&&(i=n),s++):"}"==o?0==--s&&(a+=r(e.substring(i+1,n))):0==s&&(a+=o)}return a}},function(e,r,t){"use strict";function a(e,r,t){if(i.groupOptimize){if(i.messageBufferIndex>=i.messageBufferSize){var a=i.messageBuffer;i.messageBufferSize+=65536,i.messageBuffer=new Array(i.messageBufferSize),i.messageBuffer2=new Array(i.messageBufferSize);for(var n=0,s=i.messageBufferIndex;n<s;n++)i.messageBuffer[n]=a[n]}i.messageBuffer[i.messageBufferIndex]={job:e,arrays:r,signature:t},i.messageBufferIndex++}else postMessage(e,r)}function n(){var e,r,t,a,n,s,o,l,u,c,f=i.messageBuffer;if(i.messageBufferIndex<=2)return void(i.messageBufferIndex=0);for(var d=0,v=i.messageBufferIndex;d<v;d++){var h=f[d],p=h.job,b=p.type,g=h.signature;if(p.hitable||h.reduced||"icon"==b||"label"==b||"line-geometry"==b||"point-geometry"==b)h.reduced||postMessage(h.job,h.arrays);else{switch(b){case"flat-line":for(s=p.vertexBuffer.length,e=d+1;e<v;e++)a=f[e],a.signature==g&&(a.reduced=!0,s+=a.job.vertexBuffer.length);for(o=new Float32Array(s),l=0,e=d;e<v;e++)if(a=f[e],n=a.job,a.signature==g){for(u=n.vertexBuffer,n.vertexBuffer=null,t=0,r=u.length;t<r;t++)o[l+t]=u[t];l+=r}p.vertexBuffer=o,h.arrays=[o.buffer];break;case"pixel-line":case"line-label":case"flat-rline":for(s=p.vertexBuffer.length,e=d+1;e<v;e++)a=f[e],a.signature==g&&(a.reduced=!0,s+=a.job.vertexBuffer.length);o=new Float32Array(s);var y=new Float32Array(s);for(l=0,e=d;e<v;e++)if(a=f[e],n=a.job,a.signature==g){for(u=n.vertexBuffer,n.vertexBuffer=null,"line-label"==b?(c=n.texcoordsBuffer,n.texcoordsBuffer=null):(c=n.normalBuffer,n.normalBuffer=null),t=0,r=u.length;t<r;t++)o[l+t]=u[t],y[l+t]=c[t];if(l+=r,"line-label"==b){var L=p.files,m=n.files;for(t=0,r=m.length;t<r;t++){L[t]||(L[t]=[]);for(var A=0,N=m[t].length;A<N;A++)-1==L[t].indexOf(m[t][A])&&L[t].push(m[t][A])}}}p.vertexBuffer=o,"line-label"==b?p.texcoordsBuffer=y:p.normalBuffer=y,h.arrays=[o.buffer,y.buffer]}postMessage(h.job,h.arrays)}}i.messageBufferIndex=0}var s=t(0);t.d(r,"a",function(){return a}),t.d(r,"b",function(){return n});var i=s.a},function(e,r,t){"use strict";function a(e,r,t,n,s,i,o,u,c){var f,d;if(!e||!Array.isArray(e))return!1;if(u>100)return!1;switch(e[0]){case"all":for(f=1,d=e.length;f<d;f++)if(!a(e[f],r,t,n,s,i,o,u+1,c))return!1;return!0;case"any":for(f=1,d=e.length;f<d;f++)if(a(e[f],r,t,n,i,o,u+1,c))return!0;return!1;case"none":for(f=1,d=e.length;f<d;f++)if(a(e[f],r,t,n,i,o,u+1,c))return!1;return!0;case"skip":return!1}var v,h;switch(c&&e[2]?v=e[1]:(l.disableLog="has"==e[0]||"!has"==e[0],v=b(s,i,r,o,e[1],0),l.disableLog=!1),e[0]){case"==":case"!=":case">=":case"<=":case">":case"<":if(void 0===(h=e[c?3:2]))return!1;c&&e[4]||(h=b(s,i,r,o,h,0))}switch(e[0]){case"==":return v==h;case"!=":return v!=h;case">=":return v>=h;case"<=":return v<=h;case">":return v>h;case"<":return v<h;case"has":return void 0!==v;case"!has":return void 0===v;case"in":for(f=c?3:2,d=e.length;f<d;f++)if(e[f]==v)return!0;return!1;case"!in":for(f=c?3:2,d=e.length;f<d;f++)if(e[f]==v)return!1;return!0}return!1}function n(e){switch(typeof e){case"number":return!0;case"string":if(!(e.length>0))return!0;switch(e.charAt(0)){case"#":case"$":case"@":case"&":break;default:if(-1==e.indexOf("{"))return!0}}return!1}function s(e){if(!e||!Array.isArray(e))return e;var r,t,a=[e[0]];switch(e[0]){case"all":case"any":case"none":case"skip":for(r=1,t=e.length;r<t;r++)a[r]=s(e[r]);return a}switch(a[1]=e[1],a[2]=n(e[1]),e[0]){case"==":case"!=":case">=":case"<=":case">":case"<":a[3]=e[2],a[4]=n(e[2]);break;case"in":case"!in":for(r=2,t=e.length;r<t;r++)a[r+1]=e[r]}return a}var i=t(0),o=t(3);t.d(r,"e",function(){return a}),t.d(r,"d",function(){return x}),t.d(r,"b",function(){return v}),t.d(r,"c",function(){return p}),t.d(r,"g",function(){return h}),t.d(r,"f",function(){return b}),t.d(r,"a",function(){return s});var l=i.a,u=i.b,c=o.c,f=o.d,d=o.e,v=function(e,r,t){var a=l.stylesheetData.layers[e];return null==a?(L("wrong-Layer",e,null,null,t,r),{}):a},h=function(e,r,t,a,n){var s;switch(typeof r){case"string":if(r.length>0){switch(r.charAt(0)){case"#":switch(r){case"#id":return t.id;case"#type":return l.featureType;case"#group":return l.groupId;case"#lod":return l.tileLod;case"#tileSize":return l.tileSize;case"#pixelSize":return l.pixelSize;case"#metric":return l.metricUnits;case"#dpr":return l.pixelFactor}return s;case"$":case"@":switch(r.charAt(0)){case"$":s=t.properties[r.substr(1)];break;case"@":s=l.stylesheetConstants[r]}return void 0===s?(L("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),s):h(e,s,t,a,n)}return u(r,function(i){if(i.length>0){switch(i.charAt(0)){case"#":switch(i){case"#id":return t.id;case"#type":return l.featureType;case"#group":return l.groupId;case"#lod":return l.tileLod;case"#tileSize":return l.tileSize;case"#pixelSize":return l.pixelSize;case"#metric":return l.metricUnits;case"#dpr":return l.pixelFactor}case"$":case"@":switch(i.charAt(0)){case"$":s=t.properties[i.substr(1)];break;case"@":s=l.stylesheetConstants[i]}return void 0===s?(L("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),s):(s=b(e,n,t,a,s,0),h(e,s,t,a,n))}if(-1!=i.indexOf("{")){try{i=i.replace(/\'/g,\'"\'),s=JSON.parse(i)}catch(t){return L("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),""}return void 0===s?(L("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),""):b(e,n,t,a,s,0)}return i}})}}return r},p=function(e,r,t,a){var n=b(e,r,t,a);return A(e["$$layer-id"],r,n)},b=function(e,r,t,n,s,i){var o,u,v,p,g,y,m;if(void 0===s)s=e[r],p=!0,i=0;else if(i>100)return;switch(typeof s){case"string":if(s.length>0){switch(v=s,s.charAt(0)){case"$":v=t.properties[s.substr(1)];break;case"@":v=l.stylesheetConstants[s];break;case"&":v=l.stylesheetVariables[s.substr(1)];break;case"#":switch(s){case"#id":return t.id;case"#type":return l.featureType;case"#group":return l.groupId;case"#lod":return l.tileLod;case"#tileSize":return l.tileSize;case"#pixelSize":return l.pixelSize;case"#metric":return l.metricUnits;case"#dpr":return l.pixelFactor}}return"string"==typeof v?v=h(e,s,t,n,r):void 0!==v&&"@"==s.charAt(0)&&(v=b(e,r,t,n,v,i+1)),void 0!==v?v:(L("wrong-object",e["$$layer-id"],r,s,null,"feature-property"),p?N(r):void 0)}return s;case"object":if(null==s)return p?N(r):void 0;if(Array.isArray(s)){if("icon-source"==r&&null==l.stylesheetBitmaps[s[0]])return L("wrong-object",e["$$layer-id"],r,s,null,"bitmap"),p?N(r):void 0;if("filter"!=r){for(m=new Array(s.length),o=0,u=s.length;o<u;o++)m[o]=b(e,r,t,n,s[o],i+1);return m}return s}var A,U,x,v;for(A in s)break;if(!A)return p?N(r):void 0;switch(U=s[A],A){case"if":if(Array.isArray(U)&&3==U.length){if(void 0!==(v=a(U[0],t,l.featureType,l.groupId,e,r,n,0)?b(e,r,t,n,U[1],i+1):b(e,r,t,n,U[2],i+1)))return v;x=!0}else x=!0;case"add":case"sub":case"mul":case"div":case"pow":case"atan2":if(Array.isArray(U)&&2==U.length)if(g=b(e,r,t,n,U[0],i+1),y=b(e,r,t,n,U[1],i+1),"number"!=typeof g||"number"!=typeof y)x=!0;else switch(A){case"add":return g+y;case"sub":return g-y;case"mul":return g*y;case"div":return g/y;case"pow":return Math.pow(g,y);case"atan2":return Math.atan2(g,y)}else x=!0;case"sgn":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"sqrt":case"abs":case"log":case"round":case"floor":case"ceil":case"deg2rad":case"rad2deg":if("number"!=typeof(U=b(e,r,t,n,U,i+1)))x=!0;else switch(A){case"sgn":return U<0?-1:1;case"sin":return Math.sin(U);case"cos":return Math.cos(U);case"tan":return Math.tan(U);case"asin":return Math.asin(U);case"acos":return Math.acos(U);case"atan":return Math.atan(U);case"sqrt":return Math.sqrt(U);case"abs":return Math.abs(U);case"log":return Math.log(U);case"round":return Math.round(U);case"floor":return Math.floor(U);case"ceil":return Math.ceil(U);case"deg2rad":return U/180*Math.PI;case"rad2deg":return U/Math.PI*180}break;case"strlen":case"str2num":case"lowercase":case"uppercase":case"capitalize":case"has-fonts":case"has-latin":case"is-cjk":if("string"!=typeof(U=b(e,r,t,n,U,i+1)))x=!0;else switch(A){case"strlen":return U.length;case"str2num":return parseFloat(U);case"lowercase":return U.toLowerCase();case"uppercase":return U.toUpperCase();case"capitalize":return U.replace(/(?:^|\\s)\\S/g,function(e){return e.toUpperCase()});case"has-fonts":return d(U);case"has-latin":return c(U);case"is-cjk":return f(U)}break;case"min":case"max":if(Array.isArray(U)){for(v=b(e,r,t,n,U[0],i+1),o=0,u=s.length;o<u;o++){if("number"!=typeof(m=b(e,r,t,n,U[o],i+1))){x=!0;break}v="max"==A?Math.max(v,m):Math.min(v,m)}return v}x=!0;break;case"linear":case"linear2":case"discrete":case"discrete2":case"lod-scaled":var S=null,w=null,U=n;if(null!=s["lod-scaled"]){var B=s["lod-scaled"];if("number"==typeof B[1])return B[1]*Math.pow(2*B[2],B[0]-n);S=B[1],w=B}if(null!=s.discrete2||null!=s.linear2){var B=s.discrete2||s.linear2;S=B[1],U=b(e,r,t,n,B[0],i+1)}else S=s.discrete||s.linear;for(var M,_,O=S[0][0],k=S[0][1],E=typeof k,I=k,o=0,u=S.length;o<=u;o++){if(o==u){I=k;break}if(S[o][0]>U){if(null!=s.discrete||null!=s.discrete2||null!=w){I=k;break}if(M=S[o][0],_=S[o][1],M==O)break;switch(E){case"boolean":k=k?1:0,_=k?1:0,I=k+(U-O)/(M-O)*(_-k),I=I>.5;break;case"number":I=k+(U-O)/(M-O)*(_-k);break;case"object":I=[];for(var z=0,F=k.length;z<F;z++)I[z]=k[z]+(_[z]-k[z])*((U-O)/(M-O))}break}O=S[o][0],k=S[o][1]}return null!=w&&(I*=Math.pow(2*w[2],w[0]-U)),I;default:x=!0}if(x)return p?N(r):void 0;case"number":case"boolean":return s}return p?N(r):void 0},g=function(e,r,t,a,n){if(n>100)return void L("custom","infinite inherit loop in Layer: "+e);if(null!=t.inherit){var s=a.layers[t.inherit];if(null==s)return L("wrong-object",e,"inherit",s,"Layer"),N(i);null!=s.inherit&&g(t.inherit,r,s,a,n++);for(var i in s)r[i]=s[i]}},y=function(e,r,t,a){null!=t.inherit&&g(e,r,t,a,0);for(var n in t)r[n]=t[n];r["$$layer-id"]=e},L=function(e,r,t,a,n,s){if(!l.disableLog){"object"==typeof a&&(a=JSON.stringify(a));var i=null;switch(e){case"wrong-property-value":i="Error: wrong layer property "+(s?"\'"+s+"\'":"")+": "+r+"."+t+" = "+a;break;case"wrong-property-value[]":i="Error: wrong layer property "+(s?"\'"+s+"\'":"")+"["+n+"]: "+r+"."+t+" = "+a;break;case"wrong-object":i="Error: reffered "+s+" does not exist: "+r+"."+t+" = "+a;break;case"wrong-object[]":i="Error: reffered "+s+" does not exist: "+r+"."+t+"["+n+"] = "+a;break;case"wrong-Layer":i="Error: reffered "+s+" Layer does not exist: "+s+"["+n+"].Layer = "+r;break;case"wrong-bitmap":i="Error: wrong definition of bitmap: "+r;break;case"custom":i="Error: "+r}i&&console.log(i)}},m=function(e,r,t,a,n,s,i){var o,u;if(null!=t&&"object"==typeof t&&!Array.isArray(t))return L("wrong-property-value",e,r,t),N(r);if(typeof t!=a&&(null!==t||"icon-source"!=r&&"visibility"!=r&&"label-no-overlap-factor"!=r))return L("wrong-property-value",e,r,t),N(r);switch(typeof t){case"object":if(null===t)return t;if("reduce"==r||"dynamic-reduce"==r||"label-no-overlap-factor"==r){if(!(Array.isArray(t)&&t.length>0&&"string"==typeof t[0]))return L("wrong-property-value",e,r,t),N(r);if("dynamic-reduce"==r){if("by-extenal-param"==t[0]&&(t[0]=l.reduceMode),"tilt"!=t[0]&&"tilt-cos"!=t[0]&&"tilt-cos2"!=t[0]&&"scr-count"!=t[0]&&"scr-count2"!=t[0]&&"scr-count3"!=t[0]&&"scr-count4"!=t[0]&&"scr-count5"!=t[0]||"number"!=typeof t[1]||"number"!=typeof t[2]&&"scr-count4"!=t[0]&&"scr-count5"!=t[0])return L("wrong-property-value",e,r,t),N(r)}else if("reduce"==r){if("odd"!=t[0]&&"even"!=t&&("number"!=typeof t[1]||("top"!=t[0]||"bottom"!=t)&&"string"!=typeof t[2]))return L("wrong-property-value",e,r,t),N(r)}else if("label-no-overlap-factor"==r&&"direct"!=t[0]&&"div-by-dist"!=t[0])return L("wrong-property-value",e,r,t),N(r)}if("next-pass"==r){if(!(Array.isArray(t)&&t.length>0))return L("wrong-property-value",e,r,t),N(r);for(o=0;o<u;o++){var c=t[o];if("object"!=typeof c||!Array.isArray(c)||2!=c.length||"number"!=typeof c[0]||"string"!=typeof c[1])return L("wrong-property-value[]",e,r,t,o),N(r)}}if("label-font"==r||"line-label-font"==r){if(!Array.isArray(t)||t.length<1)return L("wrong-property-value[]",e,r,t,0),N(r);for(o=0,u=t.length;o<u;o++)if("string"!=typeof t[o]||!l.fonts[t[o]])return L("wrong-property-value[]",e,r,t,0),N(r);return t}if(null!=n){if(Array.isArray(t)&&t.length==n){if(o=0,"icon-source"==r||"line-style-texture"==r){if("string"!=typeof t[0])return L("wrong-property-value[]",e,r,t,0),N(r);if(null==l.stylesheetBitmaps[t[0]])return L("wrong-object",e,r,t,null,"bitmap"),N(r);o=1}for(u=t.length;o<u;o++)if("number"!=typeof t[o])return L("wrong-property-value[]",e,r,t,o),N(r);return t}return L("wrong-property-value",e,r,t),N(r)}return t;case"string":if("line-style"==r)switch(t){case"solid":case"texture":return t;default:return L("wrong-property-value",e,r,t),N(r)}if("label-size-units"==r)switch(t){case"pixels":case"points":return t;default:return L("wrong-property-value",e,r,t),N(r)}if("line-width-units"==r)switch(t){case"pixels":case"points":case"meters":case"ratio":return t;default:return L("wrong-property-value",e,r,t),N(r)}if("label-origin"==r||"icon-origin"==r)switch(t){case"top-left":case"top-right":case"top-center":case"center-left":case"center-right":case"center-center":case"bottom-left":case"bottom-right":case"bottom-center":return t;default:return L("wrong-property-value",e,r,t),N(r)}if("label-align"==r)switch(t){case"left":case"right":case"center":return t;default:return L("wrong-property-value",e,r,t),N(r)}return t;case"number":return t>i||t<s?(L("wrong-property-value",e,r,t),N(r)):t;case"boolean":return t}},A=function(e,r,t){switch(r){case"inherit":return m(e,r,t,"string");case"reduce":case"dynamic-reduce":return m(e,r,t,"object");case"line":case"line-flat":return m(e,r,t,"boolean");case"line-width":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"line-width-units":return m(e,r,t,"string");case"line-color":return m(e,r,t,"object",4,0,255);case"line-style":return m(e,r,t,"string");case"line-style-texture":return m(e,r,t,"object",3,-Number.MAX_VALUE,Number.MAX_VALUE);case"line-style-background":return m(e,r,t,"object",4,0,255);case"line-label":return m(e,r,t,"boolean");case"line-label-source":return m(e,r,t,"string");case"line-label-color":case"line-label-color2":return m(e,r,t,"object",4,0,255);case"line-label-size":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"line-label-offset":return m(e,r,t,"number",null,-Number.MAX_VALUE,Number.MAX_VALUE);case"line-label-spacing":case"line-label-line-height":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"point":case"point-flat":return m(e,r,t,"boolean");case"point-radius":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"point-Layer":return m(e,r,t,"string");case"point-color":return m(e,r,t,"object",4,0,255);case"icon":return m(e,r,t,"boolean");case"icon-source":return m(e,r,t,"object",5,-Number.MAX_VALUE,Number.MAX_VALUE);case"icon-scale":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"icon-offset":return m(e,r,t,"object",2,-Number.MAX_VALUE,Number.MAX_VALUE);case"icon-origin":return m(e,r,t,"string");case"icon-stick":return m(e,r,t,"object",8,-Number.MAX_VALUE,Number.MAX_VALUE);case"icon-color":return m(e,r,t,"object",4,0,255);case"label":return m(e,r,t,"boolean");case"label-color":case"label-color2":return m(e,r,t,"object",4,0,255);case"label-source":return m(e,r,t,"string");case"label-size":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"label-size-units":return m(e,r,t,"string");case"label-spacing":case"label-line-height":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"label-offset":return m(e,r,t,"object",2,-Number.MAX_VALUE,Number.MAX_VALUE);case"label-origin":case"label-align":return m(e,r,t,"string");case"label-stick":return m(e,r,t,"object",8,-Number.MAX_VALUE,Number.MAX_VALUE);case"label-width":return m(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"label-no-overlap":return m(e,r,t,"boolean");case"label-no-overlap-factor":return m(e,r,t,"object");case"label-no-overlap-margin":return m(e,r,t,"object",2,-Number.MAX_VALUE,Number.MAX_VALUE);case"polygon":return m(e,r,t,"boolean");case"polygon-color":return m(e,r,t,"object",4,0,255);case"z-index":return m(e,r,t,"number",null,-Number.MAX_VALUE,Number.MAX_VALUE);case"zbuffer-offset":return m(e,r,t,"object",3,0,Number.MAX_VALUE);case"selected-hover-layer":case"selected-layer":return m(e,r,t,"string");case"hover-event":return m(e,r,t,"boolean");case"hover-layer":return m(e,r,t,"string");case"enter-event":case"leave-event":case"click-event":case"draw-event":case"advanced-hit":case"export-geometry":case"pack":case"visible":return m(e,r,t,"boolean");case"visibility":return m(e,r,t,"number",null,1e-5,Number.MAX_VALUE);case"visibility-abs":return m(e,r,t,"object",2,1e-5,Number.MAX_VALUE);case"visibility-rel":return m(e,r,t,"object",4,1e-5,Number.MAX_VALUE);case"hysteresis":return m(e,r,t,"object");case"culling":return m(e,r,t,"number",180,1e-4,180);case"next-pass":return m(e,r,t,"object");case"importance-source":return m(e,r,t,"string")}return t},N=function(e){switch(e){case"inherit":return"";case"filter":case"reduce":case"dynamic-reduce":return null;case"line":case"line-flat":return!1;case"line-width":return 1;case"line-width-units":return"meters";case"line-color":return[255,255,255,255];case"line-style":return"solid";case"line-style-texture":return null;case"line-style-background":return[0,0,0,0];case"line-label":return!1;case"line-label-font":return["#default"];case"line-label-color":return[255,255,255,255];case"line-label-color2":return[0,0,0,255];case"line-label-outline":return[.27,.75,2.2,2.2];case"line-label-source":return"$name";case"line-label-size":return 1;case"line-label-offset":return 0;case"line-label-spacing":case"line-label-line-height":return 1;case"point":case"point-flat":return!1;case"point-radius":return 1;case"point-Layer":return"solid";case"point-color":return[255,255,255,255];case"icon":return!1;case"icon-source":return null;case"icon-scale":return 1;case"icon-offset":return[0,0];case"icon-origin":return"bottom-center";case"icon-stick":return[0,0,0,255,255,255,255,0];case"icon-color":return[255,255,255,255];case"label":return!1;case"label-font":return["#default"];case"label-color":return[255,255,255,255];case"label-color2":return[0,0,0,255];case"label-outline":return[.27,.75,2.2,2.2];case"label-source":return"$name";case"label-size":return 10;case"label-size-units":return"pixels";case"label-spacing":case"label-line-height":return 1;case"label-offset":return[0,0];case"label-origin":return"bottom-center";case"label-align":return"center";case"label-stick":return[0,0,0,255,255,255,255,0];case"label-width":return 200;case"label-no-overlap":return!0;case"label-no-overlap-factor":return null;case"label-no-overlap-margin":return[5,5];case"polygon":return!1;case"polygon-color":return[255,255,255,255];case"z-index":return 0;case"zbuffer-offset":return[0,0,0];case"selected-hover-layer":case"selected-layer":return"";case"hover-event":return!1;case"hover-layer":return"";case"enter-event":case"leave-event":case"click-event":case"draw-event":case"advanced-hit":case"export-geometry":case"pack":return!1;case"visible":return!0;case"visibility":case"visibility-abs":case"visibility-rel":case"hysteresis":return null;case"culling":return 180;case"next-pass":return null}},U=function(e,r,t){var a,n,s={};y(e,s,r,t);for(a in s)if("string"==typeof(n=s[a])&&n.length>0)switch(n.charAt(0)){case"@":null!=l.stylesheetConstants[n]?s[a]=l.stylesheetConstants[n]:(L("wrong-object",e,a,n,null,"constant"),s[a]=N(a));break;case"&":null!=l.stylesheetVariables[n]?(s["$$layer-variables"]||(s["$$layer-variables"]={}),s["$$layer-variables"][a]=n,s[a]=l.stylesheetVariables[n]):(L("wrong-object",e,a,n,null,"variable"),s[a]=N(a))}return s},x=function(e){var r;l.stylesheetBitmaps={},l.stylesheetFonts={},l.stylesheetConstants=e.constants||{},l.stylesheetVariables=e.variables||{};var t=e.bitmaps||{};for(r in t){var a=t[r];"string"==typeof a?a={url:a}:"object"==typeof a?null==a.url&&L("wrong-bitmap",r):L("wrong-bitmap",r),l.stylesheetBitmaps[r]=a}postMessage({command:"loadBitmaps",bitmaps:l.stylesheetBitmaps});var n=e.fonts||{};for(r in n){var s=n[r];"string"==typeof s?s={url:s}:"object"==typeof s?null==s.url&&L("wrong-font",r):L("wrong-font",r),l.stylesheetFonts[r]=s}postMessage({command:"loadFonts",fonts:l.stylesheetFonts}),l.stylesheetData={layers:{}};var i=e.layers||{};l.stylesheetLayers=l.stylesheetData.layers;for(r in i)l.stylesheetData.layers[r]=U(r,i[r],e)}},function(e,r,t){"use strict";var a=t(0),n=t(8);t.d(r,"n",function(){return b}),t.d(r,"i",function(){return L}),t.d(r,"m",function(){return y}),t.d(r,"g",function(){return m}),t.d(r,"e",function(){return x}),t.d(r,"f",function(){return h}),t.d(r,"a",function(){return c}),t.d(r,"b",function(){return f}),t.d(r,"l",function(){return v}),t.d(r,"j",function(){return B}),t.d(r,"k",function(){return M}),t.d(r,"c",function(){return S}),t.d(r,"d",function(){return w}),t.d(r,"h",function(){return _});var s=a.a,i=a.c,o=a.d,l=a.e,u=n.a,c=function(e){console.log("setFont "+e.url);var r=u.parse(e.data);s.fontsStorage[e.url]=r},f=function(e){var r=e.map;for(var t in r)s.fonts[t]=s.fontsStorage[r[t]];s.fontsMap=r},d=function(e,r,t,a,n,o,u,c,f,d,v,h,p,b,g){var y,L=d[g];if(s.geocent&&!p){y=[0,0,0];var m=[0,0,0];i(s.bboxMin,m),l(m,r,y)}else y=[-r[1],r[0],0];var A=[e[0],e[1],e[2]],N=[A[0],A[1],A[2]],U=L.glyphs[a];if(a=0,!U)return[e,u,c,0];var x=0,S=f[0],w=f[1],B=f[2];if(9==a||32==a)(U=chars[32])&&(e[0]+=r[0]*U.step*n*o,e[1]+=r[1]*U.step*n*o,x=U.lx*n);else if(0==U.lx)e[0]=e[0]+r[0]*U.step*n*o,e[1]=e[1]+r[1]*U.step*n*o,x=U.lx*n;else{var M=U.lx*n,_=U.ly*n,O=[y[0]*t,y[1]*t,y[2]*t],k=[O[0]+y[0]*_,O[1]+y[1]*_,O[2]+y[2]*_];A[0]=A[0]+r[0]*U.sx*n,A[1]=A[1]+r[1]*U.sx*n,A[2]=A[2]+r[2]*U.sx*n,A[0]=A[0]+y[0]*(U.sy-L.size)*n,A[1]=A[1]+y[1]*(U.sy-L.size)*n,A[2]=A[2]+y[2]*(U.sy-L.size)*n,N[0]=A[0]+r[0]*M,N[1]=A[1]+r[1]*M,N[2]=A[2]+r[2]*M;var E=4e3*g,I=U.plane+E;b&&(b[g]||(b[g]={}),b[g][I]=!0),v[u]=A[0]-O[0],v[u+1]=A[1]-O[1],v[u+2]=A[2]-O[2],v[u+3]=B,h[c]=U.u1,h[c+1]=U.v1+E,h[c+2]=S,h[c+3]=w,v[u+4]=A[0]-k[0],v[u+5]=A[1]-k[1],v[u+6]=A[2]-k[2],v[u+7]=B,h[c+4]=U.u1,h[c+5]=U.v2+E,h[c+6]=S,h[c+7]=w,v[u+8]=N[0]-O[0],v[u+9]=N[1]-O[1],v[u+10]=N[2]-O[2],v[u+11]=B,h[c+8]=U.u2,h[c+9]=U.v1+E,h[c+10]=S,h[c+11]=w,v[u+12]=A[0]-k[0],v[u+13]=A[1]-k[1],v[u+14]=A[2]-k[2],v[u+15]=B,h[c+12]=U.u1,h[c+13]=U.v2+E,h[c+14]=S,h[c+15]=w,v[u+16]=N[0]-k[0],v[u+17]=N[1]-k[1],v[u+18]=N[2]-k[2],v[u+19]=B,h[c+16]=U.u2,h[c+17]=U.v2+E,h[c+18]=S,h[c+19]=w,v[u+20]=N[0]-O[0],v[u+21]=N[1]-O[1],v[u+22]=N[2]-O[2],v[u+23]=B,h[c+20]=U.u2,h[c+21]=U.v1+E,h[c+22]=S,h[c+23]=w,u+=24,c+=24,e[0]=e[0]+r[0]*U.step*n*o,e[1]=e[1]+r[1]*U.step*n*o,x=U.lx*n}return[e,u,c,x*o]},v=function(e){return 3*(e?3:4)*2},h=function(e,r,t,a,n,s,i,o,l,c,f,v){for(var h=[0,1,0],p=[e[0],e[1],e[2]],b=v||u.U.stringToGlyphs(s,t),y=b[0],L=b[1],m=0,A=y.length;m<A;m++){var N=y[m],U=s[L[m]];if(U){var x=g(a,U),S=d(p,r,0,N,x,n,c,c,h,s,i,o,l,f,L[m]);p=S[0],c=S[1]}}return c},p=function(e,r,t,a,n,s,o,l,c,f,v,h,p){null==s&&(s=[0,1,0]);var b=e[0];b=[b[0],b[1],b[2]];for(var y=r,L=p||u.U.stringToGlyphs(o,t),m=L[0],A=L[1],U=0,x=m.length;U<x;U++){var S=m[U],w=o[A[U]];if(w){var B=g(a,w),M=.01,_=w.glyphs[S];_&&(M=_.step*B*n);var O=N(e,y),k=N(e,y+M),E=[.5*(k[1][0]+O[1][0]),.5*(k[1][1]+O[1][1]),.5*(k[1][2]+O[1][2])];i(E);var I=d(O[0],E,-B*w.size*.7+l,n,S,B,v,v,s,o,c,f,null,h,A[U]);b=I[0],v=I[1],y+=M}}return v},b=function(e,r,t,a,n,s,i,o,l,u,c){var f=L(r,t,a,n,c),d=A(e),v=.5*(d-f);if(v<0&&(v=0),!(f>d)){var h=U(e,v,r,t,n,c);return p(e,v,r,t,a,h,n,s,i,o,l,u,c)}},g=function(e,r){return r?e/r.size*1.52:1},y=function(e,r,t){var a=g(e,t[0]);return t[0].cly*a*r},L=function(e,r,t,a,n){for(var s=0,i=n||u.U.stringToGlyphs(a,e),o=i[0],l=i[1],c=0,f=o.length;c<f;c++){var d=o[c],v=a[l[c]];if(v){var h=g(r,v)*t,p=v.glyphs[d];p&&(s+=c==f-1?p.lx*h:p.step*h)}}return s},m=function(e,r,t,a,n,s){for(var i=0,o=s||u.U.stringToGlyphs(n,e),l=o[0],c=o[1],f=o[2],d=0,v=l.length;d<v;d++){var h=l[d],p=f[d];if(i>r&&(10==p||9==p||32==p))return d;if(10!=p){var b=n[c[d]];if(b){var y=g(t,b)*a,L=b.glyphs[h];L&&(i+=d==v-1?L.lx*y:L.step*y)}}}return v},A=function(e){for(var r=0,t=0,a=e.length-1;t<a;t++){var n=e[t],s=e[t+1],i=[s[0]-n[0],s[1]-n[1],s[2]-n[2]];r+=o(i)}return r},N=function(e,r){for(var t=0,a=[0,0,0],n=[1,0,0],s=0,l=e.length-1;s<l;s++){a=e[s];var u=e[s+1];n=[u[0]-a[0],u[1]-a[1],u[2]-a[2]];var c=o(n);if(t+c>r){var f=(r-t)/c,d=[a[0]+n[0]*f,a[1]+n[1]*f,a[2]+n[2]*f];return i(n),[d,n]}t+=c}return[a,n]},U=function(e,r,t,a,n,u,c){for(var f=0,d=[0,0,0],v=[1,0,0],h=[0,0,0],p=r,b=r+L(t,a,n,u,c),g=s.bboxMin,y=s.geocent,m=0,A=e.length-1;m<A;m++){d=e[m];var N=e[m+1];if(v=[N[0]-d[0],N[1]-d[1],N[2]-d[2]],f+=o(v),f>p&&(i(v),h[0]+=v[0],h[1]+=v[1],h[2]+=v[2]),f>b){if(i(h),y){var U=[0,0,0];return i(g,U),l(U,h,U),U}return[-h[1],h[0],0]}}return h},x=function(e,r,t){return!(!e||""==e)&&-1==(t||u.U.stringToGlyphs(r,e))[0].indexOf(0)},S=function(e){for(var r=0,t=e.length;r<t;r++){var a=e.charCodeAt(r);if(a>=65&&a<=90||a>=97&&a<=122||a>=192&&a<=255&&215!=a&&247!=a||a>=256&&a<=383)return!0}return!1},w=function(e){for(var r=0,t=e.length;r<t;r++){var a=e.charCodeAt(r);if(!(a>=19968&&a<=25343||a>=25344&&a<=30719||a>=30720&&a<=36095||a>=36096&&a<=40959||a>=13312&&a<=19903||a>=131072&&a<=136703||a>=136704&&a<=143615||a>=143616&&a<=148991||a>=148992&&a<=155903||a>=155904&&a<=161279||a>=161280&&a<=168191||a>=168192&&a<=173791||a>=173824&&a<=177983||a>=177984&&a<=178207||a>=178208&&a<=183983||a>=183984&&a<=191471||a>=63744&&a<=64255||a>=13056&&a<=13311||a>=65072&&a<=65103||a>=63744&&a<=64255||a>=194560&&a<=195103||a>=0&&a<=64||a>=160&&a<=191))return!1}return!0},B=function(e){for(var r=[],t=0,a=e.length;t<a;t++)r.push(s.fonts[e[t]]);return r},M=function(e){for(var r=[],t=0,a=e.length;t<a;t++)r.push(s.fontsMap[e[t]]);return r},_=function(e,r){return u.U.stringToGlyphs(r,e)}},function(e,r,t){"use strict";var a=t(0),n=t(2),s=t(3),i=t(1);t.d(r,"a",function(){return L}),t.d(r,"b",function(){return A});var o=a.a,l=a.c,u=a.e,c=n.c,f=n.g,d=s.n,v=s.e,h=s.l,p=s.j,b=s.k,g=i.a,y=s.h,L=function(e,r,t,a,n,s){var i=e.lines||e["d-lines"]||[];if(0!=i.length){var f=!!e["d-lines"],d=c(t,"line",e,r),v=c(t,"line-label",e,r);if(d||v){var h=c(t,"hover-event",e,r),p=c(t,"click-event",e,r),b=c(t,"draw-event",e,r),y=c(t,"enter-event",e,r),L=c(t,"leave-event",e,r),A=c(t,"advanced-hit",e,r),N=c(t,"zbuffer-offset",e,r),U=c(t,"line-flat",e,r),x=c(t,"line-color",e,r),S=.5*c(t,"line-width",e,r),w=c(t,"line-width-units",e,r),B=c(t,"line-style",e,r),M=c(t,"line-style-texture",e,r),_=c(t,"line-style-background",e,r),O=c(t,"line-label-size",e,r),k="solid"!=B,E="ratio"==w;"points"==w&&(S*=o.pixelFactor/(1/72*96));var I=0,z=0,F=0,C=!1;C=E?!U&&1080*S<2.1:!U&&S<2.1;var T,j,G,R,V,$,P,X,D,J,H,q,Y=1;if(!C){var W=[],Z=[],K=8,Q=0,ee=2*Math.PI/K;for(j=0;j<K;j++)W[j]=[-Math.sin(Q),Math.cos(Q)],Z[j]=Q,Q+=ee;W[K]=[0,1],Z[K]=0}var re=0;for(T=0;T<i.length;T++)Array.isArray(i[T])&&(re+=i[T].length);U&&(K=2);var te=3*(k||E||!U?4:3)*2,ae=C?0:K*(k||E||!U?4:3)*3,ne=new Float32Array((re-1)*te+re*ae);if(A)var se=new Float32Array(6*(re-1)+re*(C?0:K)*3);if(!U||k||E)var ie=C?0:3*K*4,oe=new Float32Array(24*(re-1)+re*ie);var le=[0,0,0],ue=[],ce=o.forceOrigin,fe=o.bboxMin,de=o.geocent,ve=o.tileX,he=o.tileY,pe=o.forceScale,be=[1,0,0],ge=[-1,0,0];for(T=0;T<i.length;T++)if(Array.isArray(i[T])&&i[T].length){var ye=i[T];if(v){var Le=new Array(ye.length),me=new Array(ye.length);ue.push({points:Le,points2:me})}H=ye[0],J=[H[0],H[1],H[2]],ce&&(J=[J[0]-ve,J[1]-he,J[2]]),null!=pe&&(J=[J[0]*pe[0],J[1]*pe[1],J[2]*pe[2]]);var Ae=.001,Ne=.001,Ue=I,xe=z;for(j=0,G=ye.length-1;j<G;j++)f?(R=ye[j+1],R=[J[0]+R[0],J[1]+R[1],J[2]+R[2]],ce&&(R=[R[0]-ve,R[1]-he,R[2]]),null!=pe&&(R=[R[0]*pe[0],R[1]*pe[1],R[2]*pe[2]])):(J=ye[j],R=ye[j+1],ce&&(J=[J[0]-ve,J[1]-he,J[2]],R=[R[0]-ve,R[1]-he,R[2]]),null!=pe&&(J=[J[0]*pe[0],J[1]*pe[1],J[2]*pe[2]],R=[R[0]*pe[0],R[1]*pe[1],R[2]*pe[2]])),A&&(q=Y+j,se[F]=q,se[F+1]=q,se[F+2]=q,se[F+3]=q,se[F+4]=q,se[F+5]=q,F+=6),!U||k||E?U?(de?(V=[R[0]-J[0],R[1]-J[1],R[2]-J[2]],P=Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]),Ne+=P,P=0!=P?1/P:0,$=[V[0]*P,V[1]*P,V[2]*P],X=[0,0,0],D=[0,0,0],0==j&&(be=$),j==G-1&&(ge=$),l(fe,D),u(D,$,X),X=[X[0],X[1],X[2]]):(V=[R[0]-J[0],R[1]-J[1],0],P=Math.sqrt(V[0]*V[0]+V[1]*V[1]),Ne+=P,P=0!=P?S/P:0,X=[-V[1],V[0],0],0==j&&(be=[V[0]*P,V[1]*P,0]),j==G-1&&(ge=[V[0]*P,V[1]*P,0])),ne[I]=J[0],ne[I+1]=J[1],ne[I+2]=J[2],ne[I+3]=Ae,oe[z]=X[0],oe[z+1]=X[1],oe[z+2]=X[2],oe[z+3]=S,ne[I+4]=J[0],ne[I+5]=J[1],ne[I+6]=J[2],ne[I+7]=-Ae,oe[z+4]=-X[0],oe[z+5]=-X[1],oe[z+6]=-X[2],oe[z+7]=S,ne[I+8]=R[0],ne[I+9]=R[1],ne[I+10]=R[2],ne[I+11]=Ne,oe[z+8]=X[0],oe[z+9]=X[1],oe[z+10]=X[2],oe[z+11]=S,ne[I+12]=J[0],ne[I+13]=J[1],ne[I+14]=J[2],ne[I+15]=-Ae,oe[z+12]=-X[0],oe[z+13]=-X[1],oe[z+14]=-X[2],oe[z+15]=S,ne[I+16]=R[0],ne[I+17]=R[1],ne[I+18]=R[2],ne[I+19]=-Ne,oe[z+16]=-X[0],oe[z+17]=-X[1],oe[z+18]=-X[2],oe[z+19]=S,ne[I+20]=R[0],ne[I+21]=R[1],ne[I+22]=R[2],ne[I+23]=Ne,oe[z+20]=X[0],oe[z+21]=X[1],oe[z+22]=X[2],oe[z+23]=S,I+=24,z+=24):(V=[R[0]-J[0],R[1]-J[1],0],P=Math.sqrt(V[0]*V[0]+V[1]*V[1]),Ne+=P,ne[I]=J[0],ne[I+1]=J[1],ne[I+2]=J[2],ne[I+3]=Ae,oe[z]=R[0],oe[z+1]=R[1],oe[z+2]=R[2],oe[z+3]=S,ne[I+4]=J[0],ne[I+5]=J[1],ne[I+6]=J[2],ne[I+7]=-Ae,oe[z+4]=R[0],oe[z+5]=R[1],oe[z+6]=R[2],oe[z+7]=-S,ne[I+8]=R[0],ne[I+9]=R[1],ne[I+10]=R[2],ne[I+11]=-Ne,oe[z+8]=J[0],oe[z+9]=J[1],oe[z+10]=J[2],oe[z+11]=S,ne[I+12]=J[0],ne[I+13]=J[1],ne[I+14]=J[2],ne[I+15]=Ae,oe[z+12]=R[0],oe[z+13]=R[1],oe[z+14]=R[2],oe[z+15]=S,ne[I+16]=R[0],ne[I+17]=R[1],ne[I+18]=R[2],ne[I+19]=-Ne,oe[z+16]=J[0],oe[z+17]=J[1],oe[z+18]=J[2],oe[z+19]=S,ne[I+20]=R[0],ne[I+21]=R[1],ne[I+22]=R[2],ne[I+23]=Ne,oe[z+20]=J[0],oe[z+21]=J[1],oe[z+22]=J[2],oe[z+23]=-S,I+=24,z+=24):(de?(V=[R[0]-J[0],R[1]-J[1],R[2]-J[2]],P=Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2]),Ne+=P,P=0!=P?1/P:0,$=[V[0]*P,V[1]*P,V[2]*P],X=[0,0,0],D=[0,0,0],l(fe,D),u(D,$,X),0==j&&(be=$),j==G-1&&(ge=$),X=[X[0]*S,X[1]*S,X[2]*S]):(V=[R[0]-J[0],R[1]-J[1],0],P=Math.sqrt(V[0]*V[0]+V[1]*V[1]),Ne+=P,P=0!=P?S/P:0,X=[-V[1]*P,V[0]*P,0],0==j&&(be=[V[0]*P,V[1]*P,0]),j==G-1&&(ge=[V[0]*P,V[1]*P,0])),ne[I]=J[0]+X[0],ne[I+1]=J[1]+X[1],ne[I+2]=J[2]+X[2],ne[I+3]=J[0]-X[0],ne[I+4]=J[1]-X[1],ne[I+5]=J[2]-X[2],ne[I+6]=R[0]+X[0],ne[I+7]=R[1]+X[1],ne[I+8]=R[2]+X[2],ne[I+9]=J[0]-X[0],ne[I+10]=J[1]-X[1],ne[I+11]=J[2]-X[2],ne[I+12]=R[0]-X[0],ne[I+13]=R[1]-X[1],ne[I+14]=R[2]-X[2],ne[I+15]=R[0]+X[0],ne[I+16]=R[1]+X[1],ne[I+17]=R[2]+X[2],I+=18),Ae=Ne,J=R;for(J=[H[0],H[1],H[2]],j=0,G=ye.length;j<G;j++){if(ce&&(J=[J[0]-ve,J[1]-he,J[2]]),null!=pe&&(J=[J[0]*pe[0],J[1]*pe[1],J[2]*pe[2]]),le[0]+=J[0],le[1]+=J[1],le[2]+=J[2],!C){if(U){A&&(q=Y+(j!=G-1?j:j-1),se[F]=q,se[F+1]=q,se[F+2]=q,se[F+3]=q,se[F+4]=q,se[F+5]=q,F+=6);var Se,we;k||E?(Ae=j!=G-1?ne[j*te+3]:ne[(j-1)*te+11],Se=j!=G-1?xe+j*te:xe+(j-1)*te+8,we=j>0?xe+(j-1)*te+8:xe+Se,ne[I]=J[0],ne[I+1]=J[1],ne[I+2]=J[2],ne[I+3]=Ae,ne[I+4]=J[0],ne[I+5]=J[1],ne[I+6]=J[2],ne[I+7]=Ae,ne[I+8]=J[0],ne[I+9]=J[1],ne[I+10]=J[2],ne[I+11]=Ae,ne[I+12]=J[0],ne[I+1+12]=J[1],ne[I+2+12]=J[2],ne[I+3+12]=Ae,ne[I+4+12]=J[0],ne[I+5+12]=J[1],ne[I+6+12]=J[2],ne[I+7+12]=-Ae,ne[I+8+12]=J[0],ne[I+9+12]=J[1],ne[I+10+12]=J[2],ne[I+11+12]=-Ae,0==j?(oe[z]=0,oe[z+1]=0,oe[z+2]=0,oe[z+3]=-S,oe[z+4]=oe[Se],oe[z+5]=oe[Se+1],oe[z+6]=oe[Se+2],oe[z+7]=S,oe[z+8]=-be[0],oe[z+9]=-be[1],oe[z+10]=-be[2],oe[z+11]=-S,oe[z+12]=0,oe[z+1+12]=0,oe[z+2+12]=0,oe[z+3+12]=-S,oe[z+4+12]=-oe[Se],oe[z+5+12]=-oe[Se+1],oe[z+6+12]=-oe[Se+2],oe[z+7+12]=S,oe[z+8+12]=-be[0],oe[z+9+12]=-be[1],oe[z+10+12]=-be[2],oe[z+11+12]=-S):j==G-1?(oe[z]=0,oe[z+1]=0,oe[z+2]=0,oe[z+3]=-S,oe[z+4]=oe[we],oe[z+5]=oe[we+1],oe[z+6]=oe[we+2],oe[z+7]=S,oe[z+8]=ge[0],oe[z+9]=ge[1],oe[z+10]=ge[2],oe[z+11]=-S,oe[z+12]=0,oe[z+1+12]=0,oe[z+2+12]=0,oe[z+3+12]=-S,oe[z+4+12]=-oe[we],oe[z+5+12]=-oe[we+1],oe[z+6+12]=-oe[we+2],oe[z+7+12]=S,oe[z+8+12]=ge[0],oe[z+9+12]=ge[1],oe[z+10+12]=ge[2],oe[z+11+12]=-S):(oe[z]=0,oe[z+1]=0,oe[z+2]=0,oe[z+3]=-S,oe[z+4]=oe[Se],oe[z+5]=oe[Se+1],oe[z+6]=oe[Se+2],oe[z+7]=S,oe[z+8]=oe[we],oe[z+9]=oe[we+1],oe[z+10]=oe[we+2],oe[z+11]=S,oe[z+12]=0,oe[z+1+12]=0,oe[z+2+12]=0,oe[z+3+12]=-S,oe[z+4+12]=-oe[Se],oe[z+5+12]=-oe[Se+1],oe[z+6+12]=-oe[Se+2],oe[z+7+12]=S,oe[z+8+12]=-oe[we],oe[z+9+12]=-oe[we+1],oe[z+10+12]=-oe[we+2],oe[z+11+12]=S),I+=24,z+=24):(Se=j!=G-1?Ue+j*te:Ue+(j-1)*te,we=j>0?Ue+(j-1)*te:Ue+Se,0==j?(ne[I]=J[0],ne[I+1]=J[1],ne[I+2]=J[2],ne[I+3]=ne[Se],ne[I+4]=ne[Se+1],ne[I+5]=ne[Se+2],ne[I+6]=J[0]-be[0]*S,ne[I+7]=J[1]-be[1]*S,ne[I+8]=J[2]-be[2]*S,ne[I+9]=J[0],ne[I+9+1]=J[1],ne[I+9+2]=J[2],ne[I+9+3]=ne[Se+3],ne[I+9+4]=ne[Se+4],ne[I+9+5]=ne[Se+5],ne[I+9+6]=J[0]-be[0]*S,ne[I+9+7]=J[1]-be[1]*S,ne[I+9+8]=J[2]-be[2]*S):j==G-1?(ne[I]=J[0],ne[I+1]=J[1],ne[I+2]=J[2],ne[I+3]=ne[Se+15],ne[I+4]=ne[Se+16],ne[I+5]=ne[Se+17],ne[I+6]=J[0]+ge[0]*S,ne[I+7]=J[1]+ge[1]*S,ne[I+8]=J[2]+ge[2]*S,ne[I+9]=J[0],ne[I+9+1]=J[1],ne[I+9+2]=J[2],ne[I+9+3]=ne[Se+12],ne[I+9+4]=ne[Se+13],ne[I+9+5]=ne[Se+14],ne[I+9+6]=J[0]+ge[0]*S,ne[I+9+7]=J[1]+ge[1]*S,ne[I+9+8]=J[2]+ge[2]*S):(ne[I]=J[0],ne[I+1]=J[1],ne[I+2]=J[2],ne[I+3]=ne[Se],ne[I+4]=ne[Se+1],ne[I+5]=ne[Se+2],ne[I+6]=ne[we+15],ne[I+7]=ne[we+16],ne[I+8]=ne[we+17],ne[I+9]=J[0],ne[I+9+1]=J[1],ne[I+9+2]=J[2],ne[I+9+3]=ne[Se+3],ne[I+9+4]=ne[Se+4],ne[I+9+5]=ne[Se+5],ne[I+9+6]=ne[we+12],ne[I+9+7]=ne[we+13],ne[I+9+8]=ne[we+14]),I+=18)}else for(var Be=j!=G-1?j:j-1,Me=0;Me<K;Me++)A&&(q=Y+Be,se[F]=q,se[F+1]=q,se[F+2]=q,F+=3),Ae=ne[Be*te+3],ne[I]=J[0],ne[I+1]=J[1],ne[I+2]=J[2],ne[I+3]=Ae,oe[z]=0,oe[z+1]=0,oe[z+2]=0,oe[z+3]=0,ne[I+4]=J[0],ne[I+5]=J[1],ne[I+6]=J[2],ne[I+7]=Ae,oe[z+4]=W[Me][0]*S,oe[z+5]=W[Me][1]*S,oe[z+6]=Z[Me]+0,oe[z+7]=0,ne[I+8]=J[0],ne[I+9]=J[1],ne[I+10]=J[2],ne[I+11]=Ae,oe[z+8]=W[Me+1][0]*S,oe[z+9]=W[Me+1][1]*S,oe[z+10]=Z[Me+1]+0,oe[z+11]=0,I+=12,z+=12}v&&(H=[J[0],J[1],J[2]+.1*O],Le[j]=H,me[G-j-1]=H),j+1<G&&(f?(R=ye[j+1],J=[J[0]+R[0],J[1]+R[1],J[2]+R[2]]):J=ye[j+1])}Y+=ye.length}re>0&&(le[0]/=re,le[1]/=re,le[2]/=re),le[0]+=o.groupOrigin[0],le[1]+=o.groupOrigin[1],le[2]+=o.groupOrigin[2];var _e=h||p||y||L;if(d){var Oe={command:"addRenderJob",vertexBuffer:ne,color:x,"z-index":n,center:le,normalBuffer:oe,elementBuffer:se,"hover-event":h,"click-event":p,"draw-event":b,hitable:_e,state:o.hitState,eventInfo:s,advancedHit:A,"enter-event":y,"leave-event":L,"zbuffer-offset":N,"width-units":w,"line-width":2*S,lod:o.autoLod?null:o.tileLod};Oe.type=U?k?"flat-tline":E?"flat-rline":"flat-line":k?"pixel-tline":"pixel-line",k&&null!=M&&(Oe.texture=[o.stylesheetBitmaps[M[0]],M[1],M[2]],Oe.background=_);var ke=JSON.stringify({type:Oe.type,color:x,zIndex:n,zOffset:N,state:o.hitState});oe?g(Oe,[ne.buffer,oe.buffer],ke):g(Oe,[ne.buffer],ke)}if(v)for(j=0,G=ue.length;j<G;j++)m(ue[j].points,ue[j].points2,e,le,r,t,a,n,s)}}},m=function(e,r,t,a,n,s,i,l,u){var L=c(s,"line-label-color",t,n),m=c(s,"line-label-color2",t,n),A=c(s,"line-label-outline",t,n),N=c(s,"line-label-source",t,n),U=c(s,"line-label-size",t,n),x=c(s,"line-label-spacing",t,n),S=(c(s,"line-label-line-height",t,n),c(s,"line-label-offset",t,n));if(!(Math.abs(U)<1e-4)){var w=f(s,N,t,n,N);w=w?w.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var B=c(s,"line-label-font",t,n),M=p(B),_=b(B),O=y(w,M);if("$name"==N&&!v(w,M,O)){var k=f(s,"$name:en",t,n,N);k=k?k.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var E=y(w,M);v(k,M,E)&&(w=k,O=E)}if(w&&""!=w){var I=c(s,"hover-event",t,n),z=c(s,"click-event",t,n),F=c(s,"draw-event",t,n),C=c(s,"enter-event",t,n),T=c(s,"leave-event",t,n),j=c(s,"advanced-hit",t,n),G=c(s,"zbuffer-offset",t,n),R=h()*w.length*2,V=new Float32Array(R),$=new Float32Array(R),P={},X=I||z||C||T,D=d(e,w,U,x,M,S,V,$,0,P,O);if(D=d(r,w,U,x,M,S,V,$,D,null,O)){for(var J=new Array(M.length),H=0,q=M.length;H<q;H++)J[H]=[];for(var Y in P){var W=parseInt(Y),Z=P[Y],K=[];for(var Q in Z){var ee=parseInt(Q)-4e3*W,re=Math.round((ee-ee%4)/4);-1==K.indexOf(re)&&K.push(re)}J[W]=K}var te=JSON.stringify({type:"line-label",color:L,color2:m,outline:A,fonts:B,zIndex:l,zOffset:G});g({command:"addRenderJob",type:"line-label",vertexBuffer:V,texcoordsBuffer:$,color:L,color2:m,outline:A,"z-index":l,center:a,"hover-event":I,"click-event":z,"draw-event":F,files:J,"enter-event":C,"leave-event":T,"zbuffer-offset":G,fonts:_,hitable:X,state:o.hitState,eventInfo:u,advancedHit:j,lod:o.autoLod?null:o.tileLod},[V.buffer,$.buffer],te)}}}},A=function(e){var r=e.lines||e["d-lines"]||[];if(0!=r.length){var t=!!e["d-lines"],a=0,n=new Uint32Array(r.length);for(v=0;v<r.length;v++)n[v]=a,Array.isArray(r[v])&&(a+=r[v].length);for(var s,i,l,u,c=new Float64Array(3*a),f=o.forceScale,d=0,v=0;v<r.length;v++)if(Array.isArray(r[v])&&r[v].length){var h=r[v];u=h[0],s=[u[0],u[1],u[2]];for(var p=0,b=h.length;p<b&&(null!=f&&(l=[s[0]*f[0],s[1]*f[1],s[2]*f[2]]),c[d]=l[0],c[d+1]=l[1],c[d+2]=l[2],d+=3,p!=b-1);p++)t?(i=h[p+1],s=[s[0]+i[0],s[1]+i[1],s[2]+i[2]]):s=h[p+1]}o.signatureCounter++,g({command:"addRenderJob",type:"line-geometry",id:e.id,geometryBuffer:c,indicesBuffer:n},[c.buffer,n.buffer],""+o.signatureCounter)}}},function(e,r,t){"use strict";var a=t(0),n=t(2),s=t(3),i=t(1);t.d(r,"a",function(){return A}),t.d(r,"b",function(){return S});var o=a.a,l=a.f,u=n.c,c=n.g,f=s.f,d=s.g,v=s.h,h=s.i,p=s.j,b=s.k,g=s.e,y=s.l,L=s.m,m=i.a,A=function(e,r,t,a,n,s){var i,f,d=[],h=!1;if(e.lines||e["d-lines"]?(d=e.lines||e["d-lines"],h=!!e["d-lines"]):(e.points||e["d-points"])&&(d=[e.points||e["d-points"]],h=!!e["d-points"]),0!=d.length){var L,A,N,S,w,B,M=u(t,"visibility-rel",e,r)||u(t,"visibility-abs",e,r)||u(t,"visibility",e,r),_=u(t,"culling",e,r),O=u(t,"hover-event",e,r),k=u(t,"click-event",e,r),E=u(t,"draw-event",e,r),I=u(t,"enter-event",e,r),z=u(t,"leave-event",e,r),F=u(t,"advanced-event",e,r),C=u(t,"zbuffer-offset",e,r),T=u(t,"point",e,r),j=u(t,"point-flat",e,r),G=u(t,"point-color",e,r),R=.5*u(t,"point-radius",e,r),V=0;for(w=0,B=d.length;w<B;w++)S=d[w],Array.isArray(S)&&S.length>0&&(V+=S.length);var $=u(t,"icon",e,r);if($)if(L=u(t,"icon-source",e,r)){A=y()*V,N=y(!0)*V;var P={color:u(t,"icon-color",e,r),scale:u(t,"icon-scale",e,r),offset:u(t,"icon-offset",e,r),stick:u(t,"icon-stick",e,r),reduce:u(t,"dynamic-reduce",e,r),origin:u(t,"icon-origin",e,r),source:u(t,"icon-source",e,r),index:0,index2:0};V>1?(P.vertexBuffer=new Float32Array(A),P.originBuffer=new Float32Array(N),P.texcoordsBuffer=new Float32Array(A)):P.singleBuffer=new Float32Array(16)}else $=!1;var X=u(t,"label",e,r);if(X){L=u(t,"label-source",e,r);var D=c(t,L,e,r,L);D=D?D.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var J=u(t,"label-size",e,r),H=u(t,"label-font",e,r),q=p(H),Y=v(D,q);if("$name"==L&&!g(D,q,Y)){var W=c(t,"$name:en",e,r,L);W=W?W.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var Z=v(W,q);g(W,q)&&(D=W,Y=Z)}if(D&&""!=D&&Math.abs(J)>1e-4){A=y()*D.length*V,N=y(!0)*D.length*V;var K=1;"points"==u(t,"label-size-units",e,r)&&(K=o.pixelFactor/(1/72*96));var Q={color:u(t,"label-color",e,r),color2:u(t,"label-color2",e,r),outline:u(t,"label-outline",e,r),reduce:u(t,"dynamic-reduce",e,r),size:J*K,spacing:u(t,"label-spacing",e,r),lineHeight:u(t,"label-line-height",e,r),offset:u(t,"label-offset",e,r),stick:u(t,"label-stick",e,r),origin:u(t,"label-origin",e,r),align:u(t,"label-align",e,r),fonts:q,fontsStorage:b(H),text:D,hysteresis:u(t,"hysteresis",e,r),width:K*u(t,"label-width",e,r),noOverlap:u(t,"label-no-overlap",e,r),noOverlapMargin:u(t,"label-no-overlap-margin",e,r),noOverlapFactor:u(t,"label-no-overlap-factor",e,r),vertexBuffer:new Float32Array(A),originBuffer:new Float32Array(N),texcoordsBuffer:new Float32Array(A),index:0,index2:0,glyphsRes:Y};Q.stick&&(Q.stick=Q.stick.slice(),Q.stick[2]*=K)}else X=!1}var ee,re,te,ae,ne,se,ie,oe=0,le=0,ue=[0,0,0],ce=o.forceOrigin,fe=o.bboxMin,de=o.tileX,ve=o.tileY,he=o.forceScale;if(T){var pe=[],be=l(8*R*.5,8,32),ge=0,ye=2*Math.PI/be;for(i=0;i<be;i++)pe[i]=[-Math.sin(ge),Math.cos(ge)],ge+=ye;pe[be]=[0,1],j?(ae=3*be*3,ne=new Float32Array(V*ae)):(ae=3*be*4,ne=new Float32Array(V*ae),se=3*be*4,ie=new Float32Array(V*se))}for(w=0,B=d.length;w<B;w++)if(S=d[w],Array.isArray(S)&&S.length>0)for(re=S[0],te=[re[0],re[1],re[2]],i=0,f=S.length;i<f;i++){if(ce&&(te=[te[0]-de,te[1]-ve,te[2]]),null!=he&&(te=[te[0]*he[0],te[1]*he[1],te[2]*he[2]]),ue[0]+=te[0],ue[1]+=te[1],ue[2]+=te[2],$&&U(te,P),X&&(ee=x(te,Q)),T)for(var Le=0;Le<be;Le++)j?(ne[oe]=te[0],ne[oe+1]=te[1],ne[oe+2]=te[2],ne[oe+3]=te[0]+pe[Le][0]*R,ne[oe+4]=te[1]+pe[Le][1]*R,ne[oe+5]=te[2],ne[oe+6]=te[0]+pe[Le+1][0]*R,ne[oe+7]=te[1]+pe[Le+1][1]*R,ne[oe+8]=te[2],oe+=9):(ne[oe]=te[0],ne[oe+1]=te[1],ne[oe+2]=te[2],ne[oe+3]=0,ie[le]=0,ie[le+1]=0,ie[le+2]=0,ie[le+3]=0,ne[oe+4]=te[0],ne[oe+5]=te[1],ne[oe+6]=te[2],ne[oe+7]=0,ie[le+4]=pe[Le][0]*R,ie[le+5]=pe[Le][1]*R,ie[le+6]=0,ie[le+7]=0,ne[oe+8]=te[0],ne[oe+9]=te[1],ne[oe+10]=te[2],ne[oe+11]=0,ie[le+8]=pe[Le+1][0]*R,ie[le+9]=pe[Le+1][1]*R,ie[le+10]=0,ie[le+11]=0,oe+=12,le+=12);if(i+1<f)if(h){var me=S[i+1];te=[te[0]+me[0],te[1]+me[1],te[2]+me[2]]}else te=S[i+1]}V>0&&(ue[0]/=V,ue[1]/=V,ue[2]/=V),ue[0]+=fe[0],ue[1]+=fe[1],ue[2]+=fe[2];var Ae=O||k||I||z;o.signatureCounter++;var Ne=""+o.signatureCounter;if(T&&(j?m({command:"addRenderJob",type:"flat-line",vertexBuffer:ne,color:G,"z-index":n,visibility:M,center:ue,"hover-event":O,"click-event":k,"draw-event":E,"enter-event":I,"leave-event":z,"zbuffer-offset":C,hitable:Ae,state:o.hitState,eventInfo:s,advancedHit:F,lod:o.autoLod?null:o.tileLod},[ne.buffer],Ne):m({command:"addRenderJob",type:"pixel-line",vertexBuffer:ne,normalBuffer:ie,color:G,"z-index":n,visibility:M,center:ue,"hover-event":O,"click-event":k,"draw-event":E,"enter-event":I,"leave-event":z,"zbuffer-offset":C,hitable:Ae,state:o.hitState,eventInfo:s,lod:o.autoLod?null:o.tileLod},[ne.buffer,ie.buffer],Ne)),$&&(P.singleBuffer?(o.signatureCounter++,Ne=""+o.signatureCounter,m({command:"addRenderJob",type:"icon",singleBuffer:P.singleBuffer,icon:o.stylesheetBitmaps[P.source[0]],color:P.color,"z-index":n,visibility:M,culling:_,center:ue,stick:P.stick,"hover-event":O,"click-event":k,"draw-event":E,advancedHit:F,"enter-event":I,"leave-event":z,"zbuffer-offset":C,hitable:Ae,state:o.hitState,eventInfo:s,index:a,reduce:P.reduce,lod:o.autoLod?null:o.tileLod},[P.singleBuffer.buffer],Ne)):P.vertexBuffer&&P.vertexBuffer.length>0&&(o.signatureCounter++,Ne=""+o.signatureCounter,m({command:"addRenderJob",type:"icon",vertexBuffer:P.vertexBuffer,originBuffer:P.originBuffer,texcoordsBuffer:P.texcoordsBuffer,icon:o.stylesheetBitmaps[P.source[0]],color:P.color,"z-index":n,visibility:M,culling:_,center:ue,stick:P.stick,"hover-event":O,"click-event":k,"draw-event":E,advancedHit:F,"enter-event":I,"leave-event":z,"zbuffer-offset":C,hitable:Ae,state:o.hitState,eventInfo:s,index:a,reduce:P.reduce,lod:o.autoLod?null:o.tileLod},[P.vertexBuffer.buffer,P.originBuffer.buffer,P.texcoordsBuffer.buffer],Ne))),X&&Q.vertexBuffer.length>0){if(o.signatureCounter++,Ne=""+o.signatureCounter,Q.noOverlap){var Ue=Q.noOverlapMargin,xe=null,Se=null;if(null!==Q.noOverlapFactor){switch(Q.noOverlapFactor[0]){case"direct":xe=0;break;case"div-by-dist":xe=1}Se=Q.noOverlapFactor[1]}var we=[ee[0]-Ue[0],ee[1]-Ue[1],ee[2]+Ue[0],ee[3]+Ue[1],xe,Se]}m({command:"addRenderJob",type:"label",vertexBuffer:Q.vertexBuffer,originBuffer:Q.originBuffer,texcoordsBuffer:Q.texcoordsBuffer,size:Q.size,color:Q.color,color2:Q.color2,outline:Q.outline,"z-index":n,visibility:M,culling:_,center:ue,stick:Q.stick,noOverlap:Q.noOverlap?we:null,"hover-event":O,"click-event":k,"draw-event":E,files:Q.files,index:a,"enter-event":I,"leave-event":z,"zbuffer-offset":C,fonts:Q.fontsStorage,hysteresis:Q.hysteresis,hitable:Ae,state:o.hitState,eventInfo:s,advancedHit:F,reduce:Q.reduce,lod:o.autoLod?null:o.tileLod},[Q.vertexBuffer.buffer,Q.originBuffer.buffer,Q.texcoordsBuffer.buffer],Ne)}}},N=function(e,r,t){switch(e){case"top-left":return[0,0];case"top-right":return[-r,0];case"top-center":return[.5*-r,0];case"center-left":return[0,.5*-t];case"center-right":return[-r,.5*-t];case"center-center":return[.5*-r,.5*-t];case"bottom-left":return[0,-t];case"bottom-right":return[-r,-t];case"bottom-center":return[.5*-r,-t]}},U=function(e,r){var t=r.source,a=r.index,n=r.index2,s=a,i=Math.abs(t[3]*r.scale*.5),o=Math.abs(t[4]*r.scale*.5),l=N(r.origin,i,o),u=l[0]+r.offset[0],c=l[1]+r.offset[1];if(r.singleBuffer){var f=r.singleBuffer;return f[0]=u,f[1]=c,f[2]=t[1],f[3]=t[2],f[4]=i+u,f[5]=c,f[6]=t[1]+t[3],f[7]=t[2],f[8]=i+u,f[9]=o+c,f[10]=t[1]+t[3],f[11]=t[2]+t[4],f[12]=u,f[13]=o+c,f[14]=t[1],void(f[15]=t[2]+t[4])}var d=r.vertexBuffer,v=r.texcoordsBuffer,h=r.originBuffer;d[a]=0,d[a+1]=0,d[a+2]=0,d[a+3]=0,d[a+4]=i,d[a+5]=0,d[a+6]=0,d[a+7]=0,d[a+8]=i,d[a+9]=-o,d[a+10]=0,d[a+11]=0,v[a]=t[1],v[a+1]=t[2],v[a+2]=0,v[a+3]=0,v[a+4]=t[1]+t[3],v[a+5]=t[2],v[a+6]=0,v[a+7]=0,v[a+8]=t[1]+t[3],v[a+9]=t[2]+t[4],v[a+10]=0,v[a+11]=0,a+=12,d[a]=0,d[a+1]=0,d[a+2]=0,d[a+3]=0,d[a+4]=0,d[a+5]=-o,d[a+6]=0,d[a+7]=0,d[a+8]=i,d[a+9]=-o,d[a+10]=0,d[a+11]=0,v[a]=t[1],v[a+1]=t[2],v[a+2]=0,v[a+3]=0,v[a+4]=t[1],v[a+5]=t[2]+t[4],v[a+6]=0,v[a+7]=0,v[a+8]=t[1]+t[3],v[a+9]=t[2]+t[4],v[a+10]=0,v[a+11]=0,a+=12;for(var p=e[0],b=e[1],g=e[2],y=s;y<a;y+=4)d[y]+=u,d[y+1]-=c,h[n]=p,h[n+1]=b,h[n+2]=g,n+=3;r.index=a,r.index2=n},x=function(e,r){var t,a,n=r.vertexBuffer,s=r.texcoordsBuffer,i=r.originBuffer,o=r.index,l=r.index2,u=o,c=(r.text,r.fonts),v={},p=r.glyphsRes,b=[],g=[];do{var y=p[2].indexOf(10);-1!=y?(b.push([p[0].slice(0,y),p[1].slice(0,y),p[2].slice(0,y)]),p=[p[0].slice(y+1),p[1].slice(y+1),p[2].slice(y+1)]):b.push(p)}while(-1!=y);for(var t=0,a=b.length;t<a;t++)for(var p=b[t];;){var m=d(null,r.width,r.size,r.spacing,c,p),A=p[2];if(A.length==m){g.push(p);break}g.push([p[0].slice(0,m),p[1].slice(0,m),p[2].slice(0,m)]),p=[p[0].slice(m+1),p[1].slice(m+1),p[2].slice(m+1)]}var U=0,x=0,S=L(r.size,r.lineHeight,c),w=0,B=[];for(t=0,a=g.length;t<a;t++)B[t]=h(null,r.size,r.spacing,c,g[t]),w=Math.max(B[t],w);for(t=0,a=g.length;t<a;t++){var M=B[t];switch(r.align){case"left":U=0;break;case"right":U=w-M;break;case"center":U=.5*(w-M)}o=f([U,x,0],[1,0,0],null,r.size,r.spacing,c,n,s,!0,o,v,g[t]),x-=S}var _=N(r.origin,w,-x),O=_[0]+r.offset[0],k=_[1]+r.offset[1],E=e[0],I=e[1],z=e[2];for(t=u;t<o;t+=4)n[t]+=O,n[t+1]-=k,i[l]=E,i[l+1]=I,i[l+2]=z,l+=3;var c=r.fonts;for(r.files=new Array(c.length),t=0,a=c.length;t<a;t++)r.files[t]=[];for(var F in v){var C=parseInt(F),T=v[F],j=[];for(var G in T){var R=parseInt(G)-4e3*C,V=Math.round((R-R%4)/4);-1==j.indexOf(V)&&j.push(V)}r.files[C]=j}return r.index=o,r.index2=l,[.5*O,.5*k,.5*(O+w)+1,.5*(k+Math.abs(x))]},S=function(e){var r,t,a=!1;if(!e.points&&!e["d-points"]||(points=e.points||e["d-points"],a=!!e["d-points"],Array.isArray(points)&&points.length>0)){var n,s,i=0,l=o.forceScale,u=new Float64Array(points.length),c=points[0],f=[c[0],c[1],c[2]];for(r=0,t=points.length;r<t&&(null!=l&&(n=[f[0]*l[0],f[1]*l[1],f[2]*l[2]]),u[i]=n[0],u[i+1]=n[1],u[i+2]=n[2],i+=3,!(r>=t-1));r++)a?(s=points[r+1],f=[f[0]+s[0],f[1]+s[1],f[2]+s[2]]):f=points[r+1];m({command:"addRenderJob",type:"point-geometry",id:lineString.id,geometryBuffer:u},[u.buffer,indicesBuffer.buffer],""+o.signatureCounter)}}},function(e,r,t){"use strict";var a=t(0),n=t(2),s=t(1),i=t(4),o=t(5);t.d(r,"a",function(){return v});var l=a.a,u=n.c,c=s.a,f=i.a,d=o.a,v=function(e,r,t,a,n,s){var i=e.vertices||[];if(0!=i.length){(u(t,"point",e,r)||u(t,"label",e,r))&&p(e,i,r,t,n,s,!1),(u(t,"line",e,r)||u(t,"line-label",e,r))&&p(e,i,r,t,n,s,!0);if(u(t,"polygon",e,r)){var o=e.surface||[];if(0!=o.length){for(var f,d,v=u(t,"hover-event",e,r),h=u(t,"click-event",e,r),b=u(t,"draw-event",e,r),g=u(t,"enter-event",e,r),y=u(t,"leave-event",e,r),L=u(t,"advanced-hit",e,r),m=u(t,"zbuffer-offset",e,r),A=u(t,"polygon-color",e,r),N=[0,0,0],U=o.length/3,x=3*U,S=new Array(3*x),w=0,B=0,M=l.tileX,_=l.tileY,O=l.forceOrigin,k=l.forceScale,E=0;E<x;E++)d=3*o[w++],f=[i[d++],i[d++],i[d]],O&&(f=[f[0]-M,f[1]-_,f[2]]),null!=k&&(f=[f[0]*k[0],f[1]*k[1],f[2]*k[2]]),N[0]+=f[0],N[1]+=f[1],N[2]+=f[2],S[B++]=f[0],S[B++]=f[1],S[B++]=f[2];if(x>0){var I=1/x;N[0]*=I,N[1]*=I,N[2]*=I}N[0]+=l.groupOrigin[0],N[1]+=l.groupOrigin[1],N[2]+=l.groupOrigin[2];var z=v||h||g||y,F={command:"addRenderJob",type:"flat-line",vertexBuffer:S,color:A,"z-index":n,center:N,"hover-event":v,"click-event":h,"draw-event":b,hitable:z,state:l.hitState,eventInfo:s,advancedHit:L,"enter-event":g,"leave-event":y,"zbuffer-offset":m,lod:l.autoLod?null:l.tileLod};c(F)}}}},h=function(e){var r={};for(var t in e)"surface"!=t&&"vertices"!=t&&"borders"!=t&&(r[t]=e[t]);return r},p=function(e,r,t,a,n,s,i,o){var l=e.borders||[];if(0!=l.length)for(var u=h(e),c=l.length,v=0;v<c;v++){var p,b=l[v],g=b.length,y=0;if(g>0){var L,m;for(L=o?new Array(g+1):new Array(g),m=0;m<g;m++)b[m]>=0?(p=3*b[m],y++):p=3*-b[m],L[m]=[r[p],r[p+1],r[p+2]],o&&0==m&&(L[g]=L[0]);var A=new Array(y),N=0;for(m=0;m<g;m++)b[m]>=0&&(p=3*b[m],A[N]=[r[p],r[p+1],r[p+2]],N++);o?(u.lines=[L],f(u,t,a,n,s,i)):(u.points=A,d(u,t,a,n,s,i))}}}},function(e,r,t){"use strict";function a(e){return 0!=(1&e)}function n(e){return 0==(1&e)}function s(e,r,t){for(var a=r,n=e.length;a<n;++a)if(e[a]!==t)return a;return a}function i(e,r,t,a){for(var n=r;n<t;++n)e[n]=a}function o(e,r,t,a){for(var n=t,s=a-1;n<s;++n,--s){var i=e[n];e[n]=e[s],e[s]=i,i=r[n],r[n]=r[s],r[s]=i}}function l(e,r,t){return{str:e,indices:h,types:v,dir:t?"ttb":r?"ltr":"rtl"}}function u(e,r,t){var u=!0,p=e.length;if(0===p||t)return l(e,u,t);d.length=p,v.length=p;var b,g,y=0;for(b=0;b<p;++b){d[b]=e.charAt(b),h[b]=b;var L=e.charCodeAt(b),m="L";L<=255?m=c[L]:1424<=L&&L<=1524?m="R":1536<=L&&L<=1791?m=f[255&L]:1792<=L&&L<=2220&&(m="AL"),"R"!==m&&"AL"!==m&&"AN"!==m||y++,v[b]=m}if(0===y)return u=!0,l(e,u);-1===r&&(y/p<.3?(u=!0,r=0):(u=!1,r=1));var A=[];for(b=0;b<p;++b)A[b]=r;var N=a(r)?"R":"L",U=N,x=U,S=U;for(b=0;b<p;++b)"NSM"===v[b]?v[b]=S:S=v[b];S=U;var w;for(b=0;b<p;++b)w=v[b],"EN"===w?v[b]="AL"===S?"AN":"EN":"R"!==w&&"L"!==w&&"AL"!==w||(S=w);for(b=0;b<p;++b)"AL"===(w=v[b])&&(v[b]="R");for(b=1;b<p-1;++b)"ES"===v[b]&&"EN"===v[b-1]&&"EN"===v[b+1]&&(v[b]="EN"),"CS"!==v[b]||"EN"!==v[b-1]&&"AN"!==v[b-1]||v[b+1]!==v[b-1]||(v[b]=v[b-1]);for(b=0;b<p;++b)if("EN"===v[b]){var B;for(B=b-1;B>=0&&"ET"===v[B];--B)v[B]="EN";for(B=b+1;B<p&&"ET"===v[B];++B)v[B]="EN"}for(b=0;b<p;++b)"WS"!==(w=v[b])&&"ES"!==w&&"ET"!==w&&"CS"!==w||(v[b]="ON");for(S=U,b=0;b<p;++b)w=v[b],"EN"===w?v[b]="L"===S?"L":"EN":"R"!==w&&"L"!==w||(S=w);for(b=0;b<p;++b)if("ON"===v[b]){var M=s(v,b+1,"ON"),_=U;b>0&&(_=v[b-1]);var O=x;M+1<p&&(O=v[M+1]),"L"!==_&&(_="R"),"L"!==O&&(O="R"),_===O&&i(v,b,M,_),b=M-1}for(b=0;b<p;++b)"ON"===v[b]&&(v[b]=N);for(b=0;b<p;++b)w=v[b],n(A[b])?"R"===w?A[b]+=1:"AN"!==w&&"EN"!==w||(A[b]+=2):"L"!==w&&"AN"!==w&&"EN"!==w||(A[b]+=1);var k,E=-1,I=99;for(b=0,g=A.length;b<g;++b)k=A[b],E<k&&(E=k),I>k&&a(k)&&(I=k);for(k=E;k>=I;--k){var z=-1;for(b=0,g=A.length;b<g;++b)A[b]<k?z>=0&&(o(d,h,z,b),z=-1):z<0&&(z=b);z>=0&&o(d,h,z,A.length)}for(b=0,g=d.length;b<g;++b){var F=d[b];"<"!==F&&">"!==F||(d[b]="")}return l(d.join(""),u)}t.d(r,"a",function(){return u});var c=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","ON","ON","ET","ET","ET","ON","ON","ON","ON","ON","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","ON","ET","ET","ET","ET","ON","ON","ON","ON","L","ON","ON","BN","ON","ON","ET","ET","EN","EN","ON","L","ON","ON","ON","EN","L","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L"],f=["AN","AN","AN","AN","AN","AN","ON","ON","AL","ET","ET","AL","CS","AL","ON","ON","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","ON","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","ON","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL"],d=[],v=[],h=[]},function(e,r,t){"use strict";var a=t(7);t.d(r,"a",function(){return s});var n=a.a,s={};s.parse=function(e){var r=s._bin,t=new Uint8Array(e),a=0;r.readFixed(t,a);a+=4;var n=r.readUshort(t,a);a+=2;r.readUshort(t,a);a+=2;r.readUshort(t,a);a+=2;r.readUshort(t,a);a+=2;for(var i=["cmap","head","hhea","maxp","hmtx","kern","GPOS","GSUB"],o={_data:t},l={},u=0,c=0;c<n;c++){var f=r.readASCII(t,a,4);a+=4;r.readUint(t,a);a+=4;var d=r.readUint(t,a);a+=4;var v=r.readUint(t,a);a+=4,l[f]={offset:d,length:v},u=d+v}for(var c=0;c<i.length;c++){var h=i[c];l[h]&&(o[h.trim()]=s[h.trim()].parse(t,l[h].offset,l[h].length,o))}o._tabs=l,s._processGlyphs(t,u,l,o);var p=o.GSUB;if(p){var b=p.lookupList,g=p.featureList;o.gsubIsolTable=[],o.gsubInitTable=[],o.gsubFinaTable=[],o.gsubMediTable=[],o.gsubRligLigaTable=[];for(var y=0;y<g.length;y++){var f=g[y].tag;switch(f){case"isol":case"init":case"fina":case"medi":for(var L=0;L<g[y].tab.length;L++){var m=b[g[y].tab[L]];if(1==m.ltype)switch(f){case"isol":o.gsubIsolTable.push(m.tabs);break;case"init":o.gsubInitTable.push(m.tabs);break;case"fina":o.gsubFinaTable.push(m.tabs);break;case"medi":o.gsubMediTable.push(m.tabs)}}break;case"rlig":case"liga":for(var L=0;L<g[y].tab.length;L++){var m=b[g[y].tab[L]];4==m.ltype&&o.gsubRligLigaTable.push(m.tabs)}}}}return o},s._processGlyphs=function(e,r,t,a){var n=e[r];r+=1;var i=e[r]<<8|e[r+1];r+=2;var o=e[r]<<8|e[r+1];r+=2;var l=e[r];r+=1;var u=e[r];r+=1,a.version=n,a.textureLX=i,a.textureLY=o,a.size=l,a.cly=1.5*l,a.flags=u;var c=new Array(a.maxp.numGlyphs),f=1/i,d=1/o,v=i>256?7:6,h=r+a.maxp.numGlyphs*v,p=e[h]<<8|e[h+1],b=new Array(p);h+=2;for(var g=0,y=p;g<y;g++)b[g]=e[h+2*g]<<8|e[h+2*g+1];var L=0;for(g=0,y=a.maxp.numGlyphs;g<y;g++)g==b[L]&&L++,c[g]=s._processGlyph(e,r,f,d,i,a,g,L),r+=v;a.glyphs=c},s._processGlyph=function(e,r,t,a,n,s,i,o){var l=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],u=l>>22&63,c=l>>16&63,f=(l>>9&63)*(l>>15&1?-1:1),d=-(l>>2&63)*(l>>8&1?-1:1),v=(3&l)+4*o;l=n>256?e[r+4]<<16|e[r+5]<<8|e[r+6]:e[r+4]<<8|e[r+5];var h,p,b=s.size/.75/s.head.unitsPerEm*.75,g=s.hmtx.aWidth[i]*b;switch(n){case 2048:h=l>>11&2047,p=2047&l;break;case 1024:h=l>>10&1023,p=1023&l;break;case 512:h=l>>9&511,p=511&l;break;default:h=l>>8&255,p=255&l}return{u1:h*t,v1:p*a+v,u2:(h+u)*t,v2:(p+c)*a+v,lx:u,ly:c,sx:f,sy:d,step:g,plane:v}},s._tabOffset=function(e,r){for(var t=s._bin,a=t.readUshort(e,4),n=12,i=0;i<a;i++){var o=t.readASCII(e,n,4);n+=4;t.readUint(e,n);n+=4;var l=t.readUint(e,n);n+=4;t.readUint(e,n);if(n+=4,o==r)return l}return 0},s._bin={readFixed:function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<8|e[r+3])/65540},readF2dot14:function(e,r){var t=s._bin.readShort(e,r);return t/16384},readInt:function(e,r){var t=s._bin.t.uint8;return t[0]=e[r+3],t[1]=e[r+2],t[2]=e[r+1],t[3]=e[r],s._bin.t.int32[0]},readInt8:function(e,r){return s._bin.t.uint8[0]=e[r],s._bin.t.int8[0]},readShort:function(e,r){var t=s._bin.t.uint8;return t[1]=e[r],t[0]=e[r+1],s._bin.t.int16[0]},readUshort:function(e,r){return e[r]<<8|e[r+1]},readUshorts:function(e,r,t){for(var a=[],n=0;n<t;n++)a.push(s._bin.readUshort(e,r+2*n));return a},readUint:function(e,r){var t=s._bin.t.uint8;return t[3]=e[r],t[2]=e[r+1],t[1]=e[r+2],t[0]=e[r+3],s._bin.t.uint32[0]},readUint64:function(e,r){return 4294967296*s._bin.readUint(e,r)+s._bin.readUint(e,r+4)},readASCII:function(e,r,t){for(var a="",n=0;n<t;n++)a+=String.fromCharCode(e[r+n]);return a},readUnicode:function(e,r,t){for(var a="",n=0;n<t;n++){var s=e[r++]<<8|e[r++];a+=String.fromCharCode(s)}return a},readBytes:function(e,r,t){for(var a=[],n=0;n<t;n++)a.push(e[r+n]);return a},readASCIIArray:function(e,r,t){for(var a=[],n=0;n<t;n++)a.push(String.fromCharCode(e[r+n]));return a}},s._bin.t={buff:new ArrayBuffer(8)},s._bin.t.int8=new Int8Array(s._bin.t.buff),s._bin.t.uint8=new Uint8Array(s._bin.t.buff),s._bin.t.int16=new Int16Array(s._bin.t.buff),s._bin.t.uint16=new Uint16Array(s._bin.t.buff),s._bin.t.int32=new Int32Array(s._bin.t.buff),s._bin.t.uint32=new Uint32Array(s._bin.t.buff),s._lctf={},s._lctf.parse=function(e,r,t,a,n){var i=s._bin,o={},l=r;i.readFixed(e,r);r+=4;var u=i.readUshort(e,r);r+=2;var c=i.readUshort(e,r);r+=2;var f=i.readUshort(e,r);return r+=2,o.scriptList=s._lctf.readScriptList(e,l+u),o.featureList=s._lctf.readFeatureList(e,l+c),o.lookupList=s._lctf.readLookupList(e,l+f,n),o},s._lctf.readLookupList=function(e,r,t){var a=s._bin,n=r,i=[],o=a.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=a.readUshort(e,r);r+=2;var c=s._lctf.readLookupTable(e,n+u,t);i.push(c)}return i},s._lctf.readLookupTable=function(e,r,t){var a=s._bin,n=r,i={tabs:[]};i.ltype=a.readUshort(e,r),r+=2,i.flag=a.readUshort(e,r),r+=2;var o=a.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=a.readUshort(e,r);r+=2;var c=t(e,i.ltype,n+u);i.tabs.push(c)}return i},s._lctf.numOfOnes=function(e){for(var r=0,t=0;t<32;t++)0!=(e>>>t&1)&&r++;return r},s._lctf.readClassDef=function(e,r){var t=s._bin,a={start:[],end:[],class:[]},n=t.readUshort(e,r);if(r+=2,1==n){var i=t.readUshort(e,r);r+=2;var o=t.readUshort(e,r);r+=2;for(var l=0;l<o;l++)a.start.push(i+l),a.end.push(i+l),a.class.push(t.readUshort(e,r)),r+=2}if(2==n){var u=t.readUshort(e,r);r+=2;for(var l=0;l<u;l++)a.start.push(t.readUshort(e,r)),r+=2,a.end.push(t.readUshort(e,r)),r+=2,a.class.push(t.readUshort(e,r)),r+=2}return a},s._lctf.readValueRecord=function(e,r,t){var a=s._bin,n=[];return n.push(1&t?a.readShort(e,r):0),r+=1&t?2:0,n.push(2&t?a.readShort(e,r):0),r+=2&t?2:0,n.push(4&t?a.readShort(e,r):0),r+=4&t?2:0,n.push(8&t?a.readShort(e,r):0),r+=8&t?2:0,n},s._lctf.readCoverage=function(e,r){var t=s._bin,a={};a.fmt=t.readUshort(e,r),r+=2;var n=t.readUshort(e,r);r+=2,1==a.fmt&&(a.tab=t.readUshorts(e,r,n)),2==a.fmt&&(a.tab=t.readUshorts(e,r,3*n));var i=Number.POSITIVE_INFINITY,o=0,l=a.tab;if(1==a.fmt)for(var u=0;u<l.length;u++){var c=l[u];c>o&&(o=c),c<i&&(i=c)}if(2==a.fmt)for(var u=0;u<l.length;u+=3){var f=l[u],d=l[u+1];f>o&&(o=f),f<i&&(i=f),d>o&&(o=d),d<i&&(i=d)}return a.min=i,a.max=o,a},s._lctf.coverageIndex=function(e,r){if(r<e.min||r>e.max)return-1;var t=e.tab;if(1==e.fmt)return t.indexOf(r);for(var a=0;a<t.length;a+=3){var n=t[a],s=t[a+1],i=t[a+2];if(n<=r&&r<=s)return i+(r-n)}return-1},s._lctf.readFeatureList=function(e,r){var t=s._bin,a=r,n=[],i=t.readUshort(e,r);r+=2;for(var o=0;o<i;o++){var l=t.readASCII(e,r,4);r+=4;var u=t.readUshort(e,r);r+=2,n.push({tag:l.trim(),tab:s._lctf.readFeatureTable(e,a+u)})}return n},s._lctf.readFeatureTable=function(e,r){var t=s._bin;t.readUshort(e,r);r+=2;var a=t.readUshort(e,r);r+=2;for(var n=[],i=0;i<a;i++)n.push(t.readUshort(e,r+2*i));return n},s._lctf.readScriptList=function(e,r){var t=s._bin,a=r,n={},i=t.readUshort(e,r);r+=2;for(var o=0;o<i;o++){var l=t.readASCII(e,r,4);r+=4;var u=t.readUshort(e,r);r+=2,n[l.trim()]=s._lctf.readScriptTable(e,a+u)}return n},s._lctf.readScriptTable=function(e,r){var t=s._bin,a=r,n={},i=t.readUshort(e,r);r+=2,n.default=s._lctf.readLangSysTable(e,a+i);var o=t.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=t.readASCII(e,r,4);r+=4;var c=t.readUshort(e,r);r+=2,n[u.trim()]=s._lctf.readLangSysTable(e,a+c)}return n},s._lctf.readLangSysTable=function(e,r){var t=s._bin,a={};t.readUshort(e,r);r+=2,a.reqFeature=t.readUshort(e,r),r+=2;var n=t.readUshort(e,r);return r+=2,a.features=t.readUshorts(e,r,n),a},s.cmap={},s.cmap.parse=function(e,r,t){e=new Uint8Array(e.buffer,r,t),r=0;var a=s._bin,n={};a.readUshort(e,r);r+=2;var i=a.readUshort(e,r);r+=2;var o=[];n.tables=[];for(var l=0;l<i;l++){var u=a.readUshort(e,r);r+=2;var c=a.readUshort(e,r);r+=2;var f=a.readUint(e,r);r+=4;var d="p"+u+"e"+c,v=o.indexOf(f);if(-1==v){v=n.tables.length;var h;o.push(f);var p=a.readUshort(e,f);0==p?h=s.cmap.parse0(e,f):4==p?h=s.cmap.parse4(e,f):6==p?h=s.cmap.parse6(e,f):12==p?h=s.cmap.parse12(e,f):console.log("unknown format: "+p,u,c,f),n.tables.push(h)}if(null!=n[d])throw"multiple tables for one platform+encoding";n[d]=v}return n},s.cmap.parse0=function(e,r){var t=s._bin,a={};a.format=t.readUshort(e,r),r+=2;var n=t.readUshort(e,r);r+=2;t.readUshort(e,r);r+=2,a.map=[];for(var i=0;i<n-6;i++)a.map.push(e[r+i]);return a},s.cmap.parse4=function(e,r){var t=s._bin,a=r,n={};n.format=t.readUshort(e,r),r+=2;var i=t.readUshort(e,r);r+=2;t.readUshort(e,r);r+=2;var o=t.readUshort(e,r);r+=2;var l=o/2;n.searchRange=t.readUshort(e,r),r+=2,n.entrySelector=t.readUshort(e,r),r+=2,n.rangeShift=t.readUshort(e,r),r+=2,n.endCount=t.readUshorts(e,r,l),r+=2*l,r+=2,n.startCount=t.readUshorts(e,r,l),r+=2*l,n.idDelta=[];for(var u=0;u<l;u++)n.idDelta.push(t.readShort(e,r)),r+=2;for(n.idRangeOffset=t.readUshorts(e,r,l),r+=2*l,n.glyphIdArray=[];r<a+i;)n.glyphIdArray.push(t.readUshort(e,r)),r+=2;return n},s.cmap.parse6=function(e,r){var t=s._bin,a={};a.format=t.readUshort(e,r),r+=2;t.readUshort(e,r);r+=2;t.readUshort(e,r);r+=2,a.firstCode=t.readUshort(e,r),r+=2;var n=t.readUshort(e,r);r+=2,a.glyphIdArray=[];for(var i=0;i<n;i++)a.glyphIdArray.push(t.readUshort(e,r)),r+=2;return a},s.cmap.parse12=function(e,r){var t=s._bin,a={};a.format=t.readUshort(e,r),r+=2,r+=2;t.readUint(e,r);r+=4;t.readUint(e,r);r+=4;var n=t.readUint(e,r);r+=4,a.groups=[];for(var i=0;i<n;i++){var o=r+12*i,l=t.readUint(e,o+0),u=t.readUint(e,o+4),c=t.readUint(e,o+8);a.groups.push([l,u,c])}return a},s.GPOS={},s.GPOS.parse=function(e,r,t,a){return s._lctf.parse(e,r,t,a,s.GPOS.subt)},s.GPOS.subt=function(e,r,t){if(2!=r)return null;var a=s._bin,n=t,i={};i.format=a.readUshort(e,t),t+=2;var o=a.readUshort(e,t);t+=2,i.coverage=s._lctf.readCoverage(e,o+n),i.valFmt1=a.readUshort(e,t),t+=2,i.valFmt2=a.readUshort(e,t),t+=2;var l=s._lctf.numOfOnes(i.valFmt1),u=s._lctf.numOfOnes(i.valFmt2);if(1==i.format){i.pairsets=[];var c=a.readUshort(e,t);t+=2;for(var f=0;f<c;f++){var d=a.readUshort(e,t);t+=2,d+=n;var v=a.readUshort(e,d);d+=2;for(var h=[],p=0;p<v;p++){var b=a.readUshort(e,d);d+=2;var g,y;0!=i.valFmt1&&(g=s._lctf.readValueRecord(e,d,i.valFmt1),d+=2*l),0!=i.valFmt2&&(y=s._lctf.readValueRecord(e,d,i.valFmt2),d+=2*u),h.push({gid2:b,val1:g,val2:y})}i.pairsets.push(h)}}if(2==i.format){var L=a.readUshort(e,t);t+=2;var m=a.readUshort(e,t);t+=2;var A=a.readUshort(e,t);t+=2;var N=a.readUshort(e,t);t+=2,i.classDef1=s._lctf.readClassDef(e,n+L),i.classDef2=s._lctf.readClassDef(e,n+m),i.matrix=[];for(var f=0;f<A;f++){for(var U=[],p=0;p<N;p++){var g=null,y=null;0!=i.valFmt1&&(g=s._lctf.readValueRecord(e,t,i.valFmt1),t+=2*l),0!=i.valFmt2&&(y=s._lctf.readValueRecord(e,t,i.valFmt2),t+=2*u),U.push({val1:g,val2:y})}i.matrix.push(U)}}return i},s.GSUB={},s.GSUB.parse=function(e,r,t,a){return s._lctf.parse(e,r,t,a,s.GSUB.subt)},s.GSUB.subt=function(e,r,t){var a=s._bin,n=t,i={};if(1!=r&&4!=r)return null;i.fmt=a.readUshort(e,t),t+=2;var o=a.readUshort(e,t);if(t+=2,i.coverage=s._lctf.readCoverage(e,o+n),1==r){if(1==i.fmt)i.delta=a.readShort(e,t),t+=2;else if(2==i.fmt){var l=a.readUshort(e,t);t+=2,i.newg=a.readUshorts(e,t,l),t+=2*i.newg.length}}else if(4==r){i.vals=[];var l=a.readUshort(e,t);t+=2;for(var u=0;u<l;u++){var c=a.readUshort(e,t);t+=2,i.vals.push(s.GSUB.readLigatureSet(e,n+c))}}return i},s.GSUB.readChainSubClassSet=function(e,r){var t=s._bin,a=r,n=[],i=t.readUshort(e,r);r+=2;for(var o=0;o<i;o++){var l=t.readUshort(e,r);r+=2,n.push(s.GSUB.readChainSubClassRule(e,a+l))}return n},s.GSUB.readChainSubClassRule=function(e,r){for(var t=s._bin,a={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var o=t.readUshort(e,r);r+=2,1==i&&o--,a[n[i]]=t.readUshorts(e,r,o),r+=2*a[n[i]].length}var o=t.readUshort(e,r);return r+=2,a.subst=t.readUshorts(e,r,2*o),r+=2*a.subst.length,a},s.GSUB.readLigatureSet=function(e,r){var t=s._bin,a=r,n=[],i=t.readUshort(e,r);r+=2;for(var o=0;o<i;o++){var l=t.readUshort(e,r);r+=2,n.push(s.GSUB.readLigature(e,a+l))}return n},s.GSUB.readLigature=function(e,r){var t=s._bin,a={chain:[]};a.nglyph=t.readUshort(e,r),r+=2;var n=t.readUshort(e,r);r+=2;for(var i=0;i<n-1;i++)a.chain.push(t.readUshort(e,r)),r+=2;return a},s.head={},s.head.parse=function(e,r,t){var a=s._bin,n={};a.readFixed(e,r);r+=4,n.fontRevision=a.readFixed(e,r),r+=4;a.readUint(e,r);r+=4;a.readUint(e,r);return r+=4,n.flags=a.readUshort(e,r),r+=2,n.unitsPerEm=a.readUshort(e,r),r+=2,n.created=a.readUint64(e,r),r+=8,n.modified=a.readUint64(e,r),r+=8,n.xMin=a.readShort(e,r),r+=2,n.yMin=a.readShort(e,r),r+=2,n.xMax=a.readShort(e,r),r+=2,n.yMax=a.readShort(e,r),r+=2,n.macStyle=a.readUshort(e,r),r+=2,n.lowestRecPPEM=a.readUshort(e,r),r+=2,n.fontDirectionHint=a.readShort(e,r),r+=2,n.indexToLocFormat=a.readShort(e,r),r+=2,n.glyphDataFormat=a.readShort(e,r),r+=2,n},s.hhea={},s.hhea.parse=function(e,r,t){var a=s._bin,n={};a.readFixed(e,r);return r+=4,n.ascender=a.readShort(e,r),r+=2,n.descender=a.readShort(e,r),r+=2,n.lineGap=a.readShort(e,r),r+=2,n.advanceWidthMax=a.readUshort(e,r),r+=2,n.minLeftSideBearing=a.readShort(e,r),r+=2,n.minRightSideBearing=a.readShort(e,r),r+=2,n.xMaxExtent=a.readShort(e,r),r+=2,n.caretSlopeRise=a.readShort(e,r),r+=2,n.caretSlopeRun=a.readShort(e,r),r+=2,n.caretOffset=a.readShort(e,r),r+=2,r+=8,n.metricDataFormat=a.readShort(e,r),r+=2,n.numberOfHMetrics=a.readUshort(e,r),r+=2,n},s.hmtx={},s.hmtx.parse=function(e,r,t,a){var n=s._bin,i={};i.aWidth=[],i.lsBearing=[];for(var o=0,l=0,u=0;u<a.maxp.numGlyphs;u++)u<a.hhea.numberOfHMetrics&&(o=n.readUshort(e,r),r+=2,l=n.readShort(e,r),r+=2),i.aWidth.push(o),i.lsBearing.push(l);return i},s.kern={},s.kern.parse=function(e,r,t,a){var n=s._bin,i=n.readUshort(e,r);if(r+=2,1==i)return s.kern.parseV1(e,r-2,t,a);var o=n.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},u=0;u<o;u++){r+=2;var t=n.readUshort(e,r);r+=2;var c=n.readUshort(e,r);r+=2;var f=c>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;r=s.kern.readFormat0(e,r,l)}return l},s.kern.parseV1=function(e,r,t,a){var n=s._bin;n.readFixed(e,r);r+=4;var i=n.readUint(e,r);r+=4;for(var o={glyph1:[],rval:[]},l=0;l<i;l++){n.readUint(e,r);r+=4;var u=n.readUshort(e,r);r+=2;n.readUshort(e,r);r+=2;var c=u>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;r=s.kern.readFormat0(e,r,o)}return o},s.kern.readFormat0=function(e,r,t){var a=s._bin,n=-1,i=a.readUshort(e,r);r+=2;a.readUshort(e,r);r+=2;a.readUshort(e,r);r+=2;a.readUshort(e,r);r+=2;for(var o=0;o<i;o++){var l=a.readUshort(e,r);r+=2;var u=a.readUshort(e,r);r+=2;var c=a.readShort(e,r);r+=2,l!=n&&(t.glyph1.push(l),t.rval.push({glyph2:[],vals:[]}));var f=t.rval[t.rval.length-1];f.glyph2.push(u),f.vals.push(c),n=l}return r},s.maxp={},s.maxp.parse=function(e,r,t){var a=s._bin,n={},i=a.readUint(e,r);return r+=4,n.numGlyphs=a.readUshort(e,r),r+=2,65536==i&&(n.maxPoints=a.readUshort(e,r),r+=2,n.maxContours=a.readUshort(e,r),r+=2,n.maxCompositePoints=a.readUshort(e,r),r+=2,n.maxCompositeContours=a.readUshort(e,r),r+=2,n.maxZones=a.readUshort(e,r),r+=2,n.maxTwilightPoints=a.readUshort(e,r),r+=2,n.maxStorage=a.readUshort(e,r),r+=2,n.maxFunctionDefs=a.readUshort(e,r),r+=2,n.maxInstructionDefs=a.readUshort(e,r),r+=2,n.maxStackElements=a.readUshort(e,r),r+=2,n.maxSizeOfInstructions=a.readUshort(e,r),r+=2,n.maxComponentElements=a.readUshort(e,r),r+=2,n.maxComponentDepth=a.readUshort(e,r),r+=2),n},s.U={},s.U.codeToGlyph=function(e,r){var t=e.cmap,a=-1;if(null!=t.p0e4?a=t.p0e4:null!=t.p3e1?a=t.p3e1:null!=t.p1e0&&(a=t.p1e0),-1==a)throw"no familiar platform and encoding!";var n=t.tables[a];if(0==n.format)return r>=n.map.length?0:n.map[r];if(4==n.format){for(var s=-1,i=0;i<n.endCount.length;i++)if(r<=n.endCount[i]){s=i;break}if(-1==s)return 0;if(n.startCount[s]>r)return 0;return 65535&(0!=n.idRangeOffset[s]?n.glyphIdArray[r-n.startCount[s]+(n.idRangeOffset[s]>>1)-(n.idRangeOffset.length-s)]:r+n.idDelta[s])}if(12==n.format){if(r>n.groups[n.groups.length-1][1])return 0;for(var i=0;i<n.groups.length;i++){var o=n.groups[i];if(o[0]<=r&&r<=o[1])return o[2]+(r-o[0])}return 0}throw"unknown cmap table format "+n.format},s.U._getGlyphClass=function(e,r){for(var t=0;t<r.start.length;t++)if(r.start[t]<=e&&r.end[t]>=e)return r.class[t];return 0},s.U.getPairAdjustment=function(e,r,t){if(e.GPOS){for(var a=null,n=0;n<e.GPOS.featureList.length;n++){var i=e.GPOS.featureList[n];if("kern"==i.tag)for(var o=0;o<i.tab.length;o++)2==e.GPOS.lookupList[i.tab[o]].ltype&&(a=e.GPOS.lookupList[i.tab[o]])}if(a)for(var n=0;n<a.tabs.length;n++){var l=a.tabs[n],u=s._lctf.coverageIndex(l.coverage,r);if(-1!=u){var c=0;if(1==l.format){for(var f=l.pairsets[u],o=0;o<f.length;o++)f[o].gid2==t&&(c=f[o]);if(null==c)continue}else if(2==l.format){var d=s.U._getGlyphClass(r,l.classDef1),v=s.U._getGlyphClass(t,l.classDef2);c=l.matrix[d][v]}return c.val1[2]}}}if(e.kern){var h=e.kern.glyph1.indexOf(r);if(-1!=h){var p=e.kern.rval[h].glyph2.indexOf(t);if(-1!=p)return e.kern.rval[h].vals[p]}}return 0},s.U.RTable=[1570,1571,1572,1573,1575,1577,1583,1584,1585,1586,1608,1649,1650,1651,1653,1654,1655,1672,1673,1674,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1728,1731,1732,1733,1734,1735,1736,1737,1738,1739,1741,1743,1746,1747,1749,1774,1775,1808,1813,1814,1815,1816,1817,1822,1832,1834,1836,1839,1869,1881,1882,1883,1899,1900,1905,1907,1908,1912,1913,2112,2118,2119,2121,2132,2151,2153,2154,2218,2219,2220,2222,2225,2226,2233,2757,2759,2761,2762,2766,2767,2768,2769,2770,2781,2785,2788,2799,2945,2947,2948,2949,2953,2956,2958,2959,2961,2985,2986,2987,2988],s.U.stringToGlyphs=function(e,r){var t,a,i,o,l,u,c,f,d,v,h,p,b,g=[],y=[],L=[],m=[],A=[],N=n(r,-1,!1),U=s.U.RTable;for(a=0,i=r.length;a<i;a++)f=r.charCodeAt(a),m.push(f),A.push(0),2765==f||2775==f||43122==f?A[a]=2:1548==f?A[a]=1:f<=63?9!=f&&10!=f&&32!=f&&33!=f&&34!=f&&40!=f&&41!=f&&44!=f&&46!=f&&58!=f&&59!=f&&63!=f||(A[a]=1):f>=1570&&f<=2988&&-1!=U.indexOf(f)&&(A[a]=3);for(a=0,i=r.length;a<i;a++)f=m[a],1!=A[a]&&a<i-2&&4156==(d=m[a+1])&&(m[a]=d,m[a+1]=f,a++);for(a=0,i=r.length;a<i;a++){for(f=m[a],o=0,l=e.length;o<l&&(h=e[o],!(t=s.U.codeToGlyph(h,f)));o++);g.push(t),y.push(t?o:0)}L=m,h=null;for(var x=0;x<g.length;x++)if(b=g[x],h!=y[x]&&(h=e[y[x]],v=h.GSUB),v){var S=A[x-1],w=A[x],B=A[x+1],M=0==x||1==S,_=x==g.length-1||1==B;if(M||3!=S||(M=!0),_||3!=w||(_=!0),_||2!=B||(_=!0),M||2!=w||(M=!0),p=null,p=M?_?h.gsubIsolTable:h.gsubInitTable:_?h.gsubFinaTable:h.gsubMediTable)for(c=0;c<p.length;c++){var O=p[c];for(o=0;o<O.length;o++){var k=O[o],E=s._lctf.coverageIndex(k.coverage,b);-1!=E&&(0==k.fmt?g[x]=E+k.delta:k.newg?g[x]=k.newg[E]:(g[x]=b,console.log(x,b,"subst-error"," original:",r)))}}}h=null;for(var x=0;x<g.length;x++)if(b=g[x],h!=y[x]&&(h=e[y[x]],v=h.GSUB),v&&(p=h.gsubRligLigaTable)){var I=Math.min(3,g.length-x-1);for(c=0;c<p.length;c++){var O=p[c];for(o=0;o<O.length;o++){var k=O[o],E=s._lctf.coverageIndex(k.coverage,b);if(-1!=E){var z=k.vals[E];for(u=0;u<z.length;u++){var F=z[u],C=F.chain.length;if(!(C>I)){for(var T=!0,j=0;j<C;j++)F.chain[j]!=g[x+(1+j)]&&(T=!1);if(T){g[x]=F.nglyph;for(var j=0;j<C;j++)g[x+j+1]=-1}}}}}}}var G=N.indices,R=g.slice(),V=g.slice();for(a=0,i=g.length;a<i;a++)f=G[a],R[a]=g[f],V[a]=L[f];return[R,y,V]}},function(e,r,t){"use strict";function a(e,r,t,a,n,s,i){switch(e){case"line-string":(A(a,"point",r,t)||A(a,"label",r,t))&&S(r,t,a,n,s,i),x(r,t,a,n,s,i);break;case"point-array":S(r,t,a,n,s,i);break;case"polygon":w(r,t,a,n,s,i)}}function n(e,r,t,a,n){for(var s in b.stylesheetLayers){var o=b.stylesheetLayers[s],l=1==o.pack;if("point-array"==e){var u=o["importance-source"];if(!u&&r[0]&&r[0].importance&&(u="$importance"),u)switch(b.reduceMode){case"scr-count2":o.reduce=["top",100,u],o["dynamic-reduce"]=["scr-count2",b.reduceParams[0],b.reduceParams[1]];break;case"scr-count4":o["dynamic-reduce"]=["scr-count4",u];break;case"scr-count5":o["dynamic-reduce"]=["scr-count5",u]}}var c,f,d=o.filter,v=o.reduce;for(d&&((d=o["#filter"])||(o["#filter"]=L(o.filter),d=o["#filter"])),z=0,C=0,T=0,c=0,f=r.length;c<f;c++){var h=r[c];h.properties=h.properties||{},h.id&&(h.properties["#id"]=h.id),d&&!U(d,h,a,n,o,"filter",t,0,!0)||(v?(I[z]=h,z++):l?(_({command:"addRenderJob",type:"pack-begin"}),i(e,h,t,o,c),_({command:"addRenderJob",type:"pack-end"})):i(e,h,t,o,c))}if(v){var p=v[1],g=v[2];switch(v[0]){case"top":case"bottom":if("string"==typeof g&&"@"==g.charAt(0)&&void 0===(g=b.stylesheetConstants[g]))break;if("string"==typeof g&&"$"==g.charAt(0)||"object"==typeof g){var y="object"==typeof g;y||(g=g.substr(1)),p>z&&(p=z);var m,A="top"==v[0],N=0,x=A?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;do{var S=A?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;for(T=C,c=0,f=z;c<f;c++)h=I[c],N?m=h.tmp:(m=y?k(o,null,h,t,g,0):parseFloat(h.properties[g]),h.tmp=m),!isNaN(m)&&(A&&m>=S&&m<x||m<=S&&m>x)&&(S!=m&&(C=T),F[C]=h,C++,S=m);x=S,N++}while(N<p)}break;case"odd":case"even":for(c="odd"==v[0]?1:0,f=z;c<f;c+=2)h=I[c],F[C]=h,C++;case"every":for(p>z&&(p=z),c=0,f=z;c<f;c+=p)h=I[c],F[C]=h,C++}for(c=0,f=C;c<f;c++)h=F[c],l?(_({command:"addRenderJob",type:"pack-begin"}),i(e,F[c],t,o,c),_({command:"addRenderJob",type:"pack-end"})):i(e,F[c],t,o,c)}}}function s(e,r,t,n,s,i){var o,l=A(n,"next-pass",r,t);if(null!=l)for(var u=0,c=l.length;u<c;u++){var f=l[u][0];if(o=m(l[u][1],e,s),A(o,"visible",r,t)){var d=A(o,"selected-layer",r,t),v=""!=d?m(d,e,s):null,h=A(o,"selected-hover-layer",r,t),p=""!=h?m(h,e,s):null,g=A(o,"hover-layer",r,t),y=""!=g?m(g,e,s):null,L=(null!=y?256:0)|(null!=v?512:0)|(null!=p?1024:0),N=b.hitState;null!=v&&(b.hitState=2|L,a(e,r,t,v,s,f,i)),null!=p&&(b.hitState=3|L,a(e,r,t,p,s,f,i)),null!=y&&(b.hitState=1|L,a(e,r,t,y,s,f,i)),a(e,r,t,o,s,f,i),b.hitState=N}}}function i(e,r,t,n,i){if(A(n,"visible",r,t)){var o=A(n,"z-index",r,t);if(A(n,"export-geometry",r,t)&&void 0!==r.id&&!E[r]){switch(e){case"line-string":B(r);break;case"point-array":M(r)}E[r]=!0}var l=r.properties,u=A(n,"selected-layer",r,t),c=""!=u?m(u,e,i):null,f=A(n,"selected-hover-layer",r,t),d=""!=f?m(f,e,i):null,v=A(n,"hover-layer",r,t),h=""!=v?m(v,e,i):null,p=(null!=h?256:0)|(null!=c?512:0)|(null!=d?1024:0);null!=c&&(b.hitState=2|p,a(e,r,t,c,i,o,l),s(e,r,t,c,i,l)),null!=d&&(b.hitState=3|p,a(e,r,t,d,i,o,l),s(e,r,t,d,i,l)),null!=h&&(b.hitState=1|p,a(e,r,t,h,i,o,l),s(e,r,t,h,i,l)),b.hitState=0|p,a(e,r,t,n,i,o,l),s(e,r,t,n,i,l)}}function o(e,r){var t=e.id||"";b.groupId=t;var a=e.bbox;if(a){var s=a[0],i=a[1];b.bboxMin=s,b.bboxMax=i;var o=[a[1][0]-a[0][0],a[1][1]-a[0][1],a[1][2]-a[0][2]],l=e.resolution||4096;b.groupOrigin=[0,0,0],b.forceScale=[o[0]/l,o[1]/l,o[2]/l],_({command:"beginGroup",id:e.id,bbox:[s,i],origin:s});var u=e.points||[];b.featureType="point",n("point-array",u,r,"point",t);var c=e.lines||[];b.featureType="line",n("line-string",c,r,"line",t);var f=e.polygons||[];b.featureType="polygon",n("polygon",f,r,"polygon",t),_({command:"endGroup"}),b.groupOptimize&&O()}}function l(e,r){if("string"==typeof e)try{var t=JSON.parse(e)}catch(e){t=null}else t=e;if(t)for(var a=t.groups||[],n=0,s=a.length;n<s;n++)o(a[n],r)}Object.defineProperty(r,"__esModule",{value:!0});var u=t(0),c=t(3),f=t(2),d=t(4),v=t(5),h=t(6),p=t(1),b=u.a,g=c.a,y=c.b,L=f.a,m=f.b,A=f.c,N=f.d,U=f.e,x=d.a,S=v.a,w=h.a,B=d.b,M=v.b,_=p.a,O=p.b,k=f.f,E=[],I=new Array(1024),z=0,F=new Array(1024),C=0,T=0;self.onmessage=function(e){var r=e.data,t=r.command,a=r.data;switch(t){case"setStylesheet":a&&(b.geocent=a.geocent,b.metricUnits=a.metric,b.reduceMode=a.reduceMode,b.reduceParams=a.reduceParams,N(a.data)),postMessage({command:"ready"});break;case"setFont":g(a),postMessage({command:"ready"});break;case"setFontMap":y(a),postMessage({command:"styleDone"}),postMessage({command:"ready"});break;case"processGeodata":b.tileLod=r.lod||0,b.tileSize=r.tileSize||1,b.pixelSize=r.pixelSize||1,b.pixelFactor=r.dpr||1,b.invPixelFactor=1/b.pixelFactor,a=JSON.parse(a),E=[],l(a,b.tileLod),b.groupOptimize&&O(),postMessage({command:"allProcessed"}),postMessage({command:"ready"})}}}]);',null)}},function(e,t,r){"use strict";var i=function(e){this.inspector=e,this.core=e.core};i.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-graphs-panel {position:absolute;left:10px;top:10px;z-index: 7;background-color: #FFFFFF;padding: 5px;border-radius: 4px;font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;color:#000000;text-align: left;font-size: 12px;display:none;}.vts-graphs-canvas {border: solid 1px #bbb;image-rendering : pixelated;}.vts-graphs-info {padding: 5px 2px;font-size: 10px;}.vts-graphs-button {padding: 2px 5px;display:inline-block;margin-right: 4px;border-radius: 4px;cursor:pointer;}.vts-graphs-button:hover {box-shadow: 0 0 1px #0066ff;}'),this.element=document.createElement("div"),this.element.id="vts-graphs-panel",this.element.innerHTML='<canvas id="vts-graphs-render" class="vts-graphs-canvas" width="900" height="100" ></canvas><div id="vts-graphs-info" class="vts-graphs-info" >&FilledSmallSquare; Frame: 1234 &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Render: 1234 &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: 1234 &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Mesh: 1234 &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> GpuMesh: 1234</div><canvas id="vts-graphs-cache" class="vts-graphs-canvas" width="900" height="100" ></canvas><div id="vts-graphs-info2" class="vts-graphs-info" >&FilledSmallSquare; Cache: 1234 &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Used: 123 &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: 1234 &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> Mesh: &nbsp 1234</div><div id="vts-graphs-rec" class="vts-graphs-button" >Recording On</div><div id="vts-graphs-ref" class="vts-graphs-button" >Refresh On</div><div id="vts-graphs-res" class="vts-graphs-button" >Reset</div><div id="vts-graphs-zoom" class="vts-graphs-button" >Scale: Max value</div><div id="vts-graphs-magnify" class="vts-graphs-button" >Magnify Off</div><div id="vts-graphs-graph" class="vts-graphs-button" >Graph: Cache</div>',this.core.element.appendChild(this.element),this.canvasRender=document.getElementById("vts-graphs-render"),this.canvasCache=document.getElementById("vts-graphs-cache"),this.canvasRenderCtx=this.canvasRender.getContext("2d"),this.canvasCacheCtx=this.canvasCache.getContext("2d"),document.getElementById("vts-graphs-rec").onclick=this.recordingPressed.bind(this),document.getElementById("vts-graphs-rec").onclick=this.recordingPressed.bind(this),document.getElementById("vts-graphs-ref").onclick=this.refreshPressed.bind(this),document.getElementById("vts-graphs-res").onclick=this.resetPressed.bind(this),document.getElementById("vts-graphs-zoom").onclick=this.zoomPressed.bind(this),document.getElementById("vts-graphs-magnify").onclick=this.magnifyPressed.bind(this),document.getElementById("vts-graphs-graph").onclick=this.graphPressed.bind(this),document.getElementById("vts-graphs-render").onmousemove=this.onMouseMove.bind(this),document.getElementById("vts-graphs-render").onmouseout=this.onMouseOut.bind(this),document.getElementById("vts-graphs-cache").onmousemove=this.onMouseMove.bind(this),document.getElementById("vts-graphs-cache").onmouseout=this.onMouseOut.bind(this),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.zoom="max",this.graph="Cache",this.refresh=!0,this.panelVisible=!1},i.prototype.showPanel=function(){this.element.style.display="block",this.panelVisible=!0,this.recordingPressed(!0)},i.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1,this.recordingPressed(!0)},i.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},i.prototype.recordingPressed=function(e){var t=this.core.getMap();t&&(t.stats.recordGraphs=null==e?e:!t.stats.recordGraphs,this.updateGraphsPanel(),this.updateGraphs(null,!0))},i.prototype.refreshPressed=function(){this.refresh=!this.refresh,this.updateGraphsPanel(),this.updateGraphs()},i.prototype.resetPressed=function(){var e=this.core.getMap();e&&(e.stats.resetGraphs(),this.updateGraphs(null,!0))},i.prototype.zoomPressed=function(){switch(this.zoom){case"max":this.zoom="120avrg";break;case"120avrg":this.zoom="180avrg";break;case"180avrg":this.zoom="max"}this.updateGraphsPanel(),this.updateGraphs()},i.prototype.graphPressed=function(){switch(this.graph){case"Cache":this.graph="Polygons";break;case"Polygons":this.graph="Processing";break;case"Processing":this.graph="LODs";break;case"LODs":this.graph="Flux";break;case"Flux":this.graph="Cache"}this.updateGraphsPanel(),this.updateGraphs()},i.prototype.magnifyPressed=function(){this.magnify=!this.magnify,this.magnify?(this.canvasRender.style.width="1400px",this.canvasRender.style.height="200px",this.canvasCache.style.width="1400px",this.canvasCache.style.height="200px",document.getElementById("vts-graphs-magnify").innerHTML="Magnify On"):(this.canvasRender.style.width="900px",this.canvasRender.style.height="100px",this.canvasCache.style.width="900px",this.canvasCache.style.height="100px",document.getElementById("vts-graphs-magnify").innerHTML="Magnify Off"),this.updateGraphsPanel(),this.updateGraphs()},i.prototype.updateGraphsPanel=function(){var e=this.core.getMap();if(e){switch(e.stats.recordGraphs?document.getElementById("vts-graphs-rec").innerHTML="Recording On":document.getElementById("vts-graphs-rec").innerHTML="Recording Off",this.refresh?document.getElementById("vts-graphs-ref").innerHTML="Refresh On":document.getElementById("vts-graphs-ref").innerHTML="Refresh Off",this.zoom){case"max":document.getElementById("vts-graphs-zoom").innerHTML="Scale: Max value";break;case"120avrg":document.getElementById("vts-graphs-zoom").innerHTML="Scale: 100% Avrg";break;case"180avrg":document.getElementById("vts-graphs-zoom").innerHTML="Scale: 50% Avrg"}document.getElementById("vts-graphs-graph").innerHTML="Graph: "+this.graph}},i.prototype.onMouseMove=function(e){var t=e.clientX-this.canvasRender.getBoundingClientRect().left;this.showCursor=!0,this.magnify&&(t=Math.floor(900*t/1400)),this.cursorIndex=t;var r=this.core.getMap();r&&(r.stats.recordGraphs||this.updateGraphs(null))},i.prototype.onMouseOut=function(){this.showCursor=!1,this.updateGraphs(null)},i.prototype.updateGraphs=function(e,t){var r=this.core.getMap();if(r&&(this.refresh||t)&&this.panelVisible){e=e||r.stats;var i=this.canvasRender.width,a=this.canvasRender.height,s=this.canvasRenderCtx,n=e.graphsTimeSamples,o=e.graphsTimeIndex,h=i/n;s.clearRect(0,0,i,a);var l,u,c,d,p,f,m,g,v,y,b,x,M=0,S=0,w=0,A=0,T=0,C=0,P=0,F=e.graphsFrameTimes,L=e.graphsRenderTimes,E=e.graphsCreateTextureTimes,I=e.graphsCreateMeshTimes,N=e.graphsCreateGpuMeshTimes;for(l=0;l<n;l++){S+=F[l],w+=L[l],A+=E[l],T+=I[l],C+=N[l];var B=F[l];B>M&&(M=B),B>0&&P++}for("120avrg"==this.zoom&&(M=S/P*1),"180avrg"==this.zoom&&(M=S/P*.5),v=a/M,l=0;l<n;l++)d=o+l,d%=n,s.fillStyle="#000000",s.fillRect(l*h,a,1,-F[d]*v),s.fillStyle="#ff0000",s.fillRect(l*h,a,1,-L[d]*v),s.fillStyle="#0000ff",s.fillRect(l*h,a,1,-E[d]*v),g=a-E[d]*v,s.fillStyle="#007700",s.fillRect(l*h,g,1,-I[d]*v),g-=I[d]*v,s.fillStyle="#00ff00",s.fillRect(l*h,g,1,-N[d]*v);switch(this.showCursor?(s.fillStyle="#aa00aa",d=this.cursorIndex%n,s.fillRect(Math.floor(d*h)-1,0,1,a),s.fillRect(Math.floor(d*h)+1,0,1,a),d=(this.cursorIndex+o)%n,m="&FilledSmallSquare; Frame: "+F[d].toFixed(2)+' &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Render: '+L[d].toFixed(2)+' &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: '+E[d].toFixed(2)+' &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Meshes: '+I[d].toFixed(2)+' &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> GpuMeshes: '+N[d].toFixed(2)+"</div>"):m="&FilledSmallSquare; Frame: "+Math.round(S)+' &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Render: '+Math.round(w)+' &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: '+Math.round(A)+' &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Meshes: '+Math.round(T)+' &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> GpuMeshes: '+Math.round(C)+"</div>",document.getElementById("vts-graphs-info").innerHTML=m,i=this.canvasCache.width,a=this.canvasCache.height,s=this.canvasCacheCtx,h=i/n,s.clearRect(0,0,i,a),this.graph){case"Cache":v=a/(r.gpuCache.maxCost+r.resourcesCache.maxCost+r.metatileCache.maxCost);var _=0,R=0,k=0,z=0,U=0,D=0,G=e.graphsCpuMemoryMetatiles,V=e.graphsCpuMemoryUsed,O=e.graphsGpuMemoryRender;for(x=e.graphsGpuMemoryGeodata,E=e.graphsGpuMemoryTextures,I=e.graphsGpuMemoryMeshes,l=0;l<n;l++)_=G[l]>_?G[l]:_,R=V[l]>R?V[l]:R,k=E[l]>k?E[l]:k,z=I[l]>z?I[l]:z,U=x[l]>U?x[l]:U,D=O[l]>D?O[l]:D;for(l=0;l<n;l++)d=o+l,d%=n,p=G[d]+I[d]+E[d]+x[d]+V[d],s.fillStyle="#000000",s.fillRect(l*h,a,1,-p*v),p-=V[d],s.fillStyle="#0000ff",s.fillRect(l*h,a,1,-p*v),p-=E[d],s.fillStyle="#009999",s.fillRect(l*h,a,1,-p*v),p-=x[d],s.fillStyle="#007700",s.fillRect(l*h,a,1,-p*v),p-=I[d],s.fillStyle="#ff0000",s.fillRect(l*h,a,1,-p*v),p=O[d],s.fillStyle="#ffff00",s.fillRect(l*h,a-p*v,1,1);this.showCursor?(d=(this.cursorIndex+o)%n,m='<span style="color:#555">&FilledSmallSquare;</span> Total: '+Math.ceil((G[d]+V[d]+E[d]+I[d])/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> CPU: '+Math.ceil(V[d]/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> GPU: '+Math.ceil((E[d]+I[d])/1048576)+'MB &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Te: '+Math.ceil(E[d]/1048576)+'MB &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Me: '+Math.ceil(I[d]/1048576)+'MB &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Ge: '+Math.ceil(x[d]/1048576)+'MB &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Met: '+Math.ceil(G[d]/1048576)+'MB &nbsp <span style="color:#ffff00">&FilledSmallSquare;</span> Render: '+Math.ceil(O[d]/1048576)+"MB</div>"):m='<span style="color:#555">&FilledSmallSquare;</span> Total: '+Math.round((_+R+k+z)/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> CPU: '+Math.ceil(R/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> GPU: '+Math.ceil((k+z)/1048576)+'MB &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Te '+Math.ceil(k/1048576)+'MB &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Me: '+Math.ceil(z/1048576)+'MB &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Ge: '+Math.ceil(U/1048576)+'MB &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Met: '+Math.ceil(_/1048576)+'MB &nbsp <span style="color:#ffff00">&FilledSmallSquare;</span> Render: '+Math.ceil(D/1048576)+"MB</div>";break;case"Polygons":case"Processing":y=0,b=99999999999,P=0,f="Polygons"==this.graph?e.graphsPolygons:e.graphsBuild;var j=0;for(l=0;l<n;l++)y=f[l]>y?f[l]:y,f[l]>0&&(b=f[l]<b?f[l]:b,j+=f[l],P++);for(v=a/y,l=0;l<n;l++)d=o+l,d%=n,s.fillStyle="#007700",s.fillRect(l*h,a,1,-f[d]*v);this.showCursor?(d=(this.cursorIndex+o)%n,m='<span style="color:#007700">&FilledSmallSquare;</span> '+this.graph+" Max: "+Math.round(f[d])+"</div>"):(m='<span style="color:#007700">&FilledSmallSquare;</span> '+this.graph+" Max: "+y+"</div>",m+=" &nbsp Min: "+b,m+=" &nbsp Avrg: "+Math.round(j/P)+"</div>");break;case"LODs":for(y=0,f=e.graphsLODs,l=0;l<n;l++)y=f[l][0]>y?f[l][0]:y;v=a/y,s.fillStyle="#000000",s.fillRect(0,0,i,a);var H;for(l=0;l<n;l++)for(d=o+l,d%=n,g=a,H=f[d][1],u=0,c=H.length;u<c;u++)H[u]&&(s.fillStyle="hsl("+23*u%360+",100%,50%)",p=Math.round(H[u]*v),s.fillRect(l*h,g,1,-p),g-=p);if(this.showCursor)for(d=(this.cursorIndex+o)%n,m="LODs:"+f[d][0],H=f[d][1],u=0,c=H.length;u<c;u++)H[u]&&(m+='<span style="color:hsl('+23*u%360+',100%,50%)">&FilledSmallSquare;</span>'+u+":"+H[u]);else m="LODs:"+f[d][0];m+="</div>";break;case"Flux":var q=0,J=0,X=0,W=0,Y=0,Z=0,Q=0,K=0,$=0,ee=0,te=0,re=0,ie=0,ae=0;for(E=e.graphsFluxTextures,I=e.graphsFluxMeshes,x=e.graphsFluxGeodatas,l=0;l<n;l++){var se=E[l][0][0]+I[l][0][0];q=se>q?se:q,se=E[l][1][0]+I[l][1][0],q=se>q?se:q,se=E[l][0][1]+I[l][0][1],J=se>J?se:J,se=E[l][1][1]+I[l][1][1],J=se>J?se:J,X=E[l][0][0]>X?E[l][0][0]:X,W=E[l][0][1]>W?E[l][0][1]:W,Y=E[l][1][0]>Y?E[l][1][0]:Y,Z=E[l][1][1]?E[l][1][1]:Z,Q=I[l][0][0]>Q?I[l][0][0]:Q,K=I[l][0][1]>K?I[l][0][1]:K,$=I[l][1][0]>$?I[l][1][0]:$,ee=I[l][1][1]>ee?I[l][1][1]:ee,te=x[l][0][0]>te?x[l][0][0]:te,re=x[l][0][1]>re?x[l][0][1]:re,ie=x[l][1][0]>ie?x[l][1][0]:ie,ae=x[l][1][1]>ae?x[l][1][1]:ae}v=(.25*a-2)/q;var ne=(.25*a-2)/J,oe=Math.floor(.25*a),he=Math.floor(.75*a);for(l=0;l<n;l++){d=o+l,d%=n;var le=oe,ue=oe+1,ce=he,de=he+1;s.fillStyle="#0000aa",s.fillRect(l*h,le,1,-E[d][0][0]*v),s.fillRect(l*h,ue,1,E[d][1][0]*v),s.fillRect(l*h,ce,1,-E[d][0][1]*ne),s.fillRect(l*h,de,1,E[d][1][1]*ne),le-=E[d][0][0]*v,ue+=E[d][1][0]*v,ce-=E[d][0][1]*ne,de+=E[d][1][1]*ne,s.fillStyle="#007700",s.fillRect(l*h,le,1,-I[d][0][0]*v),s.fillRect(l*h,ue,1,I[d][1][0]*v),s.fillRect(l*h,ce,1,-I[d][0][1]*ne),s.fillRect(l*h,de,1,I[d][1][1]*ne),le-=I[d][0][0]*v,ue+=I[d][1][0]*v,ce-=I[d][0][1]*ne,de+=I[d][1][1]*ne,s.fillStyle="#009999",s.fillRect(l*h,le,1,-x[d][0][0]*v),s.fillRect(l*h,ue,1,x[d][1][0]*v),s.fillRect(l*h,ce,1,-x[d][0][1]*ne),s.fillRect(l*h,de,1,x[d][1][1]*ne),s.fillStyle="#aaaaaa",s.fillRect(0,Math.floor(.5*a),i,1),s.fillStyle="#dddddd",s.fillRect(0,oe,i,1),s.fillRect(0,he,i,1)}this.showCursor?(d=(this.cursorIndex+o)%n,m='<span style="color:#007700">&FilledSmallSquare;</span> Textures Count +/-: '+E[d][0][0]+"/"+E[d][1][0],m+=" &nbsp Size +/-: "+(E[d][0][1]/1024/1024).toFixed(2)+"/"+(E[d][1][1]/1024/1024).toFixed(2),m+=' &nbsp <span style="color:#0000aa">&FilledSmallSquare;</span> Meshes Count +/-: '+I[d][0][0]+"/"+I[d][1][0],m+=" &nbsp Size +/-: "+(I[d][0][1]/1024/1024).toFixed(2)+"/"+(I[d][1][1]/1024/1024).toFixed(2),m+=' &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Geodata Count +/-: '+x[d][0][0]+"/"+x[d][1][0],m+=" &nbsp Size +/-: "+(x[d][0][1]/1024/1024).toFixed(2)+"/"+(x[d][1][1]/1024/1024).toFixed(2),m+="</div>"):(m='<span style="color:#007700">&FilledSmallSquare;</span> Textures Count +/-: '+X+"/"+Y,m+=" &nbsp Size +/-: "+(W/1024/1024).toFixed(2)+"/"+(Z/1024/1024).toFixed(2),m+=' &nbsp <span style="color:#0000aa">&FilledSmallSquare;</span> Meshes Count +/-: '+Q+"/"+$,m+=" &nbsp Size +/-: "+(K/1024/1024).toFixed(2)+"/"+(ee/1024/1024).toFixed(2),m+=' &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Geodata Count +/-: '+te+"/"+ie,m+=" &nbsp Size +/-: "+(re/1024/1024).toFixed(2)+"/"+(ae/1024/1024).toFixed(2),m+="</div>")}this.showCursor&&(s.fillStyle="#aa00aa",d=this.cursorIndex%n,s.fillRect(Math.floor(d*h)-1,0,1,a),s.fillRect(Math.floor(d*h)+1,0,1,a)),document.getElementById("vts-graphs-info2").innerHTML=m}},t.a=i},function(e,t,r){"use strict";var i=function(e){this.inspector=e,this.core=e.core};i.prototype.init=function(){document.addEventListener("keyup",this.onKeyUp.bind(this),!1),document.addEventListener("keypress",this.onKeyPress.bind(this),!1),document.addEventListener("keydown",this.onKeyDown.bind(this),!1)},i.prototype.onKeyDown=function(e){void 0===e&&(e=window.event),this.altDown=e.altKey,this.ctrlDown=e.ctrlKey,this.shiftDown=e.shiftKey,this.onKeyUp(e,!0)},i.prototype.onKeyPress=function(e){this.onKeyUp(e,!0)},i.prototype.onKeyUp=function(e,t){void 0===e&&(e=window.event);var r=this.core.getMap(),i=this.inspector;if(r){var a=r.draw.debug;this.altDown=e.altKey,this.ctrlDown=e.ctrlKey,this.shiftDown=e.shiftKey;var s=!1,n=!0;if(e){var o;if(o=window.event?window.event.keyCode:e.which?e.which:e.charCode,this.shiftDown&&this.ctrlDown)switch(o){case 68:case 100:i.preventDefault(e)}if(this.shiftDown&&!0!==t){if(this.ctrlDown)switch(o){case 68:case 100:i.enableInspector(),this.diagnosticMode=!0,s=!0}if(this.diagnosticMode){switch(n=!0,o){case 67:case 99:r.config.mapDegradeHorizon=!r.config.mapDegradeHorizon;break;case 49:case 50:case 51:case 48:break;case 72:case 104:a.heightmapOnly=!a.heightmapOnly;break;case 81:case 113:var h=r.getPosition();console.log("pos-before: "+JSON.stringify(h.pos)),r.convert.convertPositionViewMode(h,"obj"==h.getViewMode()?"subj":"obj"),console.log("new mode: "+h.getViewMode()),console.log("pos-after: "+JSON.stringify(h.pos)),r.setPosition(h),this.altDown&&"obj"!=h.getViewMode()?r.camera.near=.1:r.camera.near=2,i.preventDefault(e);break;case 80:case 112:r.renderer.saveScreenshot("file","vts-screenshot.png","png");break;case 83:case 115:i.stats.switchPanel();break;case 86:case 118:i.layers.switchPanel();break;case 69:case 101:i.stylesheets.switchPanel();break;case 84:case 116:i.replay.switchPanel();break;case 66:case 98:a.drawBBoxes=!a.drawBBoxes;break;case 87:case 119:var l=a.drawWireframe+1;a.drawWireframe=l>2?0:l;break;case 70:case 102:a.drawWireframe=3!=a.drawWireframe?3:0;break;case 77:case 109:r.loaderSuspended=!r.loaderSuspended,console.log("loader state "+r.loaderSuspended);break;case 74:case 106:a.drawEarth=!a.drawEarth,s=!0;break;case 88:case 120:a.drawFog=!a.drawFog,s=!0;break;case 82:case 114:i.graphs.switchPanel();break;case 79:case 111:r.camera.camera.setOrtho(!r.camera.camera.getOrtho());break;case 76:case 108:i.drawRadar=!i.drawRadar;break;case 90:case 122:a.maxZoom=!a.maxZoom;break;case 78:case 110:i.shakeCamera=!i.shakeCamera;break;default:n=!1}n&&(s=!0)}}if(this.diagnosticMode&&a.drawWireframe&&!t&&o>=96&&o<=105&&(this.altDown?(a.drawTestData=o-96,this.ctrlDown&&(a.drawTestData+=10)):a.drawTestMode=o-96,s=!0),this.diagnosticMode&&i.drawRadar&&!this.shiftDown&&!t){switch(n=!0,o){case 43:case 107:null==i.radarLod&&(i.radarLod=8),i.radarLod++;break;case 45:case 109:null==i.radarLod&&(i.radarLod=8),i.radarLod=Math.max(0,i.radarLod-1);break;case 42:case 106:i.radarLod=null;break;default:n=!1}n&&(s=!0)}if(this.diagnosticMode&&a.drawBBoxes&&!this.shiftDown&&!t){switch(n=!0,o){case 76:case 108:a.drawLods=!a.drawLods;break;case 80:case 112:a.drawPositions=!a.drawPositions;break;case 84:case 116:a.drawTextureSize=!a.drawTextureSize;break;case 70:case 102:a.drawFaceCount=!a.drawFaceCount;break;case 71:case 103:a.drawGeodataOnly=!a.drawGeodataOnly;break;case 68:case 100:a.drawDistance=!a.drawDistance;break;case 78:case 110:a.drawNodeInfo=!a.drawNodeInfo;break;case 77:case 109:a.drawMeshBBox=!a.drawMeshBBox;break;case 73:case 105:a.drawIndices=!a.drawIndices;break;case 66:case 98:a.drawBoundLayers=!a.drawBoundLayers;break;case 83:case 115:a.drawSurfaces=!a.drawSurfaces;break;case 67:case 99:a.drawCredits=!a.drawCredits;break;case 79:case 111:a.drawOrder=!a.drawOrder;break;case 65:case 97:a.drawLabelBoxes=!a.drawLabelBoxes;break;case 69:case 101:a.debugTextSize=2==a.debugTextSize?3:2;break;case 88:case 120:r.config.mapPreciseBBoxTest=!r.config.mapPreciseBBoxTest;break;case 90:case 122:r.config.mapPreciseDistanceTest=!r.config.mapPreciseDistanceTest;break;case 75:case 107:a.drawGPixelSize=!a.drawGPixelSize;break;default:n=!1}n&&(s=!0)}}s&&(r.markDirty(),i.preventDefault(e))}},i.prototype.setParameter=function(e,t){var r=this.core.getMap(),i=this.inspector;if(r){var a=r.draw.debug;switch(e){case"debugBBox":a.drawBBoxes=!0;var s=function(e){return-1!=t.indexOf(e)};s("L")&&(a.drawLods=!0),s("P")&&(a.drawPositions=!0),s("T")&&(a.drawTextureSize=!0),s("F")&&(a.drawFaceCount=!0),s("G")&&(a.drawGeodataOnly=!0),s("D")&&(a.drawDistance=!0),s("N")&&(a.drawNodeInfo=!0),s("M")&&(a.drawMeshBBox=!0),s("I")&&(a.drawIndices=!0),s("B")&&(a.drawBoundLayers=!0),s("S")&&(a.drawSurfaces=!0),s("C")&&(a.drawCredits=!0),s("O")&&(a.drawOrder=!0),s("E")&&(a.debugTextSize=3),s("K")&&(a.drawGPixelSize=!0);break;case"debugLBox":a.drawLabelBoxes=!0;break;case"debugNoEarth":a.drawEarth=!1;break;case"debugShader":a.drawWireframe=parseInt(t);break;case"debugHeightmap":a.heightmapOnly=!0;break;case"debugGridCells":a.drawGridCells=!0;break;case"debugRadar":i.enableInspector(),i.drawRadar=!0,i.radarLod=parseInt(t),isNaN(i.radarLod)&&(i.radarLod=null)}r.markDirty()}},t.a=i},function(e,t,r){"use strict";var i=r(2),a=r(3),s=r(4),n=r(119),o=r(123),h=r(118),l=r(121),u=r(122),c=r(124),d=i.e,p=a.a,f=s.a,m=n.a,g=o.a,v=h.a,y=l.a,b=u.a,x=c.a,M=function(e){this.core=e,this.enabled=!1,this.input=new m(this),this.stats=new g(this),this.graphs=new v(this),this.layers=new y(this),this.replay=new b(this),this.stylesheets=new x(this),this.core.config.inspector&&this.input.init(),this.shakeCamera=!1,this.drawReplayCamera=!1,this.drawRadar=!1,this.radarLod=null,this.debugValue=0,this.measureMode=!1,this.measurePoints=[]};M.prototype.enableInspector=function(){this.enabled||(this.stats.init(),this.graphs.init(),this.layers.init(),this.replay.init(),this.stylesheets.init(),this.circleImage||(this.circleImage=f.loadImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QAAAAAAAD5Q7t/AAAACW9GRnMAAAAgAAAA4ACD+EAUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVRYw+2VPwqDMBTG3dz1Am56EnH2XLroETxGuwc3Z7cOdhY8QJpfSUBspUvStJAPPggvD973/uQligICAgL+DKViqygUV02hbaXLwJlio7gpyhNu2idzEXwwgfI8H+u6vnZdN/V9P3EuimLcCRlsiyArGcfxjWDLsmzyAGzc4aNFNDZ7/iw7AeQH4LNrh5WZYLgkJTaZCyHuVVVdkiSZ0zSdOWMzlaBFWkRrQ4A4Zk/A4wBie1MFYUMAz0wybCYAmR8FUAlzj6+2r18TgM2VAO8tOB1Cyk7mrofQ+zP0voheVjHtIBjDxjrmvCu7k1Xs/TP6ie84ICDAGR5uCYdPo0MWiAAAAABJRU5ErkJggg==",function(){this.circleTexture=this.core.getRendererInterface().createTexture({source:this.circleImage})}.bind(this))),this.core.on("map-update",this.onMapUpdate.bind(this)),this.enabled=!0)},M.prototype.setParameter=function(e,t){this.input.setParameter(e,t)},M.prototype.addStyle=function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},M.prototype.doNothing=function(e){return e.stopPropagation(),!1},M.prototype.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},M.prototype.onMapUpdate=function(){var e=this.core.getMapInterface();if(e){this.shakeCamera&&e.redraw();var t,r,i,a,s,n,o,h=this.core.getRendererInterface();if(this.replay.drawGlobe){o=e.convertCoordsFromPhysToCameraSpace([0,0,0]);var l=this.core.getRenderer();l.draw.drawTBall(o,6371e3,l.progStardome,this.replay.globeTexture,6371e3,!0)}if(this.replay.drawCamera){for(s=this.replay.cameraLines,n=[],t=0,r=s.length;t<r;t++)n.push(e.convertCoordsFromPhysToCanvas(s[t]));for(h.drawLineString({points:n,size:2,screenSpace:!0,color:[0,128,255,255],depthTest:!1,blend:!1}),s=this.replay.cameraLines3,t=0,r=s.length;t<r;t++){for(n=[],i=0,a=s[t].length;i<a;i++)n.push(e.convertCoordsFromPhysToCanvas(s[t][i]));h.drawLineString({points:n,size:2,screenSpace:!0,color:[0,255,128,255],depthTest:!1,blend:!1})}for(s=this.replay.cameraLines2,t=0,r=s.length;t<r;t++){for(n=[],i=0,a=s[t].length;i<a;i++)n.push(e.convertCoordsFromPhysToCanvas(s[t][i]));h.drawLineString({points:n,size:2,screenSpace:!0,color:[0,255,255,255],depthTest:!1,blend:!1})}var u=e.getCameraInfo(),c=e.convertCoordsFromPhysToCameraSpace(this.replay.cameraLines[0]),f=d.create(this.replay.cameraMatrix);f[12]=c[0],f[13]=c[1],f[14]=c[2];var m=[255,128,128,0,0,0,0,0,0,0,0,0,0,.5,0,0];d.multiply(u.viewMatrix,f,f);var g=[0,0,0,0,0,0,0,0,0];d.toInverseMat3(f,g),h.setState(this.replay.frustumState),h.drawMesh({mesh:this.replay.frustumMesh,texture:null,shader:"shaded",shaderVariables:{uMV:["mat4",f],uNorm:["mat3",g],uMaterial:["mat4",m]}})}if(this.drawRadar&&this.circleTexture){var v=e.getPosition(),y=v.getViewExtent()/64,b=new Array(256);for(i=0;i<16;i++)for(t=0;t<16;t++){var x=t*y-8*y,M=i*y-8*y,S=Math.atan2(M,x),w=Math.sqrt(x*x+M*M),A=e.movePositionCoordsTo(v,p.degrees(S),w),T=A.getCoords(),C=e.convertCoordsFromNavToCanvas([T[0],T[1],0],"float",this.radarLod);b[16*i+t]=C}var P=new Array(16);for(i=0;i<16;i++){for(t=0;t<16;t++)P[t]=b[16*i+t];h.drawLineString({points:P,size:2,screenSpace:!0,color:[0,255,255,255],depthTest:!1,blend:!1})}for(t=0;t<16;t++){for(i=0;i<16;i++)P[i]=b[16*i+t];h.drawLineString({points:P,size:2,screenSpace:!0,color:[0,255,255,255],depthTest:!1,blend:!1})}for(t=0,r=b.length;t<r;t++)o=b[t],h.drawImage({rect:[o[0]-10,o[1]-10,20,20],texture:this.circleTexture,color:[255,0,255,255],depth:o[2],depthTest:!1,blend:!0})}}},t.a=M},function(e,t,r){"use strict";var i=function(e){this.inspector=e,this.core=e.core};i.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-layers-panel {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;display: none;padding:15px;font-size: 14px;position: absolute;right: 10px;bottom: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-layers-panel button {max-width: 23px;max-height: 21px;}#vts-layers-panel-title {margin-bottom: 3px;}#vts-layers-views-panel {margin-top: 5px;float: left;}#vts-layers-views-items {width: 191px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;}#vts-layers-surfaces-panel {margin-top: 5px;float: left;}#vts-layers-surfaces-items {width: 150px;overflow-y: scroll;overflow-x: hidden;height: 200px;border-top: 1px solid #ddd;border-bottom: 1px solid #ddd;}#vts-layers-boundlayers-panel {margin-top: 5px;float: left;}#vts-layers-boundlayers-items {width: 250px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;border-right: none;}#vts-layers-freelayers-panel {margin-top: 5px;float: left;}#vts-layers-freelayers-items {width: 150px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;}#vts-layers-fl-properties-panel {margin-top: 5px;float: left;}#vts-layers-fl-properties-items {width: 250px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;border-right: none;}#vts-layers-json-panel {margin-top: 5px;float: right;}#vts-layers-json-text {width: 200px;resize: none;height: 180px;border: 1px solid #ddd;white-space: pre;padding: 0px;}#vts-layers-json-text2 {width: 200px;height: 21px;border: 1px solid #ddd;}.vts-layers-panel-title {margin: 0px;margin-bottom: 5px;}.vts-layers-item {width: 100%;}.vts-layers-item input[type=number]{width: 43px;}.vts-layers-name {width: 120px;display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}.vts-layers-name2 {width: 126px;display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}#vts-layers-fl-properties-style {width: 175px;height: 21px;}.vts-surface-item {width: 100%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}'),this.element=document.createElement("div"),this.element.id="vts-layers-panel",this.element.innerHTML='<div id="vts-layers-views-panel"><p class="vts-layers-panel-title">Named Views:</p><div id="vts-layers-views-items"></div></div><div id="vts-layers-surfaces-panel"><p class="vts-layers-panel-title">Surfaces:</p><div id="vts-layers-surfaces-items"></div></div><div id="vts-layers-boundlayers-panel"><p class="vts-layers-panel-title">Surface Bound Layers:</p><div id="vts-layers-boundlayers-items"></div></div><div id="vts-layers-freelayers-panel"><p class="vts-layers-panel-title">Free Layers:</p><div id="vts-layers-freelayers-items"></div></div><div id="vts-layers-fl-properties-panel"><p class="vts-layers-panel-title">Free Layer Properties:</p><div id="vts-layers-fl-properties-items"></div></div><div id="vts-layers-json-panel"><p class="vts-layers-panel-title">Definition:</p><textarea id="vts-layers-json-text" cols="48"></textarea><br/><input id="vts-layers-json-text2" type="text"></div>',this.core.element.appendChild(this.element),this.viewItems=document.getElementById("vts-layers-views-items"),this.surfacesItems=document.getElementById("vts-layers-surfaces-items"),this.boundLayersItems=document.getElementById("vts-layers-boundlayers-items"),this.freeLayersItems=document.getElementById("vts-layers-freelayers-items"),this.freeLayersPropertiesItems=document.getElementById("vts-layers-fl-properties-items"),this.jsonText=document.getElementById("vts-layers-json-text"),this.jsonText2=document.getElementById("vts-layers-json-text2"),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.views=[],this.panelVisible=!1,this.panelInitialized=!1,this.currentView="",this.currentSurface="",this.currentFreeLayer=""},i.prototype.initViews=function(){var e=this.core.getMap();if(e){var t,r,i,a,s,n,o,h,l,u,c,d=e.getNamedViews(),p="--initial--";for(this.views[p]={surfaces:{},freeLayers:{},original:JSON.parse(JSON.stringify(e.getView()))},r=0,i=d.length;r<i;r++)l=d[r],this.views[l]={surfaces:{},freeLayers:{},original:JSON.parse(JSON.stringify(e.getNamedView(l).getInfo()))};this.currentView=p,d=this.views;for(var f in d){for(l=d[f],u=e.getSurfaces(),r=0,i=u.length;r<i;r++){for(p=u[r],y=e.getSurface(p),n=e.getBoundLayers(),o=[],a=0,s=n.length;a<s;a++)o.push({id:n[a],alpha:100,enabled:!1});l.surfaces[p]={enabled:!1,layers:o}}var m=e.getFreeLayers();for(r=0,i=m.length;r<i;r++){for(p=m[r],n=e.getBoundLayers(),o=[],a=0,s=n.length;a<s;a++)o.push({id:n[a],alpha:100,enabled:!1});t=e.getFreeLayer(p);var g=t.getInfo();l.freeLayers[p]={enabled:!1,style:null,originalStyle:g.style,depthShift:0,depthShift2:0,depthShift3:0,layers:o}}var v=l.original.surfaces;for(c in v)if(n=v[c],l.surfaces[c]){var y=l.surfaces[c];for(y.enabled=!0,r=0,i=n.length;r<i;r++)"string"==typeof n[r]?-1!=(h=this.findIdInArray(y.layers,n[r]))&&y.layers[h]&&(y.layers[h].enabled=!0,y.layers.splice(r,0,y.layers.splice(h,1)[0])):(p=n[r].id,-1!=(h=this.findIdInArray(y.layers,p))&&y.layers[h]&&(y.layers[h].enabled=!0,y.layers[h].alpha=n[r].alpha?100*parseFloat(n[r].alpha):100,y.layers.splice(r,0,y.layers.splice(h,1)[0])))}var b=l.original.freeLayers;for(c in b){var x=b[c];if(l.freeLayers[c]){t=l.freeLayers[c],t.enabled=!0;var M=x.depthOffset||[0,0,0];for(t.depthShift=M[0],t.depthShift2=M[1],t.depthShift3=M[2],t.style=x.style,n=x.boundLayers||[],r=0,i=n.length;r<i;r++)"string"==typeof n[r]?-1!=(h=this.findIdInArray(t.layers,n[r]))&&t.layers[h]&&(t.layers[h].enabled=!0,t.layers.splice(r,0,t.layers.splice(h,1)[0])):(p=n[r].id,-1!=(h=this.findIdInArray(t.layers,p))&&y.layers[h]&&(t.layers[h].enabled=!0,t.layers[h].alpha=n[r].alpha?100*parseFloat(n[r].alpha):100,t.layers.splice(r,0,y.layers.splice(h,1)[0])))}}}}},i.prototype.findIdInArray=function(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r].id==t)return r;return-1},i.prototype.buildViews=function(){if(this.core.getMap()){var e=this.views,t="";for(var r in e)t+='<div class="vts-views-item" id="vts-views-item-'+r+'"><div class="vts-layers-name2">'+r+'</div><button id="vts-views-cbutton-'+r+'" type="button" title="Clone">C</button><button id="vts-views-xbutton-'+r+'" type="button" title="Remove">X</button></div>';this.viewItems.innerHTML=t;for(r in e){i="vts-views-cbutton-"+r,document.getElementById(i).onclick=this.switchView.bind(this,r,i,"clone"),i="vts-views-xbutton-"+r,document.getElementById(i).onclick=this.switchView.bind(this,r,i,"remove");var i="vts-views-item-"+r;document.getElementById(i).onclick=this.selectView.bind(this,r)}}},i.prototype.buildSurfaces=function(){var e,t,r=this.views[this.currentView],i=r.surfaces,a="",s=null;for(t in i)a+='<div id="vts-surface-item-'+t+'" class="vts-surface-item"><input id="vts-surface-checkbox-'+t+'" type="checkbox"/><span title='+t+">"+t+"</span></div>",null===s&&(s=t);this.surfacesItems.innerHTML=a,this.currentSurface=s;for(t in i)i[t].enabled&&(e="vts-surface-checkbox-"+t,document.getElementById(e).checked=!0);for(t in i)e="vts-surface-checkbox-"+t,document.getElementById(e).onchange=this.switchSurface.bind(this,t,e),e="vts-surface-item-"+t,document.getElementById(e).onclick=this.selectSurface.bind(this,t)},i.prototype.buildBoundLayers=function(e){var t=this.views[this.currentView],r="";if(t.surfaces[e])for(var i=t.surfaces[e].layers,a=0,s=i.length;a<s;a++){var n=i[a];r+='<div class="vts-layers-item"><input id="vts-boundlayer-checkbox-'+n.id+'" type="checkbox" '+(n.enabled?"checked":"")+'/><div class="vts-layers-name">'+n.id+'</div><input id="vts-boundlayer-spinner-'+n.id+'" type="number" title="Alpha" min="0" max="100" step="10" value="'+n.alpha+'"><button id="vts-boundlayer-ubutton-'+n.id+'" type="button" title="Move Above">&uarr;</button><button id="vts-boundlayer-dbutton-'+n.id+'" type="button" title="Move Bellow">&darr;</button></div>'}if(this.boundLayersItems.innerHTML=r,t.surfaces[e])for(a=0,s=i.length;a<s;a++){var o="vts-boundlayer-checkbox-"+i[a].id;document.getElementById(o).onchange=this.switchBoundLayer.bind(this,i[a].id,o,"enable"),o="vts-boundlayer-spinner-"+i[a].id,document.getElementById(o).onchange=this.switchBoundLayer.bind(this,i[a].id,o,"alpha"),o="vts-boundlayer-ubutton-"+i[a].id,document.getElementById(o).onclick=this.switchBoundLayer.bind(this,i[a].id,o,"up"),o="vts-boundlayer-dbutton-"+i[a].id,document.getElementById(o).onclick=this.switchBoundLayer.bind(this,i[a].id,o,"down")}},i.prototype.buildFreeLayers=function(){var e=this.views[this.currentView],t=e.freeLayers,r="";for(var i in t)r+='<div class="vts-surface-item" id="vts-freelayer-item-'+i+'"><input id="vts-freelayer-checkbox-'+i+'" type="checkbox" '+(t[i].enabled?"checked":"")+"/><span title="+i+">"+i+"</span></div>";this.freeLayersItems.innerHTML=r;for(i in t){var a="vts-freelayer-checkbox-"+i;document.getElementById(a).onchange=this.switchFreeLayer.bind(this,i,a),a="vts-freelayer-item-"+i,document.getElementById(a).onclick=this.selectFreeLayer.bind(this,i)}},i.prototype.buildFreeLayerProperties=function(e){var t,r,i,a=this.core.getMap(),s=this.views[this.currentView],n=s.freeLayers[e].layers,o="";if(a&&a.getFreeLayer(e)){switch(a.getFreeLayer(e).getInfo().type){case"mesh":case"mesh-tiles":for(o+='<div class="vts-layers-item"><div class="vts-layers-name" style="width:90px">DepthOffset:</div><input id="vts-fl-properties-depth-shift" type="number" min="-100" max="100" step="1" value="'+s.freeLayers[e].depthShift+'"><input id="vts-fl-properties-depth-shift2" type="number" min="-100" max="100" step="1" value="'+s.freeLayers[e].depthShift2+'"><input id="vts-fl-properties-depth-shift3" type="number" min="-100" max="100" step="1" value="'+s.freeLayers[e].depthShift3+'"></div>',o+='<div class="vts-layers-item"><div class="vts-layers-name">BoundLayers:</div></div>',t=0,r=n.length;t<r;t++){var h=n[t];o+='<div class="vts-layers-item"><input id="vts-fl-properties-checkbox-'+h.id+'" type="checkbox" '+(h.enabled?"checked":"")+'/><div class="vts-layers-name">'+h.id+'</div><input id="vts-fl-properties-spinner-'+h.id+'" type="number" title="Alpha" min="0" max="100" step="10" value="'+h.alpha+'"><button id="vts-fl-properties-ubutton-'+h.id+'" type="button" title="Move Above">&uarr;</button><button id="vts-fl-properties-dbutton-'+h.id+'" type="button" title="Move Bellow">&darr;</button></div>'}for(this.freeLayersPropertiesItems.innerHTML=o,i="vts-fl-properties-depth-shift",document.getElementById(i).onchange=this.switchFreeLayerProperty.bind(this,i,"depthShift"),i="vts-fl-properties-depth-shift2",document.getElementById(i).onchange=this.switchFreeLayerProperty.bind(this,i,"depthShift2"),i="vts-fl-properties-depth-shift3",document.getElementById(i).onchange=this.switchFreeLayerProperty.bind(this,i,"depthShift3"),t=0,r=n.length;t<r;t++)i="vts-fl-properties-checkbox-"+n[t].id,document.getElementById(i).onchange=this.switchFreeLayerBoundLayer.bind(this,n[t].id,i,"enable"),i="vts-fl-properties-spinner-"+n[t].id,document.getElementById(i).onchange=this.switchFreeLayerBoundLayer.bind(this,n[t].id,i,"alpha"),i="vts-fl-properties-ubutton-"+n[t].id,document.getElementById(i).onclick=this.switchFreeLayerBoundLayer.bind(this,n[t].id,i,"up"),i="vts-fl-properties-dbutton-"+n[t].id,document.getElementById(i).onclick=this.switchFreeLayerBoundLayer.bind(this,n[t].id,i,"down");break;case"geodata":case"geodata-tiles":o+='<div class="vts-layers-item"><div class="vts-layers-name" style="width:50px">Style:</div><select id="vts-layers-fl-properties-style">';var l=a.getStylesheets(),u=l.indexOf(s.freeLayers[e].style||s.freeLayers[e].originalStyle);for(t=0,r=l.length;t<r;t++)o+='<option value="'+l[t]+'" '+(t==u?"selected":"")+">"+l[t]+"</option>";o+="</select></div>",this.freeLayersPropertiesItems.innerHTML=o,i="vts-layers-fl-properties-style",document.getElementById(i).onchange=this.switchFreeLayerProperty.bind(this,i,"style")}}},i.prototype.selectView=function(e){if(this.views[e]){var t;this.currentView&&(t=document.getElementById("vts-views-item-"+this.currentView))&&(t.style.backgroundColor="initial"),t=document.getElementById("vts-views-item-"+e),t.style.backgroundColor="#ddd",this.currentView=e,this.buildSurfaces(),this.selectSurface(this.currentSurface),this.buildFreeLayers(),this.applyMapView()}},i.prototype.switchView=function(e,t,r){var i=this.views;for(var a in this.views)if(a==e){switch(r){case"clone":for(var s=2;;){if(!i[e+" #"+s]){i[e+" #"+s]=JSON.parse(JSON.stringify(i[e]));break}s++}this.buildViews();break;case"remove":var n=0;for(a in i)n++;if(n>1)if(delete i[e],this.buildViews(),this.currentView==e)for(a in i){this.selectView(a);break}else this.selectView(this.currentView)}break}},i.prototype.switchSurface=function(e,t){var r=document.getElementById(t);this.views[this.currentView].surfaces[e].enabled=r.checked,this.applyMapView()},i.prototype.selectSurface=function(e){var t;this.currentSurface&&(t=document.getElementById("vts-surface-item-"+this.currentSurface),t.style.backgroundColor="initial"),t=document.getElementById("vts-surface-item-"+e),t&&(t.style.backgroundColor="#ddd"),this.currentSurface=e,this.buildBoundLayers(this.currentSurface)},i.prototype.switchBoundLayer=function(e,t,r){for(var i=document.getElementById(t),a=this.views[this.currentView],s=a.surfaces[this.currentSurface].layers,n=0,o=s.length;n<o;n++)if(s[n].id==e){switch(r){case"enable":s[n].enabled=i.checked;break;case"alpha":s[n].alpha=parseInt(i.value,10);break;case"up":s.splice(Math.max(0,n-1),0,s.splice(n,1)[0]),this.selectSurface(this.currentSurface);break;case"down":s.splice(Math.max(0,n+1),0,s.splice(n,1)[0]),this.selectSurface(this.currentSurface)}break}this.applyMapView()},i.prototype.switchFreeLayer=function(e,t){var r=document.getElementById(t);this.views[this.currentView].freeLayers[e].enabled=r.checked,this.applyMapView()},i.prototype.selectFreeLayer=function(e){var t;this.currentFreeLayer&&(t=document.getElementById("vts-freelayer-item-"+this.currentFreeLayer),t.style.backgroundColor="initial"),t=document.getElementById("vts-freelayer-item-"+e),t.style.backgroundColor="#ddd",this.currentFreeLayer=e,this.buildFreeLayerProperties(this.currentFreeLayer)},i.prototype.switchFreeLayerBoundLayer=function(e,t,r){for(var i=document.getElementById(t),a=this.views[this.currentView],s=a.freeLayers[this.currentFreeLayer].layers,n=0,o=s.length;n<o;n++)if(s[n].id==e){switch(r){case"enable":s[n].enabled=i.checked;break;case"alpha":s[n].alpha=parseInt(i.value,10);break;case"up":s.splice(Math.max(0,n-1),0,s.splice(n,1)[0]),this.selectFreeLayer(this.currentFreeLayer);break;case"down":s.splice(Math.max(0,n+1),0,s.splice(n,1)[0]),this.selectFreeLayer(this.currentFreeLayer)}break}this.applyMapView()},i.prototype.switchFreeLayerProperty=function(e,t){var r=document.getElementById(e),i=this.views[this.currentView],a=i.freeLayers[this.currentFreeLayer];switch(t){case"depthShift":a.depthShift=parseInt(r.value,10);break;case"depthShift2":a.depthShift2=parseInt(r.value,10);break;case"depthShift3":a.depthShift3=parseInt(r.value,10);break;case"style":a.style=r.value}this.applyMapView()},i.prototype.applyMapView=function(e){var t,r,i,a={surfaces:{},freeLayers:{}},s=this.views[this.currentView],n=s.surfaces;for(var o in n)if(n[o].enabled){var h=[];for(i=n[o].layers,t=0,r=i.length;t<r;t++)i[t].enabled&&(i[t].alpha<100?h.push({id:i[t].id,alpha:(.01*i[t].alpha).toFixed(2)}):h.push(i[t].id));a.surfaces[o]=h}var l=s.freeLayers;for(o in l)if(l[o].enabled){var u=[];for(i=l[o].layers,t=0,r=i.length;t<r;t++)i[t].enabled&&(i[t].alpha<100?u.push({id:i[t].id,alpha:parseFloat((.01*i[t].alpha).toFixed(2))}):u.push(i[t].id));a.freeLayers[o]={},u.length>0&&(a.freeLayers[o].boundLayers=u),l[o].style&&l[o].style!=l[o].originalStyle&&(a.freeLayers[o].style=l[o].style),0==l[o].depthShift&&0==l[o].depthShift2&&0==l[o].depthShift3||(a.freeLayers[o].depthOffset=[parseFloat(l[o].depthShift.toFixed(2)),parseFloat(l[o].depthShift2.toFixed(2)),parseFloat(l[o].depthShift3.toFixed(2))])}if(this.jsonText.value=JSON.stringify(a,null,"  "),this.jsonText2.value=encodeURIComponent(JSON.stringify(a)),!e){var c=this.core.getMap();if(!c)return;c.setView(a)}},i.prototype.showPanel=function(){this.element.style.display="block",this.panelVisible=!0,this.updatePanel()},i.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},i.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},i.prototype.updatePanel=function(){this.panelInitialized||(this.panelInitialized=!1,this.initViews(),this.buildViews(),this.selectView(this.currentView))},t.a=i},function(e,t,r){"use strict";var i=r(6),a=r(3),s=r(2),n=a.a,o=i.a,h=s.b,l=s.e,u=function(e){this.inspector=e,this.core=e.core};u.prototype.init=function(){var e=this.inspector;e.addStyle("#vts-replay-panel {font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;display: none;padding:15px;width: 618px;font-size: 14px;position: absolute;right: 10px;top: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-replay-panel-left {width: 253px;height: 100%;float: left;}#vts-replay-panel-right {width: 340px;height: 100%;float: right;}#vts-replay-items {width: 240px;overflow-x: hidden;border: 1px solid #ddd;padding-right: 5px;}.vts-replay-item {width: 100%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}#vts-replay-lod-slider {width: 240px;}#vts-replay-lod-text {width: 60px;margin-left: 10px;margin-right: 10px;}#vts-replay-lod-single {margin-left: 10px;}#vts-replay-time-slider {width: 330px;}#vts-replay-time-text {width: 60px;margin-left: 10px;margin-right: 10px;}#vts-replay-time-single {margin-left: 10px;}#vts-replay-panel-gtime canvas{border: 1px solid #555;}#vts-replay-panel-gtime span{font-size: 10px;}#vts-replay-info {width: 240px;height: 140px;overflow-x: hidden;border: 1px solid #ddd;padding-right: 5px;margin-top: 10px;font-size: 12px;word-wrap: break-word;}"),this.element=document.createElement("div"),this.element.id="vts-replay-panel",this.element.innerHTML='<div id="vts-replay-panel-left"><div id="vts-replay-items"></div><div id="vts-replay-panel-lod"><input id="vts-replay-lod-slider" type="range" min="0" max="30" step="1" value="30" /><br/><span>LOD:</span><input id="vts-replay-lod-text" type="text" value="30"/><input id="vts-replay-lod-up" type="button" value="<"/><input id="vts-replay-lod-down" type="button" value=">"/><input id="vts-replay-lod-single" type="checkbox"/><span>Single</span></div><div id="vts-replay-info"></div></div><div id="vts-replay-panel-right"><div id="vts-replay-panel-gtime"><span id="vts-replay-info-meshes">Meshes Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-meshes" width=340 height=30></canvas><br/><span id="vts-replay-info-textures">Internal Textures Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-textures" width=340 height=30></canvas><br/><span id="vts-replay-info-textures2">External Textures Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-textures2" width=340 height=30></canvas><br/><span id="vts-replay-info-geodata">Geodata Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-geodata" width=340 height=30></canvas><br/><span id="vts-replay-info-metatiles">Metatiles Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-metatiles" width=340 height=30></canvas><br/><span id="vts-replay-info-intervals">Interval Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-intervals" width=340 height=30></canvas><br/><span id="vts-replay-info-threads">Threads Min/Max: 0/0 Avg. 0 </span><br/><canvas id="vts-replay-canvas-threads" width=340 height=30></canvas><br/></div><div id="vts-replay-panel-time"><input id="vts-replay-time-slider" type="range" min="0" max="2000" value="0" /><br/><span>File:</span><input id="vts-replay-time-text" type="text" value="0"/><input id="vts-replay-time-up" type="button" value="<"/><input id="vts-replay-time-down" type="button" value=">"/><input id="vts-replay-time-single" type="checkbox"/><span>Single</span></div></div>',this.core.element.appendChild(this.element),this.items=document.getElementById("vts-replay-items"),this.lodSlider=document.getElementById("vts-replay-lod-slider"),this.lodSlider.onchange=this.onSliderChange.bind(this,"lod"),this.lodSlider.oninput=this.onSliderChange.bind(this,"lod"),this.lodText=document.getElementById("vts-replay-lod-text"),this.lodText.onchange=this.onTextChange.bind(this,"lod"),document.getElementById("vts-replay-lod-up").onclick=this.onSliderChange.bind(this,"lod","down"),document.getElementById("vts-replay-lod-down").onclick=this.onSliderChange.bind(this,"lod","up"),document.getElementById("vts-replay-lod-single").onclick=this.onSliderChange.bind(this,"lod","single"),this.timeSlider=document.getElementById("vts-replay-time-slider"),this.timeSlider.onchange=this.onSliderChange.bind(this,"time"),this.timeSlider.oninput=this.onSliderChange.bind(this,"time"),this.timeText=document.getElementById("vts-replay-time-text"),this.timeText.onchange=this.onTextChange.bind(this,"time"),this.timeInfo=document.getElementById("vts-replay-info"),document.getElementById("vts-replay-time-up").onclick=this.onSliderChange.bind(this,"time","down"),document.getElementById("vts-replay-time-down").onclick=this.onSliderChange.bind(this,"time","up"),document.getElementById("vts-replay-time-single").onclick=this.onSliderChange.bind(this,"time","single"),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.infoMeshes=document.getElementById("vts-replay-info-meshes"),this.ctxMeshes=document.getElementById("vts-replay-canvas-meshes").getContext("2d"),this.infoTextures=document.getElementById("vts-replay-info-textures"),this.ctxTextures=document.getElementById("vts-replay-canvas-textures").getContext("2d"),this.infoTextures2=document.getElementById("vts-replay-info-textures2"),this.ctxTextures2=document.getElementById("vts-replay-canvas-textures2").getContext("2d"),this.infoGeodata=document.getElementById("vts-replay-info-geodata"),this.ctxGeodata=document.getElementById("vts-replay-canvas-geodata").getContext("2d"),this.infoMetatiles=document.getElementById("vts-replay-info-metatiles"),this.ctxMetatiles=document.getElementById("vts-replay-canvas-metatiles").getContext("2d"),this.infoIntervals=document.getElementById("vts-replay-info-intervals"),this.ctxIntervals=document.getElementById("vts-replay-canvas-intervals").getContext("2d"),this.infoThreads=document.getElementById("vts-replay-info-threads"),this.ctxThreads=document.getElementById("vts-replay-canvas-threads").getContext("2d"),this.cameraLines=[],this.cameraLines2=[],this.cameraLines3=[],this.cameraGenarated=!1,this.panelVisible=!1},u.prototype.showPanel=function(){this.buildReplayCombo(),this.element.style.display="block",this.panelVisible=!0;var e=this.core.getMap();if(e){var t=e.draw.replay;this.updateFileInfo(t.loadedIndex),this.updateLoadGraphs()}},u.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},u.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},u.prototype.onSliderChange=function(e,t){if("lod"==e)switch(t){case"up":this.lodSlider.stepUp(),this.lodText.value=this.lodSlider.value;break;case"down":this.lodSlider.stepDown(),this.lodText.value=this.lodSlider.value;break;default:this.lodText.value=this.lodSlider.value}else switch(t){case"up":this.timeSlider.stepUp(),this.timeText.value=this.timeSlider.value;break;case"down":this.timeSlider.stepDown(),this.timeText.value=this.timeSlider.value;break;default:this.timeText.value=this.timeSlider.value}var r=this.core.getMap();if(r){var i=r.draw.replay;"lod"==e?(i.lod=parseFloat(this.lodText.value),i.singleLod=document.getElementById("vts-replay-lod-single").checked):(i.loadedIndex=parseFloat(this.timeText.value),i.singleLodedIndex=document.getElementById("vts-replay-time-single").checked,this.updateFileInfo(i.loadedIndex),this.updateLoadGraphs()),r.markDirty()}},u.prototype.onTextChange=function(e){"lod"==e?this.lodSlider.value=this.lodText.value:this.timeSlider.value=this.timeText.value;var t=this.core.getMap();if(t){var r=t.draw.replay;"lod"==e?r.lod=parseFloat(this.lodText.value):(r.loadedIndex=parseFloat(this.timeText.value),this.updateFileInfo(r.loadedIndex),this.updateLoadGraphs()),t.markDirty()}},u.prototype.generateCameraLines=function(e){var t=this.core.getRendererInterface(),r=e.position,i=e.center;this.cameraLines=[r,i],this.cameraLines2=[[r],[r],[r],[r]];var a=16,s=this.core.getMap(),o=s.camera.getRotationviewMatrix(),u=l.create();l.inverse(o,u),this.cameraMatrix=u;for(var c,d,p,f,m=Math.tan(n.radians(s.camera.getFov())),g=m*s.camera.getAspect(),v=Math.sqrt(m*m+g*g),y=Math.atan(v/1),b=e.cameraDistance/a,x=.5*b*Math.tan(y),M=x*s.camera.getAspect(),S=0;S<a;S++)c=[-M,-x,-b],d=[M,-x,-b],p=[M,x,-b],f=[-M,x,-b],h.scale(c,S+1),h.scale(d,S+1),h.scale(p,S+1),h.scale(f,S+1),l.multiplyVec3(u,c),l.multiplyVec3(u,d),l.multiplyVec3(u,p),l.multiplyVec3(u,f),h.add(c,r),h.add(d,r),h.add(p,r),h.add(f,r),this.cameraLines2[0].push(c),this.cameraLines2[1].push(d),this.cameraLines2[2].push(p),this.cameraLines2[3].push(f);for(this.cameraLines3=[[r],[r],[r],[r]],a=256,b=(e.distance+12742e3*1.1)/a,x=.5*b*Math.tan(y),M=x*s.camera.getAspect(),S=0;S<a;S++)c=[-M,-x,-b],d=[M,-x,-b],p=[M,x,-b],f=[-M,x,-b],h.scale(c,S+1),h.scale(d,S+1),h.scale(p,S+1),h.scale(f,S+1),l.multiplyVec3(u,c),l.multiplyVec3(u,d),l.multiplyVec3(u,p),l.multiplyVec3(u,f),h.add(c,r),h.add(d,r),h.add(p,r),h.add(f,r),this.cameraLines3[0].push(c),this.cameraLines3[1].push(d),this.cameraLines3[2].push(p),this.cameraLines3[3].push(f);c=[-M,-x,-b],d=[M,-x,-b],p=[M,x,-b],f=[-M,x,-b],h.scale(c,a),h.scale(d,a),h.scale(p,a),h.scale(f,a),r=[0,0,0];var w=[r[0],r[1],r[2],c[0],c[1],c[2],d[0],d[1],d[2],r[0],r[1],r[2],d[0],d[1],d[2],p[0],p[1],p[2],r[0],r[1],r[2],p[0],p[1],p[2],f[0],f[1],f[2],r[0],r[1],r[2],f[0],f[1],f[2],c[0],c[1],c[2]],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];this.frustumState=t.createState({blend:!0,zwrite:!1,ztest:!0,culling:!1}),this.frustumMesh=t.createMesh({vertices:w,uvs:A,normals:T}),this.cameraGenarated=!0},u.prototype.itemButton=function(e,t){var r=this.core.getMap();if(r){var i=r.draw.replay;switch(e){case"DrawnTiles":i.storeTiles=!0;break;case"DrawnTilesFreeLayers":i.storeFreeTiles=!0;break;case"TracedNodes":i.storeNodes=!0;break;case"TracedNodesFreeLayers":i.storeFreeNodes=!0;break;case"LoadSequence":i.storeLoaded="S"==t,"S"==t?(i.loadedIndex=0,i.loaded=[]):(this.updateFileInfo(i.loadedIndex),this.updateLoadGraphs());break;case"Camera":if("S"==t){var a=i.camera={distance:r.camera.distance,position:r.camera.position.slice(),vector:r.camera.vector.slice(),center:r.camera.center.slice(),height:r.camera.height};i.cameraPos=r.getPosition(),this.generateCameraLines(a)}else i.cameraPos&&r.setPosition(i.cameraPos)}r.markDirty()}},u.prototype.switchItem=function(e,t){var r=document.getElementById(t),i=this.core.getMap();if(i){var a=i.draw.replay;switch(e){case"DrawnTiles":a.drawTiles=r.checked;break;case"DrawnTilesFreeLayers":a.drawFreeTiles=r.checked;break;case"TracedNodes":a.drawNodes=r.checked;break;case"TracedNodesFreeLayers":a.drawFreeNodes=r.checked;break;case"LoadSequence":a.drawLoaded=r.checked;break;case"Camera":this.cameraGenarated||this.itemButton("Camera"),this.drawCamera=r.checked;break;case"Globe":var s=this.core.getRenderer();if(!this.globeTexture){this.globeTexture=new o(s.gpu,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAEACAMAAADyTj5VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0Mzk4RkVFMzlGNjUxMUU2OTBDM0I0OEM1NjU0RURBMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0Mzk4RkVFNDlGNjUxMUU2OTBDM0I0OEM1NjU0RURBMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjQzOThGRUUxOUY2NTExRTY5MEMzQjQ4QzU2NTRFREEzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjQzOThGRUUyOUY2NTExRTY5MEMzQjQ4QzU2NTRFREEzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+5rvbhAAAAAZQTFRFwcHBLS0tMDfv/wAAAiZJREFUeNrs2LENAEEIA0HTf9ME5DTgIZn8ta+TnLjymzuW6kMIwIcQgA8hAAqAAmBdAM4O4E/wBPgQAqAAKAAKgAKgHcDZAegJoAAoAAqAAqAAaAdwdgB6AigACoACoAAoANoBnB2AngAKgAKgACgACoB2AGcHoCeAAqAAKAAKgAKgHcDZAegJoAAoAAqAAqAAaAdwdgB6AigACoACoAAoANoBnB2AngAKgAKgACgACoB2AGcHoCeAAqAAKAAKgAKgHcDZAegJoAAoAAqAAqAAaAdwdgB6AigACoACEIAPIQAfwg7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABSAAH0IAPoQAfAgB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQAPxcAQYAZt2IEFFJhxsAAAAASUVORK5CYII=",this.core,null,!0)}this.drawGlobe=r.checked,this.drawGlobe=this.drawGlobe}i.markDirty()}},u.prototype.updateLoadGraphs=function(){var e=this.core.getMap();if(e){var t=e.draw.replay,r=t.loaded,i=t.loadedIndex;this.timeSlider.max=r.length;var a,s=340;this.ctxMeshes.fillStyle="#000000",this.ctxMeshes.fillRect(0,0,s,30),this.ctxTextures.fillStyle="#000000",this.ctxTextures.fillRect(0,0,s,30),this.ctxTextures2.fillStyle="#000000",this.ctxTextures2.fillRect(0,0,s,30),this.ctxGeodata.fillStyle="#000000",this.ctxGeodata.fillRect(0,0,s,30),this.ctxMetatiles.fillStyle="#000000",this.ctxMetatiles.fillRect(0,0,s,30),this.ctxIntervals.fillStyle="#000000",this.ctxIntervals.fillRect(0,0,s,30),this.ctxThreads.fillStyle="#000000",this.ctxThreads.fillRect(0,0,s,30);var n,o=Math.floor(t.loadedIndex/s)*s,h=339,l=o;for(o=0;o<h;o++)if(n=r[o+l]){switch(n.kind){case"mesh":a=this.ctxMeshes;break;case"texture-in":a=this.ctxTextures;break;case"texture-ex":a=this.ctxTextures2;break;case"geodata":a=this.ctxGeodata;break;case"metatile":a=this.ctxMetatiles;break;default:continue}var u=Math.round(Math.min(255,60+20*Math.max(1,n.duration/300)));a.fillStyle="rgb("+u+","+u+","+u+")";var c=n.duration/300*30;a.fillRect(o,30,1,-c),u=Math.round(Math.min(255,60+20*Math.max(1,n.interval/300))),this.ctxIntervals.fillStyle="rgb("+u+","+u+","+u+")",c=n.interval/300*30,this.ctxIntervals.fillRect(o,30,1,-c),this.ctxThreads.fillStyle="rgb(80,80,80)",c=n.threads/e.config.mapDownloadThreads*30,this.ctxThreads.fillRect(o,30,1,-c)}var d=Number.MAX_VALUE,p=0,f=0,m=0,g=Number.MAX_VALUE,v=0,y=0,b=0,x=Number.MAX_VALUE,M=0,S=0,w=0,A=Number.MAX_VALUE,T=0,C=0,P=0,F=Number.MAX_VALUE,L=0,E=0,I=0,N=Number.MAX_VALUE,B=0,_=0,R=0,k=Number.MAX_VALUE,z=0,U=0,D=0;for(h=r.length,o=0;o<h;o++)if(n=r[o]){switch(n.kind){case"mesh":n.duration<d&&(d=n.duration),n.duration>p&&(p=n.duration),f+=n.duration,m++;break;case"texture-in":n.duration<g&&(g=n.duration),n.duration>v&&(v=n.duration),y+=n.duration,b++;break;case"texture-ex":n.duration<x&&(x=n.duration),n.duration>M&&(M=n.duration),S+=n.duration,w++;break;case"geodata":n.duration<A&&(A=n.duration),n.duration>T&&(T=n.duration),C+=n.duration,P++;break;case"metatile":n.duration<F&&(F=n.duration),n.duration>L&&(L=n.duration),E+=n.duration,I++;break;default:continue}n.threads<N&&(N=n.threads),n.threads>B&&(B=n.threads),_+=n.threads,R++,n.threads<k&&(k=n.threads),n.threads>z&&(z=n.threads),U+=n.threads,D++}i-=l,this.ctxMeshes.fillStyle="#ff0000",this.ctxMeshes.fillRect(i-1,0,1,30),this.ctxMeshes.fillRect(i+1,0,1,30),this.ctxTextures.fillStyle="#ff0000",this.ctxTextures.fillRect(i-1,0,1,30),this.ctxTextures.fillRect(i+1,0,1,30),this.ctxTextures2.fillStyle="#ff0000",this.ctxTextures2.fillRect(i-1,0,1,30),this.ctxTextures2.fillRect(i+1,0,1,30),this.ctxGeodata.fillStyle="#ff0000",this.ctxGeodata.fillRect(i-1,0,1,30),this.ctxGeodata.fillRect(i+1,0,1,30),this.ctxMetatiles.fillStyle="#ff0000",this.ctxMetatiles.fillRect(i-1,0,1,30),this.ctxMetatiles.fillRect(i+1,0,1,30),this.ctxIntervals.fillStyle="#ff0000",this.ctxIntervals.fillRect(i-1,0,1,30),this.ctxIntervals.fillRect(i+1,0,1,30),this.ctxThreads.fillStyle="#ff0000",this.ctxThreads.fillRect(i-1,0,1,30),this.ctxThreads.fillRect(i+1,0,1,30),m||(d=0,p=0),b||(g=0,v=0),w||(x=0,M=0),P||(A=0,T=0),I||(F=0,L=0),R||(N=0,B=0),D||(k=0,z=0),f=m?f/m:0,y=b?y/b:0,S=w?S/w:0,C=P?C/P:0,E=I?E/I:0,U=D?U/D:0,_=R?_/R:0,this.infoMeshes.innerHTML="Meshes Min/Max/Avg/Count: "+d.toFixed(0)+"/"+p.toFixed(0)+"/"+f.toFixed(1)+"/"+m,this.infoTextures.innerHTML="Internal Textures Min/Max/Avg/Count: "+g.toFixed(0)+"/"+v.toFixed(0)+"/"+y.toFixed(1)+"/"+b,this.infoTextures2.innerHTML="External Textures Min/Max/Avg/Count: "+x.toFixed(0)+"/"+M.toFixed(0)+"/"+S.toFixed(1)+"/"+w,this.infoGeodata.innerHTML="Geodata Min/Max/Avg/Count: "+A.toFixed(0)+"/"+T.toFixed(0)+"/"+C.toFixed(1)+"/"+P,this.infoMetatiles.innerHTML="Metatiles Min/Max/Avg/Count: "+F.toFixed(0)+"/"+L.toFixed(0)+"/"+E.toFixed(1)+"/"+I,this.infoIntervals.innerHTML="Intervals Min/Max/Avg: "+k.toFixed(0)+"/"+z.toFixed(0)+"/"+U.toFixed(1),this.infoThreads.innerHTML="Threads Min/Max/Avg: "+N+"/"+B+"/"+_.toFixed(1)}},u.prototype.updateFileInfo=function(e){var t=this.core.getMap();if(t){var r=t.draw.replay,i=r.loaded[e];this.timeInfo.innerHTML=i?"Resource Kind: "+i.kind+"<br/>Time: "+i.time.toFixed(2)+"<br/>Duration: "+i.duration.toFixed(2)+"<br/>Interval: "+i.interval.toFixed(2)+"<br/>Priority: "+i.priority.toFixed(2)+"<br/>Threads: "+i.threads+"<br/>"+i.url:""}},u.prototype.buildReplayCombo=function(){if(this.core.getMap()){var e,t,r,i=[["Drawn Tiles",1],["Drawn Tiles - Free Layers",1],["Traced Nodes",1],["Traced Nodes - Free Layers",1],["Load Sequence",2],["Camera",2],["Globe",0]],a=["DrawnTiles","DrawnTilesFreeLayers","TracedNodes","TracedNodesFreeLayers","LoadSequence","Camera","Globe"],s="";for(e=0,t=i.length;e<t;e++)s+='<div id="vts-replay-item-'+a[e]+'" class="vts-replay-item"><input id="vts-replay-checkbox-'+a[e]+'" type="checkbox"/><span title='+i[e][0]+">"+i[e][0]+"&nbsp;&nbsp;</span>",i[e][1]>0&&(s+='<input id="vts-replay-sbutton-'+a[e]+'" type="button" value="S"/>'),i[e][1]>1&&(s+='<input id="vts-replay-fbutton-'+a[e]+'" type="button" value="'+("Camera"==a[e]?"R":"F")+'"/>'),s+="</div>";for(this.items.innerHTML=s,e=0,t=i.length;e<t;e++)r="vts-replay-checkbox-"+a[e],document.getElementById(r).onchange=this.switchItem.bind(this,a[e],r),i[e][1]>0&&(r="vts-replay-sbutton-"+a[e],document.getElementById(r).onclick=this.itemButton.bind(this,a[e],"S")),i[e][1]>1&&(r="vts-replay-fbutton-"+a[e],document.getElementById(r).onclick=this.itemButton.bind(this,a[e],"Camera"==a[e]?"R":"F"))}},t.a=u},function(e,t,r){"use strict";var i=r(13),a=function(e){this.inspector=e,this.core=e.core};a.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-stats-panel {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;display: none;padding:15px;width: 305px;font-size: 14px;position: absolute;right: 10px;top: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-stats-panel-info {margin-top: 5px;margin-bottom: 3px;overflow: hidden;}#vts-stats-panel-info table {color:#000000;text-align: left;font-size: 12px;}#vts-stats-panel-info table td {vertical-align: top;}#vts-stats-panel-pos {width: 100%;}'),this.element=document.createElement("div"),this.element.id="vts-stats-panel",this.element.innerHTML='<span id="vts-stats-panel-title">Render statistics &nbsp;&nbsp;&nbsp;v'+r.i(i.a)()+'</h3><p id="vts-stats-panel-info"></p><input id="vts-stats-panel-pos" type="text">',this.core.element.appendChild(this.element),this.infoElement=document.getElementById("vts-stats-panel-info"),this.posElement=document.getElementById("vts-stats-panel-pos"),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.panelVisible=!1},a.prototype.showPanel=function(){this.element.style.display="block",this.panelVisible=!0},a.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},a.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},a.prototype.updateStatsPanel=function(e){if(this.infoElement){var t=this.inspector,r="FPS: "+Math.round(e.fps)+"<br/>Render time: "+Math.round(1e3*e.renderTime)+"<br/> - resources: "+Math.round(e.gpuRenderUsed/1048576)+"MB<br/> - topdown: "+Math.round(e.gpuNeeded/1048576)+"MB<br/>GPU Cache: "+Math.round(e.gpuUsed/1048576)+"MB<br/> - textures: "+Math.round(e.gpuTextures/1048576)+"MB<br/> - meshes: "+Math.round(e.gpuMeshes/1048576)+"MB<br/> - geodata: "+Math.round(e.gpuGeodata/1048576)+"MB<br/>CPU Cache: "+Math.round(e.resourcesUsed/1048576)+"MB<br/>Metaile Cache: "+Math.round(e.metaUsed/1048576)+"MB<br/>Draw calls: "+e.drawCalls+"<br/>Polygons: "+e.drawnFaces+"<br/><br/>Terrain Height: "+e.heightTerrain.toFixed(2)+"<br/>- float: "+e.heightDelta.toFixed(2)+"<br/>- desired lod: "+e.heightLod.toFixed(2)+"<br/>- used lod: "+e.heightNode.toFixed(2)+"<br/>- used source: "+(2==e.heightClass?"navtile":1==e.heightClass?"node":"---")+"<br/>Terrain Radar Lod: "+t.radarLod+"<br/><br/>Loaded/Errors: "+e.loadedCount+" / "+e.loadErrorCount+"<br/>Load time: "+(.001*(e.loadLast-e.loadFirst)).toFixed(2)+"s <br/>",i=this.core.renderer;i&&(r+="<br/>Render jobs: "+i.totalJobs+"<br/>Drawn jobs: "+i.drawnJobs+"<br/>Jobs total time: "+Math.round(1e3*(i.jobsTimer2-i.jobsTimer1))+"<br/>Jobs reduce time: "+Math.round(1e3*i.jobsTimer4)+"<br/>"),e.debugStr&&(r+=e.debugStr+"<br/>");for(var a="Metatiles: "+e.processedMetatiles+"<br/>Metanodes: "+e.processedNodes+" / "+e.usedNodes+"<br/>GeodataTiles: "+e.drawnGeodataTiles+"<br/>GVGeodataTiles: "+e.drawnGeodataTilesPerLayer+"<br/><br/>Tiles: "+e.drawnTiles+"<br/>",s=0,n=e.renderedLods.length;s<n;s++)e.renderedLods[s]&&(a+="LOD "+s+": "+e.renderedLods[s]+"<br/>");var o='<table style="width:305px"><tr><td>'+r+"</td><td>"+a+"</td></tr></table>";this.infoElement.innerHTML=o;var h=this.core.getMap();if(null!=h){var l=h.getPosition(),u="";u+=l.getViewMode()+",";var c=l.getCoords();u+=c[0]+","+c[1]+","+l.getHeightMode()+","+c[2].toFixed(2)+",";var d=l.getOrientation();u+=d[0].toFixed(2)+","+d[1].toFixed(2)+","+d[2].toFixed(2)+",",u+=l.getViewExtent().toFixed(2)+","+l.getFov().toFixed(2),this.posElement.value!=u&&(this.posElement.value=u)}}},t.a=a},function(e,t,r){"use strict";var i=function(e){this.inspector=e,this.core=e.core};i.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-stylesheets-panel * {all: initial;}#vts-stylesheets-panel {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;display: none;padding:15px;width: 1200px;height: 350px;font-size: 14px;position: absolute;right: 10px;bottom: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-stylesheets-panel-header {width: 100%;height: 28px;}#vts-stylesheets-panel-combo {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 13px;border: 1px solid #a9a9a9;width: 1070px;height: 17px;padding: 2px;margin-bottom: 5px;-webkit-appearance: menulist;-moz-appearance: menulist;}#vts-stylesheets-panel-combo option {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 13px;}#vts-stylesheets-panel-update-button {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 14px;float: right;background-color: #dedede;padding: 3px 2px 2px 2px;border: 1px solid #a0a0a0;border-radius: 2px;margin-right: 5px;}#vts-stylesheets-panel-hide-button {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 14px;float: right;background-color: #dedede;padding: 3px 2px 2px 2px;border: 1px solid #a0a0a0;border-radius: 2px;}#vts-stylesheets-panel-text {font-family: monospace;border: 1px solid #a9a9a9;padding: 2px 0px 0px 2px;width: 100%;height: 300px;resize: none;white-space: pre;}'),this.element=document.createElement("div"),this.element.id="vts-stylesheets-panel",this.element.innerHTML='<div id="vts-stylesheets-panel-header"><select id="vts-stylesheets-panel-combo"></select><button id="vts-stylesheets-panel-hide-button" type="button" title="Hide">Hide</button><button id="vts-stylesheets-panel-update-button" type="button" title="Update">Update</button></div><textarea id="vts-stylesheets-panel-text" rows="4" cols="50">aa\naa\n</textarea>',this.core.element.appendChild(this.element),this.optionsElement=document.getElementById("vts-stylesheets-panel-combo"),this.optionsElement.onchange=this.onComboSwitched.bind(this),this.textElement=document.getElementById("vts-stylesheets-panel-text"),document.getElementById("vts-stylesheets-panel-update-button").onclick=this.onUpdate.bind(this),document.getElementById("vts-stylesheets-panel-hide-button").onclick=this.hidePanel.bind(this),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.textElement.addEventListener("keyup",e.doNothing.bind(this),!1),this.textElement.addEventListener("keydown",e.doNothing.bind(this),!1),this.panelVisible=!1},i.prototype.showPanel=function(){this.buildStylesheetsCombo(),this.element.style.display="block",this.panelVisible=!0},i.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},i.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},i.prototype.onComboSwitched=function(){var e=this.core.getMap();if(e){var t=e.getStylesheet(this.optionsElement.value);this.textElement.value=this.niceStyleFormat(t)}},i.prototype.onUpdate=function(){var e=this.core.getMap();e&&e.setStylesheetData(this.optionsElement.value,JSON.parse(this.textElement.value))},i.prototype.niceStyleFormat=function(e){if(!e||!e.data)return"";e=e.data;var t="";t+="{\n";var r=[];e.constants&&r.push("constants"),e.bitmaps&&r.push("bitmaps"),e.fonts&&r.push("fonts"),e.layers&&r.push("layers");for(var i=0,a=r.length;i<a;i++){var s=r[i];t+='  "'+s+'": {\n';var n=e[s],o=[];for(var h in n)o.push(h);for(var l=0,u=o.length;l<u;l++)if("layers"==s){var c=n[o[l]],d=[];for(var p in c)d.push(p);t+='    "'+o[l]+'": {\n';for(var f=0,m=d.length;f<m;f++)t+='      "'+d[f]+'": '+JSON.stringify(c[d[f]])+(f==m-1?"":",")+"\n";t+="    }"+(l==u-1?"":",\n")}else t+='    "'+o[l]+'": '+JSON.stringify(n[o[l]])+(l==u-1?"":",")+"\n";t+="\n  }"+(i==a-1?"":",\n")}return t+="\n}"},i.prototype.buildStylesheetsCombo=function(){var e=this.core.getMap();if(e){for(var t="",r=e.getStylesheets(),i=0,a=r.length;i<a;i++)t+='<option value="'+r[i]+'">'+r[i]+"</option>";this.optionsElement.innerHTML=t;var s=e.getStylesheet(r[0]);this.textElement.value=this.niceStyleFormat(s)}},t.a=i},function(e,t,r){"use strict";var i=function(e,t){this.parse(t)};i.prototype.parse=function(e){this.class=e.class||"",this.comment=e.comment||"",this.parent=e.parent||"",this.atmosphere=e.atmosphere||null,this.atmosphere&&(this.atmosphere.colorHorizon||(this.atmosphere.colorHorizon=[0,0,0,0]),this.atmosphere.colorZenith||(this.atmosphere.colorZenith=[0,0,0,0]),this.atmosphere.thickness||(this.atmosphere.thickness=1e5),this.atmosphere.visibility||(this.atmosphere.visibility=1e5))},i.prototype.getInfo=function(){return{class:this.class,comment:this.comment,parent:this.parent,atmosphere:JSON.parse(JSON.stringify(this.atmosphere))}},t.a=i},function(e,t,r){"use strict";var i=function(e,t){this.map=e,this.maxCost=null!=t?t:Number.MAX_VALUE,this.skipCostCheck=!1,this.last=null,this.first=null,this.totalCost=0,this.totalItems=0};i.prototype.updateItem=function(e){if(null!=e&&this.first!=e){null!=e.prev&&(e.prev.next=e.next),null!=e.next&&(e.next.prev=e.prev),this.last==e&&(this.last=e.prev);var t=this.first;this.first=e,this.first.next=t,this.first.prev=null,t.prev=this.first}},i.prototype.getMaxCost=function(){return this.maxCost},i.prototype.setMaxCost=function(e){this.maxCost=e,this.checkCost()},i.prototype.clear=function(){for(var e=this.first;null!=e;)null!=e.destructor&&e.destructor(),e=e.next;this.last=null,this.first=null,this.totalCost=0,this.totalItems=0},i.prototype.insert=function(e,t){this.totalItems++;var r={destructor:e,cost:t,prev:null,next:this.first};return null!=this.first&&(this.first.prev=r),this.first=r,null==this.last&&(this.last=r),this.totalCost+=t,this.checkCost(),r},i.prototype.remove=function(e){this.totalItems++;var t=!1;e==this.first&&(this.first=e.next,t=!0,null!=this.first&&(this.first.prev=null)),e==this.last&&(this.last=e.prev,t=!0,null!=this.last&&(this.last.next=null)),t||(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev)),this.totalCost-=e.cost,e.destructor(),this.checkCost()},i.prototype.checkCost=function(){if(!this.skipCostCheck)for(;this.totalCost>this.maxCost;){this.totalItems--;var e=this.last;if(null==e)break;this.last=this.last.prev,null!=this.last&&(this.last.next=null),this.totalCost-=e.cost,e.destructor()}},i.prototype.addItem=function(e,t){return this.insert(t,e)},i.prototype.removeItem=function(e){return this.remove(e)},i.prototype.itemUsed=function(e){return this.updateItem(e)},t.a=i},function(e,t,r){"use strict";var i=r(2),a=r(3),s=i.b,n=a.a,o=function(e){this.map=e,this.camera=e.renderer.camera,this.distance=10,this.distance2=10,this.position=[0,0,0],this.vector=[0,0,1],this.vector2=[0,0,1,1],this.center=[0,0,0],this.height=0,this.terrainHeight=0,this.lastTerrainHeight=0,this.near=2};o.prototype.update=function(){var e=this.map;e.position.check();var t=e.position.getHeight(),r=e.measure.getOptimalHeightLod(e.position.getCoords(),e.position.getViewExtent(),e.config.mapNavSamplesPerViewExtent),i=e.measure.getSurfaceHeight(e.position.getCoords(),r,!0);e.stats.heightTerrain=i[0],e.stats.heightDelta=t,"float"==e.position.getHeightMode()&&(t+=i[0]);var a=e.measure.getPositionCameraInfo(e.position,e.getNavigationSrs().isProjected());this.camera.setPosition(a.orbitCoords),this.camera.setRotationMatrix(a.rotMatrix),this.vector=a.vector,this.vector2=a.vector2,this.position=a.orbitCoords,this.height=a.orbitHeight+t,this.terrainHeight=this.height-i[0],this.distance2=e.position.getViewDistance(),this.distance=Math.max(this.terrainHeight,this.distance2),this.distance=n.clamp(this.distance,.1,this.camera.getFar()),this.distanceFactor=Math.tan(n.radians(.5*e.position.getFov())),this.perceivedDistance=Math.max(this.terrainHeight,this.distance2*this.distanceFactor),e.renderer.cameraDistance=this.distance,this.camera.setViewHeight(e.position.getViewExtent());var o=e.position.getCoords(),h=e.convert.convertCoords([o[0],o[1],t],"navigation","physical");if(this.center=[h[0],h[1],h[2]],h[0]+=a.orbitCoords[0],h[1]+=a.orbitCoords[1],h[2]+=a.orbitCoords[2],this.camera.setPosition([0,0,0]),this.position=h,this.vector2=[-h[0],-h[1],-h[2],1],s.normalize(this.vector2),this.mapIsProjected=e.getNavigationSrs().isProjected(),this.mapIsProjected)this.vector2[3]=0;else{this.geocentDistance=s.length(this.position);var l=[0,0,0];s.normalize(this.position,l),this.geocentNormal=l}var u=Math.max(this.height,this.distance)/6e5,c=Math.max(this.near,this.near*(20*u));u=Math.max(1,u);var d=10*u*6e5;return this.camera.setParams(.5*e.position.getFov(),c,2*d),a},o.prototype.getCameraHeight=function(){return this.cameraHeight},o.prototype.getMvpMatrix=function(){return this.camera.getMvpMatrix()},o.prototype.getRotationMatrix=function(){return this.camera.getRotationMatrix()},o.prototype.getRotationviewMatrix=function(){return this.camera.getRotationviewMatrix()},o.prototype.getFar=function(){return this.camera.getFar()},o.prototype.getFov=function(){return this.camera.getFov()},o.prototype.getAspect=function(){return this.camera.getAspect()},t.a=o},function(e,t,r){"use strict";var i=r(47),a=r(30),s=r(145),n=r(56),o=r(50),h=r(125),l=r(54),u=r(155),c=r(51),d=a.a,p=i.a,f=s.a,m=n.a,g=o.a,v=h.a,y=l.a,b=u.a,x=c.a,M=function(e,t){this.map=e,this.mapConfig=t,this.parseConfig()};M.prototype.parseConfig=function(){this.parseSrses()&&this.parseBodies()&&this.parseReferenceFrame()&&this.parseCredits()&&this.parseStylesheets()&&this.parseSurfaces()&&this.parseGlues()&&this.parseVirtualSurfaces()&&this.parseBoundLayers()&&this.parseFreeLayers()&&this.parseViews()&&this.parseParams()&&this.parseBrowserOptions();var e=this.map.stats;e.loadedCount=0,e.loadErrorCount=0,e.loadFirst=performance.now(),e.loadLast=this.map.loadFirst},M.prototype.afterConfigParsed=function(){null!=this.mapConfig.position&&this.map.setPosition(this.mapConfig.position,!1),this.map.setView(this.map.initialView)},M.prototype.parseSrses=function(){var e=this.mapConfig.srses;if(this.map.srses={},null==e)return!1;for(var t in e)this.map.addSrs(t,new g(this.map,t,e[t]));return!0},M.prototype.parseBodies=function(){var e=this.mapConfig.bodies;if(this.map.bodies={},null==e)return!0;for(var t in e)this.map.addBody(t,new v(this.map,e[t]));return!0},M.prototype.parseReferenceFrame=function(){var e=this.mapConfig.referenceFrame;return null!=e&&(this.map.referenceFrame=new f(this.map,e),!!this.map.referenceFrame.valid)},M.prototype.parseCredits=function(){var e=this.mapConfig.credits;if(this.map.credits={},null==e)return!1;for(var t in e)this.map.addCredit(t,new d(this.map,e[t]));return!0},M.prototype.parseSurfaces=function(){var e=this.mapConfig.surfaces;if(this.map.surfaces=[],null==e)return!1;for(var t=0,r=e.length;t<r;t++){var i=new y(this.map,e[t]);this.map.addSurface(i.id,i)}return!0},M.prototype.parseVirtualSurfaces=function(){var e=this.mapConfig.virtualSurfaces;if(this.map.virtualSurfaces=[],!this.map.config.mapVirtualSurfaces)return!0;if(null==e)return!0;for(var t=0,r=e.length;t<r;t++){var i=new b(this.map,e[t]);this.map.virtualSurfaces[i.strId]=i}return!0},M.prototype.parseViews=function(){var e=this.mapConfig.namedViews;if(this.map.namedViews=[],null!=e)for(var t in e)this.map.addNamedView(t,new m(this.map,e[t]));var r=this.mapConfig.view;return null==r||(this.map.initialView=JSON.parse(JSON.stringify(r)),!0)},M.prototype.parseGlues=function(){var e=this.mapConfig.glue;if(this.map.glues=[],null==e)return!0;for(var t=0,r=e.length;t<r;t++){var i=new y(this.map,e[t],"glue");this.map.addGlue(i.id.join(";"),i)}return!0},M.prototype.parseBoundLayers=function(){var e=this.mapConfig.boundLayers;if(this.map.boundLayers=[],null==e)return!0;for(var t in e){var r=new p(this.map,e[t],t);this.map.addBoundLayer(t,r)}return!0},M.prototype.parseFreeLayers=function(){var e=this.mapConfig.freeLayers;if(this.map.freeLayers=[],null==e)return!0;for(var t in e){var r=new y(this.map,e[t],"free");this.map.addFreeLayer(t,r)}return!0},M.prototype.parseStylesheets=function(){var e=this.mapConfig.stylesheets;if(this.map.stylesheets=[],null==e)return!0;for(var t in e){var r=new x(this.map,t,e[t]);this.map.addStylesheet(t,r)}return!0},M.prototype.parseParams=function(){return!0},M.prototype.parseBrowserOptions=function(){var e=this.mapConfig.browserOptions;return this.map.browserOptions={},null==e||(this.map.browserOptions=JSON.parse(JSON.stringify(e)),!0)},M.prototype.cloneConfig=function(){return JSON.parse(JSON.stringify(this.mapConfig))},t.a=M},function(e,t,r){"use strict";var i=r(2),a=r(3),s=r(23),n=r.n(s),o=i.e,h=a.a,l=(n.a,function(e){this.map=e,this.config=e.config,this.measure=e.measure,this.isProjected=this.map.getNavigationSrs().isProjected()});l.prototype.convertCoords=function(e,t,r){return this.map.referenceFrame.convertCoords(e,t,r)},l.prototype.movePositionCoordsTo=function(e,t,r,i){var a=e.getCoords();this.map.getNavigationSrs().getSrsInfo();if(i=null==i?1:i,this.isProjected){var s=h.radians(t),n=[-Math.sin(s),Math.cos(s)];e.setCoords2([a[0]+n[0]*r,a[1]+n[1]*r])}else{var o=this.measure.getGeodesic(),l=o.Direct(a[1],a[0],t,r);e.setCoords2([l.lon2,l.lat2]);var u=e.getOrientation();u[0]-=(l.azi1-l.azi2)*i,e.setOrientation(u)}return e},l.prototype.convertPositionViewMode=function(e,t){if(t==e.pos[0])return e;if("obj"==t){if("float"==e.getHeightMode()){var r=!0;this.convertPositionHeightMode(e,"fix",!0)}var i,a=e.getViewDistance(),s=e.getOrientation(),n=h.radians(-s[1]),o=a*Math.sin(n);if(a*=Math.cos(n),this.isProjected){var l=h.radians(s[0]),u=[-Math.sin(l),Math.cos(l)];i=e.getCoords(),i[0]=i[0]+u[0]*a,i[1]=i[1]+u[1]*a}else this.movePositionCoordsTo(e,-s[0],a),i=e.getCoords();i[2]-=o,e.setCoords(i),r&&this.convertPositionHeightMode(e,"float",!0)}else"subj"==t&&(i=this.getPositionCameraCoords(e,e.getHeightMode()),e.setCoords(i));return e.pos[0]=t,e},l.prototype.convertPositionHeightMode=function(e,t,r){if(e.pos[3]==t)return e;var i=this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent),a=this.measure.getSurfaceHeight(e.getCoords(),i);return a[1],"float"==t?(e.pos[3]=t,e.pos[4]=e.pos[4]-a[0]):"fix"==t&&(e.pos[3]=t,e.pos[4]=e.pos[4]+a[0]),e},l.prototype.getPositionCameraCoords=function(e,t){var r=e.getOrientation(),i=o.create();o.multiply(h.rotationMatrix(2,h.radians(-r[0])),h.rotationMatrix(0,h.radians(r[1])),i);var a,s,n=0,l=-1;if("obj"==e.getViewMode()){a=e.getCoords(),"float"==e.getHeightMode()&&(l=this.measure.getOptimalHeightLod(a,e.getViewExtent(),this.config.mapNavSamplesPerViewExtent),s=this.measure.getSurfaceHeight(a,l),n=s[0]);var u=this.measure.getPositionCameraInfo(e,this.isProjected);if(this.isProjected)a[0]+=u.orbitCoords[0],a[1]+=u.orbitCoords[1],a[2]+=u.orbitCoords[2]+n;else{var c=this.convertCoords([a[0],a[1],a[2]+n],"navigation","physical");c[0]+=u.orbitCoords[0],c[1]+=u.orbitCoords[1],c[2]+=u.orbitCoords[2],a=this.convertCoords(c,"physical","navigation")}return"fix"==t?a:(-1==l&&(l=this.measure.getOptimalHeightLod(a,e.getViewExtent(),this.config.mapNavSamplesPerViewExtent)),s=this.measure.getSurfaceHeight(a,l),a[2]-=s[0],a)}return e.getHeightMode()==t?e.getCoords():(l=this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent),s=this.measure.getSurfaceHeight(e.getCoords(),l),a=e.getCoords(),"fix"==t?a[2]+=s[0]:a[2]-=s[0],a)},l.prototype.getPositionNavCoordsFromPublic=function(e,t){var r=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var i=this.measure.getSurfaceHeight(e.getCoords(),t);r[2]+=i[0]}return this.convertCoords(r,"public","navigation")},l.prototype.getPositionPublicCoords=function(e,t){var r=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var i=this.measure.getSurfaceHeight(e.getCoords(),t);r[2]+=i[0]}return this.convertCoords(r,"navigation","public")},l.prototype.getPositionPhysCoords=function(e,t){var r=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var i=this.measure.getSurfaceHeight(e.getCoords(),t);r[2]+=i[0]}return this.convertCoords(r,"navigation","physical")},l.prototype.getPositionCameraSpaceCoords=function(e,t){var r=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var i=this.measure.getSurfaceHeight(e.getCoords(),t);r[2]+=i[0]}var a=this.convertCoords(r,"navigation","physical"),s=this.map.camera.position;return a[0]-=s[0],a[1]-=s[1],a[2]-=s[2],a},l.prototype.getPositionCanvasCoords=function(e,t,r){var i;if(r){var a=this.map.camera.position,s=e.getCoords();i=[s[0]-a[0],s[1]-a[1],s[2]-a[2]]}else i=this.getPositionCameraSpaceCoords(e,t);return this.map.renderer.project2(i,this.map.camera.getMvpMatrix())},l.prototype.convertCoordsFromPhysToNav=function(e,t,r){if(e=this.convertCoords(e,"physical","navigation"),"float"==t){r=null!=r?r:this.measure.getOptimalHeightLod(e,10,this.config.mapNavSamplesPerViewExtent);var i=this.measure.getSurfaceHeight(e,r);e[2]-=i[0]}return e},l.prototype.getGeodesicLinePoints=function(e,t,r,i){var a,s,n,o,h,l,u=this.measure.navigationSrsInfo,c=t[0]-e[0],d=t[1]-e[1],p=t[2]-e[2];this.isProjected?(n=Math.sqrt(c*c+d*d+p*p),h=1e6):(a=this.measure.getGeodesic(),s=a.Inverse(e[1],e[0],t[1],t[0]),n=s.s12,o=s.azi1,h=2*u.a*Math.PI/4007.5*10);for(var f=[e],m=h;m<n;m+=h)l=m/n,this.isProjected?f.push([e[0]+c*l,e[1]+d*l,e[2]+p*l]):(s=a.Direct(e[1],e[0],o,m),f.push([s.lon2,s.lat2,e[2]+p*l]));return f.push(t),f},t.a=l},function(e,t,r){"use strict";var i=function(e,t,r,i,a,s){this.map=e,this.id=t,this.srs=this.map.getMapsSrs(r),this.extents=i,this.heightRange=a,this.partitioning=s,this.isPole=1==t[0]&&(0==t[1]&&1==t[2]||1==t[1]&&0==t[2])};i.prototype.getInnerCoords=function(e){return this.srs.convertCoordsFrom(e,this.map.getNavigationSrs())},i.prototype.getOuterCoords=function(e){return this.srs.convertCoordsTo(e,this.map.getNavigationSrs())},i.prototype.getPhysicalCoords=function(e,t){return this.srs.convertCoordsTo(e,this.map.getPhysicalSrs(),t)},i.prototype.getPhysicalCoordsFast=function(e,t,r,i,a){return this.srs.convertCoordsToFast(e,this.map.getPhysicalSrs(),t,r,i,a)},i.prototype.getExtents=function(e){return this.srs.convertCoordsFrom(e,this.map.getNavigationSrs())},t.a=i},function(e,t,r){"use strict";var i=r(48),a=i.a,s=function(e,t){this.map=e,this.config=e.config,this.isProjected=this.map.getNavigationSrs().isProjected(),this.stats=e.stats,this.draw=t,this.debug=t.debug,this.core=e.core,this.camera=e.camera,this.renderer=e.renderer,this.getTextSize=this.renderer.draw.getTextSize.bind(this.renderer.draw),this.drawText=this.renderer.draw.drawText.bind(this.renderer.draw)};s.prototype.drawSurfaceTile=function(e,t,r,i,a,s,n,o){if(this.stats.gpuRenderUsed>=this.draw.maxGpuUsed)return!1;if(e.renderReady=!1,e.surface){if(t.hasGeometry()){if(this.debug.drawBBoxes&&!s&&(!e.surface.geodata&&this.debug.drawGeodataOnly||this.drawTileInfo(e,t,r,e.surfaceMesh,i)),this.debug.heightmapOnly&&!s)return e.surface.geodata||e.drawGrid(r),!0;if(!s&&(this.stats.renderedLods[e.id[0]]++,this.stats.drawnTiles++,e.surface.geodata)){var h=this.renderer.project2([.25*(t.bbox2[12]+t.bbox2[15]+t.bbox2[18]+t.bbox2[21])-r[0],.25*(t.bbox2[13]+t.bbox2[16]+t.bbox2[19]+t.bbox2[22])-r[1],.25*(t.bbox2[14]+t.bbox2[17]+t.bbox2[20]+t.bbox2[23])-r[2]],this.camera.getMvpMatrix());h[0]<0||h[1]<0||h[0]>this.renderer.curSize[0]||h[1]>this.renderer.curSize[1]||(this.stats.drawnGeodataTilesPerLayer++,this.stats.drawnGeodataTilesFactor+=Math.pow(Math.abs(e.tiltAngle*e.texelSize),.5)),this.stats.drawnGeodataTiles++}var l=0;do{if(e.resetDrawCommands){if(e.drawCommands=[[],[],[]],e.updateBounds=!0,e.bounds)for(var u in e.bounds)e.bounds[u].viewCoutner=0;e.resetDrawCommands=!1}var c;if(c=e.surface.geodata?this.drawGeodataTile(e,t,r,i,a,s,n,o):this.drawMeshTile(e,t,r,i,a,s,n,o),++l>10)break}while(e.resetDrawCommands);return c}return!0}if(!s&&e.lastRenderState){var d=this.draw.drawChannel;return this.draw.processDrawCommands(r,e.lastRenderState.drawCommands[d],a,!0,e),this.map.applyCredits(e),!0}},s.prototype.drawMeshTile=function(e,t,r,i,a,s,n,o){var h;if(!e.surfaceMesh){if(e.resourceSurface.virtual)return!0;h=e.resourceSurface.getMeshUrl(e.id),e.surfaceMesh=e.resources.getMesh(h,e)}var l,u,c,d=this.draw,p=d.drawChannel,f=!1;if(e.drawCommands[p].length>0&&this.draw.areDrawCommandsReady(e.drawCommands[p],a,n,o))return s||(d.processDrawCommands(r,e.drawCommands[p],a,null,e),this.map.applyCredits(e)),e.lastRenderState=null,!0;if(e.lastRenderState)if(e.surfaceMesh.isReady(!0,a,o)&&e.drawCommands[p].length>0){if(this.draw.areDrawCommandsReady(e.lastRenderState.drawCommands[p],a,n,o))return s||(d.processDrawCommands(r,e.lastRenderState.drawCommands[p],a,!0,e),this.map.applyCredits(e)),!0}else this.draw.areDrawCommandsReady(e.lastRenderState.drawCommands[p],a,n,o)&&(s||(d.processDrawCommands(r,e.lastRenderState.drawCommands[p],a,!0,e),this.map.applyCredits(e)),f=!0);if(e.drawCommands[p].length>0)return!(!this.config.mapHeightfiledWhenUnloaded||s)&&(e.drawGrid(r),!1);if(e.surfaceMesh.isReady(n,a,o)&&!n){var m=e.surfaceMesh.submeshes;e.drawCommands=[[],[],[]],e.imageryCredits={},e.boundsDebug={};var g,v,y,b,x,M,S,w=0;if(S=e.resourceSurface,S||(S=e.surface),S.glue){var A=S.id;for(g=0,v=A.length;g<v;g++){var T=this.map.getSurface(A[g]);T&&(w=Math.max(w,T.specificity))}for(x=0,M=t.credits.length;x<M;x++)e.glueImageryCredits[t.credits[x]]=w}else for(w=S.specificity,x=0,M=t.credits.length;x<M;x++)e.imageryCredits[t.credits[x]]=w;for(g=0,v=m.length;g<v;g++){var C=m[g];if(this.debug.drawBBoxes&&this.debug.drawMeshBBox&&!s&&C.drawBBox(r),C.externalUVs){if(e.updateBounds&&(e.updateBounds=!1,this.updateTileBounds(e,m)),S=e.resourceSurface,e.resourceSurface.glue&&(S=e.resourceSurface.getSurfaceReference(C.surfaceReference)),null!=S){var P=e.bounds[S.id];if(P)if(C.externalUVs)if(P.sequence.length>0)if(P.transparent){C.internalUVs&&(null==e.surfaceTextures[g]&&(h=e.resourceSurface.getTextureUrl(e.id,g),e.surfaceTextures[g]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:e.surfaceTextures[g],material:5})),e.drawCommands[0].push({type:1,state:d.drawBlendedTileState});var F=P.sequence;for(y=0,b=F.length;y<b;y++)if(l=e.boundTextures[F[y]]){for(e.boundsDebug[S.id]||(e.boundsDebug[S.id]=[]),e.boundsDebug[S.id].push(F[y]),u=e.boundLayers[F[y]],c=u.credits,x=0,M=c.length;x<M;x++)e.imageryCredits[c[x]]=u.specificity;e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:l,alpha:P.alpha[F[y]][1],material:7,layer:u})}e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:null,material:3}),e.drawCommands[0].push({type:1,state:d.drawTileState})}else{var L=P.sequence[P.sequence.length-1];if(l=e.boundTextures[L]){for(e.boundsDebug[S.id]||(e.boundsDebug[S.id]=[]),e.boundsDebug[S.id].push(L),u=e.boundLayers[L],c=u.credits,x=0,M=c.length;x<M;x++)e.imageryCredits[c[x]]=u.specificity;e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:l,material:6,layer:u})}}else if(C.textureLayer){if((u=this.map.getBoundLayerByNumber(C.textureLayer))&&(l=e.boundTextures[u.id])){for(e.boundsDebug[S.id]||(e.boundsDebug[S.id]=[]),e.boundsDebug[S.id].push(u.id),u=e.boundLayers[u.id],c=u.credits,x=0,M=c.length;x<M;x++)e.imageryCredits[c[x]]=u.specificity;e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:l,material:6,layer:u})}}else C.internalUVs?(null==e.surfaceTextures[g]&&(h=e.resourceSurface.getTextureUrl(e.id,g),e.surfaceTextures[g]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:e.surfaceTextures[g],material:4})):e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:null,material:2});else C.internalUVs&&(null==e.surfaceTextures[g]&&(h=e.resourceSurface.getTextureUrl(e.id,g),e.surfaceTextures[g]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:e.surfaceTextures[g],material:4}))}}else C.internalUVs&&(null==e.surfaceTextures[g]&&(h=e.resourceSurface.getTextureUrl(e.id,g),e.surfaceTextures[g]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:g,texture:e.surfaceTextures[g],material:4}));e.drawCommands[1].push({type:2,mesh:e.surfaceMesh,submesh:g,material:1})}if(S.pipeline>0)for(this.updateTileHmap(e,t),y=0;y<2;y++){var E=e.drawCommands[y];for(g=0,v=E.length;g<v;g++)2==E[g].type&&(E[g].pipeline=S.pipeline,E[g].hmap=e.hmap)}if(e.resetDrawCommands)return!1;if(d.areDrawCommandsReady(e.drawCommands[p],a,n,o)){if(e.resetDrawCommands)return!1;s||(d.processDrawCommands(r,e.drawCommands[p],a,null,e),this.map.applyCredits(e)),e.lastRenderState=null,f=!0}else e.lastRenderState?this.draw.areDrawCommandsReady(e.lastRenderState.drawCommands[p],a,n,o)&&(s||(d.processDrawCommands(r,e.lastRenderState.drawCommands[p],a,!0,e),this.map.applyCredits(e)),f=!0):this.config.mapHeightfiledWhenUnloaded&&!s&&(e.drawGrid(r),f=!(e.drawCommands[p].length>0))}else e.lastRenderState||!this.config.mapHeightfiledWhenUnloaded||s||(e.drawGrid(r),f=!(e.drawCommands[p].length>0));return f},s.prototype.drawGeodataTile=function(e,t,r,i,s,n,o,h){if(e.id[0]<=1)return!0;if(null==e.surfaceGeodata){var l;if(e.surface.geodataNavtileInfo){var u=this.tree.findNavTile(e.id);if(u&&u.surface){var c=u.surface.getNavUrl(u.id)+";"+u.id[0]+"-"+u.id[1]+"-"+u.id[2]+";"+u.metanode.minHeight+";"+u.metanode.maxHeight;l=e.surface.getGeodataUrl(e.id,encodeURIComponent(c))}}l||(l=e.resourceSurface.getGeodataUrl(e.id,"")),e.surfaceGeodata=e.resources.getGeodata(l,{tile:e,surface:e.surface})}var d=this.draw.drawChannel;if(e.geodataCounter!=e.surface.geodataCounter&&(e.drawCommands=[[],[],[]],null!=e.surfaceGeodataView&&e.surfaceGeodataView.kill(),e.surfaceGeodataView=null,e.geodataCounter=e.surface.geodataCounter),e.drawCommands[d].length>0&&this.draw.areDrawCommandsReady(e.drawCommands[d],s,o,h))return n||(this.draw.processDrawCommands(r,e.drawCommands[d],s,null,e),this.map.applyCredits(e)),e.lastRenderState=null,!0;if(e.surfaceGeodataView||e.surfaceGeodata.isReady(o,s,h)&&!o&&(e.surfaceGeodataView=new a(this.map,e.surfaceGeodata,{tile:e,surface:e.surface})),e.surfaceGeodataView){e.mapdataCredits={};for(var p=e.surface?e.surface.specificity:0,f=0,m=t.credits.length;f<m;f++)e.mapdataCredits[t.credits[f]]=p;return e.drawCommands[d][0]={type:3,geodataView:e.surfaceGeodataView},e.surfaceGeodataView.isReady()}return!1},s.prototype.updateTileHmap=function(e,t){if(t&&t.hasNavtile()&&e.surface){if(!e.surface||!e.resourceSurface)return!1;if(!e.resourceSurface.getHMapUrl)return!1;var r=e.resourceSurface.getHMapUrl(e.id,!0);e.hmap=e.resources.getTexture(r)}else{for(var i=e.parent,a=null;i&&i.id[0]>0;){if(i.metanode&&i.metanode.hasNavtile()){a={sourceTile:i,sourceTexture:null,hmap:!0,tile:e};break}i=i.parent}if(a){var r=e.resourceSurface.getHMapUrl(e.id,!0);e.hmap=e.resources.getTexture(r,null,a,{tile:e,hmap:!0},e,!1),e.hmap.neverReady&&(e.hmap=null)}else e.hmap=null}},s.prototype.updateTileBounds=function(e,t){for(var r=0,i=t.length;r<i;r++){var a=t[r];if(a.externalUVs){var s=e.resourceSurface;if(e.resourceSurface.glue&&(s=e.resourceSurface.getSurfaceReference(a.surfaceReference)),s){var n=e.bounds[s.id];n||(n={sequence:[],alpha:[],transparent:!1,viewCoutner:0},e.bounds[s.id]=n),n.viewCoutner!=e.viewCoutner&&this.updateTileSurfaceBounds(e,a,s,n,n.viewCoutner!=e.viewCoutner)}}}for(var o in e.bounds)e.bounds[o].viewCoutner=e.viewCoutner},s.prototype.getParentTile=function(e,t){for(;e&&e.id[0]>t;)e=e.parent;return e},s.prototype.getTileTextureTransform=function(e,t){var r=t.id[0]-e.id[0],i=e.id[1]<<r,a=e.id[2]<<r,s=1/Math.pow(2,r);return[s,s,(t.id[1]-i)*s,(t.id[2]-a)*s]},s.prototype.updateTileSurfaceBounds=function(e,t,r,i,a){var s,n,o,h;if(!this.config.mapNoTextures)if(r.boundLayerSequence.length>0){if(a){i.sequence=[];for(var l=[],u=[],c=0,d=0,p=r.boundLayerSequence.length;d<p;d++)if((o=r.boundLayerSequence[d][0])&&o.ready&&o.hasTileOrInfluence(e.id)&&r.boundLayerSequence[d][1]>0){if(n=null,e.id[0]>o.lodRange[1]&&(n={sourceTile:this.getParentTile(e,o.lodRange[1]),sourceTexture:null,layer:o,tile:e}),h=e.boundTextures[o.id],h||(s=o.getUrl(e.id),h=e.resources.getTexture(s,o.dataType,n,{tile:e,layer:o},e,!1),1==h.checkType&&(h.checkMask=!0),h.isReady(!0),e.boundTextures[o.id]=h),h.neverReady)continue;var f=!1,m=!1;h.isMaskPosible()&&(h.isMaskInfoReady()?h.getMaskTexture()&&(i.transparent=!0,f=!0):(m=!0,f=!0)),u.push(f);var g=!(r.boundLayerSequence[d][1]<1||f||o.isTransparent);if(g&&c++,l.push(g),i.sequence.push(o.id),i.alpha[o.id]=r.boundLayerSequence[d],e.boundLayers[o.id]=o,(i.alpha[o.id][1]<1||o.isTransparent)&&(i.transparent=!0),m)break}if(c>0){for(var v=[],y=i.sequence.length-1;y>=0;y--){var b=i.sequence[y];if(l[y]){v.unshift(b);break}h=e.boundTextures[b],(i.alpha[b][1]<1||e.boundLayers[b].isTransparent||u[y])&&v.unshift(b)}i.sequence=v}}}else null!=r.textureLayer?a&&(o=this.map.getBoundLayerById(r.textureLayer))&&o.hasTileOrInfluence(e.id)&&(n=null,e.id[0]>o.lodRange[1]&&(n={sourceTile:this.getParentTile(e,o.lodRange[1]),sourceTexture:null,layer:o,tile:e}),i.sequence.push(o.id),e.boundLayers[o.id]=o,e.boundTextures[o.id]||(s=o.getUrl(e.id),e.boundTextures[o.id]=e.resources.getTexture(s,o.dataType,n,{tile:e,layer:o},e,!1))):0!=t.textureLayer&&(o=this.map.getBoundLayerByNumber(t.textureLayer))&&o.hasTileOrInfluence(e.id)&&(n=null,e.id[0]>o.lodRange[1]&&(n={sourceTile:this.getParentTile(e,o.lodRange[1]),sourceTexture:null,layer:o,tile:e}),e.boundLayers[o.id]=o,e.boundTextures[o.id]||(s=o.getUrl(e.id),e.boundTextures[o.id]=e.resources.getTexture(s,o.dataType,n,{tile:e,layer:o},e,!1)))},s.prototype.drawTileInfo=function(e,t,r,i){var a,s=this.debug;if(s.drawMeshBBox||t.drawBBox(r),t.metatile.useVersion<4){var n=t.bbox.min,o=t.bbox.max;a=this.core.getRendererInterface().getCanvasCoords([n[0]+.5*(o[0]-n[0])-r[0],n[1]+.5*(o[1]-n[1])-r[1],o[2]-r[2]],this.camera.getMvpMatrix()),a[2]=.9992*a[2]}else{var h=t.bbox2[3]-t.bbox2[0],l=t.bbox2[4]-t.bbox2[1],u=t.bbox2[5]-t.bbox2[2],c=Math.sqrt(h*h+l*l+u*u);a=this.core.getRendererInterface().getCanvasCoords([.25*(t.bbox2[12]+t.bbox2[15]+t.bbox2[18]+t.bbox2[21])+t.diskNormal[0]*c*.1-r[0],.25*(t.bbox2[13]+t.bbox2[16]+t.bbox2[19]+t.bbox2[22])+t.diskNormal[1]*c*.1-r[1],.25*(t.bbox2[14]+t.bbox2[17]+t.bbox2[20]+t.bbox2[23])+t.diskNormal[2]*c*.1-r[2]],this.camera.getMvpMatrix())}var d,p,f,m=s.debugTextSize;if(s.drawLods&&(d=""+e.id[0],this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]-4*m),4*m,d,[1,0,0,1],a[2])),s.drawIndices&&(d=e.id[1]+" "+e.id[2],this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]-11*m),4*m,d,[0,1,1,1],a[2])),s.drawPositions&&(d="llx:"+Math.floor(t.llx)+" lly:"+Math.floor(t.lly)+" urx:"+Math.floor(t.urx)+" ury:"+Math.floor(t.ury),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+3*m),4*m,d,[0,1,1,1],a[2])),s.drawFaceCount&&i&&(d=i.faces+" - "+i.submeshes.length+(e.surface&&e.surface.glue?" - 1":" - 0"),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+10*m),4*m,d,[0,1,0,1],a[2])),s.drawGPixelSize&&(d=""+(Math.tan(e.metanode.diskAngle2A)*e.metanode.diskDistance*.70710678118/t.displaySize).toFixed(2),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+10*m),4*m,d,[0,1,0,1],a[2])),s.drawOrder&&(d=this.drawTileCounter+" cmds: "+e.drawCommands[0].length,this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+10*m),4*m,d,[0,1,0,1],a[2])),s.drawSurfaces&&(d=JSON.stringify(e.surface.id),t.alien&&(d="[A]"+d),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+10*m),4*m,d,[1,1,1,1],a[2])),s.drawBoundLayers&&e.boundsDebug){var g=e.resourceSurface;if(g.glue)for(p=0,f=g.id.length;p<f;p++)e.boundsDebug[g.id[p]]&&(d="< "+g.id[p]+" >",this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+(10+7*p*2)*m),4*m,d,[1,1,1,1],a[2]),d=JSON.stringify(e.boundsDebug[g.id[p]]),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+(17+7*p*2)*m),4*m,d,[1,1,1,1],a[2]));else e.boundsDebug[g.id]&&(d="< "+g.id+" >",this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+10*m),4*m,d,[1,1,1,1],a[2]),d=JSON.stringify(e.boundsDebug[g.id]),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+17*m),4*m,d,[1,1,1,1],a[2]))}if(s.drawCredits){d="{ ";for(var v in e.imageryCredits)e.imageryCredits[v]&&(d+=v+":"+e.imageryCredits[v]+", ");for(v in e.glueImageryCredits)e.imageryCredits[v]||(d+=v+":"+e.glueImageryCredits[v]+", ");d+="}",this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+10*m),4*m,d,[1,1,1,1],a[2])}if(s.drawDistance&&(d=e.distance.toFixed(2)+"  "+e.texelSize.toFixed(3)+"  "+t.pixelSize.toFixed(3),d+="--"+e.texelSize2.toFixed(3),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+17*m),4*m,d,[1,0,1,1],a[2])),s.drawNodeInfo){var y=(240&t.flags)>>4;d="v"+t.metatile.version+"-"+t.flags.toString(2)+"-"+(1&y?"1":"0")+(2&y?"1":"0")+(4&y?"1":"0")+(8&y?"1":"0"),d+="-"+t.minHeight+"/"+t.maxHeight+"-"+Math.floor(t.minZ)+"/"+Math.floor(t.maxZ)+"-"+Math.floor(t.surrogatez),this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]-18*m),4*m,d,[1,0,1,1],a[2])}if(s.drawTextureSize&&i){var b=i.submeshes;for(p=0,f=b.length;p<f;p++)if(b[p].internalUVs){var x=e.surfaceTextures[p];if(x){var M=x.getGpuTexture();M&&(d="["+p+"]: "+M.width+" x "+M.height,this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+(17+4*p*2)*m),4*m,d,[1,1,1,1],a[2]))}}else d="["+p+"]: 256 x 256",this.drawText(Math.round(a[0]-.5*this.getTextSize(4*m,d)),Math.round(a[1]+(17+4*p*2)*m),4*m,d,[1,1,1,1],a[2])}},t.a=s},function(e,t,r){"use strict";var i=r(2),a=r(3),s=r(49),n=r(48),o=r(131),h=i.b,l=a.a,u=o.a,c=n.a,d=s.a,p=function(e){this.map=e,this.config=e.config,this.isProjected=e.getNavigationSrs().isProjected(),this.isGeocent=e.isGeocent,this.renderer=e.renderer,this.stats=e.stats,this.camera=e.camera,this.tree=e.tree,this.ndcToScreenPixel=.5*this.renderer.curSize[0],this.debug={heightmapOnly:!1,blendHeightmap:!0,drawBBoxes:!1,drawMeshBBox:!1,drawLods:!1,drawPositions:!1,drawTexelSize:!1,drawWireframe:0,drawTestMode:0,drawTestData:0,drawFaceCount:!1,drawDistance:!1,drawMaxLod:!1,drawGeodataOnly:!1,drawTextureSize:!1,drawNodeInfo:!1,drawLayers:!0,drawBoundLayers:!1,drawSurfaces:!1,drawCredits:!1,drawOrder:!1,drawLabelBoxes:!1,drawEarth:!0,drawGridCells:!1,drawTileCounter:0,drawFog:this.config.mapFog,drawGPixelSize:!1,debugTextSize:2,ignoreTexelSize:!1,maxZoom:!1},this.gridFlat=!1,this.gridGlues=!1,this.gridSkipped=!1,this.atmoColor=[216/255,232/255,243/255,1],this.atmoColor2=[72/255,154/255,1,1],this.atmoHeight=5e4,this.atmoHeightFactor=1,this.atmoDensity=1,this.fogDensity=0,this.zFactor=0,this.zFactor2=.003,this.zbufferOffset=null,this.zShift=0,this.zLastShift=0,this.bestMeshTexelSize=1,this.bestGeodataTexelSize=1,this.log8=Math.log(8),this.log2=Math.log(2),this.geodataTilesPerLayer=0,this.drawCounter=0,this.drawChannel=0,this.drawChannelNames=["base","hit"],this.planetRadius=this.isGeocent?e.getNavigationSrs().getSrsInfo().a:100,this.tileBuffer=new Array(500),this.processBuffer=new Array(6e4),this.processBuffer2=new Array(6e4),this.drawBuffer=new Array(6e4),this.tmpVec3=new Array(3),this.tmpVec5=new Array(5),this.bboxBuffer=new Float32Array(24),this.planeBuffer=new Float32Array(27);var t=this.renderer.gpu;this.drawTileState=t.createState({}),this.drawStardomeState=t.createState({zwrite:!1,ztest:!1}),this.drawBlendedTileState=t.createState({zequal:!0,blend:!0}),this.drawAuraState=t.createState({zwrite:!1,blend:!0}),this.drawAtmoState=t.createState({zwrite:!1,ztest:!1,blend:!0}),this.drawAtmoState2=t.createState({zwrite:!1,ztest:!0,blend:!1}),this.degradeHorizonFactor=0,this.degradeHorizonTiltFactor=0,this.replay={camera:null,drawnTiles:null,drawnFreeTiles:null,nodeBuffer:null,tracedNodes:null,tracedFreeNodes:null,storeTiles:!1,storeFreeTiles:!1,storeNodes:!1,storeFreeNodes:!1,storeLoaded:this.config.mapStoreLoadStats,drawGlobe:!1,drawTiles:!1,drawNodes:!1,drawFreeTiles:!1,drawFreeNodes:!1,drawLoaded:!1,lod:30,singleLod:!1,loadedIndex:0,singleLodedIndex:0,loaded:[],loadFirst:0,loadLast:0},this.drawTiles=new u(e,this)};p.prototype.drawMap=function(e){var t=this.map,r=this.renderer,i=this.camera,a=this.replay,s=r.gpu,n=this.debug;1!=this.drawChannel&&(s.setViewport(),t.visibleCredits={imagery:{},glueImagery:{},mapdata:{}});var o=this.isProjected;switch(this.config.mapGridMode){case"none":this.gridSkipped=!0,this.gridFlat=!1,this.gridGlues=!1;break;case"flat":this.gridSkipped=!1,this.gridFlat=!0,this.gridGlues=!1;break;case"linear":this.gridSkipped=!1,this.gridFlat=!1,this.gridGlues=!0;break;case"fastlinear":this.gridSkipped=!1,this.gridFlat=!1,this.gridGlues=!1}var u=this.drawTiles,c=i.update(),r=this.renderer;if(r.dirty=!0,r.drawFog=this.debug.drawFog,this.config.mapForceFrameTime?-1!=this.config.mapForceFrameTime?r.frameTime=this.config.mapForceFrameTime:r.frameTime=0:r.frameTime=this.stats.frameTime,r.hoverFeatureCounter=0,r.hoverFeatureList=t.hoverFeatureList,r.hoverFeature=t.hoverFeature,r.cameraPosition=i.position,r.cameraOrientation=t.position.getOrientation(),r.cameraTiltFator=Math.cos(l.radians(r.cameraOrientation[1])),r.cameraVector=i.vector,r.cameraViewExtent=t.position.getViewExtent(),r.cameraViewExtent2=Math.pow(2,Math.max(1,Math.floor(Math.log(t.position.getViewExtent())/Math.log(2)))),r.drawLabelBoxes=this.debug.drawLabelBoxes,r.drawGridCells=this.debug.drawGridCells,r.fmaxDist=Number.NEGATIVE_INFINITY,r.fminDist=Number.POSITIVE_INFINITY,o){var d=l.radians(r.cameraOrientation[0]);r.labelVector=[-Math.sin(d),Math.cos(d),0,0,0]}else{var p=c.vector;r.labelVector=[p[0],p[1],p[2],0]}r.distanceFactor=1/Math.max(1,Math.log(i.distance)/Math.log(1.04)),r.tiltFactor=Math.abs(r.cameraOrientation[1]/-90),r.localViewExtentFactor=2*Math.tan(l.radians(.5*t.position.getFov())),this.degradeHorizonFactor=200*this.config.mapDegradeHorizonParams[0],this.degradeHorizonTiltFactor=.5*(1+Math.cos(l.radians(Math.min(180,Math.abs(2*r.cameraOrientation[1]*3))))),1!=this.drawChannel?s.clear(!0,!1):s.clear(!0,!0,[255,255,255,255]),s.setState(this.drawStardomeState),1!=this.drawChannel&&this.config.mapLowresBackground<.8&&(2==n.drawWireframe?r.draw.drawSkydome(r.whiteTexture,r.progStardome):r.draw.drawSkydome(r.blackTexture,r.progStardome)),s.setState(this.drawTileState),this.setupDetailDegradation(),t.loader.setChannel(0),this.zFactor=0,this.ndcToScreenPixel=.5*r.curSize[0],this.updateFogDensity(),this.updateGridFactors(),this.maxGpuUsed=Math.max(3929856,t.gpuCache.getMaxCost()-3929856),this.stats.renderBuild=0,this.drawTileCounter=0;var f,m,g,v,y,b,x,M,S,w,A=i.position;if(t.freeLayersHaveGeodata&&0==this.drawChannel&&r.draw.clearJobBuffer(),this.debug.drawEarth){if((a.storeNodes||a.storeFreeNodes)&&(a.nodeBuffer=[]),a.drawGlobe||a.drawTiles||a.drawFreeTiles||a.drawNodes||a.drawFreeNodes||a.drawLoaded){var T=a.lod,C=a.singleLod;if(a.drawTiles&&a.drawnTiles)for(b=a.drawnTiles,f=0,m=b.length;f<m;f++)b[f][1]?(y=b[f][0],u.debug.drawBBoxes&&u.drawTileInfo(y,y.metanode,A),y.drawGrid(A)):(y=b[f][0])&&(C&&y.id[0]==T||!C&&y.id[0]<=T)&&u.drawSurfaceTile(y,y.metanode,A,y.pixelSize,y.priority,!1,!1);if(a.drawFreeTiles&&a.drawnFreeTiles)for(b=a.drawnFreeTiles,f=0,m=b.length;f<m;f++)b[f][1]||(y=b[f][0])&&(C&&y.id[0]==T||!C&&y.id[0]<=T)&&u.drawSurfaceTile(y,y.metanode,A,y.pixelSize,y.priority,!1,!1);if(a.drawNodes&&a.tracedNodes){for(b=a.tracedNodes,x=n.drawBBoxes,n.drawBBoxes=!0,f=0,m=b.length;f<m;f++)(y=b[f])&&(C&&y.id[0]==T||!C&&y.id[0]<=T)&&u.drawTileInfo(y,y.metanode,A,y.surfaceMesh,y.pixelSize);n.drawBBoxes=x}if(a.drawFreeNodes&&a.tracedFreeNodes){for(b=a.tracedFreeNodes,x=n.drawBBoxes,n.drawBBoxes=!0,f=0,m=b.length;f<m;f++)y=b[f],(C&&y.id[0]==T||!C&&y.id[0]<=T)&&u.drawTileInfo(y,y.metanode,A,y.surfaceMesh,y.pixelSize);n.drawBBoxes=x}var P=a.loadedIndex,F=a.singleLodedIndex;if(a.drawLoaded&&a.loaded){var L=a.loaded;for(n.drawBBoxes=!0,f=0,m=L.length;f<m;f++){var E=L[f];E&&E.tile&&E.tile.id&&(y=E.tile,(F&&f==P||!F&&f<=P)&&(C&&y.id[0]==T||!C&&y.id[0]<=T)&&y.metanode&&(y.metanode.hasGeometry()?u.drawSurfaceTile(y,y.metanode,A,y.pixelSize,y.priority,!1,!1):u.drawTileInfo(y,y.metanode,A,y.surfaceMesh,y.pixelSize)))}n.drawBBoxes=x}return void((a.drawFreeTiles&&a.drawnFreeTiles||a.drawLoaded&&a.loaded)&&this.freeLayersHaveGeodata&&0==this.drawChannel&&(r.drawnGeodataTiles=this.stats.drawnGeodataTilesPerLayer,r.drawnGeodataTilesFactor=this.stats.drawnGeodataTilesFactor,r.draw.drawGpuJobs()))}for(f=0,m=this.tileBuffer.length;f<m;f++)this.tileBuffer[f]=null;if(this.tree.surfaceSequence.length>0&&this.tree.draw(),a.storeTiles){for(S=[],f=0,m=this.tileBuffer.length;f<m;f++)if(b=this.tileBuffer[f])for(g=0,v=b.length;g<v;g++)S.push(b[g]);a.cameraPos=A,a.drawnTiles=S,a.storeTiles=!1}if(a.storeNodes){for(w=[],f=0,m=a.nodeBuffer.length;f<m;f++)y=a.nodeBuffer[f],w.push(y);a.cameraPos=A,a.tracedNodes=w,a.storeNodes=!1}for(f=0,m=t.freeLayerSequence.length;f<m;f++)M=t.freeLayerSequence[f],M.ready&&M.tree&&(!M.geodata||M.stylesheet&&M.stylesheet.isReady())&&0==this.drawChannel&&(M.zFactor&&(this.zbufferOffset=M.zFactor),"geodata"==M.type?this.drawMonoliticGeodata(M):M.tree.draw(),this.zbufferOffset=null);if(a.storeFreeTiles){for(S=[],f=0,m=this.tileBuffer.length;f<m;f++)if(b=this.tileBuffer[f])for(g=0,v=b.length;g<v;g++)y=b[g],y.surface&&y.surface.free&&S.push(y);a.cameraPos=A,a.drawnFreeTiles=S,a.storeFreeTiles=!1}if(a.storeFreeNodes){for(w=[],f=0,m=a.nodeBuffer.length;f<m;f++)y=a.nodeBuffer[f],y.surface&&y.surface.free&&w.push(y);a.cameraPos=A,a.tracedFreeNodes=w,a.storeFreeNodes=!1}}var I=t.referenceFrame.body;if(1!=this.drawChannel&&!o&&n.drawFog&&(I&&I.atmosphere||"melown2015"==t.referenceFrame.id||"mars-qsc"==t.referenceFrame.id||"earth-qsc"==t.referenceFrame.id)&&r.progAtmo.isReady()&&r.progAtmo2.isReady()){var N=t.getNavigationSrs().getSrsInfo(),B=N.a,_=N.b,R=this.atmoHeight,k=[0,0,0,0];h.normalize(i.position,k);var z,U,D=t.getPosition(),G=1-l.clamp(Math.max(.1*R,i.geocentDistance-B)/(10*R),0,1),V=[Math.max(2,128*G),0,0,0];s.setState(this.drawAtmoState);V=[2,(B+R)/B*2,.25,(B+R)/B*2];var O=1/B*2;z=[i.position[0]*O,i.position[1]*O,i.position[2]*O,1];var j=.5*D.getViewExtent()/Math.tan(l.radians(.5*D.getFov())),H=B/(j+B);U=[l.mix(4.4,1.01,H),1,l.mix(5,1.05,H),0],s.setState(this.drawAuraState),r.draw.drawBall([-i.position[0],-i.position[1],-i.position[2]],B+R,_+R,r.progAtmo,V,z,U,this.atmoColor,this.atmoColor2),s.setState(this.drawTileState)}n.drawEarth&&(e||t.freeLayersHaveGeodata&&0==this.drawChannel&&(r.drawnGeodataTiles=this.stats.drawnGeodataTilesPerLayer,r.drawnGeodataTilesFactor=this.stats.drawnGeodataTilesFactor,r.draw.drawGpuJobs())),this.config.mapForceFrameTime&&-1!=this.config.mapForceFrameTime&&(r.frameTime=0,this.config.mapForceFrameTime=-1)},p.prototype.drawToTexture=function(e){this.renderer.switchToFramebuffer("texture",e),this.drawChannel=0,this.map.renderSlots.processRenderSlots(),this.renderer.switchToFramebuffer("base")},p.prototype.drawHitmap=function(){this.drawChannel=1,this.renderer.switchToFramebuffer("depth"),this.map.renderSlots.processRenderSlots(),this.renderer.switchToFramebuffer("base"),this.drawChannel=0,this.map.hitMapDirty=!1},p.prototype.drawGeodataHitmap=function(){this.renderer.gpu.setState(this.drawTileState),this.renderer.switchToFramebuffer("geo"),this.renderer.draw.drawGpuJobs(),this.renderer.advancedPassNeeded&&(this.renderer.switchToFramebuffer("geo2"),this.renderer.draw.drawGpuJobs()),this.renderer.switchToFramebuffer("base"),this.map.geoHitMapDirty=!1},p.prototype.getDrawCommandsGpuSize=function(e){for(var t=0,r=0,i=e.length;r<i;r++){var a=e[r];switch(a.type){case 2:var s=a.mesh,n=this.config.mapNoTextures?0:a.texture;s&&(t+=s.gpuSize),n&&(t+=n.getGpuSize());break;case 3:var o=a.geodataView;o&&(t+=o.size)}}return t},p.prototype.areDrawCommandsReady=function(e,t,r,i){for(var a=!0,s=!!i,n=0,o=e.length;n<o;n++){var h=e[n];switch(h.type){case 2:if(h.pipeline){var l=h.hmap;if(l&&l.isReady(r,t)||(a=!1),9==this.debug.drawTestMode){var u=h.texture,c=!!this.config.mapNoTextures||(!u||u&&u.isReady(r,t,s));c||(a=!1)}break}var d=h.mesh,u=h.texture,p=d&&d.isReady(r,t,s),c=!!this.config.mapNoTextures||(!u||u&&u.isReady(r,t,s));p&&c||(a=!1);break;case 3:var f=h.geodataView;f&&f.isReady(r,t,s)||(a=!1)}}return a},p.prototype.processDrawCommands=function(e,t,r,i,a){t.length>0&&this.drawTileCounter++;for(var s=0,n=t.length;s<n;s++){var o=t[s];switch(o.type){case 1:this.renderer.gpu.setState(o.state);break;case 2:var h=o.pipeline;if(h){var l=o.hmap;if(9==this.debug.drawTestMode){var u=o.texture,c=!!this.config.mapNoTextures||(!u||u&&u.isReady(i,r));c&&l&&l.isReady(i,r)&&a.drawHmapTile(e,null,null,h,u)}else l&&l.isReady(i,r)&&a.drawHmapTile(e,null,null,h);return}var c,d=o.mesh,u=o.texture,p=d&&d.isReady(i,r);if(this.config.mapNoTextures?(c=!0,u=null):c=!u||u&&u.isReady(i,r),p&&c)if(this.debug.drawBBoxes&&this.debug.drawMeshBBox&&d.submeshes[o.submesh].drawBBox(e),u)d.drawSubmesh(e,o.submesh,u,o.material,o.alpha,o.layer);else{var f=o.material;switch(f){case 6:case 4:f=2}d.drawSubmesh(e,o.submesh,u,f,o.alpha,o.layer)}break;case 3:var m=o.geodataView;m&&m.isReady(i,r,!0)&&m.draw(e)}}},p.prototype.drawMonoliticGeodata=function(e){if(e&&0==this.drawChannel&&this.camera.camera.bboxVisible(e.extents,this.camera.position)){var t;if(null==e.monoGeodata&&(t="object"==typeof e.geodataUrl?e.geodataUrl:e.getMonoGeodataUrl(e.id),e.monoGeodata=new d(this.map,t,{tile:null,surface:e})),e.monoGeodataCounter!=e.geodataCounter&&(e.monoGeodataView=null,e.monoGeodataCounter=e.geodataCounter),e.monoGeodata.isReady()&&(e.monoGeodataView||(e.monoGeodataView=new c(this.map,e.monoGeodata,{tile:null,surface:e})),e.monoGeodataView.isReady())){for(var r=this.map.visibleCredits.mapdata,i=0,a=e.credits.length;i<a;i++){var s=e.credits[i],n=r[s];r[s]=n?10>n?10:n:10}e.monoGeodataView.draw(this.camera.position)}}},p.prototype.updateFogDensity=function(){var e=this.map.getPosition(),t=e.getOrientation(),r=this.camera.getFar(),i=Math.max(5,-t[1])/90,a=Math.log(.05)/(this.atmoDensity*r*this.atmoHeightFactor*Math.max(1,1e-4*this.camera.height)*i);a*=5/(Math.min(5e4,Math.max(this.camera.distance,1e3))/5e3),this.debug.drawFog||(a=0),this.fogDensity=a,this.renderer.fogDensity=a},p.prototype.updateGridFactors=function(){for(var e=this.map.referenceFrame.getSpatialDivisionNodes(),t=0,r=e.length;t<r;t++){var i=e[t],a=Math.max(10,this.camera.distance+20),s=2*(i.extents.ur[0]-i.extents.ll[0]),n=Math.log(Math.min(s,a))/this.log8;n=Math.log(s)/this.log8-n,i.gridBlend=n-Math.floor(n),n=Math.floor(Math.floor(n))+1,i.gridStep1=Math.pow(8,n),i.gridStep2=8*i.gridStep1}},p.prototype.setupDetailDegradation=function(e){var t=0;this.map.mobile&&(t=this.config.mapMobileDetailDegradation),e&&(t+=e),this.texelSizeFit=this.config.mapTexelSizeFit*Math.pow(2,t)},t.a=p},function(e,t,r){"use strict";var i=r(134),a=r(135),s=r(136),n=r(2),o=i.a,h=a.a,l=s.a,u=n.b,c=n.e,d=function(e){this.map=e,this.groups=[],this.currentGroup=null,this.bboxMin=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],this.bboxMax=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],this.navSrs=this.map.getNavigationSrs(),this.physSrs=this.map.getPhysicalSrs(),this.heightsToProcess=0,this.heightsProcessBuffer=null,this.heightsProcessBufferFirst=null,this.heightsProcessBufferLast=null,this.heightsLod=8,this.heightsSource="heightmap-by-precision",this.updateCallback=null,this.processingHeights=!1,this.processHeightsCalls=[]};d.prototype.addToHeightsBuffer=function(e){var t={coords:e,prev:null,next:this.heightsProcessBufferFirst};null!=this.heightsProcessBufferFirst&&(this.heightsProcessBufferFirst.prev=t),this.heightsProcessBufferFirst=t,null==this.heightsProcessBufferLast&&(this.heightsProcessBufferLast=t)},d.prototype.removeFromHeightsBuffer=function(e){var t=!1;e==this.heightsProcessBufferFirst&&(this.heightsProcessBufferFirst=e.next,t=!0,null!=this.heightsProcessBufferFirst&&(this.heightsProcessBufferFirst.prev=null)),e==this.heightsProcessBufferLast&&(this.heightsProcessBufferLast=e.prev,t=!0,null!=this.heightsProcessBufferLast&&(this.heightsProcessBufferLast.next=null)),t||(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev))},d.prototype.addGroup=function(e){return this.groups.push({points:[],lines:[],polygons:[],id:e}),this.currentGroup=this.groups[this.groups.length-1],this},d.prototype.addPoint=function(e,t,r,i,a,s){this.currentGroup||this.addGroup("some-group");var n,o=!t||"float"==t,h={id:i,properties:r};return o?(n=[e[0],e[1],e[2]||0,h,null,null],this.addToHeightsBuffer(n),h.points=[n],h.floatHeights=!0,h.srs=a||this.navSrs,h.heightsToProcess=1,this.heightsToProcess++):h.points=s?[[e[0],e[1],e[2]]]:[this.physSrs.convertCoordsFrom(e,a||this.navSrs)],this.currentGroup.points.push(h),this},d.prototype.addPointArray=function(e,t,r,i,a,s){this.currentGroup||this.addGroup("some-group");var n,o,h,l,u=!t||"float"==t;a=a||this.navSrs;var c={id:i,properties:r},d=new Array(e.length);if(u){for(n=0,o=e.length;n<o;n++)h=e[n],l=[h[0],h[1],h[2]||0,c,null,null],this.addToHeightsBuffer(l),d[n]=l;c.floatHeights=!0,c.srs=a,c.heightsToProcess=o,this.heightsToProcess++}else if(s)for(n=0,o=e.length;n<o;n++)h=e[n],d[n]=[h[0],h[1],h[2]];else for(n=0,o=e.length;n<o;n++)d[n]=this.physSrs.convertCoordsFrom(e[n],a);return c.points=d,this.currentGroup.points.push(c),this},d.prototype.addLineString=function(e,t,r,i,a,s){this.currentGroup||this.addGroup("some-group");var n,o,h,l,u=!t||"float"==t;a=a||this.navSrs;var c={id:i,properties:r},d=new Array(e.length);if(u){for(n=0,o=e.length;n<o;n++)h=e[n],l=[h[0],h[1],h[2]||0,c,null,null],this.addToHeightsBuffer(l),d[n]=l;c.floatHeights=!0,c.srs=a,c.heightsToProcess=o,this.heightsToProcess+=o}else if(s)for(n=0,o=e.length;n<o;n++)h=e[n],d[n]=[h[0],h[1],h[2]];else for(n=0,o=e.length;n<o;n++)d[n]=this.physSrs.convertCoordsFrom(e[n],a);return c.lines=[d],this.currentGroup.lines.push(c),this},d.prototype.addLineStringArray=function(e,t,r,i,a,s){this.currentGroup||this.addGroup("some-group");var n,o,h,l,u,c,d,p,f=!t||"float"==t;a=a||this.navSrs;var m={id:i,properties:r},g=new Array(e.length);if(f){var v=0;for(h=0,l=e.length;h<l;h++){for(n=e[h],o=new Array(n.length),u=0,c=n.length;u<c;u++)d=n[u],p=[d[0],d[1],d[2]||0,m,null,null],this.addToHeightsBuffer(p),o[u]=p;v+=c,g[h]=o}m.floatHeights=!0,m.srs=a,m.heightsToProcess=v,this.heightsToProcess+=v}else for(h=0,l=e.length;h<l;h++){if(n=e[h],o=new Array(n.length),s)for(u=0,c=n.length;u<c;u++)d=n[u],o[u]=[d[0],d[1],d[2]];else for(u=0,c=n.length;u<c;u++)o[u]=this.physSrs.convertCoordsFrom(n[u],a);g[h]=o}return m.lines=g,this.currentGroup.lines.push(m),this},d.prototype.addPolygon=function(e,t,r,i,a,s,n){n=n||this.navSrs.srsProj4,t=t||[];var o,h,l,u,c,d,p,f,m,g,v,y=e;-1!=n.indexOf("+proj=longlat")&&(m=this.map.proj4(n,"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"));var b=3*e.length;for(o=0,h=t.length;o<h;o++)b+=3*t[o].length;y=new Array(b),v=new Array(b),l=0;var x=new Array(t.length+1),M=new Array(e.length);for(x[0]=M,o=0,h=e.length;o<h;o++)M[o]=o,f=e[o],v[l]=f[0],v[l+1]=f[1],v[l+2]=f[2],f=m?m.forward(e[o]):e[o],y[l]=f[0],y[l+1]=f[1],y[l+2]=f[2],l+=3;for(new Array(t.length),g=new Array(t.length),o=0,h=t.length;o<h;o++)for(p=t[o],g[o]=Math.round(l/3),M=new Array(p.length),x[o+1]=M,d=Math.floor(l/3),u=0,c=p.length;u<c;u++)f=p[u],v[l]=f[0],v[l+1]=f[1],v[l+2]=f[2],f=m?m.forward(p[u]):p[u],y[l]=f[0],y[l+1]=f[1],y[l+2]=f[2],l+=3,M[u]=d++;var S=vts.earcut(y,g,3);return this.addPolygonRAW(v,S,x,r,i,a,s,n),this},d.prototype.getPolygonCenter=function(e,t,r){if(e&&!e.length)return[0,0];var i=0,a=0,s=0;if(t){for(var n=0,o=e.length;n<o;n++){var h=e[n];i+=h[0],a+=h[1],s+=h[2]}return[i/o,a/o,s/o]}for(var n=0,o=e.length;n<o;n++){var h=e[n];h=r.forward(h),i+=h[0],a+=h[1],s+=h[2]}var l=i/o,u=a/o,c=s/o;return h=r.inverse([l,u,c]),[h[0],h[1],0]},d.prototype.addPolygon2=function(e,t,r,i,a,s,n){n=n||this.navSrs.srsProj4,t=t||[];var o,h,l,u,d,p,f,m,g,v,y,b=e,x=!0;-1!=n.indexOf("+proj=longlat")&&(x=!1,g=this.map.proj4(n,"+proj=geocent +datum=WGS84 +units=m +no_defs"));var M,S,w,A=document.getElementById("dbg-canvas"),T=A.getContext("2d"),C=300,P=4e-5,F=this.getPolygonCenter(e,x,g);this.addPoint(F,"fix",{},"aaa");var L=this.map.measure.getNewNED(F);w=L.direction,M=L.north,S=L.east,m=g.forward(F);var E=[m[0]+1e6*S[0],m[1]+1e6*S[1],m[2]+1e6*S[2]];this.addLineString([m,E],"fix",{},"line",null,!0);var E=[m[0]+1e6*w[0],m[1]+1e6*w[1],m[2]+1e6*w[2]];this.addLineString([m,E],"fix",{},"line",null,!0);var E=[m[0]+1e6*M[0],m[1]+1e6*M[1],m[2]+1e6*M[2]];if(this.addLineString([m,E],"fix",{},"line",null,!0),!x){var I=this.map.getPosition();I.setCoords(F),I.setOrientation([0,0,-90]);L=this.map.measure.getPositionCameraInfo(I,!1,!1).rotMatrix,c.inverse(L),w=[L[2],L[6],L[10]],M=[L[1],L[5],L[9]],S=[L[0],L[4],L[8]]}var N=3*e.length;for(o=0,h=t.length;o<h;o++)N+=3*t[o].length;b=new Array(N),y=new Array(N),l=0;var B=new Array(t.length+1),_=new Array(e.length);for(B[0]=_,o=0,h=e.length;o<h;o++)_[o]=o,m=e[o],y[l]=m[0],y[l+1]=m[1],y[l+2]=m[2],g?(m=g.forward(e[o]),m[0]=S[0]*m[0]+S[1]*m[1]+S[2]*m[2],m[1]=w[0]*m[0]+w[1]*m[1]+w[2]*m[2],m[2]=0):m=e[o],0==o?T.moveTo(m[0]*P+C,m[1]*P+C):T.lineTo(m[0]*P+C,m[1]*P+C),b[l]=m[0],b[l+1]=m[1],b[l+2]=m[2],l+=3;for(new Array(t.length),v=new Array(t.length),o=0,h=t.length;o<h;o++)for(f=t[o],v[o]=Math.round(l/3),_=new Array(f.length),B[o+1]=_,p=Math.floor(l/3),u=0,d=f.length;u<d;u++)m=f[u],y[l]=m[0],y[l+1]=m[1],y[l+2]=m[2],g?(m=g.forward(f[u]),m[0]=S[0]*m[0]+S[1]*m[1]+S[2]*m[2],m[1]=w[0]*m[0]+w[1]*m[1]+w[2]*m[2],m[2]=0):m=f[u],0==u?T.moveTo(m[0]*P+C,m[1]*P+C):T.lineTo(m[0]*P+C,m[1]*P+C),b[l]=m[0],b[l+1]=m[1],b[l+2]=m[2],l+=3,_[u]=p++;T.strokeStyle="#ff0000",T.stroke();var R=vts.earcut(b,v,3);return this.addPolygonRAW(y,R,B,r,i,a,s,n),this},d.prototype.insidePolygon=function(e,t,r){for(var i=e[0],a=e[1],s=!1,n=0,o=t.length-1,h=r||t.length;n<h;o=n++){var l=t[3*n],u=t[3*n+1],c=t[3*o],d=t[3*o+1];u>a!=d>a&&i<(c-l)*(a-u)/(d-u)+l&&(s=!s)}return s},d.prototype.addPolygon3=function(e,t,r,i,a,s,n){n=n||this.navSrs.srsProj4,t=t||[];var o,h,l,d,p,f,m,g,v,y,b,x,M,S,w,A=e,T=!0,C=0,P=t.length;-1!=n.indexOf("+proj=longlat")&&(T=!1,y=this.map.proj4(n,"+proj=geocent +datum=WGS84 +units=m +no_defs"));var F,L,E,I=this.getPolygonCenter(e,T,y);if(!T){var N=this.map.getPosition();N.setCoords(I),N.setOrientation([0,0,-90]);var B=this.map.measure.getPositionCameraInfo(N,!1,!1),_=B.rotMatrix;c.inverse(_),E=[_[2],_[6],_[10]],F=[_[1],_[5],_[9]],L=[_[0],_[4],_[8]]}var R=y.forward(I);R[0]=L[0]*R[0]+L[1]*R[1]+L[2]*R[2],R[1]=E[0]*R[0]+E[1]*R[1]+E[2]*R[2],R[2]=0;var k=3*e.length;for(o=0,h=t.length;o<h;o++)k+=3*t[o].length;A=new Array(k),x=new Array(k),l=0;var z=new Array(t.length+1),U=new Array(e.length);for(z[0]=U,y&&(v=y.forward(I),v[0]=L[0]*v[0]+L[1]*v[1]+L[2]*v[2],v[1]=F[0]*v[0]+F[1]*v[1]+F[2]*v[2],v[2]=0,v),o=0,h=e.length;o<h;o++)U[o]=o,v=e[o],x[l]=v[0],x[l+1]=v[1],x[l+2]=v[2],y?(v=y.forward(e[o]),v[0]=L[0]*v[0]+L[1]*v[1]+L[2]*v[2],v[1]=E[0]*v[0]+E[1]*v[1]+E[2]*v[2],v[2]=0):v=e[o],M=v[0]-R[0],S=v[1]-R[1],w=M*M+S*S,w>C&&(C=w,e[o]),A[l]=v[0],A[l+1]=v[1],A[l+2]=v[2],l+=3;for(new Array(t.length),b=new Array(t.length),o=0,h=t.length;o<h;o++)for(g=t[o],b[o]=Math.round(l/3),o<P&&(U=new Array(g.length),z[o+1]=U),m=Math.floor(l/3),p=0,f=g.length;p<f;p++)v=g[p],x[l]=v[0],x[l+1]=v[1],x[l+2]=v[2],y?(v=y.forward(g[p]),v[0]=L[0]*v[0]+L[1]*v[1]+L[2]*v[2],v[1]=E[0]*v[0]+E[1]*v[1]+E[2]*v[2],v[2]=0):v=g[p],A[l]=v[0],A[l+1]=v[1],A[l+2]=v[2],l+=3,o<P&&(U[p]=m++);var D,G,V,O,j,H,q,J,X,W,Y=vts.earcut(A,b,3),Z=Math.sqrt(C)/19,Q=new Array(z.length);for(o=0,h=z.length;o<h;o++)Q[o]=z[o].slice();var K,$,ee,te,re,ie,ae=new Array(196608),se=new Array(196608),ne=new Array(196608),oe=0,he=0,le=0,ue=new Array(196608);for(o=0,h=x.length;o<h;o+=3)ue[o]=x[o],ue[o+1]=x[o+1],ue[o+2]=x[o+2];var ce=Math.round(h/3),de=Z;for(o=0,h=Y.length;o<h;o+=3){D=Y[o],G=Y[o+1],V=Y[o+2],oe=3;var pe=null,fe=null,me=null;for(l=0,d=z.length;l<d;l++)for(U=z[l],W=Q[l],p=0,f=U.length;p<f;p++){var ge=p<U.length-1?p+1:0;(D==U[p]&&G==U[ge]||D==U[ge]&&G==U[p])&&(W[p]=[U[p]],pe=W[p]),(G==U[p]&&V==U[ge]||G==U[ge]&&V==U[p])&&(W[p]=[U[p]],fe=W[p]),(V==U[p]&&D==U[ge]||D==U[ge]&&V==U[p])&&(W[p]=[U[p]],me=W[p])}ae[0]=[D,pe],ae[1]=[G,fe],ae[2]=[V,me];var ve=0;do{for(l=0,d=oe;l<d;l+=3)if(te=ae[l][0],re=ae[l+1][0],ie=ae[l+2][0],pe=ae[l][1],fe=ae[l+1][1],me=ae[l+2][1],O=[ue[3*te],ue[3*te+1],ue[3*te+2]],j=[ue[3*re],ue[3*re+1],ue[3*re+2]],H=[ue[3*ie],ue[3*ie+1],ue[3*ie+2]],O=y.forward(O),j=y.forward(j),H=y.forward(H),K=u.length([O[0]-j[0],O[1]-j[1],O[2]-j[2]]),$=u.length([j[0]-H[0],j[1]-H[1],j[2]-H[2]]),ee=u.length([H[0]-O[0],H[1]-O[1],H[2]-O[2]]),(m=Math.max(K,$,ee))<Z)ne[le]=te,ne[le+1]=re,ne[le+2]=ie,le+=3;else{q=[.5*(O[0]+j[0]),.5*(O[1]+j[1]),.5*(O[2]+j[2])],J=[.5*(j[0]+H[0]),.5*(j[1]+H[1]),.5*(j[2]+H[2])],X=[.5*(H[0]+O[0]),.5*(H[1]+O[1]),.5*(H[2]+O[2])],q=y.inverse(q),q[2]=.5*(x[3*D+2]+x[3*G+2]),J=y.inverse(J),J[2]=.5*(x[3*G+2]+x[3*V+2]),X=y.inverse(X),X[2]=.5*(x[3*V+2]+x[3*D+2]);var ye=3*ce;K==m?(ue[ye]=q[0],ue[ye+1]=q[1],ue[ye+2]=q[2],pe&&(pe[0]=[[pe[0]],[-ce]],pe=pe[0]),m=he,se[m]=[te,pe?pe[0]:null],se[m+1]=[ce,null],se[m+2]=[ie,me||null],se[m+3]=[ce,pe?pe[1]:null],se[m+4]=[re,fe||null],se[m+5]=[ie,null]):$==m?(ue[ye]=J[0],ue[ye+1]=J[1],ue[ye+2]=J[2],fe&&(fe[0]=[[fe[0]],[-ce]],fe=fe[0]),m=he,se[m]=[te,pe||null],se[m+1]=[re,fe?fe[0]:null],se[m+2]=[ce,null],se[m+3]=[ce,fe?fe[1]:null],se[m+4]=[ie,me||null],se[m+5]=[te,null]):ee==m&&(ue[ye]=X[0],ue[ye+1]=X[1],ue[ye+2]=X[2],me&&(me[0]=[[me[0]],[-ce]],me=me[0]),m=he,se[m]=[te,pe||null],se[m+1]=[re,null],se[m+2]=[ce,me?me[1]:null],se[m+3]=[ce,null],se[m+4]=[re,fe||null],se[m+5]=[ie,me?me[0]:null]),ce+=1,he+=6}var be=ae;ae=se,se=be,oe=he,he=0,ve++}while(oe>0);Z=de}var xe=new Array(196608),Me=0,Se=function(e){for(var t=0,r=e.length;t<r;t++)Array.isArray(e[t])?Se(e[t]):(xe[Me]=e[t],Me++)},we=0;for(o=0,h=Q.length;o<h;o++)Se(Q[o]),Q[o]=xe.slice(we,Me),we=Me;for(Y=new Array(oe),o=0,h=le;o<h;o+=3)Y[o]=ne[o],Y[o+1]=ne[o+1],Y[o+2]=ne[o+2];for(x=new Array(3*ce),l=0,o=0,h=3*ce;o<h;o+=3)x[o]=ue[o],x[o+1]=ue[o+1],x[o+2]=ue[o+2],l++;this.addPolygonRAW(x,Y,Q,r,i,a,s,n)},d.prototype.addTerrainPolygon=function(e,t,r,i,a,s,n,o){},d.prototype.addPolygonRAW=function(e,t,r,i,a,s,n,o,h){this.currentGroup||this.addGroup("some-group");var l,u,c,d=!a||"float"==a,p=0;o=o||this.navSrs;var f={id:n,properties:s},m=new Array(Math.round(e.length/3));if(d){for(l=0,u=e.length;l<u;l+=3)c=[e[l],e[l+1],e[l+2],f,null,null],this.addToHeightsBuffer(c),m[p++]=c;f.floatHeights=!0,f.srs=o,f.heightsToProcess=m.length,this.heightsToProcess+=m.length}else for(l=0,u=e.length;l<u;l+=3)c=[e[l],e[l+1],e[l+2]],m[p++]=h?c:this.physSrs.convertCoordsFrom(c,o);var g=t.slice(),v=new Array(r.length);for(l=0,u=r.length;l<u;l++)v[l]=r[l].slice();return f.vertices=m,f.surface=g,f.borders=v,this.currentGroup.polygons.push(f),this},d.prototype.importVTSGeodata=function(e,t,r){return new l(this,t,r).processJSON(e)},d.prototype.importGeoJson=function(e,t,r,i,a){return new h(this,t,r,i,a).processJSON(e)},d.prototype.processHeights=function(e,t,r){if(this.heightsToProcess<=0)return void(r&&r(this));this.processingHeights&&this.processHeightsCalls.push(this.processHeights.bind(this,e,t)),this.processingHeights=!0,this.heightsSource=e,this.heightsLod=t;var i,a,s,n,o,n,h,l=this.heightsProcessBufferFirst;switch(e){case"node-by-precision":n=!0;case"heightmap-by-precision":h=l.coords,a=h[3].srs?this.navSrs.convertCoordsFrom(h,h[3].srs):h,o=this.map.measure.getOptimalHeightLodBySampleSize(a,t);break;case"node-by-lod":n=!0;case"heightmap-by-lod":o=t}do{h=l.coords,null==h[4]&&(a=h[3].srs?this.navSrs.convertCoordsFrom(h,h[3].srs):h,s=this.map.measure.getSpatialDivisionNode(a),h[4]=s[0],h[5]=s[1]),s=this.map.measure.getSurfaceHeight(h,o,null,h[4],h[5],null,n),(s[1]||s[2])&&(h[2]+=s[0],this.removeFromHeightsBuffer(l,i),h[3].heightsToProcess--,this.heightsToProcess--,h[3].heightsToProcess<=0&&(h[3].floatHeights=!1),a=[h[0],h[1],h[2]],a=this.physSrs.convertCoordsFrom(a,h[3].srs),h[0]=a[0],h[1]=a[1],h[2]=a[2]),i=l,l=l.next}while(l);this.heightsToProcess<=0?(this.updateCallback&&this.updateCallback(),this.processingHeights=!1,r&&r(this),this.processHeightsCalls.length>1&&this.processHeightsCalls.shift()()):this.updateCallback||(this.updateCallback=this.map.core.on("map-update",this.processHeights.bind(this,this.heightsSource,this.heightsLod,r)))},d.prototype.extractGeometry=function(e){for(var t,r,i,a,s,n,h,l,u,c,d,r=0,i=this.groups.length;r<i;r++){var a,s,p=this.groups[r],f=p.points,m=p.lines,g=p.polygons;for(a=0,s=f.length;a<s;a++)f[a].id==e&&(t=f[a]);for(a=0,s=m.length;a<s;a++)m[a].id==e&&(t=m[a]);for(a=0,s=g.length;a<s;a++)g[a].id==e&&(t=g[a])}if(t){if(t.points){if(n=t.points,n.length>0)for(l=new Float64Array(3*n.length),r=0,i=n.length;r<i;r++)c=3*r,d=n[r],l[c]=d[0],l[c+1]=d[1],l[c+2]=d[2];return new o(this.map,{type:"point-geometry",id:t.id,geometryBuffer:l})}if(t.lines){if(h=t.lines,h.length>0){var v=0;for(r=0,i=h.length;r<i;r++)v+=h[r].length;for(l=new Float64Array(3*v),u=new Uint32Array(i),c=0,r=0,i=h.length;r<i;r++){var n=h[r];for(a=0,s=n.length;a<s;a++)d=n[a],l[c]=d[0],l[c+1]=d[1],l[c+2]=d[2],c+=3}}return new o(this.map,{type:"line-geometry",id:t.id,geometryBuffer:l,indicesBuffer:u})}if(t.vertices)return new o(this.map,{type:"polygon-geometry",id:t.id,geometryBuffer:t.vertices,surface:t.surface})}else;},d.prototype.compileGroup=function(e,t){var r,i,a,s,n,o,h,l,u,c,d,p,f,m=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],g=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],v={},y=e.points,b=e.lines,x=e.polygons;for(v.id=e.id,h=0,l=y.length;h<l;h++)for(r=y[h].points,u=0,c=r.length;u<c;u++)i=r[u],i[0]>g[0]&&(g[0]=i[0]),i[1]>g[1]&&(g[1]=i[1]),i[2]>g[2]&&(g[2]=i[2]),i[0]<m[0]&&(m[0]=i[0]),i[1]<m[1]&&(m[1]=i[1]),i[2]<m[2]&&(m[2]=i[2]);for(h=0,l=b.length;h<l;h++)for(n=b[h].lines,u=0,c=n.length;u<c;u++)for(o=n[u],d=0,p=o.length;d<p;d++)i=o[d],i[0]>g[0]&&(g[0]=i[0]),i[1]>g[1]&&(g[1]=i[1]),i[2]>g[2]&&(g[2]=i[2]),i[0]<m[0]&&(m[0]=i[0]),i[1]<m[1]&&(m[1]=i[1]),i[2]<m[2]&&(m[2]=i[2]);for(h=0,l=x.length;h<l;h++)for(r=x[h].vertices,u=0,c=r.length;u<c;u++)i=r[u],i[0]>g[0]&&(g[0]=i[0]),i[1]>g[1]&&(g[1]=i[1]),i[2]>g[2]&&(g[2]=i[2]),i[0]<m[0]&&(m[0]=i[0]),i[1]<m[1]&&(m[1]=i[1]),i[2]<m[2]&&(m[2]=i[2]);if(!t){t=Math.max(g[0]-m[0]+1,g[1]-m[1]+1,g[2]-m[2]+1)/.25,t=Math.max(t,1024),t=Math.min(t,2<<20)}v.resolution=t;var M=[t/(g[0]-m[0]+1),t/(g[1]-m[1]+1),t/(g[2]-m[2]+1)];for(v.points=new Array(y.length),h=0,l=y.length;h<l;h++){a=y[h],r=a.points;var S=new Array(r.length);for(u=0,c=r.length;u<c;u++)i=r[u],S[u]=[Math.round((i[0]-m[0])*M[0]),Math.round((i[1]-m[1])*M[1]),Math.round((i[2]-m[2])*M[2])];s={points:S},a.id&&(s.id=a.id),a.properties&&(s.properties=a.properties),v.points[h]=s}for(v.lines=new Array(b.length),h=0,l=b.length;h<l;h++){a=b[h],n=a.lines;var w=new Array(n.length);for(u=0,c=n.length;u<c;u++){for(o=n[u],S=new Array(o.length),d=0,p=o.length;d<p;d++)i=o[d],S[d]=[Math.round((i[0]-m[0])*M[0]),Math.round((i[1]-m[1])*M[1]),Math.round((i[2]-m[2])*M[2])];w[u]=S}s={lines:w},a.id&&(s.id=a.id),a.properties&&(s.properties=a.properties),v.lines[h]=s}for(v.polygons=new Array(x.length),h=0,l=x.length;h<l;h++){a=x[h],r=a.vertices;var A=new Array(r.length);for(d=0,u=0,c=r.length;u<c;u++)i=r[u],A[d++]=Math.round((i[0]-m[0])*M[0]),A[d++]=Math.round((i[1]-m[1])*M[1]),A[d++]=Math.round((i[2]-m[2])*M[2]);s={vertices:A,surface:a.surface.slice()},f=a.borders;var T=new Array(f.length);for(u=0,c=T.length;u<c;u++)T[u]=f[u].slice();s.borders=T,a.id&&(s.id=a.id),a.properties&&(s.properties=a.properties),v.polygons[h]=s}return v.bbox=[m,g],g[0]>this.bboxMax[0]&&(this.bboxMax[0]=g[0]),g[1]>this.bboxMax[1]&&(this.bboxMax[1]=g[1]),g[2]>this.bboxMax[2]&&(this.bboxMax[2]=g[2]),m[0]<this.bboxMin[0]&&(this.bboxMin[0]=m[0]),m[1]<this.bboxMin[1]&&(this.bboxMin[1]=m[1]),m[2]<this.bboxMin[2]&&(this.bboxMin[2]=m[2]),v},d.prototype.makeGeodata=function(e){this.bboxMin=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],this.bboxMax=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(var t={version:1,groups:[]},r=0,i=this.groups.length;r<i;r++)t.groups.push(this.compileGroup(this.groups[r],e));return t},d.prototype.makeFreeLayer=function(e,t){var r=this.makeGeodata(t);return e||(e={layers:{"my-lines":{filter:["==","#type","line"],line:!0,"line-width":4,"line-color":[255,0,255,255],"zbuffer-offset":[-5,0,0]},"my-points":{filter:["==","#type","point"],point:!0,"point-radius":10,"point-color":[0,0,255,255],"zbuffer-offset":[-5,0,0]}}}),{credits:[],displaySize:1024,extents:{ll:this.bboxMin,ur:this.bboxMax},geodata:r,style:e,type:"geodata"}},t.a=d},function(e,t,r){"use strict";var i=r(2),a=i.b,s=function(e,t){switch(this.map=e,this.data=t,this.camera=e.camera,this.renderer=e.renderer,t.type){case"point-geometry":this.type=1,this.vertexBuffer=this.data.geometryBuffer;break;case"line-geometry":this.type=2,this.vertexBuffer=this.data.geometryBuffer,this.indicesBuffer=this.data.indicesBuffer;break;case"polygon-geometry":this.type=3,this.vertexBuffer=this.data.geometryBuffer,this.surface=this.data.surface,this.borders=this.data.borders}};s.prototype.getType=function(){switch(this.type){case 1:return"point";case 2:return"line";case 3:return"polygon"}},s.prototype.getElement=function(e){var t=this.vertexBuffer,r=3*e;switch(this.type){case 1:return[t[r],t[r+1],t[r+2]];case 2:return[[t[r],t[r+1],t[r+2]],[t[r+3],t[r+4],t[r+5]]];case 3:var i=this.surface,a=i[r],s=i[r+1],n=i[r+2];return[[t[a][0],t[a][1],t[a][2]],[t[s][0],t[s][1],t[s][2]],[t[n][0],t[n][1],t[n][2]]]}},s.prototype.getElements=function(e){switch(this.type){case 1:case 3:return this.surface.length/3;case 2:e=e||0;var t=3*this.indicesBuffer[e],r=e+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[e];return Math.max(0,(r-t)/3-1)}},s.prototype.getRelationToCanvasPoint=function(e,t,r){var i,s,n,o,h,l,u,c,d,p,f,m,g,v,g=this.vertexBuffer,y=3*e,b=[0,0,0];switch(i=this.camera.position,s=this.renderer.getScreenRay(t,r),this.type){case 1:var n=[g[y],g[y+1],g[y+2]],x=[n[0]-l[0],n[0]-l[0]];return a.cross(s,x,b),u=a.length(n),{distance:u,point:n};case 2:var M=[g[y],g[y+1],g[y+2]],S=[g[y+3],g[y+4],g[y+5]];m=s,g=[S[0]-M[0],S[1]-M[1],S[2]-M[2]],v=[i[0]-M[0],i[1]-M[1],i[2]-M[2]],o=a.dot(m,m),h=a.dot(m,g),l=a.dot(g,g),u=a.dot(m,v),c=a.dot(g,v),d=o*l-h*h,d<1e-7?(p=0,f=h>l?u/h:c/l):(p=(h*c-l*u)/d,f=(o*c-h*u)/d);var w=[v[0]+m[0]*p-g[0]*f,v[1]+m[1]*p-g[1]*f,v[2]+m[2]*p-g[2]*f];return{closest:[M[0]+g[0]*f,M[1]+g[1]*f,M[2]+g[2]*f],"line-distance":a.length(w),distance:f,line:[M,S]}}},s.prototype.getPathElement=function(e,t){if(2!=this.type)return null;var r=3*(this.indicesBuffer[t||0]+e),i=this.vertexBuffer;return[[i[r],i[r+1],i[r+2]],[i[r+3],i[r+4],i[r+5]]]},s.prototype.getPathPoint=function(e,t){t=t||0;for(var r,i,s=3*this.indicesBuffer[t],n=t+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[t],o=0,h=this.vertexBuffer,l=s;l<n-3;l+=3){if(r=[h[l+3]-h[l],h[l+4]-h[l+1],h[l+5]-h[l+2]],i=a.length(r),o+i>e){var u=(e-o)/i;return[h[l]+r[0]*u,h[l+1]+r[1]*u,h[l+2]+r[2]*u]}o+=i}return[h[n-3],h[n-2],h[n-1]]},s.prototype.getPathNED=function(e,t,r){r=r||0;for(var i,s,n,o=3*this.indicesBuffer[r],h=r+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[r],l=0,u=this.vertexBuffer,c=o;c<h-5;c+=3){if(s=[u[c+3]-u[c],u[c+4]-u[c+1],u[c+5]-u[c+2]],n=a.length(s),l+n>e){var p=(l+n)/e;i=[u[c]+d[0]*p,u[c+1]+d[1]*p,u[c+2]+d[2]*p];break}l+=n}i||(i=[u[h-3],u[h-2],u[h-1]]);var f=[0,0,0],m=[0,0,0],g=[0,0,0];a.nomalize(s,f),a.nomalize(i,g),a.cross(g,f,m),t&&a.cross(g,m,f);var v=m,y=f,b=g;return{east:v,direction:y,north:b,position:i,matrix:[v[0],v[1],v[2],0,b[0],b[1],b[2],0,y[0],y[1],y[2],0,0,0,0,1]}},s.prototype.getPathLengthToElement=function(e,t){t=t||0;for(var r,i,s=3*this.indicesBuffer[t],n=t+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[t],o=0,h=this.vertexBuffer,l=0,u=s;u<n-5;u+=3){if(r=[h[u+3]-h[u],h[u+4]-h[u+1],h[u+5]-h[u+2]],i=a.length(r),e==l)return{lengthToElement:o,elementLengh:i};l++,o+=i}return o},s.prototype.getPathLength=function(e){e=e||0;for(var t,r,i=3*this.indicesBuffer[e],s=e+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[e],n=0,o=this.vertexBuffer,h=i;h<s-5;h+=3)t=[o[h+3]-o[h],o[h+4]-o[h+1],o[h+5]-o[h+2]],r=a.length(t),n+=r;return n},s.prototype.getPathsCount=function(){return 2!=this.type?0:this.indicesBuffer.length},s.prototype.getSurfaceArea=function(){if(3!=this.type)return 0;if(!this.surfaceArea){var e,t,r,i,a,s,n,o,h,l,u,c=this.vertexBuffer,d=this.surface;this.surfaceArea=0;for(var p=0,f=d.length;p<f;p+=3)e=c[d[p]],t=c[d[p+1]],r=c[d[p+2]],n=t[0]-e[0],o=t[1]-e[1],h=t[2]-e[2],i=Math.sqrt(n*n+o*o+h*h),n=t[0]-r[0],o=t[1]-r[1],h=t[2]-r[2],a=Math.sqrt(n*n+o*o+h*h),n=r[0]-e[0],o=r[1]-e[1],h=r[2]-e[2],s=Math.sqrt(n*n+o*o+h*h),l=(i+a+s)/2,u=Math.sqrt(l*((l-i)*(l-a)*(l-s))),this.surfaceArea+=u}return this.surfaceArea},t.a=s},function(e,t,r){"use strict";var i=function(e,t,r,i,a){this.builder=e,this.map=e.map,this.heightMode=t||"float",this.srs=r,this.groupIdPrefix=i||"",this.dontCreateGroups=a};i.prototype.processGeometry=function(e,t){var r=e.coordinates;if(r)switch(e.type){case"Point":this.builder.addPoint(r,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"MultiPoint":this.builder.addPointArray(r,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"LineString":this.builder.addLineString(r,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"MultiLineString":this.builder.addLineStringArray(r,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"GeometryCollection":var i=e.gemetries;if(i)for(var a=0,s=i.length;a<s;a++)this.processGeometry(i[a],t)}},i.prototype.processFeature=function(e){var t=e.geometry;t&&this.processGeometry(t,e)},i.prototype.processCollection=function(e){var t=e.features;if(t)for(var r=0,i=t.length;r<i;r++)this.processFeature(t[r])},i.prototype.processJSON=function(e){if(e)if(e.type)switch(e.type){case"FeatureCollection":this.dontCreateGroups||this.builder.addGroup(""!=this.groupIdPrefix?this.groupIdPrefix:null),this.processCollection(e);break;case"Feature":this.dontCreateGroups||this.builder.addGroup(""!=this.groupIdPrefix?this.groupIdPrefix:null),this.processFeature(e)}else for(var t in e){var r=e[t];switch(this.dontCreateGroups||this.builder.addGroup(this.groupIdPrefix+t),e.type){case"FeatureCollection":this.processCollection(r);break;case"Feature":this.processFeature(r)}}},t.a=i},function(e,t,r){"use strict";var i=function(e,t,r){this.builder=e,this.map=e.map,this.groupIdPrefix=t||"",this.dontCreateGroups=r};i.prototype.processJSON=function(e){if(e){var t,r,i,a,s,n,o,h,l,u=e.groups,c=this.builder;if(u)for(t=0,r=u.length;t<r;t++){var d=u[t],p=d.bbox,f=d.resolution;if(p&&f){var m=p[0],g=p[1];if(m&&g){this.dontCreateGroups||c.addGroup(this.groupIdPrefix+(d.id||""));var v=(g[0]-m[0])/f,y=(g[1]-m[1])/f,b=(g[2]-m[2])/f,x=d.points;if(x)for(l=x.points,i=0,a=x.length;i<a;i++){var M=x[i],S=M.points,w=new Array(S.length);for(s=0,n=S.length;s<n;s++)o=S[s],w[s]=[m[0]+o[0]*v,m[1]+o[1]*y,m[2]+o[2]*b];c.addPointArray(w,"fix",M.properties,M.id,null,!0)}var A=d.lines;if(A)for(i=0,a=A.length;i<a;i++){var T=A[i],C=T.lines,P=new Array(C.length);for(s=0,n=C.length;s<n;s++){l=C[s],h=new Array(l.length);for(var F=0,L=l.length;F<L;F++)o=l[F],h[F]=[m[0]+o[0]*v,m[1]+o[1]*y,m[2]+o[2]*b];P[s]=h}c.addLineStringArray(P,"fix",T.properties,T.id,null,!0)}}}}}},t.a=i},function(e,t,r){"use strict";var i=function(e,t){this.layer=e,this.map=e.map,this.renderer=this.map.renderer,this.killed=!1,this.listener=t,this.busy=!1,this.ready=!0,this.waitingForStylesheet=!1,this.stylesheet=null,this.fonts={};var i=r(117);this.processWorker=new i,this.processWorker.onerror=function(e){throw new Error(e.message+" ("+e.filename+":"+e.lineno+")")},this.processWorker.onmessage=this.onMessage.bind(this)};i.prototype.kill=function(){this.killed||(this.killed=!0,null!=this.processWorker&&this.processWorker.terminate())},i.prototype.isReady=function(){return this.waitingForStylesheet&&(this.waitingForStylesheet=!this.stylesheet.isReady()),(this.ready&&!this.busy||this.killed)&&!this.waitingForStylesheet},i.prototype.onMessage=function(e){if(!this.killed){e=e.data;var t=e.command;"ready"==t?this.ready=!0:"styleDone"==t&&(this.busy=!1),null!=this.listener&&this.listener(t,e)}},i.prototype.setListener=function(e){this.listener=e},i.prototype.sendCommand=function(e,t,r,i){if(!this.killed){this.ready=!1;var a={command:e,data:t};r&&r.id&&(a.lod=r.id[0],r.metanode&&(a.tileSize=Math.tan(r.metanode.diskAngle2A)*r.metanode.diskDistance,a.pixelSize=.70710678118*a.tileSize/r.metanode.displaySize)),i&&(a.dpr=i),this.processWorker.postMessage(a)}},i.prototype.setStylesheet=function(e,t){if(this.stylesheet=e,!e.isReady())return void(this.waitingForStylesheet=!0);this.busy=!0;var r=this.map.config,i=r.mapFeaturesReduceParams,a=function(e){return"undefinde"!=typeof e};switch(r.mapFeaturesReduceMode){case"scr-count2":i?(i[0]=a(i[0])?i[0]:1,i[1]=a(i[1])?i[1]:50,i[2]=a(i[2])?i[2]:0,r.mapFeaturesSortByTop=!0):i=[1,50,0];case"scr-count4":i?(i[0]=a(i[0])?i[0]:.18,i[1]=a(i[1])?i[1]:0,i[2]=a(i[2])?i[2]:0,r.mapFeaturesSortByTop=!0):i=[.18,0,0];break;case"scr-count5":i?(i[0]=a(i[0])?i[0]:2,i[1]=a(i[1])?i[1]:1,i[2]=a(i[2])?i[2]:0,r.mapFeaturesSortByTop=!0):i=[2,1,0]}if(r.mapFeaturesReduceFactor=i[2],!r.mapFeaturesReduceParams)switch(r.mapFeaturesReduceMode){case"scr-count2":r.mapFeaturesReduceParams=[1,50,0];break;case"scr-count4":r.mapFeaturesReduceParams=[.18,0,1];break;case"scr-count5":r.mapFeaturesReduceParams=[2,1,1]}this.sendCommand("setStylesheet",{data:e.data,geocent:!this.map.getNavigationSrs().isProjected(),metric:r.mapMetricUnits,reduceMode:r.mapFeaturesReduceMode,reduceParams:r.mapFeaturesReduceParams});var s=e.fonts,n={};for(var o in s){var h=s[o],l=this.renderer.fonts[h];n[o]=h,l&&this.setFont(h,l)}this.sendCommand("setFontMap",{map:n})},i.prototype.setFont=function(e,t){this.fonts[e]||(this.fonts[e]=t,this.sendCommand("setFont",{url:e,data:t.data},[t.data]))},t.a=i},function(e,t,r){"use strict";var i=r(153),a=r(47),s=r(54),n=r(31),o=r(133),h=i.a,l=a.a,u=s.a,c=n.a,d=o.a,p=function(e){this.map=e,this.config=e.config};p.prototype.setPosition=function(e){return this.map.setPosition(e),this},p.prototype.getPosition=function(){return this.map.getPosition()},p.prototype.setView=function(e){return this.map.setView(e),this},p.prototype.getView=function(){return this.map.getView()},p.prototype.getCredits=function(){return this.map.getCredits()},p.prototype.getCurrentCredits=function(){return this.map.getVisibleCredits()},p.prototype.getCreditInfo=function(e){var t=this.map.getCreditById(e);return t?t.getInfo():{}},p.prototype.getViews=function(){return this.map.getNamedViews()},p.prototype.getViewInfo=function(e){var t=this.map.getNamedView(e);return t?t.getInfo():{}},p.prototype.getBoundLayers=function(){return this.map.getBoundLayers()},p.prototype.getBoundLayerInfo=function(e){return this.map.getBoundLayerInfo(e)},p.prototype.getFreeLayers=function(){return this.map.getFreeLayers()},p.prototype.getFreeLayerInfo=function(e){var t=this.map.getFreeLayer(e);return t?t.getInfo():{}},p.prototype.getSurfaces=function(){return this.map.getSurfaces()},p.prototype.getSurfaceInfo=function(e){var t=this.map.getFreeLayer(e);return t?t.getInfo():{}},p.prototype.getSrses=function(){return this.map.getSrses()},p.prototype.getSrsInfo=function(e){var t=this.map.getSrs(e);return t?t.getInfo():{}},p.prototype.getReferenceFrame=function(){return this.map.referenceFrame.getInfo()},p.prototype.addFreeLayer=function(e,t){var r=new u(this.map,t,"free");this.map.addFreeLayer(e,r)},p.prototype.removeFreeLayer=function(e){this.map.removeFreeLayer(e)},p.prototype.addBoundLayer=function(e,t){var r=new l(this.map,t,e);this.map.addBoundLayer(e,r)},p.prototype.removeBoundLayer=function(e){this.map.removeBoundLayer(e)},p.prototype.convertPositionViewMode=function(e,t){return this.map.convert.convertPositionViewMode(new c(e),t)},p.prototype.convertPositionHeightMode=function(e,t,r){return this.map.convert.convertPositionHeightMode(new c(e),t,r)},p.prototype.convertCoords=function(e,t,r){var i=this.map.getSrs(e),a=this.map.getSrs(t);return i&&a?a.convertCoordsFrom(r,i):null},p.prototype.convertCoordsFromNavToPublic=function(e,t,r){var i=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionPublicCoords(new c(i),r)},p.prototype.convertCoordsFromPublicToNav=function(e,t,r){var i=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionNavCoordsFromPublic(new c(i),r)},p.prototype.convertCoordsFromPhysToPublic=function(e){return this.map.convert.convertCoords(e,"physical","public")},p.prototype.convertCoordsFromNavToPhys=function(e,t,r){var i=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionPhysCoords(new c(i),r)},p.prototype.convertCoordsFromPhysToNav=function(e,t,r){return this.map.convert.convertCoordsFromPhysToNav(e,t,r)},p.prototype.convertCoordsFromNavToCanvas=function(e,t,r){var i=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionCanvasCoords(new c(i),r)},p.prototype.convertCoordsFromPhysToCanvas=function(e){var t=["obj",e[0],e[1],"fix",e[2],0,0,0,10,45];return this.map.convert.getPositionCanvasCoords(new c(t),null,!0)},p.prototype.convertCoordsFromNavToCameraSpace=function(e,t,r){var i=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionCameraSpaceCoords(new c(i),r)},p.prototype.convertCoordsFromPhysToCameraSpace=function(e){var t=this.map.camera.position;return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},p.prototype.getPositionCanvasCoords=function(e,t){return this.map.convert.getPositionCanvasCoords(new c(e),t)},p.prototype.getPositionCameraCoords=function(e,t){return this.map.convert.getPositionCameraCoords(new c(e),t)},p.prototype.movePositionCoordsTo=function(e,t,r,i){return this.map.convert.movePositionCoordsTo(new c(e),t,r,i)},p.prototype.getGeodesicLinePoints=function(e,t,r,i){return this.map.convert.getGeodesicLinePoints(e,t,r,i)},p.prototype.getSurfaceHeight=function(e,t){return this.map.measure.getSurfaceHeight(e,this.map.measure.getOptimalHeightLodBySampleSize(e,t))},p.prototype.getSurfaceAreaGeometry=function(e,t,r,i,a,s){var n=this.map.measure.getSurfaceAreaGeometry(e,t,r,i,!0,s);if(n[0]){var o=n[1],h=[],l=this.map;return l.tree&&(l.storedTilesRes=[],l.tree.storeGeometry(o,o.length),h=l.storedTilesRes,l.storedTilesRes=[]),a(h),function(){}}return this.map.core.once("map-update",this.getSurfaceAreaGeometry.bind(this,e,t,r,i,a,s),1)},p.prototype.getDistance=function(e,t,r,i){return this.map.measure.getDistance(e,t,r,i)},p.prototype.getAzimuthCorrection=function(e,t){return this.map.measure.getAzimuthCorrection(e,t)},p.prototype.getNED=function(e,t){return this.map.measure.getNewNED(e,!1!==t)},p.prototype.getCameraInfo=function(){var e=this.map.camera;return{projectionMatrix:e.camera.projection.slice(),viewMatrix:e.camera.modelview.slice(),viewProjectionMatrix:e.camera.mvp.slice(),rotationMatrix:e.camera.rotationview.slice(),position:this.map.camera.position.slice(),vector:this.map.camera.vector.slice(),distance:this.map.camera.distance,height:this.map.camera.height}},p.prototype.isPointInsideCameraFrustum=function(e){return this.map.camera.camera.pointVisible(e,this.map.camera.position)},p.prototype.isBBoxInsideCameraFrustum=function(e){return this.map.camera.camera.bboxVisible({min:e[0],max:e[1]},this.map.camera.position)},p.prototype.generateTrajectory=function(e,t,r){return e=new c(e),t=new c(t),new h(this.map,e,t,r).generate()},p.prototype.generatePIHTrajectory=function(e,t,r,i){var a=new c(e);return i.distance=r,i.azimuth=t,i.distanceAzimuth=!0,new h(this.map,a,a,i).generate()},p.prototype.setConfigParams=function(e){return this.map.setConfigParams(e),this},p.prototype.setConfigParam=function(e,t){return this.map.setConfigParam(e,t),this},p.prototype.getConfigParam=function(e){return this.map.getConfigParam(e)},p.prototype.redraw=function(){return this.map.markDirty(),this},p.prototype.addRenderSlot=function(e,t,r){return this.map.renderSlots.addRenderSlot(e,t,r),this},p.prototype.moveRenderSlotBefore=function(e,t){return this.map.renderSlots.moveRenderSlotBefore(e,t),this},p.prototype.moveRenderSlotAfter=function(e,t){return this.map.renderSlots.moveRenderSlotAfter(e,t),this},p.prototype.removeRenderSlot=function(e){return this.map.renderSlots.removeRenderSlot(e),this},p.prototype.setRenderSlotEnabled=function(e,t){return this.map.renderSlots.setRenderSlotEnabled(e,t),this},p.prototype.getRenderSlotEnabled=function(e){return this.map.renderSlots.getRenderSlotEnabled(e)},p.prototype.setLoaderSuspended=function(e){return this.map.loaderSuspended=e,this},p.prototype.getLoaderSuspended=function(){return this.map.loaderSuspended},p.prototype.getGpuCache=function(){return this.map.gpuCache},p.prototype.getHitCoords=function(e,t,r,i){return this.map.getHitCoords(e,t,r,i)},p.prototype.getScreenRay=function(e,t){return this.map.getScreenRay(e,t)},p.prototype.renderToImage=function(){return this.map.renderToImage()},p.prototype.getCurrentGeometry=function(){return this.map.getCurrentGeometry()},p.prototype.getStats=function(e){if(e)return{maxZoom:this.map.draw.debug.maxZoom};for(var t=0,r=0,i=this.map.geodataProcessors;r<i;r++)this.map.geodataProcessors[r].busy&&t++;return{bestMeshTexelSize:this.map.bestMeshTexelSize,bestGeodataTexelSize:this.map.bestGeodataTexelSize,downloading:this.map.loader.downloading.length,lastDownload:this.map.loader.lastDownloadTime,surfaces:this.map.tree.surfaceSequence.length,freeLayers:this.map.freeLayerSequence.length,texelSizeFit:this.map.texelSizeFit,loadMode:this.map.config.mapLoadMode,processingTasks:this.map.processingTasks.length,busyWorkers:t,dirty:this.map.dirty,drawnTiles:this.map.stats.drawnTiles,drawnGeodataTiles:this.map.stats.drawnGeodataTiles}},p.prototype.click=function(e,t,r){this.map.click(e,t,r)},p.prototype.hover=function(e,t,r,i){this.map.hover(e,t,r,i)},p.prototype.createGeodata=function(){return new d(this.map)},p.prototype.getGeodataGeometry=function(e){return this.map.renderer.geometries[e]},p.prototype.setGeodataSelection=function(e){return this.map.renderer.geodataSelection=e,this.map.markDirty(),this},p.prototype.getGeodataSelection=function(){return this.map.renderer.geodataSelection},t.a=p},function(e,t,r){"use strict";var i=function(e,t){this.map=e,this.maxThreads=t||1,this.usedThreads=0,this.maxPending=2*this.maxThreads,this.fadeout=.95,this.pending=[[],[]],this.channel=0,this.downloading=[],this.downloadingTime=[],this.lastDownloadTime=0,this.downloaded=0,this.updateThreadCount()};i.prototype.updateThreadCount=function(){this.maxThreads=this.map.config.mapDownloadThreads,this.maxPending=Math.max(20,2*this.maxThreads),this.fadeout=(this.maxPending-1)/this.maxPending},i.prototype.setChannel=function(e){this.channel=e},i.prototype.load=function(e,t,r,i,a){var s=this.downloading.indexOf(e);if(-1==s){var n=this.pending[this.channel];s=this.map.searchArrayIndexById(n,e),-1!=s?n[s].priority=r:n.unshift({id:e,call:t,priority:r||0,tile:i,kind:a});do{for(var o=!0,h=0,l=n.length-1;h<l;h++)if(n[h].priority>n[h+1].priority){var u=n[h];n[h]=n[h+1],n[h+1]=u,o=!1}}while(!o);n.length>this.maxPending&&n.pop()}},i.prototype.remove=function(e){var t=this.map.searchArrayIndexById(this.pending[this.channel],e);-1!=t&&this.pending[this.channel].splice(t,1)},i.prototype.onLoaded=function(e){var t=this.downloading.indexOf(e.id),r=performance.now(),i=this.map.stats;this.map.draw.replay.storeLoaded&&this.map.draw.replay.loaded.push({url:e.id,kind:e.kind,tile:e.tile,priority:e.priority,time:r,duration:r-this.downloadingTime[t],interval:r-this.lastDownloadTime,threads:this.downloading.length}),this.downloading.splice(t,1),this.downloadingTime.splice(t,1),this.lastDownloadTime=r,this.usedThreads--,this.map.markDirty(),this.update(),i.loadedCount++,i.loadLast=r},i.prototype.onLoadError=function(e){var t=this.downloading.indexOf(e.id),r=performance.now(),i=this.map.stats;this.map.draw.replay.storeLoaded&&this.map.draw.replay.loaded.push({url:e.id,kind:e.kind,tile:e.tile,priority:e.priority,time:r,duration:r-this.downloadingTime[t],interval:r-this.lastDownloadTime,threads:this.downloading.length}),this.downloading.splice(t,1),this.downloadingTime.splice(t,1),this.lastDownloadTime=r,this.usedThreads--,this.map.markDirty(),this.update(),i.loadErrorCount++,i.loadLast=r},i.prototype.updateChannel=function(e){var t=this.pending[e];this.updateThreadCount();for(var r=0,i=t.length;r<i;r++)t[r].priority*=this.fadeout;for(var a=performance.now();t.length>0&&this.usedThreads<this.maxThreads;){var s=t.shift();-1==this.downloading.indexOf(s.id)&&null!=s.call&&(this.downloading.push(s.id),this.downloadingTime.push(a),this.usedThreads++,this.downloaded++,s.call(s.id,this.onLoaded.bind(this,s),this.onLoadError.bind(this,s)))}},i.prototype.update=function(){if(!this.map.loaderSuspended)for(var e=this.pending.length-1;e>=0;e--)if(this.pending[e].length>0){this.updateChannel(e);break}},t.a=i},function(e,t,r){"use strict";var i=r(2),a=r(4),s=r(22),n=r(56),o=r(53),h=r(148),l=r(50),u=r(126),c=r(127),d=r(128),p=r(129),f=r(141),m=r(132),g=r(139),v=r(31),y=r(146),b=r(149),x=r(151),M=r(154),S=r(6),w=i.b,A=a.a,T=s.a,C=n.a,P=o.a,F=h.a,L=l.a,E=u.a,I=c.a,N=d.a,B=p.a,_=f.a,R=m.a,k=g.a,z=v.a,U=y.a,D=b.a,G=x.a,V=M.a,O=S.a,j=function(e,t,r,i){this.config=i||{},this.setConfigParams(i),this.core=e,this.proj4=this.core.getProj4(),this.coreConfig=e.coreConfig,this.killed=!1,this.config=i||{},this.loaderSuspended=!1,this.url=new V(this,r),this.position=new z(["obj",0,0,"fix",0,0,0,0,0,0]),this.lastPosition=this.position.clone(),this.srses={},this.bodies={},this.referenceFrame={},this.credits={},this.creditsByNumber={},this.surfaces=[],this.virtualSurfaces={},this.glues={},this.freeLayers=[],this.boundLayers=[],this.dynamicLayers=[],this.stylesheets=[],this.processingTasks=[],this.geodataProcessors=[],this.surfaceSequence=new G(this),this.initialView=null,this.currentView=new C(this,{}),this.currentViewString="",this.namedViews=[],this.viewCounter=0,this.srsReady=!1,this.freeLayerSequence=[],this.freeLayersHaveGeodata=!1,this.visibleCredits={imagery:{},glueImagery:{},mapdata:{}},this.mobile=!1,this.metanodeBuffer=new Uint8Array(1024),this.gpuCache=new E(this,1024*this.config.mapGPUCache*1024),this.resourcesCache=new E(this,1024*this.config.mapCache*1024),this.metatileCache=new E(this,1024*this.config.mapMetatileCache*1024),this.setupMobileMode(this.config.mapMobileMode),this.setupCache(),this.loader=new k(this,this.config.mapDownloadThreads),this.renderer=this.core.renderer,this.camera=new I(this),this.stats=new D(this),this.resourcesTree=new F(this),this.mapConfig=new N(this,t),this.convert=new B(this),this.measure=new _(this),this.convert.measure=this.measure,this.isGeocent=!this.getNavigationSrs().isProjected(),this.tree=new P(this,!1),this.mapConfig.afterConfigParsed(),this.updateCoutner=0,this.dirty=!0,this.dirtyCountdown=0,this.hitMapDirty=!0,this.geoHitMapDirty=!0,this.clickEvent=null,this.hoverEvent=null,this.hoverFeature=null,this.hoverFeatureId=null,this.lastHoverFeature=null,this.lastHoverFeatureId=null,this.hoverFeatureCounter=0,this.hoverFeatureList=[],this.draw=new R(this),this.draw.setupDetailDegradation();var a,s=this.referenceFrame.body;if(s&&s.atmosphere)a=s.atmosphere.colorHorizon,this.draw.atmoColor=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],a=s.atmosphere.colorZenith,this.draw.atmoColor2=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],this.draw.atmoHeight=s.atmosphere.thickness/1e5*5e4,this.draw.atmoDensity=s.atmosphere.visibility/1e5*(1e5/s.atmosphere.thickness);else switch(this.referenceFrame.id){case"melown2015":case"earth-qsc":this.draw.atmoColor=[216/255,232/255,243/255,1],this.draw.atmoColor2=[72/255,154/255,1,1],this.draw.atmoHeight=5e4;break;case"mars-qsc":this.draw.atmoColor=[1,187/255,157/255,1],this.draw.atmoColor2=[1,155/255,113/255,1],this.draw.atmoHeight=25e3,this.draw.atmoDensity=4}this.draw.atmoHeightFactor=this.draw.atmoHeight/5e4,this.renderSlots=new U(this),this.renderSlots.addRenderSlot("map",this.drawMap.bind(this),!0)};j.prototype.kill=function(){this.killed=!0,this.tree&&this.tree.kill();for(var e in this.freeLayers){var t=this.freeLayers[e];t&&t.tree&&t.tree.kill()}this.gpuCache.clear(),this.resourcesCache.clear(),this.metatileCache.clear(),null!=this.renderer&&(this.renderer.kill(),this.renderer=null)},j.prototype.setupMobileMode=function(){this.mobile=this.config.mapMobileMode,!this.mobile&&this.config.mapMobileModeAutodect&&(this.mobile=T.isMobile()),this.setupCache()},j.prototype.setupCache=function(){if(this.resourcesCache){var e=1/(this.mobile?Math.pow(2,Math.max(0,this.config.mapMobileDetailDegradation-1)):1);e=.5*(e+1/(this.mobile?Math.pow(2,this.config.mapMobileDetailDegradation):1)),this.resourcesCache.setMaxCost(1024*this.config.mapCache*1024*e),this.gpuCache.setMaxCost(1024*this.config.mapGPUCache*1024*e),this.metatileCache.setMaxCost(1024*this.config.mapMetatileCache*1024*(e<.8?.5:1))}},j.prototype.getCoreInterface=function(){return this.core.interface},j.prototype.getRendererInterface=function(){return this.core.interface.getRendererInterface()},j.prototype.setOption=function(){},j.prototype.getOption=function(){},j.prototype.addSrs=function(e,t){this.srses[e]=t},j.prototype.getSrs=function(e){return this.srses[e]},j.prototype.getSrses=function(){return this.getMapKeys(this.srses)},j.prototype.addBody=function(e,t){this.bodies[e]=t},j.prototype.getBody=function(e){return this.bodies[e]},j.prototype.getBodies=function(){return this.getMapKeys(this.bodies)},j.prototype.setReferenceFrame=function(e){this.referenceFrame=e},j.prototype.addCredit=function(e,t){this.credits[e]=t,this.creditsByNumber[t.id]=t,t.key=e},j.prototype.getCreditByNumber=function(e){return this.creditsByNumber[e]},j.prototype.getCreditById=function(e){return this.credits[e]},j.prototype.getCredits=function(){return this.getMapKeys(this.credits)},j.prototype.getVisibleCredits=function(){var e,t,r,i,a=this.visibleCredits.imagery,s=this.visibleCredits.glueImagery,n=[],o=[];for(var h in s)a[h]||(a[h]=s[h]);this.visibleCredits.glueImagery={};for(h in a)n.push(h),o.push(a[h]);do{for(i=!0,e=0,t=o.length-1;e<t;e++)o[e]<o[e+1]&&(r=o[e],o[e]=o[e+1],o[e+1]=r,r=n[e],n[e]=n[e+1],n[e+1]=r,i=!1)}while(!i);var l=this.visibleCredits.mapdata,u=[],c=[];for(h in l)u.push(h),c.push(l[h]);do{for(i=!0,e=0,t=c.length-1;e<t;e++)c[e]<c[e+1]&&(r=c[e],c[e]=c[e+1],c[e+1]=r,r=u[e],u[e]=u[e+1],u[e+1]=r,i=!1)}while(!i);return{"3D":[],imagery:n,mapdata:u}},j.prototype.addSurface=function(e,t){this.surfaces.push(t),t.index=this.surfaces.length-1},j.prototype.getSurface=function(e){return this.searchArrayById(this.surfaces,e)},j.prototype.getSurfaces=function(){for(var e=[],t=0,r=this.surfaces.length;t<r;t++)e.push(this.surfaces[t].id);return e},j.prototype.addGlue=function(e,t){this.glues[e]=t},j.prototype.getGlue=function(e){return this.glues[e]},j.prototype.addBoundLayer=function(e,t){this.boundLayers[e]=t},j.prototype.setBoundLayerOptions=function(e,t){this.boundLayers[e]&&this.boundLayers[e].setOptions(t)},j.prototype.getBoundLayerOptions=function(e){return this.boundLayers[e]?this.boundLayers[e].getOptions():null},j.prototype.removeBoundLayer=function(e){this.boundLayers[e]&&(this.boundLayers[e].kill(),this.boundLayers[e]=null)},j.prototype.getBoundLayerByNumber=function(e){var t=this.boundLayers;for(var r in t)if(t[r].numberId==e)return t[r];return null},j.prototype.getBoundLayerById=function(e){return this.boundLayers[e]},j.prototype.getBoundLayers=function(){return this.getMapKeys(this.boundLayers)},j.prototype.addFreeLayer=function(e,t){this.freeLayers[e]=t,this.setView(this.getView()),this.markDirty()},j.prototype.removeFreeLayer=function(e){this.freeLayers[e]&&(this.freeLayers[e].kill(),this.freeLayers[e]=null,this.setView(this.getView()),this.markDirty())},j.prototype.setFreeLayerOptions=function(e,t){this.freeLayers[e]&&this.freeLayers[e].setOptions(t)},j.prototype.getFreeLayerOptions=function(e){return this.freeLayers[e]?this.freeLayers[e].getOptions():null},j.prototype.getFreeLayer=function(e){return this.freeLayers[e]},j.prototype.getFreeLayers=function(){var e=[];for(var t in this.freeLayers)e.push(t);return e},j.prototype.getMapsSrs=function(e){return null==e?null:-1!=e.indexOf("+proj")?new L(this,{srsDef:e}):this.srses[e]},j.prototype.addNamedView=function(e,t){this.namedViews[e]=t},j.prototype.getNamedView=function(e){return this.namedViews[e]},j.prototype.getNamedViews=function(){return this.getMapKeys(this.namedViews)},j.prototype.setView=function(e,t){if(null!=e){if("string"==typeof e)if(e=e.trim(),"{"==e.charAt(0))try{e=JSON.parse(e)}catch(e){return}else{if(!(e=this.getNamedView(e)))return;e=e.getInfo()}var r=JSON.stringify(e);(r!=this.currentViewString||t)&&(this.currentView.parse(e),this.currentViewString=r,this.viewCounter++),this.surfaceSequence.generateSurfaceSequence(),this.surfaceSequence.generateBoundLayerSequence(),this.refreshFreelayesInView(),this.markDirty()}},j.prototype.addStylesheet=function(e,t){this.stylesheets[e]=t},j.prototype.getStylesheet=function(e){return this.stylesheets[e]},j.prototype.getStylesheets=function(){var e=[];for(var t in this.stylesheets)e.push(t);return e},j.prototype.getStylesheetData=function(e){var t=this.getStylesheet(e);return t?{url:t.url,data:t.data}:{url:null,data:{}}},j.prototype.setStylesheetData=function(e,t){var r=this.getStylesheet(e);if(this.renderer.draw.clearJobHBuffer(),r){t&&r.setData(t);for(var i in this.freeLayers){var a=this.getFreeLayer(i);a&&a.geodata&&a.stylesheet==r&&(a.geodataProcessor&&a.geodataProcessor.setStylesheet(a.stylesheet),a.geodataCounter++)}}this.markDirty()},j.prototype.getView=function(){return this.currentView.getInfo()},j.prototype.refreshFreelayesInView=function(){var e=this.currentView.freeLayers;this.freeLayerSequence=[];for(var t in e){var r=this.getFreeLayer(t);r&&(r.zFactor=e[t].depthOffset,this.freeLayerSequence.push(r),e[t].style?r.setStyle(e[t].style):r.setStyle(r.originalStyle))}},j.prototype.refreshView=function(){this.viewCounter++,this.surfaceSequence.generateSurfaceSequence(),this.surfaceSequence.generateBoundLayerSequence(),this.refreshFreelayesInView(),this.markDirty()},j.prototype.searchArrayIndexById=function(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r].id==t)return r;return-1},j.prototype.searchArrayById=function(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r].id==t)return e[r];return null},j.prototype.searchMapByInnerId=function(e,t){for(var r in e)if(e[r].id==t)return e[r];return null},j.prototype.getMapKeys=function(e){var t=[];for(var r in e)t.push(r);return t},j.prototype.getMapIds=function(e){var t=[];for(var r in e)t.push(r.id);return t},j.prototype.setPosition=function(e){this.position=new z(e),this.markDirty()},j.prototype.isReferenceFrameReady=function(){return this.referenceFrame.model.physicalSrs.isReady()&&this.referenceFrame.model.publicSrs.isReady()&&this.referenceFrame.model.navigationSrs.isReady()},j.prototype.getPhysicalSrs=function(){return this.referenceFrame.model.physicalSrs},j.prototype.getPublicSrs=function(){return this.referenceFrame.model.publicSrs},j.prototype.getNavigationSrs=function(){return this.referenceFrame.model.navigationSrs},j.prototype.getPosition=function(){return this.position.clone()},j.prototype.setConfigParams=function(e){if("object"==typeof e&&null!==e)for(var t in e)this.setConfigParam(t,e[t])},j.prototype.setConfigParam=function(e,t){switch(e){case"map":this.config.map=A.validateString(t,null);break;case"mapCache":this.config.mapCache=A.validateNumber(t,10,Number.MAXINTEGER,900),this.setupCache();break;case"mapGPUCache":this.config.mapGPUCache=A.validateNumber(t,10,Number.MAXINTEGER,360),this.setupCache();break;case"mapMetatileCache":this.config.mapMetatileCache=A.validateNumber(t,10,Number.MAXINTEGER,60),this.setupCache();break;case"mapTexelSizeFit":this.config.mapTexelSizeFit=A.validateNumber(t,1e-4,Number.MAXINTEGER,1.1);break;case"mapLowresBackground":this.config.mapLowresBackground=A.validateNumber(t,0,Number.MAXINTEGER,0);break;case"mapDownloadThreads":this.config.mapDownloadThreads=A.validateNumber(t,1,Number.MAXINTEGER,6);break;case"mapMaxProcessingTime":this.config.mapMaxProcessingTime=A.validateNumber(t,1,Number.MAXINTEGER,50);break;case"mapMobileMode":this.config.mapMobileMode=A.validateBool(t,!1),this.setupMobileMode();break;case"mapMobileModeAutodect":this.config.mapMobileModeAutodect=A.validateBool(t,!1);break;case"mapMobileDetailDegradation":this.config.mapMobileDetailDegradation=A.validateNumber(t,1,Number.MAXINTEGER,2);break;case"mapNavSamplesPerViewExtent":this.config.mapNavSamplesPerViewExtent=A.validateNumber(t,1e-11,Number.MAXINTEGER,4);break;case"mapFog":this.config.mapFog=A.validateBool(t,!1),this.draw&&(this.draw.debug.drawFog=this.config.mapFog,this.dirty=!0);break;case"mapFlatshade":this.config.mapFlatshade=A.validateBool(t,!1),this.draw&&(this.draw.debug.drawWireframe=this.config.mapFlatshade?3:0,this.dirty=!0);break;case"mapIgnoreNavtiles":this.config.mapIgnoreNavtiles=A.validateBool(t,!1);break;case"mapAllowHires":this.config.mapAllowHires=A.validateBool(t,!0);break;case"mapAllowLowres":this.config.mapAllowLowres=A.validateBool(t,!0);break;case"mapAllowSmartSwitching":this.config.mapAllowSmartSwitching=A.validateBool(t,!0);break;case"mapDisableCulling":this.config.mapDisableCulling=A.validateBool(t,!1);break;case"mapPreciseCulling":this.config.mapPreciseCulling=A.validateBool(t,!1);break;case"mapHeightLodBlend":this.config.mapHeightLodBlend=A.validateBool(t,!0);break;case"mapHeightNodeBlend":this.config.mapHeightNodeBlend=A.validateBool(t,!0);break;case"mapBasicTileSequence":this.config.mapBasicTileSequence=A.validateBool(t,!0);break;case"mapSmartNodeParsing":this.config.mapSmartNodeParsing=A.validateBool(t,!0);break;case"mapStoreLoadStats":this.config.mapStoreLoadStats=A.validateBool(t,!0),this.draw&&this.draw.replay&&(this.draw.replay.storeLoaded=this.config.mapStoreLoadStats);break;case"mapXhrImageLoad":this.config.mapXhrImageLoad=A.validateBool(t,!1);break;case"mapLoadMode":this.config.mapLoadMode=A.validateString(t,"topdown");break;case"mapGeodataLoadMode":this.config.mapGeodataLoadMode=A.validateString(t,"fit");break;case"mapGridMode":this.config.mapGridMode=A.validateString(t,"linear");break;case"mapPreciseBBoxTest":this.config.mapPreciseBBoxTest=A.validateBool(t,!0);break;case"mapPreciseDistanceTest":this.config.mapPreciseDistanceTest=A.validateBool(t,!1);break;case"mapHeightfiledWhenUnloaded":this.config.mapHeightfiledWhenUnloaded=A.validateBool(t,!1);break;case"mapForceMetatileV3":this.config.mapForceMetatileV3=A.validateBool(t,!1);break;case"mapVirtualSurfaces":this.config.mapVirtualSurfaces=A.validateBool(t,!0);break;case"mapDegradeHorizon":this.config.mapDegradeHorizon=A.validateBool(t,!0);break;case"mapDegradeHorizonParams":this.config.mapDegradeHorizonParams=A.validateNumberArray(t,4,[0,1,1,1],[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[1,3e3,15e3,7e3]);break;case"mapGridSurrogatez":this.config.mapGridSurrogatez=A.validateBool(t,!1);break;case"mapRefreshCycles":this.config.mapRefreshCycles=A.validateNumber(t,0,Number.MAXINTEGER,3);break;case"mapDefaultFont":this.config.mapDefaultFont=A.validateString(t,"");break;case"mapMetricUnits":this.config.mapMetricUnits=A.validateBool(t,!0);break;case"mapNoTextures":this.config.mapNoTextures=this.config.mapDisableCulling=A.validateBool(t,!1);break;case"mapForceFrameTime":this.config.mapForceFrameTime=A.validateNumber(t,-1,Number.MAXINTEGER,0);break;case"mapForcePipeline":this.config.mapForcePipeline=A.validateNumber(t,0,Number.MAXINTEGER,0);break;case"mapFeatureGridCells":this.config.mapFeatureGridCells=A.validateNumber(t,-Number.MAXINTEGER,Number.MAXINTEGER,0);break;case"mapFeaturesPerSquareInch":this.config.mapFeaturesPerSquareInch=A.validateNumber(t,1e-6,Number.MAXINTEGER,0);break;case"mapFeaturesSortByTop":this.config.mapFeaturesSortByTop=A.validateBool(t,!1);break;case"mapFeaturesReduceParams":this.config.mapFeaturesReduceParams=t;break;case"mario":this.config.mario=A.validateBool(t,!0);break;case"mapFeaturesReduceMode":t=A.validateString(t,"scr-count4"),"auto"==t&&(t="scr-count2"),"legacy"==t&&(t="scr-count2"),"gridcells"==t&&(t="scr-count4"),"singlepass"==t&&(t="scr-count5"),this.config.mapFeaturesReduceMode=t}},j.prototype.getConfigParam=function(e){switch(e){case"map":return this.config.map;case"mapCache":return this.config.mapCache;case"mapGPUCache":return this.config.mapGPUCache;case"mapMetatileCache":return this.config.mapMetatileCache;case"mapTexelSizeFit":return this.config.mapTexelSizeFit;case"mapLowresBackground":return this.config.mapLowresBackground;case"mapDownloadThreads":return this.config.mapDownloadThreads;case"mapMaxProcessingTime":return this.config.mapMaxProcessingTime;case"mapMobileMode":return this.config.mapMobileMode;case"mapMobileModeAutodect":return this.config.mapMobileModeAutodect;case"mapMobileDetailDegradation":return this.config.mapMobileDetailDegradation;case"mapNavSamplesPerViewExtent":return this.config.mapNavSamplesPerViewExtent;case"mapFog":return this.config.mapFog;case"mapFlatshade":return this.config.mapFlatshade;case"mapIgnoreNavtiles":return this.config.mapIgnoreNavtiles;case"mapAllowHires":return this.config.mapAllowHires;case"mapAllowLowres":return this.config.mapAllowLowres;case"mapAllowSmartSwitching":return this.config.mapAllowSmartSwitching;case"mapDisableCulling":return this.config.mapDisableCulling;case"mapPreciseCulling":return this.config.mapPreciseCulling;case"mapHeightLodBlend":return this.config.mapHeightLodBlend;case"mapHeightNodeBlend":return this.config.mapHeightNodeBlend;case"mapBasicTileSequence":return this.config.mapBasicTileSequence;case"mapSmartNodeParsing":return this.config.mapSmartNodeParsing;case"mapStoreLoadStats":return this.config.mapStoreLoadStats;case"mapXhrImageLoad":return this.config.mapXhrImageLoad;case"mapLoadMode":return this.config.mapLoadMode;case"mapGeodataLoadMode":return this.config.mapGeodataLoadMode;case"mapGridMode":return this.config.mapGridMode;case"mapPreciseBBoxTest":return this.config.mapPreciseBBoxTest;case"mapPreciseDistanceTest":return this.config.mapPreciseDistanceTest;case"mapHeightfiledWhenUnloaded":return this.config.mapHeightfiledWhenUnloaded;case"mapForceMetatileV3":return this.config.mapForceMetatileV3;case"mapVirtualSurfaces":return this.config.mapVirtualSurfaces;case"mapDegradeHorizon":return this.config.mapDegradeHorizon;case"mapDegradeHorizonParams":return this.config.mapDegradeHorizonParams;case"mapGridSurrogatez":return this.config.mapGridSurrogatez;case"mapRefreshCycles":return this.config.mapRefreshCycles;case"mapDefaultFont":return this.config.mapDefaultFont;case"mapMetricUnits":return this.config.mapMetricUnits;case"mapNoTextures":return this.config.mapNoTextures;case"mapForceFrameTime":return this.config.mapForceFrameTime;case"mapForcePipeline":return this.config.mapForcePipeline;case"mapFeatureGridCells":return this.config.mapFeatureGridCells;case"mapFeaturesPerSquareInch":return this.config.mapFeaturesPerSquareInch;case"mapFeaturesSortByTop":return this.config.mapFeaturesSortByTop;case"mapFeaturesReduceMode":return this.config.mapFeaturesReduceMode;case"mapFeaturesReduceParams":return this.config.mapFeaturesReduceParams;case"mario":return this.config.mario}},j.prototype.click=function(e,t,r){this.clickEvent=[e,t,r]},j.prototype.hover=function(e,t,r,i){this.hoverEvent=[e,t,r,i]},j.prototype.markDirty=function(){this.dirty=!0,this.hitMapDirty=!0,this.geoHitMapDirty=!0},j.prototype.getScreenRay=function(e,t){return this.renderer.getScreenRay(e,t)},j.prototype.renderToImage=function(e){var t=this.renderer.gpu.canvas,r=t.width,i=t.height,a=A.fitToPowerOfTwo(r),s=A.fitToPowerOfTwo(i),n=new Uint8Array(a*s*4),e=new O(this.renderer.gpu);e.createFromData(a,s,n),e.createFramebuffer(a,s),this.draw.drawToTexture(e),n=e.readFramebufferPixels(0,0,r,i),e.kill();for(var o=new Uint8Array(r*i*4),h=0;h<i;h++)for(var l=h*r*4,u=(i-h-1)*r*4,c=0;c<r;c++)o[u]=n[l],o[u+1]=n[l+1],o[u+2]=n[l+2],o[u+3]=n[l+3],l+=4,u+=4;return{width:r,height:i,data:o}},j.prototype.getHitCoords=function(e,t,r,i){this.hitMapDirty&&this.draw.drawHitmap();var a,s,n,o=this.renderer.hitTest(e,t),h=!1,l=this.camera.position,u=o[4];if(this.getNavigationSrs().isProjected()){var c=[0,0,Math.min(-1e3,this.referenceFrame.getGlobalHeightRange()[0])],d=[0,0,1];n=w.dot(d,u),s=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],b=w.dot(s,d)/n,b>=0&&(!o[3]||b<o[5])&&(a=[u[0]*b+l[0],u[1]*b+l[1],u[2]*b+l[2]],h=!0)}else{var p=this.getNavigationSrs().getSrsInfo(),f=p.b+this.referenceFrame.getGlobalHeightRange()[0],m=[l[0],l[1],l[2]];s=w.dot(u,u);var g=2*w.dot(u,m);if((n=g*g-4*s*(w.dot(m,m)-f*f))>0){n=Math.sqrt(n);var v=(-g-n)/(2*s),y=(-g+n)/(2*s),b=v<y?v:y;(!o[3]||b<o[5])&&(a=[u[0]*b+l[0],u[1]*b+l[1],u[2]*b+l[2]],h=!0)}}if(!o[3]&&!h)return null;h||(a=[o[0]+l[0],o[1]+l[1],o[2]+l[2]]);var x=this.convert.convertCoords(a,"physical","navigation");if("float"==r){i=null!=i?i:this.measure.getOptimalHeightLod(x,100,this.config.mapNavSamplesPerViewExtent);var M=this.measure.getSurfaceHeight(x,i);x[2]-=M[0]}return x},j.prototype.hitTestGeoLayers=function(e,t,r){if(this.geoHitMapDirty&&this.freeLayersHaveGeodata&&this.draw.drawGeodataHitmap(),!this.freeLayersHaveGeodata)return this.lastHoverFeature=null,this.lastHoverFeatureId=null,this.hoverFeature=null,this.hoverFeatureId=null,[null,!1,[]];var i,a,s=this.renderer.hitTestGeoLayers(e,t);if(!s[0])return i=[],"hover"==r&&(this.lastHoverFeature=this.hoverFeature,this.lastHoverFeatureId=this.hoverFeatureId,this.hoverFeature=null,this.hoverFeatureId=null,null!=this.lastHoverFeatureId&&(null!=this.lastHoverFeatureId&&i.push(["leave",this.lastHoverFeature,this.lastHoverFeatureId]),this.dirty=!0)),[null,!1,i,a];var n=s[1]+(s[2]<<8),o=this.hoverFeatureList[n];return o?(o[6]&&(s=this.renderer.hitTestGeoLayers(e,t,!0),s[0]&&(a=s[1]+(s[2]<<8))),"hover"==r?(this.lastHoverFeature=this.hoverFeature,this.lastHoverFeatureId=this.hoverFeatureId,o&&o[3]?(this.hoverFeature=o,this.hoverFeatureId=null!=o?o[0]["#id"]:null):(this.hoverFeature=null,this.hoverFeatureId=null),i=[],this.hoverFeatureId!=this.lastHoverFeatureId&&(null!=this.lastHoverFeatureId&&i.push(["leave",this.lastHoverFeature,this.lastHoverFeatureId]),null!=this.hoverFeatureId&&i.push(["enter",this.hoverFeature,this.hoverFeatureId]),this.dirty=!0),null!=this.hoverFeature&&this.hoverFeature[3]?[this.hoverFeature,!0,i,a]:[null,!1,i,a]):"click"==r?null!=o&&o[2]?[o,!0,[],a]:[null,!1,[],a]:void 0):[null,!1,[],a]},j.prototype.getCurrentGeometry=function(){if(this.draw.tree.surfaceSequence.length>0){this.draw.tree.draw(!0);var e=this.storedTilesRes;return this.storedTilesRes=[],e}return e},j.prototype.applyCredits=function(e){var t,r;for(var i in e.imageryCredits)t=e.imageryCredits[i],r=this.visibleCredits.imagery[i],this.visibleCredits.imagery[i]=r?t>r?t:r:t;for(i in e.glueImageryCredits)t=e.glueImageryCredits[i],r=this.visibleCredits.imagery[i],this.visibleCredits.glueImagery[i]=r?t>r?t:r:t;for(i in e.mapdataCredits)t=e.mapdataCredits[i],r=this.visibleCredits.mapdata[i],this.visibleCredits.mapdata[i]=r?t>r?t:r:t},j.prototype.drawMap=function(){this.draw.drawMap(null)},j.prototype.processProcessingTasks=function(){for(;this.processingTasks.length>0;){if(this.stats.renderBuild>this.config.mapMaxProcessingTime)return void this.markDirty();this.processingTasks[0](),this.processingTasks.shift()}},j.prototype.addProcessingTask=function(e){this.processingTasks.push(e)},j.prototype.update=function(){if(!this.killed){if(this.core.tokenExpiration&&Date.now()>this.core.tokenExpiration-6e4&&this.core.tokenExpirationCallback(),!this.srsReady)return void this.loader.update();if(!this.div||"hidden"!=this.div.style.visibility){this.position.isSame(this.lastPosition)||this.core.callListener("map-position-changed",{position:this.position.toArray(),"last-position":this.lastPosition.toArray()}),this.camera.lastTerrainHeight!=this.camera.terrainHeight&&this.core.callListener("map-position-fixed-height-changed",{height:this.camera.terrainHeight,"last-height":this.camera.lastTerrainHeight}),this.lastPosition=this.position.clone(),this.camera.lastTerrainHeight=this.camera.terrainHeight,this.drawFog=this.config.mapFog;var e,t=this.renderer.div.getBoundingClientRect(),r=this.renderer,i=r.cameraPosition;r.curSize[0]==t.width&&r.curSize[1]==t.height||(r.onResize(),this.dirty=!0);var a,s=this.dirty||this.dirtyCountdown>0;if(this.stats.begin(s),this.loader.update(),this.processProcessingTasks(),s&&(this.dirty?this.dirtyCountdown=this.config.mapRefreshCycles:this.dirtyCountdown--,this.dirty=!1,this.bestMeshTexelSize=0,this.bestGeodataTexelSize=0,this.renderSlots.processRenderSlots(),this.loader.update(),this.core.callListener("map-update",{})),null!=this.clickEvent||null!=this.hoverEvent){if(null!=this.hoverEvent){a=this.hitTestGeoLayers(this.hoverEvent[0],this.hoverEvent[1],"hover");var n=a[2];if(null!=n)for(var o=0,h=n.length;o<h;o++){var l=n[o];switch(l[0]){case"enter":e=l[1][1],this.core.callListener("geo-feature-enter",{feature:l[1][0],"canvas-coords":r.project2(l[1][1],r.camera.mvp,i),"physical-coords":[e[0]+i[0],e[1]+i[1],e[2]+i[2]],state:this.hoverEvent[3],element:a[3]});break;case"leave":e=l[1][1],this.core.callListener("geo-feature-leave",{feature:l[1][0],"canvas-coords":r.project2(l[1][1],r.camera.mvp,i),"physical-coords":[e[0]+i[0],e[1]+i[1],e[2]+i[2]],state:this.hoverEvent[3],element:a[3]})}}a[1]&&null!=a[0]&&(e=a[0][1],this.core.callListener("geo-feature-hover",{feature:a[0][0],"canvas-coords":r.project2(a[0][1],r.camera.mvp,i),"physical-coords":[e[0]+i[0],e[1]+i[1],e[2]+i[2]],state:this.hoverEvent[3],element:a[3]})),!0!==this.hoverEvent[2]&&(this.hoverEvent=null)}null!=this.clickEvent&&(a=this.hitTestGeoLayers(this.clickEvent[0],this.clickEvent[1],"click"),a[1]&&null!=a[0]&&(e=a[0][1],this.core.callListener("geo-feature-click",{feature:a[0][0],"canvas-coords":r.project2(a[0][1],r.camera.mvp,i),"physical-coords":[e[0]+i[0],e[1]+i[1],e[2]+i[2]],state:this.clickEvent[2],element:a[3]})),this.clickEvent=null)}this.stats.end(s)}}},t.a=j},function(e,t,r){"use strict";var i=r(2),a=r(3),s=r(23),n=r.n(s),o=i.b,h=i.e,l=a.a,u=n.a,c=function(e){this.map=e,this.config=e.config,this.convert=e.convert,this.getPhysicalSrs=this.map.getPhysicalSrs(),this.navigationSrs=this.map.getNavigationSrs(),this.publicSrs=this.map.getPublicSrs(),this.navigationSrsInfo=this.navigationSrs.getSrsInfo(),this.isProjected=this.navigationSrs.isProjected();var t=this.getSpatialDivisionNodeDepths();this.minDivisionNodeDepth=t[0],this.maxDivisionNodeDepth=t[1]};c.prototype.getSurfaceAreaGeometry=function(e,t,r,i,a,s){var n=this.map.tree;0==n.surfaceSequence.length&&reurn[[]];var h=this.convert.convertCoords(e,"navigation","physical"),l=[0,0,0];o.normalize(h,l);var u=o.length(h),c=Math.atan(Math.tan(t/u));return n.params={coneVec:l,coneAngle:c,mode:r,limit:i,loaded:!0,areaTiles:[],loadMeshes:!0===a,loadTextures:!0===s},n.traceAreaTiles(n.surfaceTree,0,!1),[n.params.loaded,n.params.areaTiles]},c.prototype.getSurfaceHeight=function(e,t,r,i,a,s,n){var o=this.map.tree;if(0==o.surfaceSequence.length)return[0,!0,!0,null,null,null];if(!i){var h=this.getSpatialDivisionNode(e);i=h[0],a=h[1]}if(this.config.mapHeightLodBlend||(t=Math.floor(t)),n||this.config.mapIgnoreNavtiles)return this.getSurfaceHeightNodeOnly(null,t+8,r,t,null,i,a,s);if(null!=i&&null!==t){var l=o.findSurfaceTile(i.id),u={ll:i.extents.ll.slice(),ur:i.extents.ur.slice()},c={coords:a,desiredLod:Math.ceil(t),extents:u,metanode:null,heightMap:null,heightMapExtents:null,traceHeight:!0,waitingForNode:!1,finalNode:!1,bestHeightMap:999};o.traceHeight(l,c,!1);var d,p,f,m=c.metanode;if(c.heightMap){if(r){var g=this.map.stats;g.heightClass=2,g.heightLod=t,g.heightNode=m.id[0]}var v,y,b,x=m.id[0]>=Math.ceil(t);if(this.config.mapHeightLodBlend&&m.id[0]>0&&c.parent&&c.parent.heightMap&&t<=m.id[0]){y=this.getHeightmapValue(a,c.parent.metanode,c.parent),b=this.getHeightmapValue(a,m,c);var M=t-Math.floor(t);if(f=y+(b-y)*M,s)for(v=new Array(s.length),d=0,p=s.length;d<p;d++){var S=s[d];y=this.getHeightmapValue(S,c.parent.metanode,c.parent),b=this.getHeightmapValue(S,m,c),v[d]=[y+(b-y)*M,x,!0]}}else if(f=this.getHeightmapValue(a,m,c),s)for(v=new Array(s.length),d=0,p=s.length;d<p;d++)b=this.getHeightmapValue(s[d],m,c),v[d]=[b,x,!0];return[f,x,!0,null,null,v]}if(m)return x=this.getSurfaceHeightNodeOnly(e,t+8,r,t,null,i,a,s),[x[0],x[1],x[2],null,null,x[5]]}return[0,!1,!1,null,null,null]},c.prototype.getSurfaceHeightNodeOnly=function(e,t,r,i,a,s,n,o){var h,l,u=this.map.stats,c=this.map.tree;if(0==c.surfaceSequence.length)return[0,!0,!0,null,null,null];if(a)s=a[0],n=a[1];else{if(!s){var d=this.getSpatialDivisionNode(e);s=d[0],n=d[1]}if(o){h=new Array(o.length);for(var p=0,f=o.length;p<f;p++)h[p]=this.getSurfaceHeightNodeOnly(null,t,r,i,a,s,o[p])}}if(this.config.mapHeightLodBlend||(t=Math.floor(t)),!a&&this.config.mapHeightNodeBlend){var m=this.getSurfaceHeightNodeOnly(null,t,r,i,[s,[n[0],n[1],n[2]]]);if(m[2]){var g=m[3].ur[0]-m[3].ll[0],v=m[3].ur[1]-m[3].ll[1],y=(n[0]-m[3].ll[0])/g,b=(n[1]-m[3].ll[1])/v,x=this.getSurfaceHeightNodeOnly(null,t,r,i,[s,[n[0]+g,n[1],n[2]]]),M=this.getSurfaceHeightNodeOnly(null,t,r,i,[s,[n[0],n[1]+v,n[2]]]),S=this.getSurfaceHeightNodeOnly(null,t,r,i,[s,[n[0]+g,n[1]+v,n[2]]]),w=m[0]+(x[0]-m[0])*y;return l=w+(M[0]+(S[0]-M[0])*y-w)*b,[l,m[1],m[2],m[3],null,h]}return[m[0],m[1],m[2],m[3],null,h]}if(null!=s&&null!==t){var A=c.findSurfaceTile(s.id),T={ll:s.extents.ll.slice(),ur:s.extents.ur.slice()},C={coords:n,desiredLod:Math.ceil(t),extents:T,metanode:null,heightMap:null,heightMapExtents:null,traceHeight:!0,waitingForNode:!1,finalNode:!1,bestHeightMap:999};c.traceHeight(A,C,!0);var P=C.metanode;if(null!=P){var F=P.bbox.center();if(F=this.convert.convertCoords(F,"physical","navigation"),r&&(u.heightClass=1,u.heightLod=i,u.heightNode=P.id[0]),this.config.mapHeightLodBlend&&P.id[0]>0&&C.parent&&C.parent.metanode){var L=this.convert.convertCoords(C.parent.metanode.bbox.center(),"physical","navigation"),E=t-Math.floor(t);return l=F[2]+(L[2]-F[2])*E,[l,P.id[0]>=Math.floor(t)||C.finalNode,!C.waitingForNode||P.id[0]>=Math.floor(t)||C.finalNode,C.extents,P,h]}return[F[2],P.id[0]>=Math.floor(t)||C.finalNode,!C.waitingForNode||P.id[0]>=Math.floor(t)||C.finalNode,C.extents,P,h]}}return r&&(u.heightClass=0,u.heightLod=i,u.heightNode=0),[0,!1,!1,null,null,h]},c.prototype.getHeightmapValue=function(e,t,r){var i=r.heightMap,a=i.getImageData(),s=i.getImageExtents(),n=r.heightMapExtents,o=e[0]-n.ll[0],h=n.ur[1]-e[1],l=s[0]-1,u=s[1]-1;o=l*(o/(n.ur[0]-n.ll[0])),h=u*(h/(n.ur[1]-n.ll[1])),o<0&&(o=0),h<0&&(h=0),o>l&&(o=l),h>u&&(h=u);var c=Math.floor(o),d=Math.floor(h),p=o-c,f=h-d,m=d*s[0],g=d==u?m:m+s[0],v=c==l?c:c+1,y=a[4*(m+c)],b=a[4*(m+v)],x=a[4*(g+c)],M=a[4*(g+v)],S=y+(b-y)*p,w=x+(M-x)*p,A=S+(w-S)*f;return A=t.minHeight+(t.maxHeight-t.minHeight)*(A/255)},c.prototype.getSpatialDivisionNode=function(e){for(var t=this.map.referenceFrame.getSpatialDivisionNodes(),r=null,i=-1,a=[0,0],s=0,n=t.length;s<n;s++){var o=t[s],h=o.getInnerCoords(e),l=o.extents;h[0]>=l.ll[0]&&h[0]<=l.ur[0]&&h[1]>=l.ll[1]&&h[1]<=l.ur[1]&&o.id[0]>i&&(r=o,i=o.id[0],a=h)}return[r,a]},c.prototype.getSpatialDivisionNodeAndExtents=function(e){for(var t,r=this.map.referenceFrame.getSpatialDivisionNodes(),i=null,a=[0,0],s=0,n=r.length;s<n;s++){var o=r[s];if((t=e[0]-o.id[0])>=0){var h=e[1]>>t,l=e[2]>>t;o.id[1]==h&&o.id[2]==l&&(i=o,a=[o.id[1]<<t,o.id[2]<<t])}}if(!i)return null;t=e[0]-i.id[0];var u=1/Math.pow(2,t),c=i.extents.ur,d=i.extents.ll,p=(c[0]-d[0])*u,f=(d[1]-c[1])*u,m=e[1]-a[0],g=e[2]-a[1];return[i,[[d[0]+p*m,c[1]+f*g],[d[0]+p*(m+1),c[1]+f*(g+1)]]]},c.prototype.getSpatialDivisionNodeFromId=function(e){var t=e[0]-this.maxDivisionNodeDepth,r=e[1]>>t,i=e[2]>>t;return this.map.referenceFrame.nodesMap[this.maxDivisionNodeDepth+"."+r+"."+i]},c.prototype.getSpatialDivisionNodeAndExtents2=function(e,t,r){if(!r)return[null,0,0,0,0];var i=e[0]-r.id[0],a=1/Math.pow(2,i),s=r.extents.ur,n=r.extents.ll,o=(s[0]-n[0])*a,h=(n[1]-s[1])*a,l=e[1]-(r.id[1]<<i),u=e[2]-(r.id[2]<<i);t[0]=r,t[1]=n[0]+o*l,t[2]=s[1]+h*u,t[3]=n[0]+o*(l+1),t[4]=s[1]+h*(u+1)},c.prototype.getSpatialDivisionNodeDepths=function(){for(var e=this.map.referenceFrame.getSpatialDivisionNodes(),t=-1,r=Number.MAX_VALUE,i=0,a=e.length;i<a;i++){var s=e[i];s.id[0]<r&&(r=s.id[0]),s.id[0]>t&&(t=s.id[0])}return[r,t]},c.prototype.getOptimalHeightLodBySampleSize=function(e,t){var r=this.getSpatialDivisionNode(e),i=r[0];if(null!=i){var a=i.id[0],s=i.extents.ur[1]-i.extents.ll[1],n=Math.log(s/t)/Math.log(2);return n=n-8+a,Math.max(0,n)}return null},c.prototype.getOptimalHeightLod=function(e,t,r){var i=this.getSpatialDivisionNode(e),a=i[0];if(null!=a){var s=a.id[0],n=a.extents.ur[1]-a.extents.ll[1],o=Math.log(r*n/t)/Math.log(2);return o=o-8+s,Math.max(0,o)}return null},c.prototype.getDistance=function(e,t,r,i){var a=i?this.publicSrs:this.navigationSrs,s=this.getPhysicalSrs.convertCoordsFrom(e,a),n=this.getPhysicalSrs.convertCoordsFrom(t,a),o=n[0]-s[0],h=n[1]-s[1],u=n[2]-s[2],c=Math.sqrt(o*o+h*h+u*u),d=this.navigationSrsInfo;if(this.isProjected)return[Math.sqrt(o*o+h*h),l.degrees(Math.atan2(o,h)),c];var p=this.getGeodesic(),f=p.Inverse(e[1],e[0],t[1],t[0]);return f.s12>2*d.a*Math.PI/4007.5?r?[Math.sqrt(f.s12*f.s12+u*u),-f.azi1,c]:[f.s12,-f.azi1,c]:r?[Math.sqrt(o*o+h*h+u*u),-f.azi1,c]:[f.s12,-f.azi1,c]},c.prototype.getGeodesic=function(){var e=this.navigationSrsInfo;return new u.Geodesic.Geodesic(e.a,e.a/e.b-1)},c.prototype.getAzimuthCorrection=function(e,t){if(!this.getNavigationSrs().isProjected()){var r=this.getGeodesic(),i=r.Inverse(e[0],e[1],t[0],t[1]),a=i.azi1-i.azi2;return isNaN(a)&&(a=0),a}return 0},c.prototype.getNED=function(e){var t,r,i=this.convert.convertCoords([e[0],e[1],0],"navigation","physical");if(this.isProjected)t=this.convert.convertCoords([e[0],e[1]+100,0],"navigation","physical"),r=this.convert.convertCoords([e[0]+100,e[1],0],"navigation","physical");else{var a=e[1]+90-1e-4,s=e[0]+180+1e-4;if(a<0||s>180){var n=this.getGeodesic(),h=n.Direct(e[1],e[0],0,-100);t=this.convert.convertCoords([h.lon2,h.lat2,0],"navigation","physical"),h=n.Direct(e[1],e[0],90,100),r=this.convert.convertCoords([h.lon2,h.lat2,0],"navigation","physical")}else t=this.convert.convertCoords([e[0],e[1]-1e-4,0],"navigation","physical"),r=this.convert.convertCoords([e[0]+1e-4,e[1],0],"navigation","physical")}var l=[t[0]-i[0],t[1]-i[1],t[2]-i[2]],u=[r[0]-i[0],r[1]-i[1],r[2]-i[2]],c=[0,0,0];return o.normalize(l),o.normalize(u),o.cross(l,u,c),o.normalize(c),{east:u,direction:l,north:c}},c.prototype.getNewNED=function(e,t){var r,i,a=this.convert.convertCoords([e[0],e[1],0],"navigation","physical");if(this.isProjected)r=this.convert.convertCoords([e[0],e[1]+100,0],"navigation","physical"),i=this.convert.convertCoords([e[0]+100,e[1],0],"navigation","physical");else{var s=e[1]+90+1e-4,n=e[0]+180+1e-4;if(s<0||n>180){var h=this.getGeodesic(),l=h.Direct(e[1],e[0],0,-100);r=this.convert.convertCoords([l.lon2,l.lat2,0],"navigation","physical"),l=h.Direct(e[1],e[0],90,-100),i=this.convert.convertCoords([l.lon2,l.lat2,0],"navigation","physical")}else r=this.convert.convertCoords([e[0],e[1]+1e-4,0],"navigation","physical"),i=this.convert.convertCoords([e[0]+1e-4,e[1],0],"navigation","physical")}var u=[r[0]-a[0],r[1]-a[1],r[2]-a[2]],c=[i[0]-a[0],i[1]-a[1],i[2]-a[2]],d=[0,0,0];if(o.normalize(u),o.normalize(c),o.cross(u,c,d),o.normalize(d),t){var p=c,f=u,m=d;return[p[0],p[1],p[2],0,m[0],m[1],m[2],0,f[0],f[1],f[2],0,0,0,0,1]}return{east:c,direction:u,north:d}},c.prototype.getPositionCameraInfo=function(e,t,r){var i=e.getOrientation(),a=e.getViewDistance();r&&(i[1]=l.clamp(i[1],-89,90));var s=l.clamp(i[1],-89.5,89.5),n=h.create();h.multiply(l.rotationMatrix(2,l.radians(-i[0])),l.rotationMatrix(0,l.radians(s)),n);var u,c,d,p,f,m,g,v,y,b,x,M,S;"obj"==e.getViewMode()?(u=[0,-a,0],h.multiplyVec3(n,u)):u=[0,0,0];var w={orbitCoords:null,distance:a,rotMatrix:null,vector:null,orbitHeight:u[2]},A=e.getCoords();if(t){n=h.create(),h.multiply(l.rotationMatrix(0,l.radians(-s-90)),l.rotationMatrix(2,l.radians(i[0])),n),c=this.getNED(A),d=c.north,p=c.east,f=c.direction,m=[p[0],p[1],p[2],0,f[0],f[1],f[2],0,d[0],d[1],d[2],0,0,0,0,1],v=[1,0,0],b=[0,1,0],y=[0,0,1],x=[1,0,0],M=[0,0,-1],S=[0,0,0],o.cross(x,M,S),h.multiplyVec3(n,y),h.multiplyVec3(n,v),h.multiplyVec3(n,b),h.multiplyVec3(n,x),h.multiplyVec3(n,M),h.multiplyVec3(n,S);var T=0;T=x[0],x[0]=x[1],x[1]=T,T=M[0],M[0]=M[1],M[1]=T,T=S[0],S[0]=S[1],S[1]=T,x[2]=-x[2],M[2]=-M[2],S[2]=-S[2],g=[v[0],v[1],v[2],0,b[0],b[1],b[2],0,y[0],y[1],y[2],0,0,0,0,1],w.vector=o.normalize([-u[0],-u[1],-u[2]]),w.vector2=w.vector,w.orbitCoords=u,w.rotMatrix=g}else{c=this.getNED(A),d=c.north,p=c.east,f=c.direction,m=[p[0],p[1],p[2],0,f[0],f[1],f[2],0,d[0],d[1],d[2],0,0,0,0,1];var C=h.create();h.multiply(l.rotationMatrix(0,l.radians(-s-90)),l.rotationMatrix(2,l.radians(i[0])),C),v=[1,0,0],b=[0,1,0],y=[0,0,1],A=e.getCoords();var P=h.create();h.multiply(l.rotationMatrix(0,l.radians(A[1]-90)),l.rotationMatrix(2,l.radians(-A[0]-90)),P),h.multiplyVec3(P,y),h.multiplyVec3(P,v),h.multiplyVec3(P,b),m=[v[0],v[1],v[2],0,b[0],b[1],b[2],0,y[0],y[1],y[2],0,0,0,0,1],S=[1,0,0],x=[0,1,0],M=[0,0,1],h.multiplyVec3(m,x),h.multiplyVec3(m,M),h.multiplyVec3(m,S),h.multiplyVec3(C,S),h.multiplyVec3(C,x),h.multiplyVec3(C,M),g=[S[0],S[1],S[2],0,x[0],x[1],x[2],0,M[0],M[1],M[2],0,0,0,0,1],m=h.inverse(m),h.multiplyVec3(m,u),w.vector=[-g[2],-g[6],-g[10]]}return w.orbitCoords=u,w.rotMatrix=g,w},t.a=c},function(e,t,r){"use strict";var i=r(2),a=r(4),s=r(150),n=r(5),o=r(33),h=r(58),l=i.e,u=n.a,c=s.a,d=a.a,p=o.a,f=h.a,m=function(e,t,r){this.generateLines=!0,this.map=e,this.stats=e.stats,this.mapLoaderUrl=t,this.tile=r,this.bbox=new u,this.size=0,this.gpuSize=0,this.fileSize=0,this.faces=0,this.cacheItem=null,this.gpuCacheItem=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.mBuffer=l.create(),this.mBuffer2=l.create(),this.submeshes=[],this.gpuSubmeshes=[],this.submeshesKilled=!1};m.prototype.kill=function(){this.bbox=null,this.killSubmeshes(),this.killGpuSubmeshes()},m.prototype.killSubmeshes=function(e){for(var t=0,r=this.submeshes.length;t<r;t++)this.submeshes[t].kill();this.submeshesKilled=!0,!0!==e&&this.cacheItem&&this.map.resourcesCache.remove(this.cacheItem),0==this.gpuSubmeshes.length&&(this.loadState=0),this.cacheItem=null},m.prototype.killGpuSubmeshes=function(e){for(var t=0,r=0,i=this.gpuSubmeshes.length;r<i;r++)this.gpuSubmeshes[r].kill(),t+=this.gpuSubmeshes[r].size;i>0&&(this.stats.gpuMeshes-=t,this.stats.graphsFluxMesh[1][0]++,this.stats.graphsFluxMesh[1][1]+=t),this.gpuSubmeshes=[],!0!==e&&this.gpuCacheItem&&this.map.gpuCache.remove(this.gpuCacheItem),this.submeshesKilled&&(this.loadState=0),this.gpuCacheItem=null},m.prototype.isReady=function(e,t,r){var i=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;if(e=e||i,2==this.loadState){if(this.cacheItem&&this.map.resourcesCache.updateItem(this.cacheItem),r)return!0;if(0==this.gpuSubmeshes.length){if(this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed)return!1;if(this.stats.renderBuild>this.map.config.mapMaxProcessingTime)return this.map.markDirty(),!1;if(i)return!1;var a=performance.now();this.buildGpuSubmeshes(),this.stats.renderBuild+=performance.now()-a}return!e&&this.gpuCacheItem&&this.map.gpuCache.updateItem(this.gpuCacheItem),!0}return 0==this.loadState?e||this.scheduleLoad(t):3==this.loadState&&this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(t),!1},m.prototype.scheduleLoad=function(e){this.mapLoaderUrl||(this.mapLoaderUrl=this.map.url.makeUrl(this.tile.resourceSurface.meshUrl,{lod:this.tile.id[0],ix:this.tile.id[1],iy:this.tile.id[2]})),this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this),e,this.tile,"mesh")},m.prototype.onLoad=function(e,t,r){this.mapLoaderCallLoaded=t,this.mapLoaderCallError=r,d.loadBinary(e,this.onLoaded.bind(this),this.onLoadError.bind(this),!!d.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams),this.loadState=1},m.prototype.onLoadError=function(){this.map.killed||(this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},m.prototype.onLoaded=function(e,t){if(!this.map.killed){if(!t)return this.map.markDirty(),void this.map.addProcessingTask(this.onLoaded.bind(this,e,!0));this.fileSize=e.byteLength;var r={data:new DataView(e),buffer:e,index:0},i=performance.now();this.parseMapMesh(r),this.map.stats.renderBuild+=performance.now()-i,this.submeshesKilled=!1,this.cacheItem=this.map.resourcesCache.insert(this.killSubmeshes.bind(this,!0),this.size),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},m.prototype.parseMapMesh=function(e){this.killSubmeshes();var t=e.data,r="";if(t.length<2)return!1;if(r+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,r+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,"ME"!=r)return!1;if(this.version=t.getUint16(e.index,!0),e.index+=2,this.version>3)return!1;e.uint8Data=new Uint8Array(e.buffer),this.meanUndulation=t.getFloat64(e.index,!0),e.index+=8,this.numSubmeshes=t.getUint16(e.index,!0),e.index+=2,this.submeshes=[],this.gpuSize=0,this.faces=0;for(var i=0,a=this.numSubmeshes;i<a;i++){var s=new c(this,e);s.valid&&(this.submeshes.push(s),this.size+=s.size,this.faces+=s.faces,this.gpuSize+=3*(s.vertices?s.vertices.length:0)*4+2*(s.internalUVs?s.internalUVs.length:0)*4+2*(s.externalUVs?s.externalUVs.length:0)*4)}this.numSubmeshes=this.submeshes.length},m.prototype.addSubmesh=function(e){this.submeshes.push(e),this.size+=e.size,this.faces+=e.faces},m.prototype.buildGpuSubmeshes=function(){var e=0;this.gpuSubmeshes=new Array(this.submeshes.length);for(var t=0,r=this.submeshes.length;t<r;t++)this.gpuSubmeshes[t]=this.submeshes[t].buildGpuMesh(),e+=this.gpuSubmeshes[t].size;this.stats.gpuMeshes+=e,this.stats.graphsFluxMesh[0][0]++,this.stats.graphsFluxMesh[0][1]+=e,this.gpuCacheItem=this.map.gpuCache.insert(this.killGpuSubmeshes.bind(this,!0),e),this.gpuSize=e},m.prototype.drawSubmesh=function(e,t,r,i,a,s){null!=this.gpuSubmeshes[t]||null==this.submeshes[t]||this.submeshes[t].killed||(this.gpuSubmeshes[t]=this.submeshes[t].buildGpuMesh());var n=this.submeshes[t],o=this.gpuSubmeshes[t];if(o){var h=this.map.renderer,u=this.map.draw,c=null,d=null,m=null,g=null,v=u.debug.drawWireframe,y=0!=v?["aPosition","aBarycentric"]:["aPosition"];if(1==i)c=h.progDepthTile;else if(2==i)c=h.progFlatShadeTile;else if(v>0)switch(v){case 2:c=h.progWireframeTile2;break;case 3:c=h.progFlatShadeTile;break;case 1:switch(i){case 4:case 5:c=h.progWireframeTile,m="aTexCoord",y.push("aTexCoord");break;case 6:case 7:c=h.progWireframeTile3,g="aTexCoord2",y.push("aTexCoord2");break;case 3:return}}else switch(i){case 4:case 5:c=h.progTile,m="aTexCoord",y.push("aTexCoord");break;case 6:case 7:if(c=h.progTile2,r&&(d=r.getGpuMaskTexture())&&(c=h.progTile3),s&&s.shaderFilter){var b=d?"progTile3":"progTile2",h=this.map.renderer;if(b+=s.shaderFilter,!(c=h.progMap[b])){var x=h.gpu,M=d?f.tile3FragmentShader:f.tile2FragmentShader;c=new p(x,f.tile2VertexShader,M.replace("__FILTER__",s.shaderFilter)),h.progMap[b]=c}}g="aTexCoord2",y.push("aTexCoord2");break;case 3:c=h.progFogTile}if(c&&c.isReady()){if(h.gpu.useProgram(c,y,d),r){var S=r.getGpuTexture();if(!S)return;r.statsCoutner!=this.stats.counter&&(r.statsCoutner=this.stats.counter,this.stats.gpuRenderUsed+=S.size),h.gpu.bindTexture(S),d&&h.gpu.bindTexture(d,1)}else if(3!=i&&1!=i&&2!=i)return;var w=this.mBuffer;l.multiply(h.camera.getModelviewMatrix(),n.getWorldMatrix(e,this.mBuffer2),w);var A=h.camera.getProjectionMatrix();if(c.setMat4("uMV",w),u.zbufferOffset?c.setMat4("uProj",A,h.getZoffsetFactor(u.zbufferOffset)):c.setMat4("uProj",A),0==v)switch(i){case 4:case 3:c.setVec4("uParams",[u.zFactor,u.fogDensity,0,0]),c.setVec4("uFogColor",u.atmoColor),n.getWorldMatrix([0,0,0],this.mBuffer2),c.setMat4("uMV2",this.mBuffer2),c.setVec4("uCamVec",this.map.camera.vector2);break;case 5:c.setVec4("uParams",[u.zFactor,0,0,0]);break;case 6:c.setFloat("uAlpha",1),c.setVec4("uParams",[u.zFactor,u.fogDensity,0,0]),c.setVec4("uTransform",r.getTransform()),c.setVec4("uFogColor",u.atmoColor),n.getWorldMatrix([0,0,0],this.mBuffer2),c.setMat4("uMV2",this.mBuffer2),c.setVec4("uCamVec",this.map.camera.vector2);break;case 7:c.setFloat("uAlpha",a),c.setVec4("uParams",[u.zFactor,0,0,0]),c.setVec4("uTransform",r.getTransform()),n.getWorldMatrix([0,0,0],this.mBuffer2),c.setMat4("uMV2",this.mBuffer2),c.setVec4("uCamVec",[1,0,0,0])}n.statsCoutner!=this.stats.counter&&(n.statsCoutner=this.stats.counter,this.stats.gpuRenderUsed+=o.size),o.draw(c,"aPosition",m,g,0!=v?"aBarycentric":null),this.stats.drawnFaces+=this.faces,this.stats.drawCalls++}}},t.a=m},function(e,t,r){"use strict";var i=r(2),a=r(4),s=r(3),n=r(5),o=i.b,h=i.e,l=n.a,u=s.a,c=a.a,d=function(e,t,r,i){this.metatile=e,this.map=e.map,this.id=t,this.credits=[],this.alien=!1,this.ready=!1,this.heightReady=!1,this.divisionNode=i,this.diskPos=new Array(3),this.diskDistance=1,this.diskNormal=new Array(3),this.diskAngle=1,this.diskAngle2=1,this.diskAngle2A=1,this.bbox2=new Array(24),r&&this.parseMetanode(r)};d.prototype.kill=function(){},d.prototype.hasChild=function(e){return 0!=(this.flags&1<<e+4)},d.prototype.hasChildById=function(e){var t=e[1]-(this.id[1]<<1),r=e[2]-(this.id[2]<<1);return this.hasChild((r<<1)+t)},d.prototype.hasChildren=function(){return 0!=(240&this.flags)},d.prototype.parseExtentBits=function(e,t,r){for(var i=0,a=0,s=t;a<s;a++){var n=r>>3,o=7&r;e[n]&1<<7-o&&(i|=1<<s-a-1),r++}return i/=(1<<s)-1},d.prototype.hasGeometry=function(){return 0!=(1&this.flags)},d.prototype.hasNavtile=function(){return 0!=(2&this.flags)},d.prototype.usedTexelSize=function(){return 0!=(4&this.flags)},d.prototype.usedDisplaySize=function(){return 0!=(8&this.flags)},d.prototype.parseMetanode=function(e){var t=e.data,r=this.metatile.version;if(this.flags=t.getUint8(e.index,!0),e.index+=1,r<5){for(var i=6*(this.id[0]+2)+7>>3,a=this.map.metanodeBuffer,s=0,n=i;s<n;s++)a[s]=t.getUint8(e.index,!0),e.index+=1;var o=this.id[0]+2,h=[0,0,0],u=[0,0,0],d=0,p=this.map.spaceExtentSize,f=this.map.spaceExtentOffset;for(s=0;s<3;s++)h[s]=this.parseExtentBits(a,o,d)*p[s]+f[s],d+=o,u[s]=this.parseExtentBits(a,o,d)*p[s]+f[s],d+=o;var m=0;for(s=0,n=a.length;s<n;s++)m+=a[s];0==m&&(h[0]=Number.POSITIVE_INFINITY,h[1]=Number.POSITIVE_INFINITY,h[2]=Number.POSITIVE_INFINITY,u[0]=Number.NEGATIVE_INFINITY,u[1]=Number.NEGATIVE_INFINITY,u[2]=Number.NEGATIVE_INFINITY),this.bbox=new l(h[0],h[1],h[2],u[0],u[1],u[2])}r>=4&&(this.minZ=t.getFloat32(e.index,!0),e.index+=4,this.maxZ=t.getFloat32(e.index,!0),e.index+=4,this.surrogatez=t.getFloat32(e.index,!0),e.index+=4),this.internalTextureCount=t.getUint8(e.index,!0),e.index+=1,this.pixelSize=c.decodeFloat16(t.getUint16(e.index,!0)),e.index+=2,this.displaySize=t.getUint16(e.index,!0),e.index+=2,this.displaySize=1024,0==(4&this.flags)&&(this.pixelSize=Number.POSITIVE_INFINITY),0==(8&this.flags)&&(this.displaySize=256),this.minHeight=t.getInt16(e.index,!0),e.index+=2,this.maxHeight=t.getInt16(e.index,!0),e.index+=2,r<4&&(this.minZ=this.minHeight,this.maxZ=this.maxHeight,this.surrogatez=this.minHeight),this.metatile.version>=3&&(128&this.metatile.flags?(this.sourceReference=t.getUint16(e.index,!0),e.index+=2):64&this.metatile.flags&&(this.sourceReference=t.getUint8(e.index,!0),e.index+=1)),this.heightReady=this.hasNavtile(),this.alien=!1,this.generateCullingHelpers()},d.prototype.clone=function(){var e=new d(this.metatile,this.id);e.flags=this.flags,e.minHeight=this.minHeight,e.maxHeight=this.maxHeight,e.minZ=this.minZ,e.maxZ=this.maxZ,e.surrogatez=this.surrogatez,e.internalTextureCount=this.internalTextureCount,e.pixelSize=this.pixelSize,e.displaySize=this.displaySize,e.ready=this.ready,e.stream=this.stream,e.heightReady=this.heightReady,e.credits=new Array(this.credits.length);for(var t=0,r=this.credits.length;t<r;t++)e.credits[t]=this.credits[t];return this.bbox&&(e.bbox=this.bbox.clone()),e.diskPos=this.diskPos,e.diskNormal=this.diskNormal,e.diskAngle=this.diskAngle,e.diskAngle2=this.diskAngle2,e.diskAngle2A=this.diskAngle2A,e.diskDistance=this.diskDistance,e.bbox2=this.bbox2,e.divisionNode=this.divisionNode,this.plane&&(e.plane=this.plane.slice()),e},d.prototype.generateCullingHelpers=function(e){this.ready=!0;var t=this.map,r=t.draw,i=t.isGeocent,a=this.metatile.useVersion;if(!(this.id[0]<t.measure.minDivisionNodeDepth||!i&&a<4)&&(t.config.mapPreciseCulling||a>=4)){if(e)return;var s,n,h,l,u,c=r.tmpVec3;if(this.id[0]>t.measure.maxDivisionNodeDepth){var d=r.tmpVec5;if(!(s=t.measure.getSpatialDivisionNodeFromId(this.id)))return;t.measure.getSpatialDivisionNodeAndExtents2(this.id,d,s),n=d[1],h=d[2],l=d[3],u=d[4],this.divisionNode=s}else{var p=t.measure.getSpatialDivisionNodeAndExtents(this.id);if(!(s=p?p[0]:null))return;n=p[1][0][0],h=p[1][0][1],l=p[1][1][0],u=p[1][1][1],this.divisionNode=s}this.llx=n,this.lly=h,this.urx=l,this.ury=u;var f=this.minZ;c[0]=.5*(l+n),c[1]=.5*(u+h),c[2]=f,s.getPhysicalCoordsFast(c,!0,this.diskPos,0,0),i?(this.diskDistance=o.length(this.diskPos),o.normalize(this.diskPos,this.diskNormal)):(this.diskNormal[0]=0,this.diskNormal[1]=0,this.diskNormal[2]=1);var m=this.diskNormal;c[0]=l,c[1]=u,c[2]=f;var g=this.bbox2;s.getPhysicalCoordsFast(c,!0,g,0,0),c[1]=h,s.getPhysicalCoordsFast(c,!0,g,0,3),c[0]=n,s.getPhysicalCoordsFast(c,!0,g,0,6),c[1]=u,s.getPhysicalCoordsFast(c,!0,g,0,9);var v;if(!i)return v=this.maxZ-f,g[12]=g[0],g[13]=g[1],g[14]=g[2]+v,g[15]=g[3],g[16]=g[4],g[17]=g[5]+v,g[18]=g[6],g[19]=g[7],g[20]=g[8]+v,g[21]=g[9],g[22]=g[10],void(g[23]=g[11]+v);var y,b,x,M,S,w,A=o.dot;if(t.config.mapPreciseBBoxTest||a>=4)if(v=this.maxZ-f,this.id[0]<=3){y=o.normalize2,y(g,0,c),b=A(m,c),y(g,3,c),x=A(m,c),y(g,6,c),M=A(m,c),y(g,9,c),S=A(m,c),w=Math.min(b,x,M,S),c[0]=.5*(l+n),c[1]=u,c[2]=f,s.getPhysicalCoordsFast(c,!0,g,0,12),c[1]=h,s.getPhysicalCoordsFast(c,!0,g,0,15),c[0]=l,c[1]=.5*(u+h),s.getPhysicalCoordsFast(c,!0,g,0,18),c[0]=n,s.getPhysicalCoordsFast(c,!0,g,0,21);var T=this.diskPos,C=Math.max(g[0],g[3],g[6],g[9],g[12],g[15],g[18],g[21],T[0]),P=Math.min(g[0],g[3],g[6],g[9],g[12],g[15],g[18],g[21],T[0]),F=Math.max(g[1],g[4],g[7],g[10],g[13],g[16],g[19],g[22],T[1]),L=Math.min(g[1],g[4],g[7],g[10],g[13],g[16],g[19],g[22],T[1]),E=Math.max(g[2],g[5],g[8],g[11],g[14],g[17],g[20],g[23],T[2]),I=Math.min(g[2],g[5],g[8],g[11],g[14],g[17],g[20],g[23],T[2]);this.id[0]<=1&&(c[0]=l+.25*(n-l),c[1]=.5*(u+h),s.getPhysicalCoordsFast(c,!0,g,0,12),c[0]=l+.75*(n-l),s.getPhysicalCoordsFast(c,!0,g,0,15),c[0]=.5*(l+n),c[1]=u+.25*(h-u),s.getPhysicalCoordsFast(c,!0,g,0,18),c[1]=u+.75*(h-u),s.getPhysicalCoordsFast(c,!0,g,0,21),C=Math.max(C,g[12],g[15],g[18],g[21]),P=Math.min(P,g[12],g[15],g[18],g[21]),F=Math.max(F,g[13],g[16],g[19],g[22]),L=Math.min(L,g[13],g[16],g[19],g[22]),E=Math.max(E,g[14],g[17],g[20],g[23]),I=Math.min(I,g[14],g[17],g[20],g[23]),w=-1),g[0]=P,g[1]=L,g[2]=I,g[3]=C,g[4]=L,g[5]=I,g[6]=C,g[7]=F,g[8]=I,g[9]=P,g[10]=F,g[11]=I,g[12]=P,g[13]=L,g[14]=E,g[15]=C,g[16]=L,g[17]=E,g[18]=C,g[19]=F,g[20]=E,g[21]=P,g[22]=F,g[23]=E}else{if(y=o.normalize3,A=o.dot2,y(g,0,g,12),b=A(m,g,12),y(g,3,g,15),x=A(m,g,15),y(g,6,g,18),M=A(m,g,18),y(g,9,g,21),S=A(m,g,21),w=Math.min(b,x,M,S),this.id[0]<=8){c=this.diskPos;var N=.024*(5-(this.id[0]-4));g[0]+=(g[0]-c[0])*N,g[1]+=(g[1]-c[1])*N,g[2]+=(g[2]-c[2])*N,g[3]+=(g[3]-c[0])*N,g[4]+=(g[4]-c[1])*N,g[5]+=(g[5]-c[2])*N,g[6]+=(g[6]-c[0])*N,g[7]+=(g[7]-c[1])*N,g[8]+=(g[8]-c[2])*N,g[9]+=(g[9]-c[0])*N,g[10]+=(g[10]-c[1])*N,g[11]+=(g[11]-c[2])*N}v+=r.planetRadius-r.planetRadius*w,g[12]=g[0]+g[12]*v,g[13]=g[1]+g[13]*v,g[14]=g[2]+g[14]*v,g[15]=g[3]+g[15]*v,g[16]=g[4]+g[16]*v,g[17]=g[5]+g[17]*v,g[18]=g[6]+g[18]*v,g[19]=g[7]+g[19]*v,g[20]=g[8]+g[20]*v,g[21]=g[9]+g[21]*v,g[22]=g[10]+g[22]*v,g[23]=g[11]+g[23]*v}else y=o.normalize2,y(g,0,c),b=A(m,c),y(g,3,c),x=A(m,c),y(g,6,c),M=A(m,c),y(g,9,c),S=A(m,c),w=Math.min(b,x,M,S);this.diskAngle=Math.cos(Math.max(0,.5*Math.PI-Math.acos(w))),this.diskAngle2=w,this.diskAngle2A=Math.acos(w)}},d.prototype.getWorldMatrix=function(e,t){var r=t;return null!=r?(r[0]=this.bbox.side(0),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=this.bbox.side(1),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=this.bbox.side(2),r[11]=0,r[12]=this.bbox.min[0]-e[0],r[13]=this.bbox.min[1]-e[1],r[14]=this.bbox.min[2]-e[2],r[15]=1):(r=h.create(),h.multiply(u.translationMatrix(this.bbox.min[0]-e[0],this.bbox.min[1]-e[1],this.bbox.min[2]-e[2]),u.scaleMatrix(this.bbox.side(0),this.bbox.side(1),this.bbox.side(2)),r)),r},d.prototype.drawBBox=function(e){if(this.metatile.useVersion>=4)return this.drawBBox2(e);var t=this.map.renderer;t.gpu.useProgram(t.progBBox,["aPosition"]);var r=h.create(),i=h.create();h.multiply(t.camera.getModelviewMatrix(),this.getWorldMatrix(e),i);var a=t.camera.getProjectionMatrix();h.multiply(a,i,r),t.progBBox.setMat4("uMVP",r),t.bboxMesh.draw(t.progBBox,"aPosition")},d.prototype.drawBBox2=function(){for(var e=this.bbox2,t=this.map.draw.bboxBuffer,r=this.map.camera.position,i=this.map.renderer,a=i.progBBox2,s=0;s<24;s+=3)t[s]=e[s]-r[0],t[s+1]=e[s+1]-r[1],t[s+2]=e[s+2]-r[2];i.gpu.useProgram(a,["aPosition"]),a.setFloatArray("uPoints",t);var n=i.camera.getMvpMatrix();a.setMat4("uMVP",n),i.bboxMesh2.draw(a,"aPosition")},d.prototype.drawPlane=function(e,t){var r=this.map.renderer,i=this.map.draw.planeBuffer,a=this.plane;if(a){r.gpu.useProgram(r.progPlane,["aPosition","aTexCoord"]);var s=h.create(),n=r.camera.getModelviewMatrix(),o=r.camera.getProjectionMatrix();h.multiply(o,n,s);for(var l=e[0],u=e[1],c=e[2],d=0;d<9;d++){var p=3*d;i[p]=a[p]-l,i[p+1]=a[p+1]-u,i[p+2]=a[p+2]-c}var f=r.progPlane;f.setMat4("uMV",n),f.setMat4("uProj",o),f.setFloatArray("uPoints",i);var m=Math.max(10,t.distance+20),g=Math.log(m)/Math.log(8),v=g-Math.floor(g);f.setVec4("uParams",[4,0,1/15,8]),f.setVec4("uParams2",[0,0,v,0]),r.gpu.bindTexture(r.heightmapTexture),r.planeMesh.draw(r.progPlane,"aPosition","aTexCoord")}},d.prototype.getGridHeight=function(e,t,r){var i=e[0]-this.llx,a=e[1]-this.lly,s=r-1,n=r-1;i=s*(i/(this.urx-this.llx)),a=n*(a/(this.ury-this.lly)),i<0&&(i=0),a<0&&(a=0),i>s&&(i=s),a>n&&(a=n);var o=Math.floor(i),h=Math.floor(a),l=i-o,u=a-h,c=h*r,d=h==n?c:c+r,p=o==s?o:o+1,f=t[c+o],m=t[c+p],g=t[d+o],v=t[d+p],y=f+(m-f)*l;return y+(g+(v-g)*l-y)*u},t.a=d},function(e,t,r){"use strict";var i=r(4),a=r(143),s=i.a,n=a.a,o=function(e,t,r){this.metaresources=e,this.map=e.map,this.surface=t,this.id=e.id,this.tile=r,this.nodes=[],this.drawCounter=0,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.size=0,this.cacheItem=null};o.prototype.kill=function(e){!0!==e&&null!=this.cacheItem&&this.map.metatileCache.remove(this.cacheItem),this.metaresources&&this.metaresources.removeMetatile(this),this.loadState=0,this.surface=0,this.cacheItem=null,this.nodes=[]},o.prototype.clone=function(e){var t=new o(this.metaresources,e);return t.nodes=this.nodes,t.loadState=this.loadState,t.nodes=this.nodes,t.size=this.size,t.lod=this.lod,t.metatileIdx=this.metatileIdx,t.metatileIdy=this.metatileIdy,t.offsetx=this.offsetx,t.offsety=this.offsety,t.sizex=this.sizex,t.sizey=this.sizey,t.version=this.version,t.credits=this.credits,this.version<2?t.nodeSize=this.nodeSize:(t.flags=this.flags,t.creditCount=this.creditCount,t.flagPlanes=this.flagPlanes),t.cacheItem=this.map.metatileCache.insert(t.kill.bind(t,!0),t.size),t},o.prototype.isReady=function(e){return 2==this.loadState||(0==this.loadState&&(3==this.loadState?this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(e):this.scheduleLoad(e)),!1)},o.prototype.used=function(){null!=this.cacheItem&&this.map.metatileCache.updateItem(this.cacheItem)},o.prototype.getNode=function(e){var t=e[1]-this.id[1]-this.offsetx,r=e[2]-this.id[2]-this.offsety;if(t<0||r<0||t>=this.sizex||r>=this.sizey)return null;var i=this.nodes[this.sizex*r+t];if(!i){var a=this.sizex*r+t,s={data:this.data,index:this.metanodesIndex+a*this.metanodeSize};i=new n(this,[this.lod,this.metatileIdx+this.offsetx+t,this.metatileIdy+this.offsety+r],s,this.divisionNode),this.nodes[a]=i,this.applyMetanodeCredits(t,r),this.applyMetatanodeBitplanes(t,r)}return i},o.prototype.scheduleLoad=function(){null==this.mapLoaderUrl&&(this.mapLoaderUrl=this.surface.getMetaUrl(this.id)),this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this),null,this.tile,"metatile")},o.prototype.onLoad=function(e,t,r){this.mapLoaderCallLoaded=t,this.mapLoaderCallError=r,s.loadBinary(e,this.onLoaded.bind(this),this.onLoadError.bind(this),!!s.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams),this.loadState=1},o.prototype.onLoadError=function(){this.map.killed||(this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},o.prototype.onLoaded=function(e,t){if(!this.map.killed){if(!t)return this.map.markDirty(),void this.map.addProcessingTask(this.onLoaded.bind(this,e,!0));e=new DataView(e),this.size+=4*e.byteLength,this.data=e;var r=performance.now();this.parseMetatatile({data:e,index:0}),this.map.stats.renderBuild+=performance.now()-r,this.cacheItem=this.map.metatileCache.insert(this.kill.bind(this,!0),this.size),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},o.prototype.parseMetatatile=function(e){var t=e.data,r="";r+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,r+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,"MT"==r&&(this.version=t.getUint16(e.index,!0),e.index+=2,this.version>5||(this.lod=t.getUint8(e.index,!0),e.index+=1,this.metatileIdx=t.getUint32(e.index,!0),e.index+=4,this.metatileIdy=t.getUint32(e.index,!0),e.index+=4,this.offsetx=t.getUint16(e.index,!0),e.index+=2,this.offsety=t.getUint16(e.index,!0),e.index+=2,this.sizex=t.getUint16(e.index,!0),e.index+=2,this.sizey=t.getUint16(e.index,!0),e.index+=2,this.flagPlanes=new Array(8),this.version<2?(this.nodeSize=t.getUint8(e.index,!0),e.index+=1):(this.flags=t.getUint8(e.index,!0),e.index+=1,this.creditCount=t.getUint8(e.index,!0),e.index+=1,this.parseFlagPlanes(e)),this.parseMetatatileCredits(e),this.parseMetatatileNodes(e),this.useVersion=this.map.config.mapForceMetatileV3&&this.version<5?3:this.version))},o.prototype.parseFlagPlanes=function(e){for(var t=e.data,r=this.sizex*this.sizey+7>>3,i=0;i<6;i++)if(0!=(this.flags&1<<i)){for(var a=new Uint8Array(r),s=0;s<r;s++)a[s]=t.getUint8(e.index,!0),e.index+=1;this.flagPlanes[i]=a}},o.prototype.parseMetatatileCredits=function(e){var t=e.data;if(this.version<2&&(this.creditCount=t.getUint8(e.index,!0),e.index+=1,this.creditSize=t.getUint16(e.index,!0),e.index+=2),0==this.creditCount)return void(this.credits=[]);var r=this.sizex*this.sizey+7>>3;this.credits=new Array(this.creditCount);for(var i=0,a=this.credits.length;i<a;i++){var s=t.getUint16(e.index,!0);e.index+=2;for(var n=new Uint8Array(r),o=0;o<r;o++)n[o]=t.getUint8(e.index,!0),e.index+=1;var h=this.map.getCreditByNumber(s),l=h?h.key:null;this.credits[i]={creditId:l,creditMask:n}}},o.prototype.applyMetatatileBitplanes=function(){for(var e=0;e<1;e++)if(this.flagPlanes[e])for(var t=this.flagPlanes[e],r=0;r<this.sizey;r++)for(var i=0;i<this.sizex;i++){var a=this.sizex*r+i,s=7&a,n=1<<s;if(a>>=3,t[a]&n)switch(e){case 0:this.nodes[r*this.sizex+i].alien=!0}}},o.prototype.applyMetatanodeBitplanes=function(e,t){for(var r=0;r<1;r++)if(this.flagPlanes[r]){var i=this.flagPlanes[r],a=this.sizex*t+e,s=7&a,n=1<<s;if(a>>=3,i[a]&n)switch(r){case 0:this.nodes[t*this.sizex+e].alien=!0}}},o.prototype.applyMetatatileCredits=function(){for(var e=0;e<this.sizey;e++)for(var t=0;t<this.sizex;t++){var r=this.sizex*e+t,i=7&r,a=1<<i;r>>=3;for(var s=0,n=this.credits.length;s<n;s++)if(this.credits[s].creditMask[r]&a){var o=this.credits[s].creditId;o&&this.nodes[e*this.sizex+t].credits.push(o)}}},o.prototype.applyMetanodeCredits=function(e,t){var r=this.sizex*t+e,i=7&r,a=1<<i;r>>=3;for(var s=0,n=this.credits.length;s<n;s++)if(this.credits[s].creditMask[r]&a){var o=this.credits[s].creditId;o&&this.nodes[t*this.sizex+e].credits.push(o)}},o.prototype.parseMetatatileNodes=function(e){this.metanodesIndex=e.index,this.metanodeSize=10,this.version>=5?this.metanodeSize+=12:(this.metanodeSize+=Math.floor((6*(this.id[0]+2)+7)/8),4==this.version&&(this.metanodeSize+=12)),this.version>=3&&(128&this.flags?this.metanodeSize+=2:64&this.flags&&(this.metanodeSize+=1)),this.lod>=this.map.measure.minDivisionNodeDepth?(this.divisionNode=this.map.measure.getSpatialDivisionNodeAndExtents([this.lod,this.metatileIdx+this.offsetx,this.metatileIdy+this.offsety]),this.divisionNode&&(this.divisionNode=this.divisionNode[0])):this.divisionNode=null,this.nodes=new Array(this.sizex*this.sizey)},t.a=o},function(e,t,r){"use strict";var i=r(130),a=i.a,s=function(e,t){this.map=e,this.proj4=e.proj4,this.valid=!1,this.id=t.id||null,this.description=t.description||"",this.nodesMap=[];var r=t.model;if(null!=r){if(this.model={physicalSrs:e.getMapsSrs(r.physicalSrs),navigationSrs:e.getMapsSrs(r.navigationSrs),publicSrs:e.getMapsSrs(r.publicSrs)},this.body=t.body?e.getBody(t.body):null,this.params={},null!=t.parameters){var i=t.parameters;this.params.metaBinaryOrder=i.metaBinaryOrder||1,this.params.navDelta=i.navDelta||8}var a=t.division;if(null!=a){this.division={rootLod:a.rootLod||0,arity:a.arity||null,heightRange:a.heightRange||[0,1]};var s=this.parseSpaceExtents(a.extents);this.division.extents=s,e.spaceExtentSize=[s.ur[0]-s.ll[0],s.ur[1]-s.ll[1],s.ur[2]-s.ll[2]],e.spaceExtentOffset=s.ll;var n=a.nodes;if(this.division.nodes=[],null!=n){this.hasPoles=4==n.length;for(var o=0,h=n.length;o<h;o++){var l=this.parseNode(n[o]);this.nodesMap[l.id[0]+"."+l.id[1]+"."+l.id[2]]=l,this.division.nodes.push(l)}this.valid=!0}}}};s.prototype.getInfo=function(){return{id:this.id,physicalSrs:this.model.physicalSrs.id,navigationSrs:this.model.navigationSrs.id,publicSrs:this.model.publicSrs.id}},s.prototype.getGlobalHeightRange=function(){return this.division.heightRange},s.prototype.parseNode=function(e){var t={srs:e.srs,partitioning:e.partitioning};t.extents=this.parseExtents(e.extents);var r=e.id;if(null!=r)return t.id={lod:r.lod||0,position:r.position||[0,0]},new a(this.map,[t.id.lod,t.id.position[0],t.id.position[1]],t.srs,t.extents,this.heightRange,t.partitioning)},s.prototype.parseExtents=function(e){return null==e?{ll:[0,0],ur:[1,1]}:{ll:e.ll||[0,0],ur:e.ur||[1,1]}},s.prototype.parseSpaceExtents=function(e){return null==e?{ll:[0,0,0],ur:[1,1,1]}:{ll:e.ll||[0,0,0],ur:e.ur||[1,1,1]}},s.prototype.getSpatialDivisionNodes=function(){return this.division.nodes},s.prototype.convertCoords=function(e,t,r){var i,a;switch(t){case"public":i=this.model.publicSrs;break;case"physical":i=this.model.physicalSrs;break;case"navigation":i=this.model.navigationSrs}switch(r){case"public":a=this.model.publicSrs;break;case"physical":a=this.model.physicalSrs;break;case"navigation":a=this.model.navigationSrs}return i.convertCoordsTo(e,a)},t.a=s},function(e,t,r){"use strict";var i=function(e){this.map=e,this.draw=e.draw,this.renderer=e.renderer,this.config=e.config,this.renderSlots=[]};i.prototype.createRenderSlot=function(e,t,r){return{id:e,callback:t,enabled:r}},i.prototype.addRenderSlot=function(e,t,r){this.renderSlots.push(this.createRenderSlot(e,t,r))},i.prototype.getRenderSlotIndex=function(e){return this.map.searchArrayIndexById(this.renderSlots,e)},i.prototype.checkRenderSlotId=function(e){return"after-map-render"==e?"map":e},i.prototype.moveRenderSlotBefore=function(e,t){var r=this.getRenderSlotIndex(this.checkRenderSlotId(e)),i=this.getRenderSlotIndex(t);-1!=r&&-1!=i&&i!=r-1&&this.renderSlots.splice(i,0,this.renderSlots.splice(r,1)[0])},i.prototype.moveRenderSlotAfter=function(e,t){var r=this.getRenderSlotIndex(this.checkRenderSlotId(e)),i=this.getRenderSlotIndex(t);-1!=r&&-1!=i&&i!=r+1&&(i++,this.renderSlots.splice(i,0,this.renderSlots.splice(r,1)[0]))},i.prototype.removeRenderSlot=function(e){var t=this.getRenderSlotIndex(e);-1!=t&&this.renderSlots.splice(t,1)},i.prototype.setRenderSlotEnabled=function(e,t){var r=this.getRenderSlotIndex(e);-1!=r&&(this.renderSlots[r].enabled=t)},i.prototype.getRenderSlotEnabled=function(e){var t=this.getRenderSlotIndex(e);return-1!=t&&this.renderSlots[t].enabled},i.prototype.processRenderSlots=function(){1!=this.draw.drawChannel&&this.renderer.gpu.setViewport();for(var e=0,t=this.renderSlots.length;e<t;e++){var r=this.renderSlots[e];r.enabled&&r.callback&&(this.renderer.gpu.setState(this.draw.drawTileState),r.callback(this.draw.drawChannelNames[this.draw.drawChannel]))}},t.a=i},function(e,t,r){"use strict";var i=r(55),a=r(52),s=r(144),n=r(142),o=r(49),h=i.a,l=a.a,u=s.a,c=n.a,d=o.a,p=function(e,t,r){this.map=e,this.id=r,this.parent=t,this.metatiles={},this.meshes={},this.textures={},this.subtextures={},this.geodata={},this.credits={},this.children=[null,null,null,null]};p.prototype.kill=function(){for(var e=0;e<4;e++)null!=this.children[e]&&this.children[e].kill();this.children=[null,null,null,null];var t=this.parent;this.parent=null,null!=t&&t.removeChild(this)},p.prototype.addChild=function(e){if(!this.children[e]){var t=this.id,r=[t[0]+1,t[1]<<1,t[2]<<1];switch(e){case 1:r[1]++;break;case 2:r[2]++;break;case 3:r[1]++,r[2]++}this.children[e]=new p(this.map,this,r)}},p.prototype.removeChildByIndex=function(e){null!=this.children[e]&&(this.children[e].kill(),this.children[e]=null)},p.prototype.removeChild=function(e){for(var t=0;t<4;t++)this.children[t]==e&&(this.children[t].kill(),this.children[t]=null)},p.prototype.getMesh=function(e,t){var r=this.meshes[e];return r||(r=new c(this.map,e,t),this.meshes[e]=r),r},p.prototype.getGeodata=function(e,t){var r=this.geodata[e];return r||(r=new d(this.map,e,t),this.geodata[e]=r),r},p.prototype.getTexture=function(e,t,r,i,a,s){var n;if(i&&(i.layer||i.hmap)){var o=e+(i.hmap?"":i.layer.id);n=this.textures[o],n||(n=new h(this.map,e,t,r,i,a,s),this.textures[o]=n)}else(n=this.textures[e])||(n=new h(this.map,e,t,r,i,a,s),this.textures[e]=n);return n},p.prototype.getSubtexture=function(e,t,r,i,a,s,n){return e=this.subtextures[t],e||(e=new l(this.map,t,r,i,a,s,n),this.subtextures[t]=e),e},p.prototype.addMetatile=function(e,t){this.metatiles[e]=t},p.prototype.removeMetatile=function(e){for(var t in this.metatiles)this.metatiles[t]==e&&delete this.metatiles[t]},p.prototype.getMetatile=function(e,t,r){var i,a=this.metatiles;for(var s in a)if(a[s].surface==e)return a[s];var n=e.getMetaUrl(this.id);return a[n]?(i=a[n].clone(e),this.addMetatile(n,i),i):t?(i=new u(this,e,r),this.addMetatile(n,i),i):null},t.a=p},function(e,t,r){"use strict";var i=r(147),a=i.a,s=function(e){this.map=e,this.tree=new a(e,null,[0,0,0])};s.prototype.kill=function(){this.tree.kill()},s.prototype.findNode=function(e,t){for(var r=this.tree,i=e[0];i>0;i--){var a=1<<i-1,s=0;if(0!=(e[1]&a)&&(s+=1),0!=(e[2]&a)&&(s+=2),!r.children[s]){if(!t)return null;r.addChild(s)}r=r.children[s]}return r},s.prototype.findAgregatedNode=function(e,t,r){for(var i=this.tree,a=e[1]>>t<<t,s=e[2]>>t<<t,n=e[0];n>0;n--){var o=1<<n-1,h=0;if(0!=(a&o)&&(h+=1),0!=(s&o)&&(h+=2),!i.children[h]){if(!r)return null;i.addChild(h)}i=i.children[h]}return i},t.a=s},function(e,t,r){"use strict";var i=function(e){this.map=e,this.core=e.core,this.inspector=e.core.inspector,this.drawnTiles=0,this.drawnGeodataTiles=0,this.drawnGeodataTilesFactor=0,this.drawnGeodataTilesPerLayer=0,this.drawnFaces=0,this.drawCalls=0,this.usedNodes=0,this.processedNodes=0,this.processedMetatiles=0,this.counter=0,this.statsCycle=0,this.fps=0,this.frameTime=0,this.renderTime=0,this.renderTimeTmp=0,this.renderTimeBegin=0,this.renderBuild=0,this.lastRenderTime=0,this.lastFrameTime=0,this.renderedLods=new Array(32),this.debugIds={},this.recordGraphs=!1,this.graphsTimeIndex=0,this.graphsLastTimeIndex=0,this.graphsTimeSamples=900,this.graphsRenderTimes=new Array(this.graphsTimeSamples),this.graphsCreateMeshTimes=new Array(this.graphsTimeSamples),this.graphsCreateGpuMeshTimes=new Array(this.graphsTimeSamples),this.graphsCreateTextureTimes=new Array(this.graphsTimeSamples),this.graphsFrameTimes=new Array(this.graphsTimeSamples),this.graphsCpuMemoryMetatiles=new Array(this.graphsTimeSamples),this.graphsCpuMemoryUsed=new Array(this.graphsTimeSamples),this.graphsGpuMemoryTextures=new Array(this.graphsTimeSamples),this.graphsGpuMemoryMeshes=new Array(this.graphsTimeSamples),this.graphsGpuMemoryGeodata=new Array(this.graphsTimeSamples),this.graphsGpuMemoryRender=new Array(this.graphsTimeSamples),this.graphsPolygons=new Array(this.graphsTimeSamples),this.graphsLODs=new Array(this.graphsTimeSamples),this.graphsBuild=new Array(this.graphsTimeSamples),this.graphsFluxTextures=new Array(this.graphsTimeSamples),this.graphsFluxMeshes=new Array(this.graphsTimeSamples),this.graphsFluxGeodatas=new Array(this.graphsTimeSamples),this.graphsFluxTexture=[[0,0],[0,0]],this.graphsFluxMesh=[[0,0],[0,0]],this.graphsFluxGeodata=[[0,0],[0,0]],this.graphsCreateTextureTime=0,this.graphsCreateGpuMeshTime=0,this.graphsCreateMeshTime=0,this.resetGraphs(),this.gpuMeshes=0,this.gpuTextures=0,this.gpuGeodata=0,this.gpuUsed=0,this.resourcesUsed=0,this.metaUsed=0,this.gpuRenderUsed=0,this.loadedCount=0,this.loadErrorCount=0,this.loadFirst=0,this.loadLast=0,this.gpuNeeded=0,this.gpuNeeded2=0,this.heightClass=0,this.heightLod=0,this.heightNode=0,this.heightTerrain=0,this.heightDelta=0,this.debugStr=null};i.prototype.resetGraphs=function(){this.graphsTimeIndex=0;for(var e=0;e<this.graphsTimeSamples;e++)this.graphsRenderTimes[e]=0,this.graphsCreateMeshTimes[e]=0,this.graphsCreateGpuMeshTimes[e]=0,this.graphsCreateTextureTimes[e]=0,this.graphsFrameTimes[e]=0,this.graphsCpuMemoryUsed[e]=0,this.graphsCpuMemoryMetatiles[e]=0,this.graphsGpuMemoryTextures[e]=0,this.graphsGpuMemoryMeshes[e]=0,this.graphsGpuMemoryGeodata[e]=0,this.graphsGpuMemoryRender[e]=0,this.graphsPolygons[e]=0,this.graphsLODs[e]=[0,[]],this.graphsBuild[e]=0,this.graphsFluxTextures[e]=[[0,0],[0,0]],this.graphsFluxMeshes[e]=[[0,0],[0,0]],this.graphsFluxGeodatas[e]=[[0,0],[0,0]]},i.prototype.begin=function(e){if(e){this.drawnTiles=0,this.drawnGeodataTiles=0,this.drawnGeodataTilesFactor=0,this.drawnGeodataTilesPerLayer=0,this.drawCalls=0,this.drawnFaces=0,this.gpuRenderUsed=0,this.gpuNeeded=0,this.usedNodes=0,this.processedNodes=0,this.processedMetatiles=0;for(var t=0,r=this.renderedLods.length;t<r;t++)this.renderedLods[t]=0}this.debugIds={},this.counter++,this.statsCycle++,this.renderTimeBegin=performance.now(),e&&(this.lastFrameTime&&(this.frameTime=this.renderTimeBegin-this.lastFrameTime),this.lastFrameTime=this.renderTimeBegin)},i.prototype.end=function(e){var t=performance.now(),r=t-this.renderTimeBegin;if(e?(this.renderTimeTmp+=r,this.lastRenderTime=r):this.renderTimeTmp+=this.lastRenderTime,this.recordGraphs){var i=this.graphsTimeIndex;this.graphsRenderTimes[i]=r,this.graphsCreateMeshTimes[i]=0,this.graphsCreateGpuMeshTimes[i]=0,this.graphsCreateTextureTimes[i]=0,this.graphsFrameTimes[i]=this.frameTime,this.graphsCpuMemoryUsed[i]=this.map.resourcesCache.totalCost,this.graphsCpuMemoryMetatiles[i]=this.map.metatileCache.totalCost,this.graphsGpuMemoryTextures[i]=this.gpuTextures,this.graphsGpuMemoryMeshes[i]=this.gpuMeshes,this.graphsGpuMemoryGeodata[i]=this.gpuGeodata,this.graphsGpuMemoryRender[i]=this.gpuRenderUsed,this.graphsPolygons[i]=this.drawnFaces,this.graphsFluxTextures[i]=[[this.graphsFluxTexture[0][0],this.graphsFluxTexture[0][1]],[this.graphsFluxTexture[1][0],this.graphsFluxTexture[1][1]]],this.graphsFluxMeshes[i]=[[this.graphsFluxMesh[0][0],this.graphsFluxMesh[0][1]],[this.graphsFluxMesh[1][0],this.graphsFluxMesh[1][1]]],this.graphsFluxGeodatas[i]=[[this.graphsFluxGeodata[0][0],this.graphsFluxGeodata[0][1]],[this.graphsFluxGeodata[1][0],this.graphsFluxGeodata[1][1]]],this.graphsLODs[i]=[this.drawnTiles,this.renderedLods.slice()],this.graphsBuild[i]=this.renderBuild,this.graphsTimeIndex=(this.graphsTimeIndex+1)%this.graphsTimeSamples,this.inspector&&this.inspector.graphs&&this.inspector.graphs.updateGraphs(this)}this.statsCycle%50==0&&(this.renderTime=this.renderTimeTmp/100,this.fps=1e3/this.renderTime,this.renderTimeTmp=0,this.inspector&&this.inspector.stats&&(this.gpuUsed=this.map.gpuCache.totalCost,this.resourcesUsed=this.map.resourcesCache.totalCost,this.metaUsed=this.map.metatileCache.totalCost,this.inspector.stats.updateStatsPanel(this))),this.graphsFluxTexture=[[0,0],[0,0]],this.graphsFluxMesh=[[0,0],[0,0]],this.graphsFluxGeodata=[[0,0],[0,0]],this.debugStr=this.map.renderer.debugStr},t.a=i},function(e,t,r){"use strict";var i=r(2),a=r(3),s=r(32),n=r(5),o=i.e,h=a.a,l=s.a,u=n.a,c=function(e,t){this.generateLines=!0,this.map=e.map,this.vertices=null,this.internalUVs=null,this.externalUVs=null,this.mesh=e,this.statsCounter=0,this.valid=!0,this.killed=!1,this.bbox=new u,this.size=0,this.faces=0,this.flagsInternalTexcoords=1,this.flagsExternalTexcoords=2,this.flagsPerVertexUndulation=4,this.flagsTextureMode=8,null!=t&&this.parseSubmesh(t)};c.prototype.kill=function(){this.killed=!0,this.vertices=null,this.internalUVs=null,this.externalUVs=null},c.prototype.parseSubmesh=function(e){this.parseHeader(e),this.mesh.version>=3?this.parseVerticesAndFaces2(e):this.parseVerticesAndFaces(e)},c.prototype.parseHeader=function(e){var t=e.data;this.flags=t.getUint8(e.index,!0),e.index+=1,this.mesh.version>1?(this.surfaceReference=t.getUint8(e.index,!0),e.index+=1):this.surfaceReference=0,this.textureLayer=t.getUint16(e.index,!0),e.index+=2,this.textureLayer2=this.textureLayer;var r=this.bbox.min,i=this.bbox.max;r[0]=t.getFloat64(e.index,!0),e.index+=8,r[1]=t.getFloat64(e.index,!0),e.index+=8,r[2]=t.getFloat64(e.index,!0),e.index+=8,i[0]=t.getFloat64(e.index,!0),e.index+=8,i[1]=t.getFloat64(e.index,!0),e.index+=8,i[2]=t.getFloat64(e.index,!0),e.index+=8,this.bbox.updateMaxSize()},c.prototype.parseVerticesAndFaces=function(e){var t=e.data,r=e.index,i=e.uint8Data,a=t.getUint16(r,!0);r+=2,a||(this.valid=!1);var s=null,n=null,o=new Float32Array(3*a);this.flags&this.flagsExternalTexcoords&&(n=new Float32Array(2*a));var h,l,u=0,c=0;for(h=0;h<a;h++)o[u]=(i[r]+(i[r+1]<<8))*(1/65535),o[u+1]=(i[r+2]+(i[r+3]<<8))*(1/65535),o[u+2]=(i[r+4]+(i[r+5]<<8))*(1/65535),u+=3,null!=n?(n[c]=(i[r+6]+(i[r+7]<<8))*(1/65535),n[c+1]=(65535-(i[r+8]+(i[r+9]<<8)))*(1/65535),c+=2,r+=10):r+=6;if(this.tmpVertices=o,this.tmpExternalUVs=n,this.flags&this.flagsInternalTexcoords){var d=t.getUint16(r,!0);for(r+=2,s=new Float32Array(2*d),h=0,l=2*d;h<l;h+=2)s[h]=(i[r]+(i[r+1]<<8))*(1/65535),s[h+1]=(65535-(i[r+2]+(i[r+3]<<8)))*(1/65535),r+=4;this.tmpInternalUVs=s}var p=t.getUint16(r,!0);r+=2,s=null,n=null,o=new Float32Array(3*p*3),this.flags&this.flagsInternalTexcoords&&(s=new Float32Array(3*p*2)),this.flags&this.flagsExternalTexcoords&&(n=new Float32Array(3*p*2));var f=this.tmpVertices,m=this.tmpExternalUVs,g=this.tmpInternalUVs;for(h=0;h<p;h++){u=9*h;var v=i[r]+(i[r+1]<<8),y=i[r+2]+(i[r+3]<<8),b=i[r+4]+(i[r+5]<<8),x=3*v;o[u]=f[x],o[u+1]=f[x+1],o[u+2]=f[x+2],x=3*y,o[u+3]=f[x],o[u+4]=f[x+1],o[u+5]=f[x+2],x=3*b,o[u+6]=f[x],o[u+7]=f[x+1],o[u+8]=f[x+2],null!=n&&(u=6*h,n[u]=m[2*v],n[u+1]=m[2*v+1],n[u+2]=m[2*y],n[u+3]=m[2*y+1],n[u+4]=m[2*b],n[u+5]=m[2*b+1]),null!=s?(v=i[r+6]+(i[r+7]<<8),y=i[r+8]+(i[r+9]<<8),b=i[r+10]+(i[r+11]<<8),r+=12,u=6*h,s[u]=g[2*v],s[u+1]=g[2*v+1],s[u+2]=g[2*y],s[u+3]=g[2*y+1],s[u+4]=g[2*b],s[u+5]=g[2*b+1]):r+=6}this.vertices=o,this.internalUVs=s,this.externalUVs=n,this.tmpVertices=null,this.tmpInternalUVs=null,this.tmpExternalUVs=null,e.index=r,this.size=this.vertices.length,this.internalUVs&&(this.size+=this.internalUVs.length),this.externalUVs&&(this.size+=this.externalUVs.length),this.size*=4,this.faces=p},c.prototype.parseWord=function(e,t){var r=e[t[1]];128&r?(t[0]=127&r|e[t[1]+1]<<7,t[1]+=2):(t[0]=r,t[1]++)},c.prototype.parseDelta=function(e,t){var r=e[t[1]];128&r?(r=127&r|e[t[1]+1]<<7,1&r?(t[0]=-(1+(r>>1)),t[1]+=2):(t[0]=r>>1,t[1]+=2)):1&r?(t[0]=-(1+(r>>1)),t[1]++):(t[0]=r>>1,t[1]++)},c.prototype.parseVerticesAndFaces2=function(e){var t=e.data,r=e.index,i=e.uint8Data,a=t.getUint16(r,!0);r+=2;var s=t.getUint16(r,!0);r+=2,a||(this.valid=!1);var n,o,h,l=this.bbox.center(),u=this.bbox.maxSize,c=1/s,d=null,p=new Float32Array(3*a),f=0,m=0,g=0,v=l[0],y=l[1],b=l[2],x=this.bbox.min[0],M=this.bbox.min[1],S=this.bbox.min[2],w=1/(this.bbox.max[0]-this.bbox.min[0]),A=1/(this.bbox.max[1]-this.bbox.min[1]),T=1/(this.bbox.max[2]-this.bbox.min[2]),C=[0,r];for(o=0;o<a;o++)this.parseDelta(i,C),f+=C[0],this.parseDelta(i,C),m+=C[0],this.parseDelta(i,C),g+=C[0],n=3*o,p[n]=(f*c*u+v-x)*w,p[n+1]=(m*c*u+y-M)*A,p[n+2]=(g*c*u+b-S)*T;if(r=C[1],this.flags&this.flagsExternalTexcoords)for(s=t.getUint16(r,!0),r+=2,c=1/s,d=new Float32Array(2*a),f=0,m=0,C[1]=r,o=0;o<a;o++){this.parseDelta(i,C),f+=C[0],this.parseDelta(i,C),m+=C[0];var P=2*o;d[P]=f*c,d[P+1]=1-m*c}if(r=C[1],this.tmpVertices=p,this.tmpExternalUVs=d,this.flags&this.flagsInternalTexcoords){var F=t.getUint16(r,!0);r+=2;var L=t.getUint16(r,!0);r+=2;var E=t.getUint16(r,!0);r+=2;var I=1/L,N=1/E;f=0,m=0;var B=new Float32Array(2*F);for(C[1]=r,o=0,h=2*F;o<h;o+=2)this.parseDelta(i,C),f+=C[0],this.parseDelta(i,C),m+=C[0],B[o]=f*I,B[o+1]=1-m*N;r=C[1],this.tmpInternalUVs=B}var _=t.getUint16(r,!0);r+=2,B=null,d=null,p=new Float32Array(3*_*3),this.flags&this.flagsInternalTexcoords&&(B=new Float32Array(3*_*2)),this.flags&this.flagsExternalTexcoords&&(d=new Float32Array(3*_*2));var R,k,z,U=this.tmpVertices,D=this.tmpExternalUVs,G=this.tmpInternalUVs,V=0;for(C[1]=r,o=0;o<_;o++){n=9*o,this.parseWord(i,C),R=V-C[0],C[0]||V++,this.parseWord(i,C),k=V-C[0],C[0]||V++,this.parseWord(i,C),z=V-C[0],C[0]||V++;var O=3*R;p[n]=U[O],p[n+1]=U[O+1],p[n+2]=U[O+2],O=3*k,p[n+3]=U[O],p[n+4]=U[O+1],p[n+5]=U[O+2],O=3*z,p[n+6]=U[O],p[n+7]=U[O+1],p[n+8]=U[O+2],null!=d&&(n=6*o,d[n]=D[2*R],d[n+1]=D[2*R+1],d[n+2]=D[2*k],d[n+3]=D[2*k+1],d[n+4]=D[2*z],d[n+5]=D[2*z+1])}if(V=0,null!=B)for(o=0;o<_;o++)this.parseWord(i,C),R=V-C[0],C[0]||V++,this.parseWord(i,C),k=V-C[0],C[0]||V++,this.parseWord(i,C),z=V-C[0],C[0]||V++,n=6*o,B[n]=G[2*R],B[n+1]=G[2*R+1],B[n+2]=G[2*k],B[n+3]=G[2*k+1],B[n+4]=G[2*z],B[n+5]=G[2*z+1];r=C[1],this.vertices=p,this.internalUVs=B,this.externalUVs=d,this.tmpVertices=null,this.tmpInternalUVs=null,this.tmpExternalUVs=null,e.index=r,this.size=this.vertices.length,this.internalUVs&&(this.size+=this.internalUVs.length),this.externalUVs&&(this.size+=this.externalUVs.length),this.size*=4,this.faces=_},c.prototype.size=function(){return this.size},c.prototype.fileSize=function(){return this.fileSize},c.prototype.buildGpuMesh=function(){return new l(this.map.renderer.gpu,{bbox:this.bbox,vertices:this.vertices,uvs:this.internalUVs,uvs2:this.externalUVs},1,this.map.core)},c.prototype.getWorldMatrix=function(e,t){var r=t;return null!=r?(r[0]=this.bbox.side(0),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=this.bbox.side(1),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=this.bbox.side(2),r[11]=0,r[12]=this.bbox.min[0]-e[0],r[13]=this.bbox.min[1]-e[1],r[14]=this.bbox.min[2]-e[2],r[15]=1):(r=o.create(),o.multiply(h.translationMatrix(this.bbox.min[0]-e[0],this.bbox.min[1]-e[1],this.bbox.min[2]-e[2]),h.scaleMatrix(this.bbox.side(0),this.bbox.side(1),this.bbox.side(2)),r)),r},c.prototype.drawBBox=function(e){var t=this.map.renderer;t.gpu.useProgram(t.progBBox,["aPosition"]);var r=o.create(),i=o.create();o.multiply(t.camera.getModelviewMatrix(),this.getWorldMatrix(e),i);var a=t.camera.getProjectionMatrix();o.multiply(a,i,r),t.progBBox.setMat4("uMVP",r),t.bboxMesh.draw(t.progBBox,"aPosition")},t.a=c},function(e,t,r){"use strict";var i=function(e){this.map=e};i.prototype.generateSurfaceSequence=function(){var e=this.map.currentView,t=this.map.tree;if(t){t.surfaceSequence=[],t.surfaceSequenceIndices=[],t.surfaceOnlySequence=[];var r,i,a,s,n,o,h,l,u={},c=0,d=[],p=[];for(l in e.surfaces)(r=this.map.getSurface(l))&&(p.push(r.id),c++,u[l]=r.index+1,d.push([[r.index+1],r,!0,!1]));if(c>=1&&(p.sort(),p=p.join(";"),(r=this.map.virtualSurfaces[p])&&(d=[[[r.index+1],r,!0,!1]],c=1)),c>1){var f=[];for(l in this.map.glues){i=this.map.glues[l];var m=i.id;if(m.length<=c){var g=!1;for(o=0,h=m.length;o<h;o++)if(!u[m[o]]){g=!0;break}if(!g){for(a=[],o=0,h=m.length;o<h;o++)a.unshift(u[m[o]]);f.push([a,i,!1,!1])}}}for(s=0,n=f.length;s<n;s++){var v=f[s];i=v[1],i.flagProper=!0,i.flagAlien=!0,i.flagProper&&d.push(v),i.flagAlien&&(a=v[0].slice(1),d.push([a,v[1],!1,!0]))}do{var y=!0;for(s=0,n=d.length-1;s<n;s++){var b=d[s][0],x=d[s+1][0],M=!1;for(o=0,h=Math.min(b.length,x.length);o<h;o++)if(b[o]<x[o]||o==h-1&&b[o]==x[o]&&x.length>b.length){M=!0;break}if(M){var S=d[s];d[s]=d[s+1],d[s+1]=S,y=!1}}}while(!y);var w=c-1;for(s=0,n=d.length;s<n;s++)t.surfaceSequence.push([d[s][1],d[s][3]]),d[s][1].viewSurfaceIndex=w,d[s][2]&&(w--,t.surfaceOnlySequence.push(d[s][1]))}else 1==c&&(t.surfaceSequence.push([d[0][1],d[0][3]]),d[0][1].viewSurfaceIndex=c-1,t.surfaceOnlySequence=[d[0][1]]);this.map.freeLayersHaveGeodata=!1;for(l in e.freeLayers){var A=this.map.getFreeLayer(l);A&&(A.surfaceSequence=[A],A.surfaceOnlySequence=[A],A.geodata&&(this.map.freeLayersHaveGeodata=!0))}this.map.renderer.draw.clearJobBuffer()}},i.prototype.generateBoundLayerSequence=function(){var e,t,r,i,a,s,n=this.map.currentView;for(e in n.surfaces){var o=n.surfaces[e],h=this.map.getSurface(e);if(null!=h)for(h.boundLayerSequence=[],a=0,s=o.length;a<s;a++)t=o[a],"string"==typeof t?(r=this.map.getBoundLayerById(t))&&h.boundLayerSequence.push([r,1]):(r=this.map.getBoundLayerById(t.id))&&(i=1,void 0!==t.alpha&&(i=t.alpha),h.boundLayerSequence.push([r,i]))}for(e in n.freeLayers){var l=n.freeLayers[e],u=this.map.getFreeLayer(e);if(null!=u&&u.ready){u.boundLayerSequence=[];var c=l.boundLayers;if(c&&Array.isArray(c))for(a=0,s=c.length;a<s;a++)t=c[a],"string"==typeof t?(r=this.map.getBoundLayerById(t))&&u.boundLayerSequence.push([r,1]):(r=this.map.getBoundLayerById(t.id))&&(i=1,void 0!==t.alpha&&(i=t.alpha),u.boundLayerSequence.push([r,i]))}}},t.a=i},function(e,t,r){"use strict";var i=r(2),a=r(6),s=i.b,n=a.a,o=[[-1,-1,0,0],[0,-1,.5,1],[1,-1,1,0],[-1,0,0,.5],[0,0,.5,.5],[1,0,1,.5],[-1,1,0,1],[0,1,.5,0],[1,1,1,1]],h=[[0,1,3],[2,1,5],[6,3,7],[8,7,5]],l=function(e,t,r){this.map=e,this.id=r,this.parent=t,this.viewCounter=e.viewCounter,this.drawCounter=0,this.childrenReadyCount=0,this.renderReady=!1,this.geodataCounter=0,this.texelSize=1,this.texelSize2=1,this.distance=1,this.tiltAngle=1,this.metanode=null,this.lastMetanode=null,this.boundmetaresources=null,this.surface=null,this.surfaceMesh=null,this.surfaceGeodata=null,this.surfaceGeodataView=null,this.surfaceTextures=[],this.resourceSurface=null,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.resetDrawCommands=!1,this.drawCommands=[[],[],[]],this.bounds={},this.boundLayers={},this.boundTextures={},this.updateBounds=!0,this.hmap=null,this.heightMap=null,this.drawCommands=[[],[],[]],this.imageryCredits={},this.glueImageryCredits={},this.mapdataCredits={},this.resources=this.map.resourcesTree.findNode(r,!0),this.metaresources=this.map.resourcesTree.findAgregatedNode(r,5,!0),this.boundresources=this.map.resourcesTree.findAgregatedNode(r,8,!0),this.children=[null,null,null,null]};l.prototype.kill=function(){for(var e=0;e<4;e++)null!=this.children[e]&&this.children[e].kill();this.resources=null,this.metaresources=null,this.metanode=null,this.surface=null,this.surfaceMesh=null,this.surfaceTextures=[],this.surfaceGeodata=null,this.surfaceGeodataView=null,this.resourceSurface=null,this.bounds={},this.boundLayers={},this.boundTextures={},this.updateBounds=!0,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.renderReady=!1,this.lastSurface=null,this.lastState=null,this.lastRenderState=null,this.hmap=null,this.heightMap=null,this.drawCommands=[[],[],[]],this.imageryCredits={},this.glueImageryCredits={},this.mapdataCredits={},this.verifyChildren=!1,this.children=[null,null,null,null];var t=this.parent;this.parent=null,null!=t&&t.removeChild(this)},l.prototype.validate=function(){null==this.metaresources||this.metaresources.getMetatile(this.surface,null,this)},l.prototype.viewSwitched=function(){this.lastSurface=this.surface,this.lastState={surfaceMesh:this.surfaceMesh,surfaceTextures:this.surfaceTextures,boundTextures:this.boundTextures,surfaceGeodata:this.surfaceGeodata,surfaceGeodataView:this.surfaceGeodataView,resourceSurface:this.resourceSurface},this.drawCommands[0].length>0?this.lastRenderState={drawCommands:this.drawCommands,imageryCredits:this.imageryCredits,mapdataCredits:this.mapdataCredits}:this.lastRenderState=null,this.verifyChildren=!0,this.renderReady=!1,this.lastMetanode=this.metanode;for(var e in this.bounds)this.bounds[e]={sequence:[],alpha:[],transparent:!1,viewCoutner:0};this.boundLayers={},this.boundTextures={},this.updateBounds=!0,this.transparentBounds=!1,this.surface=null,this.surfaceMesh=null,this.surfaceTextures=[],this.surfaceGeodata=null,this.surfaceGeodataView=null,this.resourceSurface=null,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.drawCommands=[[],[],[]],this.imageryCredits={},this.glueImageryCredits={},this.mapdataCredits={}},l.prototype.restoreLastState=function(){this.lastState&&(this.surfaceMesh=this.lastState.surfaceMesh,this.surfaceTextures=this.lastState.surfaceTextures,this.boundTextures=this.lastState.boundTextures,this.surfaceGeodata=this.lastState.surfaceGeodata,this.surfaceGeodataView=this.lastState.surfaceGeodataView,this.resourceSurface=this.lastState.resourceSurface,this.lastSurface=null,this.lastState=null,this.lastResourceSurface=null)},l.prototype.addChild=function(e){if(!this.children[e]){var t=this.id,r=[t[0]+1,t[1]<<1,t[2]<<1];switch(e){case 1:r[1]++;break;case 2:r[2]++;break;case 3:r[1]++,r[2]++}this.children[e]=new l(this.map,this,r)}},l.prototype.removeChildByIndex=function(e){null!=this.children[e]&&(this.children[e].kill(),this.children[e]=null)},l.prototype.removeChild=function(e){for(var t=0;t<4;t++)this.children[t]==e&&(this.children[t].kill(),this.children[t]=null)},l.prototype.isMetanodeReady=function(e,t,r){if(this.map.viewCounter!=this.viewCoutner&&(this.viewSwitched(),this.viewCoutner=this.map.viewCounter,this.map.markDirty()),!r&&((this.virtualSurfacesUncomplete||null==this.surface&&0==this.virtualSurfaces.length)&&this.checkSurface(e,t),(null==this.metanode||this.lastMetanode)&&!this.virtualSurfacesUncomplete)){if(!(this.checkMetanode(e,t)||null!=this.metanode&&this.lastMetanode))return!1}return null!=this.metanode&&(this.metanode.metatile.used(),this.lastSurface&&this.lastSurface==this.surface&&(this.lastSurface=null,this.restoreLastState()),this.surface&&(this.surface.virtual?(this.resourceSurface=this.surface.getSurface(this.metanode.sourceReference),this.resourceSurface||(this.resourceSurface=this.surface)):this.resourceSurface=this.surface),!0)},l.prototype.checkSurface=function(e,t){if(this.surface=null,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.virtualSurfacesUncomplete=!1,e.freeLayerSurface)return void(this.surface=e.freeLayerSurface);for(var r=e.surfaceSequence,i=0,a=r.length;i<a;i++){var s=r[i][0],n=r[i][1];if(s.hasTile2(this.id)[0]){if(this.id[0]>0){var o=this.parent;if(o){if(o.virtualSurfacesUncomplete)return this.virtualSurfacesUncomplete=!0,void(this.virtualSurfaces=[]);var h=o.metaresources.getMetatile(s,null,this);if(!h)continue;if(!h.isReady(t)){this.virtualSurfacesUncomplete=!0;continue}var l=h.getNode(o.id);if(!l)continue;if(!l.hasChildById(this.id))continue}}this.virtualSurfaces.push([s,n])}}this.virtualSurfaces.length>1?this.virtual=!0:this.surface=this.virtualSurfaces[0]?this.virtualSurfaces[0][0]:null},l.prototype.checkMetanode=function(e,t){if(this.virtual){if(!this.isVirtualMetanodeReady(e,t))return!1;this.metanode=this.createVirtualMetanode(e,t),this.lastMetanode=null,this.map.markDirty()}var r=this.surface;if(null==r)return!1;var i=this.metaresources.getMetatile(r,!0,this);if(!i.isReady(t))return!1;if(this.virtual||(this.metanode=i.getNode(this.id),this.lastMetanode=null,this.map.markDirty()),null!=this.metanode){this.metanode.tile=this,this.lastMetanode=null,this.map.markDirty();for(var a=0;a<4;a++)this.metanode.hasChild(a)?this.addChild(a):this.removeChildByIndex(a)}return!0},l.prototype.isVirtualMetanodeReady=function(e,t){for(var r=this.virtualSurfaces,i=0,a=0,s=r.length;a<s;a++){var n=r[a][0];this.metaresources.getMetatile(n,!0,this).isReady(t)&&i++}return i==s},l.prototype.createVirtualMetanode=function(e,t){var r,i,a,s,n,o=this.virtualSurfaces,h=null;for(r=0,i=o.length;r<i;r++){a=o[r][0];var l=o[r][1];if(s=this.metaresources.getMetatile(a,null,this),s.isReady(t)&&null!=(n=s.getNode(this.id))){if(l!=n.alien)continue;if(!l&&a.glue&&!n.hasGeometry()&&n.internalTextureCount>0){var u=n.internalTextureCount-1;u=this.map.getSurface(a.id[u]).viewSurfaceIndex;for(var c=!1,d=r;d<i;d++)if(o[d].viewSurfaceIndex<=u){c=d>r,r=d-1;break}if(c)continue}if(n.hasGeometry()){h=n.clone(),this.surface=a;break}}}for(r=0,i=o.length;r<i;r++)a=o[r][0],s=this.metaresources.getMetatile(a,null,this),s.isReady(t)&&null!=(n=s.getNode(this.id))&&(h?(h.flags|=240&n.flags,s.useVersion<4&&(h.bbox.min[0]=Math.min(h.bbox.min[0],n.bbox.min[0]),h.bbox.min[1]=Math.min(h.bbox.min[1],n.bbox.min[1]),h.bbox.min[2]=Math.min(h.bbox.min[2],n.bbox.min[2]),h.bbox.max[0]=Math.max(h.bbox.max[0],n.bbox.max[0]),h.bbox.max[1]=Math.max(h.bbox.max[1],n.bbox.max[1]),h.bbox.max[2]=Math.max(h.bbox.max[2],n.bbox.max[2]))):(h=n.clone(),this.surface=a));return h&&h.generateCullingHelpers(!0),h},l.prototype.bboxVisible=function(e,t,r,i){var a=this.map,n=a.camera;if(e[0]<a.measure.minDivisionNodeDepth)return!0;if(!a.config.mapDisableCulling&&a.isGeocent&&i){var o=i.diskPos,h=n.position,l=[o[0]-h[0],o[1]-h[1],o[2]-h[2]],u=s.normalize4(l)*n.distanceFactor,c=s.dot(l,i.diskNormal);if(this.tiltAngle=c,u>15e4&&c>i.diskAngle)return!1}return i.metatile.useVersion>=4?n.camera.pointsVisible(i.bbox2,r):!a.isGeocent||!a.config.mapPreciseBBoxTest||e[0]<4?n.camera.bboxVisible(t,r):n.camera.pointsVisible(i.bbox2,r)},l.prototype.insideCone=function(e,t,r){if(this.map.isGeocent){return Math.acos(s.dot(e,r.diskNormal))<t+r.diskAngle2A}return!1},l.prototype.getPixelSize=function(e,t,r,i,a){var s=e.min,n=e.max,o=s[0]-r[0],h=s[1]-r[1],l=n[0]-r[0],u=s[1]-r[1],c=n[0]-r[0],d=n[1]-r[1],p=s[0]-r[0],f=n[1]-r[1],m=s[2]-r[2],g=n[2]-r[2];if(!this.map.config.mapLowresBackground&&r[0]>s[0]&&r[0]<n[0]&&r[1]>s[1]&&r[1]<n[1]&&r[2]>s[2]&&r[2]<n[2])return a?[Number.POSITIVE_INFINITY,.1]:Number.POSITIVE_INFINITY;var v=0,y=this.map.camera.camera;return v=0<h?0<o?0>g?y.scaleFactor([o,h,g],a):0<m?y.scaleFactor([o,h,m],a):y.scaleFactor([o,h,.5*(m+g)],a):0>l?0>g?y.scaleFactor([l,u,g],a):0<m?y.scaleFactor([l,u,m],a):y.scaleFactor([l,u,.5*(m+g)],a):0>g?y.scaleFactor([.5*(o+l),u,g],a):0<m?y.scaleFactor([.5*(o+l),u,m],a):y.scaleFactor([.5*(o+l),u,.5*(m+g)],a):0>f?0<p?0>g?y.scaleFactor([p,f,g],a):0<m?y.scaleFactor([p,f,m],a):y.scaleFactor([p,f,.5*(m+g)],a):0>c?0>g?y.scaleFactor([c,d,g],a):0<m?y.scaleFactor([c,d,m],a):y.scaleFactor([c,d,.5*(m+g)],a):0>g?y.scaleFactor([.5*(p+c),d,g],a):0<m?y.scaleFactor([.5*(p+c),d,m],a):y.scaleFactor([.5*(p+c),d,.5*(m+g)],a):0<p?0>g?y.scaleFactor([o,.5*(u+d),g],a):0<m?y.scaleFactor([o,.5*(u+d),m],a):y.scaleFactor([o,.5*(u+d),.5*(m+g)],a):0>c?0>g?y.scaleFactor([l,.5*(u+d),g],a):0<m?y.scaleFactor([l,.5*(u+d),m],a):y.scaleFactor([l,.5*(u+d),.5*(m+g)],a):0>g?y.scaleFactor([.5*(o+l),.5*(u+d),g],a):0<m?y.scaleFactor([.5*(o+l),.5*(u+d),m],a):y.scaleFactor([.5*(o+l),.5*(u+d),.5*(m+g)],a),a?[v[0]*t,v[1]]:v*t},l.prototype.getPixelSize3Old=function(e,t,r){var i=this.map.camera,a=i.geocentDistance*r-e.diskDistance;a<0&&(a=-a);var n=s.dot(i.geocentNormal,e.diskNormal);if(n<e.diskAngle2){var o=Math.acos(n);o-=Math.acos(e.diskAngle2);var h=Math.tan(o)*e.diskDistance;a=Math.sqrt(h*h+a*a)}return r=i.camera.scaleFactor2(a),[r*t,a]},l.prototype.getPixelSize3=function(e,t){var r,i=this.map.camera,a=i.geocentDistance,n=s.dot(i.geocentNormal,e.diskNormal),o=a-(e.diskDistance+(e.maxZ-e.minZ));if(n<e.diskAngle2){var h=Math.acos(n);h-=e.diskAngle2A;var l=Math.tan(h)*e.diskDistance;o<0?(r=a-e.diskDistance,r<0?(o=-r,o=Math.sqrt(l*l+o*o)):o=l):o=Math.sqrt(l*l+o*o)}else if(o<0){if(!((r=a-e.diskDistance)<0))return[Number.POSITIVE_INFINITY,.1];o=-r}return[i.camera.scaleFactor2(o)*t,o]},l.prototype.updateTexelSize=function(){var e,t,r,i,a=this.map,s=a.draw,n=a.camera,o=s.texelSizeFit,h=this.metanode,l=a.camera.position,u=a.isGeocent&&(a.config.mapPreciseDistanceTest||h.metatile.useVersion>=4);if(h.hasGeometry()){var c=Number.POSITIVE_INFINITY;if(h.usedTexelSize()?c=s.ndcToScreenPixel*h.pixelSize:h.usedDisplaySize()&&(c=s.ndcToScreenPixel*(h.bbox.maxSize/h.displaySize)),n.camera.ortho){var d=n.camera.getViewHeight();e=[2*c/d,d]}else h.usedDisplaySize()?u?(c=s.isGeocent?s.ndcToScreenPixel*(h.diskAngle2A*s.planetRadius*1.41421356236/h.displaySize):s.ndcToScreenPixel*(h.bbox.maxSize/h.displaySize),e=this.getPixelSize3(h,c)):(c=s.ndcToScreenPixel*(h.bbox.maxSize/256),t=h.displaySize/256*n.distance,r=n.vector,i=[l[0]-r[0]*t,l[1]-r[1]*t,l[2]-r[2]*t],e=this.getPixelSize(h.bbox,c,i,i,!0)):!u&&o>1.1?(c=s.ndcToScreenPixel*h.pixelSize*(o/1.1),t=o/1.1*n.distance,r=n.vector,i=[l[0]-r[0]*t,l[1]-r[1]*t,l[2]-r[2]*t],e=this.getPixelSize(h.bbox,c,i,i,!0)):e=u?this.getPixelSize3(h,c):this.getPixelSize(h.bbox,c,l,l,!0)}else e=u?this.getPixelSize3(h,1,1):this.getPixelSize(h.bbox,1,l,l,!0),e[0]=Number.POSITIVE_INFINITY;if(this.texelSize=e[0],this.distance=e[1],a.config.mapDegradeHorizon&&!(s.degradeHorizonFactor<1)){var p=a.config.mapDegradeHorizonParams,f=p[1],m=p[2],g=s.degradeHorizonFactor*s.degradeHorizonTiltFactor,v=this.distance*n.distanceFactor;v<f?g=1:v>f&&v<m&&(g=1+(v-f)/(m-f)*(g-1)),g=Math.max(g,1);var y=n.perceivedDistance,b=p[3];y>b?g=1:y<b&&g>1&&(g=1+(g-1)*(1-y/b)),this.texelSize/=g}},l.prototype.drawGrid=function(e,t,r){if(!((this.texelSize==Number.POSITIVE_INFINITY||this.texelSize>4.4)&&this.metanode&&this.metanode.hasChildren())&&this.metanode){var i,a,s,n,l=this.map;if(!l.draw.gridSkipped){t?(i=t[0],a=t[1][0],s=t[1][1]):(n=l.measure.getSpatialDivisionNodeAndExtents(this.id),i=n[0],a=n[1][0],s=n[1][1]);var u=[.5*(s[0]+a[0]),.5*(s[1]+a[1])],c=l.referenceFrame.hasPoles;if(r=r||this.metanode.diskAngle2,c&&!i.isPole&&Math.acos(r)>.1*Math.PI)return r=Math.cos(.5*Math.acos(r)),this.drawGrid(e,[i,[[a[0],a[1]],[u[0],u[1]]]],r),this.drawGrid(e,[i,[[u[0],a[1]],[s[0],u[1]]]],r),this.drawGrid(e,[i,[[a[0],u[1]],[u[0],s[1]]]],r),void this.drawGrid(e,[i,[[u[0],u[1]],[s[0],s[1]]]],r);var d=i.extents.ur[1]-i.extents.ll[1],p=this.distance,f=Math.log(5*d/p)/l.log2;f=Math.max(0,f-8+i.id[0]);var m,g,v,y=l.draw,b=e[0],b=e[0],x=e[1],M=e[2],S=y.planeBuffer,w=y.gridFlat,A=y.gridGlues,T=this.gridPoints,C=l.config.mapGridSurrogatez;if(!T){m=C?this.metanode.surrogatez:this.metanode.minZ;var P=i.getPhysicalCoords([s[0],s[1],m],!0),F=i.getPhysicalCoords([s[0],a[1],m],!0),L=i.getPhysicalCoords([a[0],a[1],m],!0),E=i.getPhysicalCoords([a[0],s[1],m],!0),I=i.getPhysicalCoords([u[0],s[1],m],!0),N=i.getPhysicalCoords([u[0],a[1],m],!0),B=i.getPhysicalCoords([a[0],u[1],m],!0),_=i.getPhysicalCoords([s[0],u[1],m],!0);if(u[2]=m,u=i.getPhysicalCoords(u,!0),t)S[0]=E[0]-b,S[1]=E[1]-x,S[2]=E[2]-M,S[3]=I[0]-b,S[4]=I[1]-x,S[5]=I[2]-M,S[6]=P[0]-b,S[7]=P[1]-x,S[8]=P[2]-M,S[9]=B[0]-b,S[10]=B[1]-x,S[11]=B[2]-M,S[12]=u[0]-b,S[13]=u[1]-x,S[14]=u[2]-M,S[15]=_[0]-b,S[16]=_[1]-x,S[17]=_[2]-M,S[18]=L[0]-b,S[19]=L[1]-x,S[20]=L[2]-M,S[21]=N[0]-b,S[22]=N[1]-x,S[23]=N[2]-M,S[24]=F[0]-b,S[25]=F[1]-x,S[26]=F[2]-M;else{var T=[E[0],E[1],E[2],I[0],I[1],I[2],P[0],P[1],P[2],B[0],B[1],B[2],u[0],u[1],u[2],_[0],_[1],_[2],L[0],L[1],L[2],N[0],N[1],N[2],F[0],F[1],F[2]];this.gridPoints=T}}if(!w){var R,k,z,U=this.metanode,D=U.border,G=U.borderNodes,V=l.tree,O=this.id;D||(U.border=new Array(9),U.borderNodes=new Array(9),D=U.border,G=U.borderNodes,D[4]=C?U.surrogatez:U.minZ);var j=o;if(!U.borderReady){var H=!1;for(R=0;R<9;R++)4==R||G[R]||(z=V.getNodeById([O[0],O[1]+j[R][0],O[2]+j[R][1]],!0),z?(G[R]=z,D[R]=C?z.surrogatez:z.minZ):(D[R]=D[4],H=!0));H||(U.borderReady=!0)}var q=U.border2;if(m=C?U.surrogatez:U.minZ,q&&U.borderReady||(q=[.25*(D[0]+D[1]+D[3]+D[4])-m,.5*(D[1]+D[4])-m,.25*(D[2]+D[1]+D[5]+D[4])-m,.5*(D[3]+D[4])-m,D[4]-m,.5*(D[5]+D[4])-m,.25*(D[6]+D[7]+D[3]+D[4])-m,.5*(D[7]+D[4])-m,.25*(D[8]+D[7]+D[5]+D[4])-m],U.border2=q),A){var J=h,X=this.nodeTable;for(X||(X=new Array(9),this.nodeTable=X),R=0,k=j.length;R<k;R++)4!=R&&(X[R]=V.getRenderedNodeById([O[0],O[1]+j[R][0],O[2]+j[R][1]],y.drawCounter));var W=U.border3;for(W||(W=new Array(9),U.border3=W),R=0,k=J.length;R<k;R++){for(var Y=X[J[R][0]],Z=1;Z<3;Z++)(z=X[J[R][Z]])&&(Y?z.id[0]<Y.id[0]&&(Y=z):Y=z);X[J[R][0]]=Y}for(R=0,k=j.length;R<k;R++)if(z=X[R],4!=R&&z&&z.id[0]<O[0]){var Q;switch(R){case 0:Q=[U.llx,U.lly];break;case 1:Q=[.5*(U.urx+U.llx),U.lly];break;case 2:Q=[U.urx,U.lly];break;case 3:Q=[U.llx,.5*(U.ury+U.lly)];break;case 5:Q=[U.urx,.5*(U.ury+U.lly)];break;case 6:Q=[U.llx,U.ury];break;case 7:Q=[.5*(U.urx+U.llx),U.ury];break;case 8:Q=[U.urx,U.ury]}z.border2&&(U.border3[R]=z.getGridHeight(Q,z.border2,3)+(C?z.surrogatez:z.minZ)-m)}else U.border3[R]=q[R]}}var K=l.renderer,$=K.camera.getModelviewMatrix(),ee=K.camera.getProjectionMatrix();if(T&&(S[0]=T[0]-b,S[1]=T[1]-x,S[2]=T[2]-M,S[3]=T[3]-b,S[4]=T[4]-x,S[5]=T[5]-M,S[6]=T[6]-b,S[7]=T[7]-x,S[8]=T[8]-M,S[9]=T[9]-b,S[10]=T[10]-x,S[11]=T[11]-M,S[12]=T[12]-b,S[13]=T[13]-x,S[14]=T[14]-M,S[15]=T[15]-b,S[16]=T[16]-x,S[17]=T[17]-M,S[18]=T[18]-b,S[19]=T[19]-x,S[20]=T[20]-M,S[21]=T[21]-b,S[22]=T[22]-x,S[23]=T[23]-M,S[24]=T[24]-b,S[25]=T[25]-x,S[26]=T[26]-M),c&&!l.poleRadius&&1==i.id[0]&&!i.isPole){var te=i.getPhysicalCoords([i.extents.ur[0],i.extents.ur[1],0]);l.poleRadius=Math.sqrt(te[0]*te[0]+te[1]*te[1]),l.poleRadiusFactor=8*Math.pow(2,552058/l.poleRadius)}if(g=1,c&&i.isPole)g=l.poleRadiusFactor,v=K.progPlane2,K.gpu.useProgram(v,["aPosition","aTexCoord"]),v.setVec4("uParams4",[-b,-x,l.poleRadius,0]);else if(w)v=K.progPlane,K.gpu.useProgram(v,["aPosition","aTexCoord"]);else{v=K.progPlane3,K.gpu.useProgram(v,["aPosition","aTexCoord"]);var D;D=A?U.border3:U.border2,v.setFloatArray("uHeights",D),v.setVec3("uVector",U.diskNormal)}v.setMat4("uMV",$),v.setMat4("uProj",ee),v.setFloatArray("uPoints",S);var re=i.gridStep1*g,ie=1/(s[0]-a[0]),ae=1/(a[1]-s[1]),se=re/((i.extents.ur[0]-i.extents.ll[0])*ie),ne=re/((i.extents.ur[1]-i.extents.ll[1])*ae),oe=(a[0]-i.extents.ll[0])*ie*se,he=(s[1]-i.extents.ll[1])*ae*ne;v.setVec4("uParams",[re*g,y.fogDensity,1/15,i.gridStep2*g]),v.setVec4("uParams3",[he-Math.floor(he),oe-Math.floor(oe),ne,se]),v.setVec4("uParams2",[0,0,i.gridBlend,0]),v.setVec4("uFogColor",y.atmoColor),K.gpu.bindTexture(K.heightmapTexture),K.planeMesh.draw(v,"aPosition","aTexCoord"),this.map.stats.drawnFaces+=K.planeMesh.polygons}}},l.prototype.drawHmapTile=function(e,t,r,i,a){if(this.metanode){var o,h,l,u,c=this.map,d=c.renderer;d.progHmapPlane||d.initProceduralShaders(),t?(o=t[0],h=t[1][0],l=t[1][1]):(u=c.measure.getSpatialDivisionNodeAndExtents(this.id),o=u[0],h=u[1][0],l=u[1][1]);var p=[.5*(l[0]+h[0]),.5*(l[1]+h[1])],f=c.referenceFrame.hasPoles;if(r=r||this.metanode.diskAngle2,f&&!o.isPole&&Math.acos(r)>.1*Math.PI)return r=Math.cos(.5*Math.acos(r)),this.drawHmapTile(e,[o,[[h[0],h[1]],[p[0],p[1]]]],r),this.drawHmapTile(e,[o,[[p[0],h[1]],[l[0],p[1]]]],r),this.drawHmapTile(e,[o,[[h[0],p[1]],[p[0],l[1]]]],r),void this.drawHmapTile(e,[o,[[p[0],p[1]],[l[0],l[1]]]],r);var m=o.extents.ur[1]-o.extents.ll[1],g=this.distance,v=Math.log(5*m/g)/c.log2;v=Math.max(0,v-8+o.id[0]);var y,b,x,M=c.draw,S=e[0],S=e[0],w=e[1],A=e[2],T=M.planeBuffer,C=this.gridPoints;c.config.mapGridSurrogatez;if(!C){y=0;var P=o.getPhysicalCoords([l[0],l[1],y],!0),F=o.getPhysicalCoords([l[0],h[1],y],!0),L=o.getPhysicalCoords([h[0],h[1],y],!0),E=o.getPhysicalCoords([h[0],l[1],y],!0),I=o.getPhysicalCoords([p[0],l[1],y],!0),N=o.getPhysicalCoords([p[0],h[1],y],!0),B=o.getPhysicalCoords([h[0],p[1],y],!0),_=o.getPhysicalCoords([l[0],p[1],y],!0);if(p[2]=y,p=o.getPhysicalCoords(p,!0),t)T[0]=E[0]-S,T[1]=E[1]-w,T[2]=E[2]-A,T[3]=I[0]-S,T[4]=I[1]-w,T[5]=I[2]-A,T[6]=P[0]-S,T[7]=P[1]-w,T[8]=P[2]-A,T[9]=B[0]-S,T[10]=B[1]-w,T[11]=B[2]-A,T[12]=p[0]-S,T[13]=p[1]-w,T[14]=p[2]-A,T[15]=_[0]-S,T[16]=_[1]-w,T[17]=_[2]-A,T[18]=L[0]-S,T[19]=L[1]-w,T[20]=L[2]-A,T[21]=N[0]-S,T[22]=N[1]-w,T[23]=N[2]-A,T[24]=F[0]-S,T[25]=F[1]-w,T[26]=F[2]-A;else{var C=[E[0],E[1],E[2],I[0],I[1],I[2],P[0],P[1],P[2],B[0],B[1],B[2],p[0],p[1],p[2],_[0],_[1],_[2],L[0],L[1],L[2],N[0],N[1],N[2],F[0],F[1],F[2]];this.gridPoints=C}}var R=d.camera.getModelviewMatrix(),k=d.camera.getProjectionMatrix();if(C&&(T[0]=C[0]-S,T[1]=C[1]-w,T[2]=C[2]-A,T[3]=C[3]-S,T[4]=C[4]-w,T[5]=C[5]-A,T[6]=C[6]-S,T[7]=C[7]-w,T[8]=C[8]-A,T[9]=C[9]-S,T[10]=C[10]-w,T[11]=C[11]-A,T[12]=C[12]-S,T[13]=C[13]-w,T[14]=C[14]-A,T[15]=C[15]-S,T[16]=C[16]-w,T[17]=C[17]-A,T[18]=C[18]-S,T[19]=C[19]-w,T[20]=C[20]-A,T[21]=C[21]-S,T[22]=C[22]-w,T[23]=C[23]-A,T[24]=C[24]-S,T[25]=C[25]-w,T[26]=C[26]-A),f&&!c.poleRadius&&1==o.id[0]&&!o.isPole){var z=o.getPhysicalCoords([o.extents.ur[0],o.extents.ur[1],0]);c.poleRadius=Math.sqrt(z[0]*z[0]+z[1]*z[1]),c.poleRadiusFactor=8*Math.pow(2,552058/c.poleRadius)}var U=this.metanode,D=M.debug.drawTestMode;if(b=1,f&&o.isPole)b=c.poleRadiusFactor,x=d.progPlane2,d.gpu.useProgram(x,["aPosition","aTexCoord"]),x.setVec4("uParams4",[-S,-w,c.poleRadius,0]);else{switch(D){default:case 0:x=d.progHmapPlane;break;case 1:x=d.progHmapPlane2;break;case 2:x=d.progHmapPlane5;break;case 3:x=d.progHmapPlane6;break;case 4:x=d.progHmapPlane7;break;case 8:x=d.progHmapPlane4;break;case 9:x=1==i?d.progHmapPlane3:d.progHmapPlane8}if(3!=D&&4!=D||d.ntextures||(d.ntextures=[new n(d.gpu,"./textures/test/test001.png",d.core,null),new n(d.gpu,"./textures/test/test002.png",d.core,null),new n(d.gpu,"./textures/test003.jpg",d.core,null),new n(d.gpu,"./textures/download.png",d.core,null),new n(d.gpu,"./textures/test009.jpg",d.core,null),new n(d.gpu,"./textures/test004.jpg",d.core,null),new n(d.gpu,"./textures/test005.jpg",d.core,null),new n(d.gpu,"./textures/nor_sand.jpg",d.core,null),new n(d.gpu,"./textures/test007.jpg",d.core,null),new n(d.gpu,"./textures/test008.jpg",d.core,null),new n(d.gpu,"./textures/download (1).png",d.core,null),new n(d.gpu,"./textures/test010.jpg",d.core,null),new n(d.gpu,"./textures/test011.jpg",d.core,null),new n(d.gpu,"./textures/test012.jpg",d.core,null),new n(d.gpu,"./textures/test013.jpg",d.core,null),new n(d.gpu,"./textures/test014.jpg",d.core,null),new n(d.gpu,"./textures/test015.jpg",d.core,null),new n(d.gpu,"./textures/test016.jpg",d.core,null),new n(d.gpu,"./textures/test017.jpg",d.core,null),new n(d.gpu,"./textures/test018.jpg",d.core,null)]),d.gpu.useProgram(x,["aPosition"]),x.setVec3("uVector",U.diskNormal),C){var G=[C[15]-C[12],C[16]-C[13],C[17]-C[14]],V=[C[21]-C[12],C[22]-C[13],C[23]-C[14]];s.normalize(G),s.normalize(V);var O=U.diskNormal.slice(),R=c.camera.camera.modelview,j=vts.mat3.create();vts.mat4.toInverseMat3(R,j),vts.mat3.transpose(j),vts.mat3.multiplyVec3(j,V),vts.mat3.multiplyVec3(j,O),vts.mat3.multiplyVec3(j,G);var H=[G[0],G[1],G[2],V[0],V[1],V[2],O[0],O[1],O[2]];x.setMat3("uSpace",H)}}x.setMat4("uMV",R),x.setMat4("uProj",k),x.setFloatArray("uPoints",T);var q=o.gridStep1*b;if(x.setVec4("uParams",[q*b,M.fogDensity,1/127,o.gridStep2*b]),D>=3&&D<=4)x.setVec4("uParams3",[1,1,0,0]);else if(a)x.setVec4("uParams3",a.getTransform());else{var J=1/(l[0]-h[0]),X=1/(h[1]-l[1]),W=q/((o.extents.ur[0]-o.extents.ll[0])*J),Y=q/((o.extents.ur[1]-o.extents.ll[1])*X),Z=(h[0]-o.extents.ll[0])*J*W,Q=(l[1]-o.extents.ll[1])*X*Y;x.setVec4("uParams3",[Y,W,Q-Math.floor(Q),Z-Math.floor(Z)])}if(x.setVec4("uParams2",[0,0,o.gridBlend,0]),x.setVec4("uFogColor",M.atmoColor),this.hmap.extraBound?(U=this.hmap.extraBound.sourceTile.metanode,x.setVec3("uHeights",[U.minHeight,U.maxHeight,1/U.pixelSize]),x.setVec4("uTransform",this.hmap.getTransform())):(x.setVec3("uHeights",[U.minHeight,U.maxHeight,1/U.pixelSize]),x.setVec4("uTransform",[1,1,0,0])),D>=3&&D<=4){if(!d.ntextures[M.debug.drawTestData].loaded)return;d.gpu.bindTexture(d.ntextures[M.debug.drawTestData])}else a?d.gpu.bindTexture(a.getGpuTexture()):d.gpu.bindTexture(d.heightmapTexture);x.setSampler("uSampler",0),d.gpu.bindTexture(this.hmap.getGpuTexture(),1),x.setSampler("uSampler2",1),d.planeMesh2.draw(x,"aPosition"),this.map.stats.drawnFaces+=d.planeMesh2.polygons}},t.a=l},function(e,t,r){"use strict";var i=r(3),a=i.a,s=function(e,t,r,i){this.map=e,this.p1=t.clone(),this.p2=r.clone(),this.op2=r.clone();var a=this.p1.getHeightMode(),s=this.p2.getHeightMode();"fix"==a&&"float"==s?this.p1=this.map.convert.convertPositionHeightMode(this.p1,"float",!0):"float"==a&&"fix"==s&&(this.p1=this.map.convert.convertPositionHeightMode(this.p1,"fix",!0));var n=this.p1.getViewMode(),o=this.p2.getViewMode();if("subj"==n&&"obj"==o?this.p2=this.map.convert.convertPositionViewMode(this.p2,"subj"):"obj"==n&&"subj"==o&&(this.p1=this.map.convert.convertPositionViewMode(this.p1,"subj")),this.p1.pos[5]=this.p1.pos[5]<0?360+this.p1.pos[5]%360:this.p1.pos[5]%360,this.p2.pos[5]=this.p2.pos[5]<0?360+this.p2.pos[5]%360:this.p2.pos[5]%360,this.pp1=this.p1.clone(),this.mode=i.mode||"auto",this.submode=i.submode||"none",this.submode="none",this.maxHeight=i.maxHeight||1e9,this.minDuration=i.minDuration||0,this.maxDuration=i.maxDuration||1e4,this.samplePeriod=i.samplePeriod||10,this.fade=i.fade||"none",this.fadePower=i.fadePower||1,this.yawInterpolation=i.yawInterpolation||"shortest",this.pv=i.pv||.15,this.map.getNavigationSrs().isProjected()||(this.geodesic=this.map.measure.getGeodesic()),i.distanceAzimuth)this.distanceAzimuth=!0,this.pp2=this.p1.clone(),i.destHeight&&this.pp2.setHeight(i.destHeight),i.destOrientation&&this.pp2.setHeight(i.destOrientation),i.destFov&&this.pp2.setHeight(i.destFov),this.geoAzimuth=i.azimuth||0,this.geoDistance=i.distance||100,this.distance=this.geoDistance,this.azimuth=this.geoAzimuth%360,this.azimuth=this.azimuth<0?360+this.azimuth:this.azimuth;else{this.distanceAzimuth=!1,this.pp2=this.p2.clone();var h=this.map.measure.getDistance(this.pp1.getCoords(),this.pp2.getCoords());this.distance=h[0],this.azimuth=(h[1]+90)%360,this.azimuth=this.azimuth<0?360+this.azimuth:this.azimuth,this.map.getNavigationSrs().isProjected()||(h=this.geodesic.Inverse(this.pp1.pos[2],this.pp1.pos[1],this.pp2.pos[2],this.pp2.pos[1]),this.geoAzimuth=h.azi1,this.geoDistance=h.s12,this.azimuth=this.geoAzimuth%360,this.azimuth=this.azimuth<0?360+this.azimuth:this.azimuth)}this.detectMode(),this.detectDuration(),this.detectFlightHeight(i.height)};s.prototype.detectFlightHeight=function(e){"ballistic"==this.mode&&(this.flightHeight=Math.max(this.pp1.getHeight(),this.pp2.getHeight()),this.flightHeight+=e||.5*this.distance,this.flightHeight=Math.min(this.flightHeight,this.maxHeight),this.flightHeight-=Math.max(this.pp1.getHeight(),this.pp2.getHeight()))},s.prototype.detectMode=function(){"auto"==this.mode&&(this.mode=this.distance>2e3?"ballistic":"direct")},s.prototype.detectDuration=function(){if(this.duration=0,this.headingDuration=1e3,this.distance<500?this.duration=1e3:this.distance<2e3?this.duration=2e3:(this.duration=this.distance/100,this.duration<300?this.duration=3e3:this.headingDuration=1500,this.duration<6e3&&(this.duration=6e3),this.duration>1e4&&(this.duration=1e4),"direct"!=this.mode&&(this.duration*=1.8,this.headingDuration*=1.8)),"direct"!=this.mode){var e=3*this.headingDuration;this.duration=Math.max(this.duration,e),this.maxDuration<e&&(this.duration=this.maxDuration,this.headingDuration=this.maxDuration/3)}this.duration=Math.min(this.duration,this.maxDuration),this.duration=Math.max(this.duration,this.minDuration)},s.prototype.generate=function(){for(var e=new Array(Math.ceil(this.duration/this.samplePeriod)+(this.distanceAzimuth?0:1)),t=0,r=0;r<=this.duration;r+=this.samplePeriod){var i,s,n=r/this.duration,o=this.pp1.clone();if("direct"==this.mode){switch(i=n,this.fade){case"in":switch(this.fadePower){case 1:n=i*i;break;case 2:n=i*i*i;break;case 3:n=i*i*i*i;break;case 4:n=i*i*i*i*i;break;case 5:n=i*i*i*i*i*i;break;case 6:n=i*i*i*i*i*i*i}break;case"out":switch(i=1-i,this.fadePower){case 1:n=1-i*i;break;case 2:n=1-i*i*i;break;case 3:n=1-i*i*i*i;break;case 4:n=1-i*i*i*i*i;break;case 5:n=1-i*i*i*i*i*i;break;case 6:n=1-i*i*i*i*i*i*i}break;case"inout":switch(this.fadePower){case 1:n=i*i*(3-2*i);break;case 2:n=i*i*i*(i*(6*i-15)+10);break;case 3:n=i*i*(3-2*i),i=n,n=i*i*(3-2*i);break;case 4:n=i*i*i*(i*(6*i-15)+10),i=n,n=i*i*i*(i*(6*i-15)+10);break;case 5:n=i*i*(3-2*i),i=n,n=i*i*(3-2*i),i=n,n=i*i*(3-2*i);break;case 6:n=i*i*i*(i*(6*i-15)+10),i=n,n=i*i*i*(i*(6*i-15)+10),i=n,n=i*i*i*(i*(6*i-15)+10)}}o.setCoords(this.getInterpolatedCoords(n)),o.setHeight(this.getInterpolatedHeight(n));var h=this.pp1.getOrientation(),l=this.pp2.getOrientation();o.setOrientation(this.getInterpolatedOrinetation(h,l,n)),o.setFov(this.getInterpolatedFov(n)),o.setViewExtent(this.getInterpolatedViewExtent(n)),e[t]=o.pos,t++}else{i=n,n=i*i*(3-2*i),i=n,n=i*i*(3-2*i);var u=this.getSmoothFactor(r);if("piha"==this.submode){var c=this.distance/this.duration*(r-this.duration/(2*Math.PI)*Math.sin(2*Math.PI/this.duration*r))/this.distance,d=this.pv,p=this.pp1.getCoords()[2],f=this.pp2.getCoords()[2],m=this.distance/(.001*this.duration*d*Math.tan(.5*a.radians(this.pp1.getFov())))*(1-Math.cos(2*Math.PI*r/this.duration))+p+(f-p)*r/this.duration;s=this.getInterpolatedCoords(c),o.setCoords(s),o.setHeight(m)}else s=this.getInterpolatedCoords(u),o.setCoords(s),o.setHeight(this.getSineHeight(n));null!=s[3]&&(this.azimuth=-s[3]),o.setOrientation(this.getFlightOrienation(r)),o.setFov(this.getInterpolatedFov(n)),o.setViewExtent(this.getInterpolatedViewExtent(n)),e[t]=o.pos,e[t]=o.pos,t++}}return this.distanceAzimuth||(e[t]=this.op2.clone().pos),e},s.prototype.getInterpolatedCoords=function(e){var t=this.pp1.getCoords(),r=this.pp2.getCoords();if(this.map.getNavigationSrs().isProjected())return[t[0]+(r[0]-t[0])*e,t[1]+(r[1]-t[1])*e,t[2]+(r[2]-t[2])*e];var i=this.geodesic.Direct(t[1],t[0],this.geoAzimuth,this.geoDistance*e),a=i.azi1-i.azi2;return a=this.azimuth<0?360+a:a,[i.lon2,i.lat2,t[2]+(r[2]-t[2])*e,a]},s.prototype.getInterpolatedOrinetation=function(e,t,r){var i=t[0]-e[0],a=t[1]-e[1],s=t[2]-e[2];return"shortest"==this.yawInterpolation&&Math.abs(i)>180&&(i=i>0?-(360-i):360-Math.abs(i)),[e[0]+i*r,e[1]+a*r,e[2]+s*r]},s.prototype.getInterpolatedFov=function(e){var t=this.pp1.getFov();return t+(this.pp2.getFov()-t)*e},s.prototype.getInterpolatedViewExtent=function(e){var t=this.pp1.getViewExtent();return t+(this.pp2.getViewExtent()-t)*e},s.prototype.getInterpolatedHeight=function(e){var t=this.pp1.getHeight();return t+(this.pp2.getHeight()-t)*e},s.prototype.getSineHeight=function(e){var t=this.pp1.getCoords(),r=this.pp2.getCoords();return t[2]+(r[2]-t[2])*e+Math.sin(Math.PI*e)*this.flightHeight},s.prototype.getSmoothFactor=function(e){var t=0;return t=e<this.headingDuration?0:e>this.duration-this.headingDuration?1:Math.min(1,(e-this.headingDuration)/(this.duration-2*this.headingDuration)),(t=t*t*(3-2*t))*t*(3-2*t)},s.prototype.getFlightOrienation=function(e){var t=null,r=null,i=[0,-90,0],a=0;return i[0]=this.azimuth%360,i[0]<0&&(i[0]=360-Math.abs(i[0])),e<=this.headingDuration?(a=e/this.headingDuration,t=this.pp1.getOrientation(),r=i):e>=this.duration-this.headingDuration?(a=(e-(this.duration-this.headingDuration))/this.headingDuration,t=i,r=this.pp2.getOrientation()):(a=0,t=i,r=i),this.getInterpolatedOrinetation(t,r,a)},t.a=s},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__utils_utils__=__webpack_require__(4),__WEBPACK_IMPORTED_MODULE_1__utils_url__=__webpack_require__(12),utilsUrl=__WEBPACK_IMPORTED_MODULE_1__utils_url__.a,utils=__WEBPACK_IMPORTED_MODULE_0__utils_utils__.a,MapUrl=function(e,t){this.map=e,t=t.trim(),this.baseUrl=utilsUrl.getBase(t),this.baseUrlSchema=utilsUrl.getSchema(t),this.baseUrlOrigin=utilsUrl.getOrigin(t),this.urlCounter=0};MapUrl.prototype.quad=function(e,t,r){for(var i="",a=e;a>0;a--){var s=0,n=1<<a-1;0!=(t&n)&&(s+=1),0!=(r&n)&&(s+=2),i+=s}return i},MapUrl.prototype.msDigit=function(e,t){return((3&e)<<1)+(1&t)},MapUrl.prototype.hex=function(e){for(var t=e.toString(16);t.length<8;)t="0"+t;return t},MapUrl.prototype.ppx=function(e,t){return this.hex(t<<28-e,7)},MapUrl.prototype.ppy=function(e,t){return this.hex((1<<28)-(t+1<<28-e),7)},MapUrl.prototype.processUrlFunction=function(id,counter,string){var string2,fc;if("string"!=typeof string)return string;if(-1!=string.indexOf("quad")){string2="(function(lod,x,y,loclod,locx,locy){"+string.replace("quad","return this.quad")+"})";try{return(fc=eval(string2).bind(this))(id.lod,id.ix,id.iy,id.loclod,id.locx,id.locy)}catch(e){return string}}else if(-1!=string.indexOf("msdigit")){string2="(function(x,y,loclod,locx,locy){"+string.replace("msdigit","return this.msDigit")+"})";try{return(fc=eval(string2).bind(this))(id.ix,id.iy,id.loclod,id.locx,id.locy)}catch(e){return string}}else{if(-1!=string.indexOf("alt")){var result=/\(([^)]*)\)/.exec(string);if(result&&result[1]){var strings=result[1].match(/([^,]+)/g);if(strings.length>0)return strings[counter%strings.length]}return string}if(-1!=string.indexOf("ppx")){string2="(function(lod,x,loclod,locx){"+string.replace("ppx","return this.ppx")+"})";try{return(fc=eval(string2).bind(this))(id.lod,id.ix,id.loclod,id.locx)}catch(e){return string}}else{if(-1==string.indexOf("ppy"))return string;string2="(function(lod,y,loclod,locy){"+string.replace("ppy","return this.ppy")+"})";try{return(fc=eval(string2).bind(this))(id.lod,id.iy,id.loclod,id.locy)}catch(e){return string}}}},MapUrl.prototype.findLocalRoot=function(e){for(var t=this.map.referenceFrame.getSpatialDivisionNodes(),r=[],i=0,a=t.length;i<a;i++){var s=t[i],n=e[0]-s.id[0],o=e[1]>>n,h=e[2]>>n;o==s.id[1]&&h==s.id[2]&&r.push(s)}var l=null;for(i=0,a=r.length;i<a;i++)r[i].id[0]>-1&&(l=r[i]);return l?l.id.slice():[0,0,0]},MapUrl.prototype.makeUrl=function(e,t,r,i){var a=0,s=0,n=0;if(t.lod){var o=this.findLocalRoot([t.lod,t.ix,t.iy]);n=t.lod-o[0];var h=(1<<n)-1;a=t.ix&h,s=t.iy&h}var l={lod:t.lod,ix:t.ix,iy:t.iy,loclod:n,locx:a,locy:s};e=e.replace(/ /g,"");var u=utils.simpleFmtObjOrCall(e,{lod:t.lod,x:t.ix,y:t.iy,sub:r,locx:a,locy:s,loclod:n,geonavtile:r,hereappid:"abcde",hereappcode:"12345"},this.processUrlFunction.bind(this,l,this.urlCounter));return this.urlCounter++,i=-1!=u.indexOf("//"),i?0==u.indexOf("//")?this.baseUrlSchema+u:u:this.baseUrl+u},MapUrl.prototype.processUrl=function(e,t){return e?(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},__webpack_exports__.a=MapUrl},function(e,t,r){"use strict";var i=r(4),a=r(5),s=a.a,n=i.a,o=function(e,t){this.map=e,this.id=null,this.metaUrl="",this.mappingUrl="",this.baseUrl=this.map.url.baseUrl,this.baseUrlSchema=this.map.url.baseUrlSchema,this.baseUrlOrigin=this.map.url.baseUrlOrigin,this.lodRange=[0,0],this.tileRange=[[0,0],[0,0]],this.surfaces=[],this.parseJson(t),this.virtual=!0,this.ready=!1};o.prototype.parseJson=function(e){if(this.id=e.id||null,this.metaUrl=this.processUrl(e.metaUrl,""),this.mappingUrl=this.processUrl(e.mapping,""),this.lodRange=e.lodRange||[0,0],this.tileRange=e.tileRange||[[0,0],[0,0]],this.strId=this.id?this.id.join(";"):null,this.id){var t=this.id.slice();t.sort(),this.strId=t.join(";")}if(e.extents){var r=e.extents.ll,i=e.extents.ur;this.extents=new s(r[0],r[1],r[2],i[0],i[1],i[2])}else this.extents=new s(0,0,0,1,1,1);this.specificity=Math.pow(2,this.lodRange[0])/((this.tileRange[1][0]-this.tileRange[1][0]+1)*(this.tileRange[1][1]-this.tileRange[1][1]+1)),n.loadBinary(this.mappingUrl,this.onMappingFileLoaded.bind(this),this.onMappingFileLoadError.bind(this),!!n.useCredentials&&-1!=this.jsonUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)},o.prototype.onMappingFileLoaded=function(e){this.parseMappingFile(new DataView(e)),this.ready=!0,this.map.refreshView()},o.prototype.onMappingFileLoadError=function(){},o.prototype.parseMappingFile=function(e){var t=0,r="";if(r+=String.fromCharCode(e.getUint8(t,!0)),t+=1,r+=String.fromCharCode(e.getUint8(t,!0)),t+=1,"TM"!=r)return!1;var i=e.getUint16(t,!0);t+=2;for(var a=0;a<i;a++){var s=e.getUint8(t,!0);t+=1;for(var n=[],o=0;o<s;o++){var h=e.getUint16(t,!0);t+=2,h=this.id[h],h&&n.push(h)}1==n.length?this.surfaces.push(this.map.getSurface(n[0])):this.surfaces.push(this.map.getGlue(n.join(";")))}return!0},o.prototype.getInfo=function(){return{metaUrl:this.metaUrl,mapping:this.mappingUrl,lodRange:this.lodRange,tileRange:this.tileRange}},o.prototype.processUrl=function(e,t){return e?(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},o.prototype.hasTile=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var r=e[1]>>t,i=e[2]>>t;return!(e[0]<this.lodRange[0]||e[0]>this.lodRange[1]||r<this.tileRange[0][0]||r>this.tileRange[1][0]||i<this.tileRange[0][1]||i>this.tileRange[1][1])},o.prototype.hasTile2=function(e){var t=e[0]-this.lodRange[0],r=t<0;if(e[0]<this.lodRange[0]){t=-t;var i=this.tileRange[0][0]>>t,a=this.tileRange[0][1]>>t,s=this.tileRange[1][0]>>t,n=this.tileRange[1][1]>>t;if(e[0]>this.lodRange[1]||e[1]<i||e[1]>s||e[2]<a||e[2]>n)return[!1,!1]}else{var o=e[1]>>t,h=e[2]>>t;if(e[0]>this.lodRange[1]||o<this.tileRange[0][0]||o>this.tileRange[1][0]||h<this.tileRange[0][1]||h>this.tileRange[1][1])return[!1,!1]}return[!0,r]},o.prototype.hasMetatile=function(e){if(e[0]>this.lodRange[1])return!1;var t=e[0]-this.lodRange[0];if(t>=0){var r=e[1]>>t,i=e[2]>>t;if(r<this.tileRange[0][0]||r>this.tileRange[1][0]||i<this.tileRange[0][1]||i>this.tileRange[1][1])return!1}else if(t=-t,e[1]<this.tileRange[0][0]>>t||e[1]>this.tileRange[1][0]>>t||e[2]<this.tileRange[0][1]>>t||e[2]>this.tileRange[1][1]>>t)return!1;return!0},o.prototype.getSurface=function(e){return this.surfaces[e-1]},o.prototype.getMetaUrl=function(e,t){return this.map.url.makeUrl(this.metaUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},t.a=o},function(e,t,r){"use strict";var i=r(2),a=r(3),s=i.b,n=i.c,o=i.e,h=a.a,l=function(e,t,r,i){this.parent=e,this.position=[0,0,0],this.orientation=[0,0,0],this.aspect=1,this.fov=t,this.near=r,this.far=i,this.rotationByMatrix=!1,this.modelview=o.create(),this.rotationview=o.create(),this.projection=o.create(),this.projection2=o.create(),this.mvp=o.create(),this.mvp2=o.create(),this.frustumPlanes=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.bboxPoints=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.scaleFactorVec=[0,0,0,0],this.dirty=!0};l.prototype.setPosition=function(e){this.position=e,this.dirty=!0},l.prototype.setOrientation=function(e){this.rotationByMatrix=!1,this.orientation=e,this.dirty=!0},l.prototype.setRotationMatrix=function(e){this.rotationByMatrix=!0,this.rotationview=e.slice(),this.dirty=!0},l.prototype.setAspect=function(e){this.aspect=e,this.dirty=!0},l.prototype.setViewHeight=function(e){this.viewHeight=e,this.dirty=!0},l.prototype.setOrtho=function(e){this.ortho=e,this.dirty=!0},l.prototype.setParams=function(e,t,r){this.fov=e,this.near=t,this.far=r,this.dirty=!0},l.prototype.clone=function(e){var t=new l(this.parent,null!=e?e:this.getFov(),this.getNear(),this.getFar());return t.setPosition(this.getPosition()),t.setOrientation(this.getOrientation()),t.setAspect(this.getAspect()),t.update(),t},l.prototype.getPosition=function(){return[this.position[0],this.position[1],this.position[2]]},l.prototype.getOrientation=function(){return[this.orientation[0],this.orientation[1],this.orientation[2]]},l.prototype.getAspect=function(){return this.aspect},l.prototype.getFov=function(){return this.fov},l.prototype.getNear=function(){return this.near},l.prototype.getFar=function(){return this.far},l.prototype.getViewHeight=function(){return this.viewHeight},l.prototype.getOrtho=function(){return this.ortho},l.prototype.getRotationviewMatrix=function(){return this.dirty&&this.update(),this.rotationview},l.prototype.getModelviewMatrix=function(){return this.dirty&&this.update(),this.modelview},l.prototype.getProjectionMatrix=function(){return this.dirty&&this.update(),this.projection},l.prototype.getMvpMatrix=function(){return this.dirty&&this.update(),this.mvp},l.prototype.scaleFactor=function(e,t){this.dirty&&this.update(),o.multiplyVec3(this.modelview,e,this.scaleFactorVec);var r=s.length(this.scaleFactorVec);return t?r<this.near?[Number.POSITIVE_INFINITY,r]:[this.projection[0]/r,r]:r<this.near?Number.POSITIVE_INFINITY:this.projection[0]/r},l.prototype.scaleFactor2=function(e){return this.dirty&&this.update(),e<this.near?Number.POSITIVE_INFINITY:this.projection[0]/e},l.prototype.distance=function(e){var t=s.create();return s.subtract(this.position,e,t),s.length(t)},l.prototype.pointVisible=function(e,t){this.dirty&&this.update();var r;r=t?[e[0]-t[0],e[1]-t[1],e[2]-t[2],1]:[e[0],e[1],e[2],1];for(var i=0;i<6;i++)if(n.dot(this.frustumPlanes[i],r)<0)return!1;return!0},l.prototype.pointsVisible=function(e,t){this.dirty&&this.update();var r,i,a,s=this.frustumPlanes,o=e.length;t?(r=t[0],i=t[1],a=t[2]):(r=0,i=0,a=0);for(var h=n.dot3,l=0;l<6;l++){for(var u=!0,c=s[l],d=0;d<o;d+=3)if(h(c,e,d,r,i,a)>=0){u=!1;break}if(u)return!1}return!0},l.prototype.bboxVisible=function(e,t){this.dirty&&this.update();var r,i,a,s,o,h,l,u=e.min,c=e.max,d=this.bboxPoints;t?(i=u[0]-t[0],a=u[1]-t[1],s=u[2]-t[2],o=c[0]-t[0],h=c[1]-t[1],l=c[2]-t[2]):(i=u[0],a=u[1],s=u[2],o=c[0],h=c[1],l=c[2]),r=d[0],r[0]=i,r[1]=a,r[2]=s,r=d[1],r[0]=i,r[1]=a,r[2]=l,r=d[2],r[0]=i,r[1]=h,r[2]=s,r=d[3],r[0]=i,r[1]=h,r[2]=l,r=d[4],r[0]=o,r[1]=a,r[2]=s,r=d[5],r[0]=o,r[1]=a,r[2]=l,r=d[6],r[0]=o,r[1]=h,r[2]=s,r=d[7],r[0]=o,r[1]=h,r[2]=l;for(var p=n.dot2,f=this.frustumPlanes,m=0;m<6;m++){for(var g=!0,v=f[m],y=0;y<8;y++)if(p(v,d[y])>=0){g=!1;break}if(g)return!1}return!0},l.prototype.update=function(e){this.rotationByMatrix||(o.multiply(h.rotationMatrix(2,h.radians(-this.orientation[2])),h.rotationMatrix(0,h.radians(-this.orientation[1]-90)),this.rotationview),o.multiply(this.rotationview,h.rotationMatrix(2,h.radians(-this.orientation[0])),this.rotationview)),o.multiply(this.rotationview,h.translationMatrix(-this.position[0],-this.position[1],-this.position[2]),this.modelview),this.ortho?this.projection=h.orthographicMatrix(this.viewHeight,this.aspect,this.near,this.far):this.projection=h.perspectiveMatrix(this.fov,this.aspect,this.near,this.far),o.multiply(this.projection,this.modelview,this.mvp),this.frustumPlanes[0]=[0,0,1,1],this.frustumPlanes[1]=[0,0,-1,1],this.frustumPlanes[2]=[1,0,0,1],this.frustumPlanes[3]=[-1,0,0,1],this.frustumPlanes[4]=[0,1,0,1],this.frustumPlanes[5]=[0,-1,0,1];var t=o.create();o.transpose(this.mvp,t);for(var r=0;r<6;r++)this.frustumPlanes[r]=o.multiplyVec4(t,this.frustumPlanes[r]);this.dirty=!1},t.a=l},function(e,t,r){"use strict";var i=r(2),a=r(3),s=r(159),n=i.b,o=i.d,h=i.e,l=a.a,u=s.a,c=(s.b,s.c,s.d),d=function(e){this.renderer=e,this.core=e.core,this.gpu=e.gpu,this.gl=e.gpu.gl,this.rmap=e.rmap};d.prototype.drawSkydome=function(e,t){if(e){var r=this.gpu,i=this.gl,a=this.renderer,s=h.create();h.multiply(l.scaleMatrix(2,2,2),l.translationMatrix(-.5,-.5,-.5),s);var n=h.create(),o=a.camera.getPosition();h.multiply(l.translationMatrix(o[0],o[1],o[2]-400),l.scaleMatrixf(Math.min(.9*a.camera.getFar(),6e5)),n);var u=h.create();h.multiply(a.camera.getMvpMatrix(),n,u),h.multiply(u,s,u),r.useProgram(t,["aPosition","aTexCoord"]),r.bindTexture(e),t.setSampler("uSampler",0),t.setMat4("uMVP",u),i.depthMask(!1),a.skydomeMesh.draw(t,"aPosition","aTexCoord"),i.depthMask(!0),i.enable(i.CULL_FACE),a.renderedPolygons+=a.skydomeMesh.getPolygons()}},d.prototype.drawTBall=function(e,t,r,i,a,s){var n=this.gpu,o=this.gl,u=this.renderer;s&&o.disable(o.CULL_FACE);var c=h.create();h.multiply(l.scaleMatrix(2,2,2),l.translationMatrix(-.5,-.5,-.5),c);var d=[e[0],e[1],e[2]];t=null!=t?t:1.5;var p=h.create();h.multiply(l.translationMatrix(d[0],d[1],d[2]),l.scaleMatrix(t,t,a||t),p);var f=h.create();h.multiply(u.camera.getMvpMatrix(),p,f),h.multiply(f,c,f),n.useProgram(r,["aPosition","aTexCoord"]),n.bindTexture(i||u.redTexture),r.setSampler("uSampler",0),r.setMat4("uMVP",f),u.skydomeMesh.draw(r,"aPosition","aTexCoord"),u.renderedPolygons+=u.skydomeMesh.getPolygons(),s&&o.enable(o.CULL_FACE)},d.prototype.drawBall=function(e,t,r,i,a,s,n,u,c,d){var p=this.gpu,f=this.gl,m=this.renderer,g=h.create();h.multiply(l.scaleMatrix(2,2,2),l.translationMatrix(-.5,-.5,-.5),g);var v=[e[0],e[1],e[2]],y=h.create();t=t||1.5,r=r||1.5,h.multiply(l.translationMatrix(v[0],v[1],v[2]),l.scaleMatrix(t,t,r),y);var b=h.create();h.multiply(m.camera.getModelviewMatrix(),y,b),h.multiply(b,g,b);var x=m.camera.getProjectionMatrix(),M=[0,0,0,0,0,0,0,0,0];h.toInverseMat3(b,M),o.transpose(M),p.useProgram(i,["aPosition"]),p.bindTexture(m.redTexture),i.setSampler("uSampler",0),i.setMat4("uProj",x),i.setMat4("uMV",b),d&&(i.setMat3("uNorm",M),f.cullFace(f.FRONT)),a&&i.setVec4("uParams",a),s&&i.setVec4("uParams2",s),s&&i.setVec4("uParams3",n),u&&i.setVec4("uFogColor",u),c&&i.setVec4("uFogColor2",c),m.atmoMesh.draw(i,"aPosition",null),m.renderedPolygons+=m.skydomeMesh.getPolygons(),d&&f.cullFace(f.BACK)},d.prototype.drawBall2=function(e,t,r,i,a,s){var n=this.gpu,u=this.renderer,c=h.create();h.multiply(l.scaleMatrix(2,2,2),l.translationMatrix(-.5,-.5,-.5),c);var d=[e[0],e[1],e[2]],p=h.create();h.multiply(l.translationMatrix(d[0],d[1],d[2]),l.scaleMatrixf(null!=t?t:1.5),p);var f=h.create();h.multiply(u.camera.getModelviewMatrix(),p,f),h.multiply(f,c,f);var m=u.camera.getProjectionMatrix(),g=[0,0,0,0,0,0,0,0,0];h.toInverseMat3(f,g),o.transpose(g),n.useProgram(r,["aPosition"]),n.bindTexture(u.redTexture),r.setSampler("uSampler",0),r.setMat4("uProj",m),r.setMat4("uMV",f),r.setMat3("uNorm",g),r.setFloat("uNFactor",i),r.setVec3("uCenter",e),r.setVec2("uRadius",[t,s]),u.atmoMesh.draw(r,"aPosition",null),u.renderedPolygons+=u.skydomeMesh.getPolygons()},d.prototype.drawLineString=function(e,t,r,i,a,s,n,o,l){var u,c,d=this.gpu,p=this.gl,f=this.renderer,m=0,g=e.length;if(g>32)for(c=0;c<g;c+=31)u=e.slice(c,c+32),this.drawLineString(u,t,r,i,a,s,n,o,l);else{var v=f.plineBuffer;if(t)for(c=0;c<g;c++)u=e[c],v[m]=u[0],v[m+1]=u[1],v[m+2]=u[2]||0,m+=3;else{var y=f.camera.getMvpMatrix(),b=f.curSize,x=f.cameraPosition;for(c=0;c<g;c++)u=e[c],u=h.multiplyVec4(y,[u[0]-x[0],u[1]-x[1],u[2]-x[2],1]),0!=u[3]?(v[m]=.5*(u[0]/u[3]+1)*b[0],v[m+1]=.5*(-u[1]/u[3]+1)*b[1],v[m+2]=u[2]/u[3]):(v[m]=0,v[m+1]=0,v[m+2]=0),m+=3}!0!==l&&(!0!==s&&p.disable(p.DEPTH_TEST),n&&(p.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),p.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA),p.enable(p.BLEND)),!1===o&&p.depthMask(!1),p.disable(p.STENCIL_TEST),p.disable(p.CULL_FACE));var M=f.progLine4;d.useProgram(M,["aPosition"]),M.setMat4("uMVP",f.imageProjectionMatrix,a?f.getZoffsetFactor(a):null),M.setVec3("uScale",[2/f.curSize[0],2/f.curSize[1],.5*r]),M.setVec4("uColor",null!=i?i:[255,255,255,255]),M.setVec3("uPoints",v),f.plines.draw(M,"aPosition",g),!0!==l&&(!0!==s&&p.enable(p.DEPTH_TEST),n&&p.disable(p.BLEND),!1===o&&p.depthMask(!0),p.enable(p.CULL_FACE))}},d.prototype.drawImage=function(e,t,r,i,a,s,n,o,h,l,u,c){var d=this.gpu,p=this.gl,f=this.renderer;if(null!=a&&null!=f.imageProjectionMatrix){!0!==c&&(!0!==h&&p.disable(p.DEPTH_TEST),l&&(p.blendEquationSeparate(p.FUNC_ADD,p.FUNC_ADD),p.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA),p.enable(p.BLEND)),!1===u&&p.depthMask(!1),p.disable(p.CULL_FACE));var m=f.progImage;d.useProgram(m,["aPosition"]),d.bindTexture(a);var g=f.rectVerticesBuffer;p.bindBuffer(p.ARRAY_BUFFER,g),p.vertexAttribPointer(m.getAttribute("aPosition"),g.itemSize,p.FLOAT,!1,0,0);var v=f.rectIndicesBuffer;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,v),m.setMat4("uProjectionMatrix",f.imageProjectionMatrix),m.setMat4("uData",[e,t,0,0,e+r,t,1,0,e+r,t+i,1,1,e,t+i,0,1]),o&&(n*=1+2*f.getZoffsetFactor(o)),m.setVec4("uColor",null!=s?s:[1,1,1,1]),m.setFloat("uDepth",n),p.drawElements(p.TRIANGLES,v.numItems,p.UNSIGNED_SHORT,0),!0!==c&&(!1===u&&p.depthMask(!0),!0!==h&&p.enable(p.DEPTH_TEST),l&&p.disable(p.BLEND),p.enable(p.CULL_FACE))}},d.prototype.drawBillboard=function(e,t,r,i,a,s,n,o){var h=this.gpu,l=this.gl,u=this.renderer;!0!==o&&(!0!==a&&l.disable(l.DEPTH_TEST),s&&(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA),l.enable(l.BLEND)),!1===n&&l.depthMask(!1),l.disable(l.CULL_FACE));var c=u.progImage;h.useProgram(c,["aPosition","aTexCoord"]),h.bindTexture(t),c.setSampler("uSampler",0);var d=u.rectVerticesBuffer;l.bindBuffer(l.ARRAY_BUFFER,d),l.vertexAttribPointer(c.getAttribute("aPosition"),d.itemSize,l.FLOAT,!1,0,0);var p=u.rectIndicesBuffer;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,p),c.setMat4("uProjectionMatrix",e,i?u.getZoffsetFactor(i):null);c.setMat4("uData",[0,0,0,0,1,0,1,0,1,1,1,1,0,1,0,1]),c.setVec4("uColor",null!=r?r:[1,1,1,1]),c.setFloat("uDepth",0),l.drawElements(l.TRIANGLES,p.numItems,l.UNSIGNED_SHORT,0),!0!==o&&(!1===n&&l.depthMask(!0),!0!==a&&l.enable(l.DEPTH_TEST),s&&l.disable(l.BLEND),l.enable(l.CULL_FACE))},d.prototype.drawFlatImage=function(e,t,r,i,a,s,n,o){var h=this.gpu,l=this.gl,u=this.renderer;if(null!=a&&null!=u.imageProjectionMatrix){var c=u.progImage;h.useProgram(c,["aPosition"]),h.bindTexture(a);var d=u.rectVerticesBuffer;l.bindBuffer(l.ARRAY_BUFFER,d),l.vertexAttribPointer(c.getAttribute("aPosition"),d.itemSize,l.FLOAT,!1,0,0);var p=u.rectIndicesBuffer;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,p),c.setMat4("uProjectionMatrix",u.imageProjectionMatrix),c.setMat4("uData",[e,t,0,0,e+r,t,1,0,e+r,t+i,1,1,e,t+i,0,1]),c.setVec4("uColor",null!=s?s:[1,1,1,1]),c.setFloat("uDepth",null!=n?n:0),l.drawElements(l.TRIANGLES,p.numItems,l.UNSIGNED_SHORT,0)}},d.prototype.drawText=function(e,t,r,i,a,s,n){var o=this.gpu,h=this.gl,l=this.renderer;if(null!=l.imageProjectionMatrix){!0!==n&&(h.disable(h.CULL_FACE),null==s?h.disable(h.DEPTH_TEST):(h.depthFunc(h.LEQUAL),h.enable(h.DEPTH_TEST)));var u=l.progImage;o.useProgram(u,["aPosition"]),o.bindTexture(l.textTexture2);var c=l.rectVerticesBuffer;h.bindBuffer(h.ARRAY_BUFFER,c),h.vertexAttribPointer(u.getAttribute("aPosition"),c.itemSize,h.FLOAT,!1,0,0);var d=l.rectIndicesBuffer;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,d),u.setMat4("uProjectionMatrix",l.imageProjectionMatrix),u.setVec4("uColor",a),u.setFloat("uDepth",null!=s?s:0);var p=r-1,f=r,m=Math.round(.5*r),g=this.getTextSize(r,i)+2,v=0,y=(15&v)<<4,b=v>>4<<4;u.setMat4("uData",[e-2,t-2,y*(1/256),b*(1/128),e-2+g,t-2,(y+15)*(1/256),b*(1/128),e-2+g,t+f+1,(y+15)*(1/256),(b+15)*(1/128),e-2,t+f+1,y*(1/256),(b+15)*(1/128)]),h.drawElements(h.TRIANGLES,d.numItems,h.UNSIGNED_SHORT,0);for(var x=0,M=i.length;x<M;x++){switch(v=i.charCodeAt(x)-32,y=(15&v)<<4,b=v>>4<<4,v){case 12:case 14:case 27:case 28:case 64:case 73:case 76:case 84:u.setMat4("uData",[e,t,y*(1/256),b*(1/128),e+m,t,(y+8)*(1/256),b*(1/128),e+m,t+f,(y+8)*(1/256),(b+16)*(1/128),e,t+f,y*(1/256),(b+16)*(1/128)]),e+=m;break;default:u.setMat4("uData",[e,t,y*(1/256),b*(1/128),e+p,t,(y+15)*(1/256),b*(1/128),e+p,t+f,(y+15)*(1/256),(b+16)*(1/128),e,t+f,y*(1/256),(b+16)*(1/128)]),e+=p}h.drawElements(h.TRIANGLES,d.numItems,h.UNSIGNED_SHORT,0)}!0!==n&&(h.enable(h.CULL_FACE),null==s&&h.enable(h.DEPTH_TEST))}},d.prototype.getTextSize=function(e,t){for(var r=e-1,i=Math.round(.5*e),a=0,s=0,n=t.length;s<n;s++){switch(t.charCodeAt(s)-32){case 12:case 14:case 27:case 28:case 64:case 73:case 76:case 84:a+=i;break;default:a+=r}}return a},d.prototype.drawGpuJobs=function(){var e=this.gpu,t=this.gl,r=this.renderer;r.geoRenderCounter++,r.totalJobs=0,r.drawnJobs=0,r.jobsTimer4=0,r.jobsTimer3=0,r.jobsTimer2=0,r.jobsTimer1=performance.now(),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT),t.stencilFunc(t.EQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.INCR);var i,a,s=[1/r.curSize[0],1/r.curSize[1]],n=this.rmap,o=513,d=0,p=r.clearStencilPasses,f=r.jobZBuffer,m=r.jobZBufferSize,g=r.jobZBuffer2,v=r.jobZBuffer2Size,y=r.onlyHitLayers,b=r.onlyAdvancedHitLayers,x=r.geoRenderCounter,M=r.onlyHitLayers;p.length>0&&(o=p[0],d++),this.rmap.counter!=this.renderer.geoRenderCounter&&this.rmap.clear(),r.gmapIndex=0,r.gmapUseVersion=1;var S=!1;r.jobHBuffer={};for(var w=r.frameTime,A=0,T=f.length;A<T;A++){var C,P=m[A],F=(v[A],f[A]),L=g[A];if(r.totalJobs+=P,P>0&&A>=o&&(t.clear(t.STENCIL_BUFFER_BIT),p.length>d?(o=p[d],d++):o=513),y)if(b)for(C=0;C<P;C++)F[C].advancedHit&&this.drawGpuJob(e,t,r,F[C],s,!0);else for(C=0;C<P;C++){var i=F[C];i.hitable&&(this.drawGpuJob(e,t,r,i,s),i.advancedHit&&(r.advancedPassNeeded=!0))}else for(C=0;C<P;C++)if(i=F[C],this.drawGpuJob(e,t,r,i,s),!M&&i.hysteresis&&i.id){var E=L[i.id];E||(i.timerShow=0,i.timerHide=0,i.draw=!1,L[i.id]=i,v[A]++,S=!0),!0}if(r.jobsTimer3=performance.now(),r.gmapIndex>0&&(2==r.gmapUseVersion?c(e,t,r,s,this):u(e,t,r,s,this),r.gmapIndex=0),n.rectanglesCount>0&&n.processRectangles(e,t,r,s),r.jobsTimer4+=performance.now()-r.jobsTimer3,v[A]){var I=r.jobHBuffer;for(a in L){i=L[a],E=I[a],r.drawnJobs++,M||(E?(isNaN(i.timerShow)&&(i.timerShow=0,i.timerHide=0,i.draw=!1),i.draw?i.timerHide&&(i.draw=!1,i.timerShow=i.hysteresis[0]*(1-i.timerHide/i.hysteresis[1])):(i.timerShow+=w,i.timerShow>i.hysteresis[0]?(i.draw=!0,i.timerShow=0):S=!0),i.timerHide=0):(i.draw?(i.timerHide+=w,i.timerHide>i.hysteresis[1]?(delete L[a],v[A]--,i.draw=!1,i.timerHide=0):S=!0):i.timerShow&&(i.draw=!0,i.timerHide=i.hysteresis[1]*(1-i.timerShow/i.hysteresis[0])),i.timerShow=0));var N=i.draw,B=null;if(M||!0!==i.hysteresis[3]||(N?0!=i.timerHide&&(B=i.timerHide/(i.hysteresis[1]+1),B=1-Math.min(1,B)):0!=i.timerShow&&(B=i.timerShow/(i.hysteresis[0]+1),B=Math.min(1,B),N=!0)),N){if(i.renderCounter[0][0]!==x&&null!==i.renderCounter[0][0]){i.updatePos=!0;var _=i.renderCounter[0],R=h.create(),k=h.create(),z=_[3],U=z.bbox,D=r.cameraPosition,G=l.translationMatrix(U.min[0]-D[0],U.min[1]-D[1],U.min[2]-D[2]);h.multiply(r.camera.getModelviewMatrix(),G,k);var V=r.camera.getProjectionMatrix();h.multiply(V,k,R),i.mv=k,i.mvp=R}this.drawGpuSubJob(e,t,r,s,i.lastSubJob,B),i.updatePos=!1}}}}S&&this.core.markDirty(),r.jobsTimer2=performance.now()},d.prototype.clearJobBuffer=function(){for(var e=this.renderer,t=e.jobZBuffer,r=e.jobZBufferSize,i=0,a=t.length;i<a;i++){for(var s=r[i],n=t[i],o=0;o<s;o++)n[o]=null;r[i]=0}},d.prototype.clearJobHBuffer=function(){for(var e=this.renderer,t=e.jobZBuffer2,r=e.jobZBuffer2Size,i=0,a=t.length;i<a;i++)t[i]={},r[i]=0},d.prototype.paintGL=function(){var e=this.renderer;this.gpu.clear(!0,!1),e.onlyLayers||e.onlyDepth||e.onlyHitLayers||this.drawSkydome()},d.prototype.drawGpuJob=function(e,t,r,i,a,s,o){if(i.ready&&i.eventInfo){var h=255&i.state,u=i.eventInfo["#id"];if(null!=u){if(512&i.state){if(-1!=r.geodataSelection.indexOf(u)){if(768&i.state)if(r.hoverFeature&&r.hoverFeature[0]["#id"]==u){if(3!=h)return}else if(2!=h)return}else if(256&i.state){if(r.hoverFeature&&r.hoverFeature[0]["#id"]==u){if(1!=h)return}else if(0!=h)return}else if(0!=h)return}else if(256&i.state){if(r.hoverFeature&&r.hoverFeature[0]["#id"]==u){if(1!=h)return}else if(0!=h)return}else if(0!=h)return}else if(0!=h)return;var c,d,p,f,m,g,v,y,b=i.mvp,x=i.hitable&&r.onlyHitLayers,M=i.color;if(x){var S=r.hoverFeatureCounter;M=[(255&S)/255,(S>>8&255)/255,0,0],r.hoverFeatureList[S]=[i.eventInfo,i.center,i.clickEvent,i.hoverEvent,i.enterEvent,i.leaveEvent,s],r.hoverFeatureCounter++}switch(i.type){case 1:e.setState(x?r.stencilLineHitState:r.stencilLineState);var w=0===e;if(c=s?i.program2:w?r.progLineWireframe:i.program,e.useProgram(c,s?["aPosition","aElement"]:w?["aPosition","aBarycentric"]:["aPosition"]),c.setVec4("uColor",M),c.setMat4("uMVP",b,r.getZoffsetFactor(i.zbufferOffset)),p=c.getAttribute("aPosition"),t.bindBuffer(t.ARRAY_BUFFER,i.vertexPositionBuffer),t.vertexAttribPointer(p,i.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),s&&(v=c.getAttribute("aElement"),t.bindBuffer(t.ARRAY_BUFFER,i.vertexElementBuffer),t.vertexAttribPointer(v,i.vertexElementBuffer.itemSize,t.FLOAT,!1,0,0)),w){var A=c.getAttribute("aBarycentric");t.bindBuffer(t.ARRAY_BUFFER,e.barycentricBuffer),t.vertexAttribPointer(A,e.barycentricBuffer.itemSize,t.FLOAT,!1,0,0)}t.drawArrays(t.TRIANGLES,0,i.vertexPositionBuffer.numItems);break;case 2:case 3:case 4:case 5:e.setState(x?r.stencilLineHitState:r.stencilLineState),c=s?i.program2:i.program,d=null;var T=[0,0,0,0];if(y=a,x&&5==i.type&&(i.widthByRatio&&(y=[a[0]*r.curSize[1],a[1]*r.curSize[1]]),c=s?this.renderer.progELine3:this.renderer.progLine3,!c.isReady()))return;if(4!=i.type)if(2==i.type)T=[0,0,0,i.widthByRatio?r.cameraViewExtent:1];else{if(x)d=r.whiteTexture,3!=i.type&&2!=i.type||(T=[0,0,0,i.widthByRatio?r.cameraViewExtent:1]);else{var C=i.texture;if(null==C||null==C[0])return;d=C[0],T=[0,C[1]/C[0].height,(C[1]+C[2])/C[0].height,i.widthByRatio?r.cameraViewExtent:1],3==i.type||2==i.type?i.widthByRatio?T[0]=1/(r.cameraViewExtent2*i.lineWidth)/(d.width/C[2]):T[0]=1/i.lineWidth/(d.width/C[2]):i.widthByRatio?(T[0]=1/(r.cameraViewExtent2/r.curSize[1])/(d.width/C[2]),T[0]/=r.curSize[1]*i.lineWidth*.5,T[3]=r.curSize[1]):(T[0]=1/(r.cameraViewExtent2/r.curSize[1])/(d.width/C[2]),T[0]/=.5*i.lineWidth,T[3]=1)}if(!d.loaded)return;e.bindTexture(d)}else i.widthByRatio&&(y=[a[0]*r.curSize[1],a[1]*r.curSize[1]]);e.useProgram(c,s?["aPosition","aNormal","aElement"]:["aPosition","aNormal"]),c.setVec4("uColor",M),c.setVec2("uScale",y),c.setMat4("uMVP",b,r.getZoffsetFactor(i.zbufferOffset)),4!=i.type&&(null!=i.background&&c.setVec4("uColor2",x?[0,0,0,0]:i.background),c.setVec4("uParams",T),c.setSampler("uSampler",0)),p=c.getAttribute("aPosition"),m=c.getAttribute("aNormal"),t.bindBuffer(t.ARRAY_BUFFER,i.vertexPositionBuffer),t.vertexAttribPointer(p,i.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i.vertexNormalBuffer),t.vertexAttribPointer(m,i.vertexNormalBuffer.itemSize,t.FLOAT,!1,0,0),s&&(v=c.getAttribute("aElement"),t.bindBuffer(t.ARRAY_BUFFER,i.vertexElementBuffer),t.vertexAttribPointer(v,i.vertexElementBuffer.itemSize,t.FLOAT,!1,0,0)),t.drawArrays(t.TRIANGLES,0,i.vertexPositionBuffer.numItems);break;case 6:e.setState(x?r.lineLabelHitState:r.lineLabelState);var P=i.files;if(P.length>0){for(var F=0,L=P.length;F<L;F++)if(P[F].length>0){var E=i.fonts[F];if(E&&!E.areTexturesReady(P[F]))return}}else{if(!x)return;d=r.whiteTexture}c=i.program,e.useProgram(c,["aPosition","aTexCoord"]),c.setSampler("uSampler",0),c.setMat4("uMVP",b,r.getZoffsetFactor(i.zbufferOffset)),c.setVec4("uVec",r.labelVector);var I=1.4142*i.outline[2]/20,N=1.4142*i.outline[3]/20;c.setVec4("uColor",x?M:i.color2),c.setVec2("uParams",[i.outline[0],N]),p=c.getAttribute("aPosition"),f=c.getAttribute("aTexCoord"),t.bindBuffer(t.ARRAY_BUFFER,i.vertexPositionBuffer),t.vertexAttribPointer(p,i.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i.vertexTexcoordBuffer),t.vertexAttribPointer(f,i.vertexTexcoordBuffer.itemSize,t.FLOAT,!1,0,0);for(var B=0;B<(x?1:2);B++)if(1==B&&(c.setVec4("uColor",M),c.setVec2("uParams",[i.outline[1],I])),P.length>0)for(var F=0,L=P.length;F<L;F++)for(var _=P[F],R=0,k=_.length;R<k;R++){var z=_[R];c.setFloat("uFile",Math.round(z+1e3*F)),e.bindTexture(i.fonts[F].getTexture(z)),t.drawArrays(t.TRIANGLES,0,i.vertexPositionBuffer.numItems)}else e.bindTexture(d),t.drawArrays(t.TRIANGLES,0,i.vertexPositionBuffer.numItems);break;case 7:case 8:case 9:if(i.reduce&&7!=i.reduce[0]&&8!=i.reduce[0]){var U;if(i.reduce[0]>4){if(4==i.reduce[0]){if(U=Math.max(i.reduce[1],Math.floor(i.reduce[2]/Math.max(1,r.drawnGeodataTiles))),i.index>=U)return}else if(U=Math.pow(i.texelSize*i.tiltAngle,.5),U=Math.max(i.reduce[1],Math.round(i.reduce[2]*(U/Math.max(1e-5,this.renderer.drawnGeodataTilesFactor)))),i.index>=U)return}else{U=i.tiltAngle,1==i.reduce[0]?U=1-Math.acos(U)*(1/(.5*Math.PI)):3==i.reduce[0]&&(U=.5*(Math.cos(2*Math.acos(U))+1));var D=Math.round(i.reduce[1]+U*i.reduce[2])-1;if(i.index>D)return}}var P=i.files;if(9==i.type){for(var G=!1,B=0,V=i.subjobs.length;B<V;B++){var O=i.subjobs[B];if(P=O.files,P.length>0){for(var F=0,L=P.length;F<L;F++)if(P[F].length>0){var E=O.fonts[F];E&&!E.areTexturesReady(P[F])&&(G=!0)}}else d=x?r.whiteTexture:O.texture,d.loaded||(G=!0)}if(G)return}else if(P=i.files,P.length>0){for(var F=0,L=P.length;F<L;F++)if(P[F].length>0){var E=i.fonts[F];if(E&&!E.areTexturesReady(P[F]))return}}else if(d=x?r.whiteTexture:i.texture,!d.loaded)return;var j,H,q,J,X=null;if(180!=i.culling){if(H=i.center,j=r.cameraPosition,q=[H[0]-j[0],H[1]-j[1],H[2]-j[2]],i.visibility){switch(X=n.length(q),i.visibility.length){case 1:if(X>i.visibility[0])return;break;case 2:if((J=X*r.localViewExtentFactor)<i.visibility[0]||J>i.visibility[1])return;break;case 4:J=X*r.localViewExtentFactor;var W=i.visibility[0]*i.visibility[1];if(W<i.visibility[2]*J||W>i.visibility[3]*J)return}X=1/X,q[0]*=X,q[1]*=X,q[2]*=X}else n.normalize(q);i.normal=[0,0,0],n.normalize(i.center,i.normal);var U=-n.dot(q,i.normal);if(U<Math.cos(l.radians(i.culling)))return}else if(i.visibility)switch(H=i.center,j=r.cameraPosition,q=[H[0]-j[0],H[1]-j[1],H[2]-j[2]],X=n.length(q),i.visibility.length){case 1:if(X>i.visibility[0])return;break;case 2:if((X*=r.localViewExtentFactor)<i.visibility[0]||X>i.visibility[1])return;break;case 4:X*=r.localViewExtentFactor;var W=i.visibility[0]*i.visibility[1];if(W<i.visibility[2]*X||W>i.visibility[3]*X)return}var Y,Z,Q,K=i.stick,$=0;0!=K[0]&&($=r.cameraTiltFator*K[0],$<K[1]?$=0:0!=K[2]&&(Y=r.project2(i.center,r.camera.mvp,r.cameraPosition),Y[0]=Math.round(Y[0]),Y[1]-=$));var ee=i.reduce&&(7==i.reduce[0]||8==i.reduce[0]);if(i.noOverlap){if(Y||(Y=r.project2(i.center,r.camera.mvp,r.cameraPosition)),Z=i.noOverlap,Q=Y[2],Q<0||Q>1)return;if(!r.rmap.checkRectangle(Y[0]+Z[0],Y[1]+Z[1],Y[0]+Z[2],Y[1]+Z[3],$))return;if(null!==Z[4]&&(0===Z[4]?Q=Z[5]:(null===X&&(H=i.center,j=r.cameraPosition,q=[H[0]-j[0],H[1]-j[1],H[2]-j[2]],X=n.length(q)+1e-4),i.reduce&&8!=i.reduce[0]&&(Q=Z[5]/X))),i.lastSubJob=[i,$,d,P,M,Y,!0,Q,Z],ee)return r.gmapUseVersion=8==i.reduce[0]?2:1,r.gmap[r.gmapIndex]=i.lastSubJob,r.gmapIndex++,void(1==r.config.mapFeaturesReduceFactor&&(null===X&&(H=i.center,j=r.cameraPosition,q=[H[0]-j[0],H[1]-j[1],H[2]-j[2]],X=n.length(q)+1e-4),X>r.fmaxDist&&(r.fmaxDist=X),X<r.fminDist&&(r.fminDist=X),i.reduce[1]=i.reduce[2],i.reduce[4]=X));if(!r.rmap.addRectangle(Y[0]+Z[0],Y[1]+Z[1],Y[0]+Z[2],Y[1]+Z[3],Q,i.lastSubJob))return void r.rmap.storeRemovedRectangle(Y[0]+Z[0],Y[1]+Z[1],Y[0]+Z[2],Y[1]+Z[3],Q,i.lastSubJob);return}if(ee)return Y||(Y=r.project2(i.center,r.camera.mvp,r.cameraPosition)),i.lastSubJob=[i,$,d,P,M,Y,!1],r.gmapUseVersion=8==i.reduce[0]?2:1,r.gmap[r.gmapIndex]=i.lastSubJob,r.gmapIndex++,void(1==r.config.mapFeaturesReduceFactor&&(null===X&&(H=i.center,j=r.cameraPosition,q=[H[0]-j[0],H[1]-j[1],H[2]-j[2]],X=n.length(q)+1e-4),X>r.fmaxDist&&(r.fmaxDist=X),X<r.fminDist&&(r.fminDist=X),i.reduce[1]=i.reduce[2],i.reduce[4]=X));if(i.hysteresis&&i.id)return Y||(Y=r.project2(i.center,r.camera.mvp,r.cameraPosition)),i.lastSubJob=[i,$,d,P,M,Y],void(r.jobHBuffer[i.id]=i);if(9==i.type)return;if(r.drawLabelBoxes&&(Z=i.noOverlap)&&(Y||(Y=r.project2(i.center,r.camera.mvp,r.cameraPosition)),e.setState(x?r.lineLabelHitState:r.lineLabelState),this.drawLineString([[Y[0]+Z[0],Y[1]+Z[1],.5],[Y[0]+Z[2],Y[1]+Z[1],.5],[Y[0]+Z[2],Y[1]+Z[3],.5],[Y[0]+Z[0],Y[1]+Z[3],.5],[Y[0]+Z[0],Y[1]+Z[1],.5]],!0,1,[255,0,0,255],null,!0,null,null,null)),e.setState(x?r.lineLabelHitState:r.labelState),0!=K[0]&&0!=K[2]&&(Y||(Y=r.project2(i.center,r.camera.mvp,r.cameraPosition)),this.drawLineString([[Y[0],Y[1]+$,Y[2]],[Y[0],Y[1],Y[2]]],!0,K[2],[K[3],K[4],K[5],K[6]],null,null,null,null,!0)),i.singleBuffer){Y||(Y=r.project2(i.center,r.camera.mvp,r.cameraPosition));var te=i.singleBuffer;if(!i.singleBuffer2){i.singleBuffer2=new Float32Array(te);var re=1/d.width,ie=1/d.height;te[2]*=re,te[3]*=ie,te[6]*=re,te[7]*=ie,te[10]*=re,te[11]*=ie,te[14]*=re,te[15]*=ie}c=r.progImage;var ae=i.singleBuffer2;te[0]=Y[0]+ae[0],te[1]=Y[1]+ae[1],te[4]=Y[0]+ae[4],te[5]=Y[1]+ae[5],te[8]=Y[0]+ae[8],te[9]=Y[1]+ae[9],te[12]=Y[0]+ae[12],te[13]=Y[1]+ae[13],e.useProgram(c,["aPosition"]),e.bindTexture(d);var se=r.rectVerticesBuffer;t.bindBuffer(t.ARRAY_BUFFER,se),t.vertexAttribPointer(c.getAttribute("aPosition"),se.itemSize,t.FLOAT,!1,0,0);var ne=r.rectIndicesBuffer;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,ne),c.setMat4("uProjectionMatrix",r.imageProjectionMatrix),c.setMat4("uData",te),c.setVec4("uColor",null!=M?M:[1,1,1,1]),c.setFloat("uDepth",null!=Q?Q:0),void t.drawElements(t.TRIANGLES,ne.numItems,t.UNSIGNED_SHORT,0)}c=i.program,e.useProgram(c,["aPosition","aTexCoord","aOrigin"]),c.setSampler("uSampler",0),c.setMat4("uMVP",b,r.getZoffsetFactor(i.zbufferOffset)),c.setVec4("uScale",[a[0],a[1],8==i.type?1:1/d.width,2*$]);var B=0,V=1,I=0,N=0;for(c!=r.progIcon?(I=1.4142*i.outline[2]/i.size,N=1.4142*i.outline[3]/i.size,c.setVec4("uColor",x?M:i.color2),c.setVec2("uParams",[i.outline[0],N]),V=x?1:2):c.setVec4("uColor",M),p=c.getAttribute("aPosition"),f=c.getAttribute("aTexCoord"),g=c.getAttribute("aOrigin"),t.bindBuffer(t.ARRAY_BUFFER,i.vertexPositionBuffer),t.vertexAttribPointer(p,i.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i.vertexTexcoordBuffer),t.vertexAttribPointer(f,i.vertexTexcoordBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i.vertexOriginBuffer),t.vertexAttribPointer(g,i.vertexOriginBuffer.itemSize,t.FLOAT,!1,0,0);B<V;B++)if(1==B&&(c.setVec4("uColor",M),c.setVec2("uParams",[i.outline[1],I])),P.length>0)for(var F=0,L=P.length;F<L;F++)for(var _=P[F],R=0,k=_.length;R<k;R++){var z=_[R];c.setFloat("uFile",Math.round(z+1e3*F)),e.bindTexture(i.fonts[F].getTexture(z)),t.drawArrays(t.TRIANGLES,0,i.vertexPositionBuffer.numItems)}else e.bindTexture(d),t.drawArrays(t.TRIANGLES,0,i.vertexPositionBuffer.numItems)}}},d.prototype.drawGpuSubJob=function(e,t,r,i,a,s){if(a){var o=a[0],h=a[1],u=a[2],c=a[3],d=a[4],p=a[5],f=o.stick,m=o.noOverlap;if(o.hysteresis&&o.id){if(180!=o.culling){var g=o.center,v=r.cameraPosition,y=[g[0]-v[0],g[1]-v[1],g[2]-v[2]];n.normalize(y),o.normal=[0,0,0],n.normalize(o.center,o.normal);if(-n.dot(y,o.normal)<Math.cos(l.radians(o.culling)))return}m&&0!=f[0]&&(h=r.cameraTiltFator*f[0])<f[1]&&(h=0),0!=f[0]&&(h=r.cameraTiltFator*f[0],h<f[1]?h=0:0!=f[2]&&(p=r.project2(o.center,r.camera.mvp,r.cameraPosition),p[0]=Math.round(p[0]),p[1]-=h))}var b=o.hitable&&r.onlyHitLayers;if(9!=o.type){r.drawLabelBoxes&&m&&(e.setState(b?r.lineLabelHitState:r.lineLabelState),this.drawLineString([[p[0]+m[0],p[1]+m[1],.5],[p[0]+m[2],p[1]+m[1],.5],[p[0]+m[2],p[1]+m[3],.5],[p[0]+m[0],p[1]+m[3],.5],[p[0]+m[0],p[1]+m[1],.5]],!0,1,[255,0,0,255],null,!0,null,null,null)),e.setState(b?r.lineLabelHitState:r.labelState);var x=0,M=1,S=0,w=0,A=o.color2;if(null!==s&&(d=[d[0],d[1],d[2],d[3]*s],A&&(A=[A[0],A[1],A[2],A[3]*s])),0!=f[0]&&0!=f[2]&&h>=4&&this.drawLineString([[p[0],p[1]+h,p[2]],[p[0],p[1],p[2]]],!0,f[2],[f[3],f[4],f[5],null!==s?f[6]*s:f[6]],null,null,null,null,!0),o.singleBuffer){var T=r.progImage,C=o.singleBuffer;if(!o.singleBuffer2){o.singleBuffer2=new Float32Array(C);var P=1/u.width,F=1/u.height;C[2]*=P,C[3]*=F,C[6]*=P,C[7]*=F,C[10]*=P,C[11]*=F,C[14]*=P,C[15]*=F}o.updatePos&&(p=r.project2(o.center,r.camera.mvp,r.cameraPosition),p[1]-=h,p[2]=p[2]*(1+2*r.getZoffsetFactor(o.zbufferOffset))),O=p[2];var L=o.singleBuffer2;C[0]=p[0]+L[0],C[1]=p[1]+L[1],C[4]=p[0]+L[4],C[5]=p[1]+L[5],C[8]=p[0]+L[8],C[9]=p[1]+L[9],C[12]=p[0]+L[12],C[13]=p[1]+L[13],e.useProgram(T,["aPosition"]),e.bindTexture(u);var E=r.rectVerticesBuffer;t.bindBuffer(t.ARRAY_BUFFER,E),t.vertexAttribPointer(T.getAttribute("aPosition"),E.itemSize,t.FLOAT,!1,0,0);var I=r.rectIndicesBuffer;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,I),T.setMat4("uProjectionMatrix",r.imageProjectionMatrix),T.setMat4("uData",o.singleBuffer),T.setVec4("uColor",d),T.setFloat("uDepth",O),void t.drawElements(t.TRIANGLES,I.numItems,t.UNSIGNED_SHORT,0)}var T=o.program;e.useProgram(T,["aPosition","aTexCoord","aOrigin"]),T.setSampler("uSampler",0),T.setMat4("uMVP",o.mvp,r.getZoffsetFactor(o.zbufferOffset)),T.setVec4("uScale",[i[0],i[1],8==o.type?1:1/u.width,2*h]),T!=r.progIcon?(S=1.4142*o.outline[2]/o.size,w=1.4142*o.outline[3]/o.size,T.setVec4("uColor",b?d:A),T.setVec2("uParams",[o.outline[0],w]),M=b?1:2):T.setVec4("uColor",d);var N=T.getAttribute("aPosition"),B=T.getAttribute("aTexCoord"),_=T.getAttribute("aOrigin");for(t.bindBuffer(t.ARRAY_BUFFER,o.vertexPositionBuffer),t.vertexAttribPointer(N,o.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,o.vertexTexcoordBuffer),t.vertexAttribPointer(B,o.vertexTexcoordBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,o.vertexOriginBuffer),t.vertexAttribPointer(_,o.vertexOriginBuffer.itemSize,t.FLOAT,!1,0,0);x<M;x++)if(1==x&&(T.setVec4("uColor",d),T.setVec2("uParams",[o.outline[1],S])),c.length>0)for(var R=0,k=c.length;R<k;R++)for(var z=c[R],U=0,D=z.length;U<D;U++){var G=z[U];T.setFloat("uFile",Math.round(G+1e3*R)),e.bindTexture(o.fonts[R].getTexture(G)),t.drawArrays(t.TRIANGLES,0,o.vertexPositionBuffer.numItems)}else e.bindTexture(u),t.drawArrays(t.TRIANGLES,0,o.vertexPositionBuffer.numItems)}else{r.drawLabelBoxes&&m&&(e.setState(b?r.lineLabelHitState:r.lineLabelState),this.drawLineString([[p[0]+m[0],p[1]+m[1],.5],[p[0]+m[2],p[1]+m[1],.5],[p[0]+m[2],p[1]+m[3],.5],[p[0]+m[0],p[1]+m[3],.5],[p[0]+m[0],p[1]+m[1],.5]],!0,1,[255,0,0,255],null,!0,null,null,null)),e.setState(b?r.lineLabelHitState:r.labelState),0!=f[0]&&0!=f[2]&&h>=4&&(this.drawLineString([[p[0],p[1]+h,p[2]],[p[0],p[1],p[2]]],!0,f[2],[f[3],f[4],f[5],null!==s?f[6]*s:f[6]],null,null,null,null,!0),h+=f[7]);for(var R=0,k=o.subjobs.length;R<k;R++){var V=o.subjobs[R];V.mvp=o.mvp,V.updatePos=o.updatePos;var O=a[7];m=null,c=V.files,b?(d=a[4],u=r.whiteTexture):(d=V.color,u=V.texture),this.drawGpuSubJob(e,t,r,i,[V,h,u,c,d,p,!0,O,m],s)}}}},t.a=d},function(e,t,r){"use strict";var i=r(5),a=i.a,s={};s.setFaceVertices=function(e,t,r,i,a){e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=r[0],e[a+4]=r[1],e[a+5]=r[2],e[a+6]=i[0],e[a+7]=i[1],e[a+8]=i[2]},s.setFaceUVs=function(e,t,r,i,a){e[a]=t[0],e[a+1]=t[1],e[a+2]=r[0],e[a+3]=r[1],e[a+4]=i[0],e[a+5]=i[1]},s.buildHeightmap=function(e){e--;for(var t=s,r=e*e*2,i=new Float32Array(3*r*3),n=new Float32Array(3*r*2),o=1*e,h=0,l=0,u=0;u<e;u++)for(var c=0;c<e;c++){var d=c*o,p=(c+1)*o,f=u*o,m=(u+1)*o;t.setFaceVertices(i,[d,f,0],[p,f,0],[p,m,0],h),t.setFaceUVs(n,[d,f],[p,f],[p,m],l),h+=9,l+=6,t.setFaceVertices(i,[p,m,0],[d,m,0],[d,f,0],h),t.setFaceUVs(n,[p,m],[d,m],[d,f],l),h+=9,l+=6}return{bbox:new a(0,0,0,1,1,1),vertices:i,uvs:n}},s.buildPlane=function(e){e--;for(var t=s,r=e*e*2,i=new Float32Array(3*r*3),n=new Float32Array(3*r*2),o=1/e,h=0,l=0,u=0;u<e;u++)for(var c=0;c<e;c++){var d=c,p=c+1,f=u,m=u+1,g=c*o,v=(c+1)*o,y=u*o,b=(u+1)*o;t.setFaceVertices(i,[d,f,0],[d,m,0],[p,m,0],h),t.setFaceUVs(n,[g,y],[g,b],[v,b],l),h+=9,l+=6,t.setFaceVertices(i,[p,m,0],[p,f,0],[d,f,0],h),t.setFaceUVs(n,[v,b],[v,y],[g,y],l),h+=9,l+=6}return{bbox:new a(0,0,0,1,1,1),vertices:i,uvs:n}},s.spherePos=function(e,t){return t*=Math.PI,e*=2*Math.PI,[Math.cos(e)*Math.sin(t)*.5+.5,Math.sin(e)*Math.sin(t)*.5+.5,.5*Math.cos(t)+.5]},s.buildSkydome=function(e,t){for(var r=s,i=e*t*2,n=new Float32Array(3*i*3),o=new Float32Array(3*i*2),h=0,l=0,u=0;u<e;u++)for(var c=0;c<t;c++){var d=c/t,p=(c+1)/t,f=u/e,m=(u+1)/e;r.makeQuad(d,f,p,m,n,h,o,l),h+=18,l+=12}return{bbox:new a(0,0,0,1,1,1),vertices:n,uvs:o}},s.makeQuad=function(e,t,r,i,a,n,o,h){var l=s,u=l.spherePos(e,t),c=[e,t],d=l.spherePos(e,i),p=[e,i],f=l.spherePos(r,t),m=[r,t],g=l.spherePos(r,i),v=[r,i];l.setFaceVertices(a,d,u,f,n),l.setFaceUVs(o,p,c,m,h),l.setFaceVertices(a,f,g,d,n+9),l.setFaceUVs(o,m,v,p,h+6)},t.a=s},function(e,t,r){"use strict";function i(e,t,r,i,s){if(r.config.mapFeaturesReduceParams){var n,o,h=r.config.mapFeaturesReduceParams[1],l=r.config.mapFeaturesReduceParams[0],u=96*(window.devicePixelRatio||1),c=r.curSize[0],d=r.curSize[1],p=Math.ceil(c/u*(d/u)*l),f=r.config.mapFeaturesSortByTop;h=h<=0?2*p:h,r.debugStr="<br>featuresPerScr: "+p+"<br>gridCells: "+h;var m=r.gmap,g=r.gmapIndex,v=r.gmapTop,y=p;p>g&&(y=g);var b,x,M,S=Math.floor(Math.sqrt(c*d/h)),w=r.gmapHit,A=0,T=[[0,0,255,255],[128,0,255,255],[255,0,0,255],[255,128,0,255],[0,255,0,255],[0,255,128,255],[128,255,128,255]],C=0;do{var P,F,L,E,I,N,B,_,R,k,z,U,D,G,V,O;I=c/S,N=d/S,B=I*N,z=Math.floor(I),U=Math.floor(N),I-=z,N-=U,P=1/B,F=I/B,L=N/B,E=I*N/B,P=Math.floor(P*p),F=Math.floor(F*p),L=Math.floor(L*p),E=Math.floor(E*p);var w=r.gmapStore,j=r.gmapHit;if(r.drawGridCells){e.setState(r.lineLabelState);var O,H,q=0,J=0;for(O=0,H=U+1;O<H;O++)for(n=0,o=z+1;n<o;n++)q=S*n,J=S*O,D=P,n>=z?D=O>=U?E:F:O>=U&&(D=F),s.drawLineString([[q,J,.5],[q+S,J,.5],[q+S,J+S,.5],[q,J+S,.5]],!0,1,T[C],null,!0,null,null,null),s.drawText(Math.round(q+5),Math.round(J+5+15*C),10,""+D,T[C],.5)}for(n=0,o=(z+1)*(U+1);n<o;n++)w[n]=null;for(n=0,o=g;n<o;n++)(M=m[n])&&(_=M[5],_[0]<30||_[0]>=c-30||_[1]<30||_[1]>=d-30?m[n]=null:(R=_[0]/S,k=_[1]/S,(D=R>z?k>U?E:F:k>U?L:P)>0&&(G=Math.floor(R)+Math.floor(k)*(z+1),b=w[G],b?w[G].push(n):(w[G]=[n],j[G]=D))));for(n=0,o=(z+1)*(U+1);n<o;n++)if((b=w[n])&&b.length)for(x=j[n],x>b.length&&(x=b.length),a(b,f,x,r),O=0;O<x;O++)G=v[O],M=m[G],v[O]=null,m[G]=null,M[6]?(_=M[5],V=M[8],r.rmap.addRectangle(_[0]+V[0],_[1]+V[1],_[0]+V[2],_[1]+V[3],M[7],M[0].lastSubJob)||r.rmap.storeRemovedRectangle(_[0]+V[0],_[1]+V[1],_[0]+V[2],_[1]+V[3],M[7],M[0].lastSubJob)):M[0].hysteresis?r.jobHBuffer[M[0].id]=M[0]:s.drawGpuSubJob(e,t,r,i,subjob,null);P*=z*U,F*=z,L*=U,A+=P+F+L+E,p-=P+F+L+E,S*=2,C++}while(A<y)}}function a(e,t,r,i){var a,s,n,o=0,h=t?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,l=i.gmapTop,u=0,c=0,d=i.gmap;do{var p=t?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;c=u;for(var f=0,m=e.length;f<m;f++)n=e[f],s=d[n],a=s[0].reduce[1],(t&&a>=p&&a<h||a<=p&&a>h)&&(p!=a&&(u=c),l[u]=n,u++,p=a);h=p,o++}while(o<r)}function s(e,t,r,i,a){if(r.config.mapFeaturesReduceParams){var s,n,o,h,l,u,c,d,p,f=96*(window.devicePixelRatio||1),m=r.config.mapFeaturesReduceParams[0]*f,g=r.config.mapFeaturesReduceParams[1],v=(r.curSize[0],r.curSize[1],r.config.mapFeaturesSortByTop),y=r.gmap,b=r.gmap2,x=r.gmapIndex,M=0,S=1==r.config.mapFeaturesReduceFactor;for(r.debugStr="<br>: "+featureCount+"<br>gridCells: "+tileCount,s=0,n=x;s<n;s++)(h=y[s])&&(u=h[5],S&&(p=h[0].reduce,p[1]=p[2]/p[4]),b[M]=h,M++);do{var w=!1;if(v)for(s=0,n=M-1;s<n;s++)b[s][0].reduce[1]<b[s+1][0].reduce[1]&&(o=b[s],b[s]=b[s+1],b[s+1]=o,w=!0);else for(s=0,n=M-1;s<n;s++)b[s][0].reduce[1]>b[s+1][0].reduce[1]&&(o=b[s],b[s]=b[s+1],b[s+1]=o,w=!0)}while(w);var A,T,C,P,F,L=r.gmapHit,E=0;for(m*=m,s=0,n=M;s<n;s++){for(C=0,h=b[s],u=h[5],A=0,T=E;A<T&&(l=L[A],c=l[5],P=u[0]-c[0],F=u[1]-c[1],!(P*P+F*F<m&&++C>g));A++);C<=g&&(h[6]?(u=h[5],d=h[8],r.rmap.addRectangle(u[0]+d[0],u[1]+d[1],u[0]+d[2],u[1]+d[3],h[7],h[0].lastSubJob,!0)&&(L[E]=h,E++)):(h[0].hysteresis?r.jobHBuffer[h[0].id]=h[0]:(r.drawnJobs++,a.drawGpuSubJob(e,t,r,i,subjob,null)),L[E]=h,E++))}}}function n(e,t,r,i,a){if(r.config.mapFeaturesReduceParams){var s,n,o,h,l,u,c,d,p,f=96*(window.devicePixelRatio||1),m=r.config.mapFeaturesReduceParams[0]*f,g=r.config.mapFeaturesReduceParams[1],v=(r.curSize[0],r.curSize[1],r.config.mapFeaturesSortByTop,r.gmap),y=r.gmapIndex,b=r.gmap3,x=r.gmap3Size,M=1e4,S=0,w=1==r.config.mapFeaturesReduceFactor;if(w){if(r.fmaxDist==Number.NEGATIVE_INFINITY||r.fminDist==Number.POSITIVE_INFINITY)return;var A=1-Math.log(r.fminDist)/Math.log(101),T=-Math.log(r.fmaxDist)/Math.log(101)}for(s=0,n=y;s<n;s++)(o=v[s])&&(l=o[5],w?(p=o[0].reduce,d=Math.round(((Math.log(p[1]+1)-Math.log(p[4]))/Math.log(101)-T)/(A-T)*1e4-5e3)+5e3):d=o[0].reduce[1],d<0&&(d=0),d>=1e4&&(d=9999),d<M&&(M=d),d>S&&(S=d),b[d][x[d]++]=o);var C,P,F,L,E,I,N,B=r.gmapHit,_=0;for(m*=m,s=S,n=M;s>=0;s--)if(x[s]>0){var R=b[s];for(C=0,P=x[s];C<P;C++){for(o=R[C],E=0,l=o[5],F=0,L=_;F<L&&(h=B[F],u=h[5],I=l[0]-u[0],N=l[1]-u[1],!(I*I+N*N<m&&++E>g));F++);E<=g&&(o[6]?(l=o[5],c=o[8],r.rmap.addRectangle(l[0]+c[0],l[1]+c[1],l[0]+c[2],l[1]+c[3],o[7],o[0].lastSubJob,!0)&&(B[_]=o,_++)):(o[0].hysteresis?r.jobHBuffer[o[0].id]=o[0]:(r.drawnJobs++,a.drawGpuSubJob(e,t,r,i,subjob,null)),B[_]=o,_++))}x[s]=0}}}function o(e,t,r,i,a,s,n,o,h){var l,u,c=r-1,d=i-1,p=r+1,f=i+1;for(c<0&&(c=0),d<0&&(d=0),p>a&&(p=a),f>s&&(f=s);d<=f;d++)for(l=c;l<=p;l++)u=2*(d*a+l),n[u],n[u]?(o[n[u+1]]=h,n[u+1]=h+1,o[h]=t,o[h+1]=0,h+=2):(n[u]=h,n[u+1]=h+1,o[h]=t,o[h+1]=0,h+=2);return h}function h(e,t,r,i,a){if(r.config.mapFeaturesReduceParams){var s,n,h,l,u,c,d,p,f,m=96*(window.devicePixelRatio||1),g=r.config.mapFeaturesReduceParams[0]*m,v=r.config.mapFeaturesReduceParams[1],y=r.curSize[0],b=r.curSize[1],x=(r.config.mapFeaturesSortByTop,r.gmap),M=r.gmapIndex,S=r.gmap2,w=1,A=r.gmap3,T=r.gmap3Size,A=r.gmap3,C=1e4,P=0,F=1==r.config.mapFeaturesReduceFactor;if(F){if(r.fmaxDist==Number.NEGATIVE_INFINITY||r.fminDist==Number.POSITIVE_INFINITY)return;var L=1-Math.log(r.fminDist)/Math.log(101),E=-Math.log(r.fmaxDist)/Math.log(101)}for(s=0,n=M;s<n;s++)(h=x[s])&&(u=h[5],F?(f=h[0].reduce,p=Math.round(((Math.log(f[1]+1)-Math.log(f[4]))/Math.log(101)-E)/(L-E)*1e4-5e3)+5e3):p=h[0].reduce[1],p<0&&(p=0),p>=1e4&&(p=9999),p<C&&(C=p),p>P&&(P=p),A[p][T[p]++]=h);var I,N,B,_,R=1/g,k=Math.floor(y*R),z=Math.floor(b*R),U=r.gmapStore;r.gmapHit;for(s=0,n=(k+1)*(z+1)*2;s<n;s+=2)U[s]=0;var D,G,V,O,j,H=0;for(g*=g,s=P,n=C;s>=0;s--)if(T[s]>0){var _=A[s];for(D=0,G=T[s];D<G;D++){if(h=_[D],V=0,u=h[5],N=Math.floor(u[0]*R),B=Math.floor(u[1]*R),I=2*(B*k+N),U[I]){I=U[I];do{if(l=S[I],c=l[5],O=u[0]-c[0],j=u[1]-c[1],O*O+j*j<g&&++V>v)break;I=S[I+1]}while(I)}V<=v&&(I=H,h[6]?(u=h[5],d=h[8],r.rmap.addRectangle(u[0]+d[0],u[1]+d[1],u[0]+d[2],u[1]+d[3],h[7],h[0].lastSubJob,!0)&&H++):(h[0].hysteresis?r.jobHBuffer[h[0].id]=h[0]:(r.drawnJobs++,a.drawGpuSubJob(e,t,r,i,h[0].lastSubJob,null)),H++),I!=H&&(w=o(I,h,N,B,k,z,U,S,w)))}T[s]=0}}}r.d(t,"a",function(){return i}),r.d(t,"b",function(){return s}),r.d(t,"c",function(){return n}),r.d(t,"d",function(){return h})},function(e,t,r){"use strict";var i=function(e,t){this.gl=e.gl;var r=this.gl;if(null!=r){this.free=t,this.vertexPositionBuffer=null,this.vertexPositionBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexPositionBuffer);var i;i=t?[0,0,0,0,0,1,0,0,1,0,0,2,0,0,2,0,0,3,0,0,3,0,0,0,0,0,4,0,0,5,0,0,5,0,0,6,0,0,6,0,0,7,0,0,7,0,0,4,0,0,0,0,0,4,0,0,1,0,0,5,0,0,2,0,0,6,0,0,3,0,0,7]:[0,0,0,1,0,0,1,0,0,1,1,0,1,1,0,0,1,0,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,1,0,0,0,0,0,1,1,0,0,1,0,1,1,1,0,1,1,1,0,1,0,0,1,1],r.bufferData(r.ARRAY_BUFFER,new Float32Array(i),r.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=i.length/3,this.size=36,this.lines=this.vertexPositionBuffer.numItems/3}};i.prototype.kill=function(){this.gl.deleteBuffer(this.vertexPositionBuffer)},i.prototype.draw=function(e,t){var r=this.gl;if(null!=r){var i=e.getAttribute(t);r.bindBuffer(r.ARRAY_BUFFER,this.vertexPositionBuffer),r.vertexAttribPointer(i,this.vertexPositionBuffer.itemSize,r.FLOAT,!1,0,0),r.drawArrays(r.LINES,0,this.vertexPositionBuffer.numItems)}},t.a=i},function(e,t,r){"use strict";var i=function(e,t,r,i,a,s){this.renderer=e,this.div=t,this.canvas=null,this.curSize=r,this.currentProgram=null,this.maxAttributesCount=8,this.newAttributes=new Uint8Array(this.maxAttributesCount),this.enabledAttributes=new Uint8Array(this.maxAttributesCount),this.noTextures=!1,this.barycentricBuffer=null,this.defaultState=this.createState({}),this.currentState=this.defaultState,this.currentOffset=0,this.keepFrameBuffer=null!=i&&i,this.antialias=!!a,this.anisoLevel=s};i.prototype.init=function(){var e=document.createElement("canvas");if(null!=e&&(this.canvas=e,e.width=this.curSize[0],e.height=this.curSize[1],e.style.display="block",null!=e.getContext)){var t;try{t=e.getContext("webgl",{preserveDrawingBuffer:this.keepFrameBuffer,antialias:this.antialias,stencil:!0})||e.getContext("experimental-webgl",{preserveDrawingBuffer:this.keepFrameBuffer})}catch(e){}t&&(this.gl=t,t.getExtension("OES_standard_derivatives"),this.anisoExt=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.anisoExt?(this.maxAniso=t.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT),this.anisoLevel&&(-1==this.anisoLevel?this.anisoLevel=this.maxAniso:this.anisoLevel=Math.min(this.anisoLevel,this.maxAniso))):(this.maxAniso=0,this.anisoLevel=0),this.div.appendChild(e),t.viewportWidth=e.width,t.viewportHeight=e.height,t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST),t.viewport(0,0,t.viewportWidth,t.viewportHeight),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT))}},i.prototype.kill=function(){this.div.removeChild(this.canvas),delete this.canvas,this.canvas=null},i.prototype.resize=function(e,t){this.curSize=e;var r=this.canvas,i=this.gl;null!=r&&!0!==t&&(r.width=this.curSize[0],r.height=this.curSize[1]),null!=i&&(i.viewportWidth=r.width,i.viewportHeight=r.height)},i.prototype.getCanvas=function(){return this.canvas},i.prototype.setViewport=function(){this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight)},i.prototype.clear=function(e,t,r){null!=r&&this.gl.clearColor(r[0]/255,r[1]/255,r[2]/255,r[3]/255),this.gl.clear((t?this.gl.COLOR_BUFFER_BIT:0)|(e?this.gl.DEPTH_BUFFER_BIT:0))},i.prototype.useProgram=function(e,t,r){if(this.currentProgram!=e){this.gl.useProgram(e.program),this.currentProgram=e,e.setSampler("uSampler",0),r&&e.setSampler("uSampler2",1);for(var i=this.newAttributes,a=this.enabledAttributes,s=0,n=i.length;s<n;s++)i[s]=0;for(s=0,n=t.length;s<n;s++){var o=e.getAttribute(t[s]);-1!=o&&(i[o]=1)}for(s=0,n=i.length;s<n;s++)a[s]!=i[s]&&(i[s]?(this.gl.enableVertexAttribArray(s),a[s]=1):(this.gl.disableVertexAttribArray(s),a[s]=0))}},i.prototype.bindTexture=function(e,t){e.loaded&&(this.gl.activeTexture(t?this.gl.TEXTURE1:this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e.texture))},i.prototype.setFramebuffer=function(e){null!=e?this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.framebuffer):(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))},i.prototype.createState=function(e){return null==e.blend&&(e.blend=!1),null==e.stencil&&(e.stencil=!1),null==e.zwrite&&(e.zwrite=!0),null==e.ztest&&(e.ztest=!0),null==e.zequal&&(e.zequal=!1),null==e.culling&&(e.culling=!0),e},i.prototype.setState=function(e){if(e){var t=this.gl,r=this.currentState;r.blend!=e.blend&&(e.blend?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND)):t.disable(t.BLEND)),r.stencil!=e.stencil&&(e.stencil?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST)),r.zwrite!=e.zwrite&&(e.zwrite?t.depthMask(!0):t.depthMask(!1)),r.ztest!=e.ztest&&(0!=e.ztest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)),r.zequal!=e.zequal&&(0!=e.zequal?t.depthFunc(t.LEQUAL):t.depthFunc(t.LESS)),r.culling!=e.culling&&(e.culling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)),this.currentState=e}},t.a=i},function(e,t,r){"use strict";var i=r(2),a=r(5),s=r(3),n=i.b,o=i.e,h=a.a,l=s.a,u=function(e,t,r,i,a){this.id=e,this.bbox=null,this.origin=r||[0,0,0],this.gpu=i,this.gl=i.gl,this.renderer=a,this.jobs=[],this.reduced=0,this.geometries={},this.subjob=null,null!=t&&null!=t[0]&&null!=t[1]&&(this.bbox=new h(t[0][0],t[0][1],t[0][2],t[1][0],t[1][1],t[1][2])),this.size=0,this.polygons=0};u.prototype.kill=function(){for(var e=0,t=this.jobs.length;e<t;e++){var r=this.jobs[e];switch(r.type){case 1:r.vertexPositionBuffer&&this.gl.deleteBuffer(r.vertexPositionBuffer),r.vertexElementBuffer&&this.gl.deleteBuffer(r.vertexElementBuffer);break;case 3:case 2:case 4:case 5:r.vertexPositionBuffer&&this.gl.deleteBuffer(r.vertexPositionBuffer),r.vertexNormalBuffer&&this.gl.deleteBuffer(r.vertexNormalBuffer),r.vertexElementBuffer&&this.gl.deleteBuffer(r.vertexElementBuffer);break;case 6:r.vertexPositionBuffer&&this.gl.deleteBuffer(r.vertexPositionBuffer),r.vertexTexcoordBuffer&&this.gl.deleteBuffer(r.vertexTexcoordBuffer),r.vertexElementBuffer&&this.gl.deleteBuffer(r.vertexElementBuffer);break;case 7:case 8:r.vertexPositionBuffer&&this.gl.deleteBuffer(r.vertexPositionBuffer),r.vertexTexcoordBuffer&&this.gl.deleteBuffer(r.vertexTexcoordBuffer),r.vertexOriginBuffer&&this.gl.deleteBuffer(r.vertexOriginBuffer),r.vertexElementBuffer&&this.gl.deleteBuffer(r.vertexElementBuffer)}}for(var i in this.geometries){var a=this.geometries[i],s=this.renderer.geometries[i];for(this.geometries[i]=null,e=0,t=a.length;e<t;e++)a[e]==s&&(this.renderer.geometries[i]=null)}},u.prototype.size=function(){return this.size},u.prototype.getZbufferOffset=function(){return this.size},u.prototype.addGeometry=function(e){var t=e.id;this.geometries[t]?this.geometries[t].push(e):this.geometries[t]=[e],this.renderer.geometries[t]=e},u.prototype.convertColor=function(e){var t=1/255;return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]},u.prototype.addLineJob=function(e){var t=this.gl,r=e.vertexBuffer,i={};if(i.type=1,i.program=this.renderer.progLine,i.color=this.convertColor(e.color),i.zIndex=e["z-index"]+256,i.clickEvent=e["click-event"],i.hoverEvent=e["hover-event"],i.enterEvent=e["enter-event"],i.leaveEvent=e["leave-event"],i.advancedHit=e.advancedHit,i.hitable=e.hitable,i.eventInfo=e.eventInfo,i.state=e.state,i.center=e.center,i.lod=e.lod,i.lineWidth=e["line-width"],i.zbufferOffset=e["zbuffer-offset"],i.reduced=!1,i.ready=!0,i.program.isReady()&&(!i.advancedHit||(i.program2=this.renderer.progELine,i.program2.isReady()))){if(i.vertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i.vertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),i.vertexPositionBuffer.itemSize=3,i.vertexPositionBuffer.numItems=r.length/3,i.advancedHit){i.program=this.renderer.progLine;var a=e.elementBuffer;i.vertexElementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i.vertexElementBuffer),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),i.vertexElementBuffer.itemSize=1,i.vertexElementBuffer.numItems=a.length}this.jobs.push(i),this.size+=4*r.length,this.polygons+=r.length/9}},u.prototype.addExtentedLineJob=function(e){var t=this.gl,r=e.vertexBuffer,i=e.normalBuffer,a={};switch(a.type=e.type,e.type){case"flat-tline":a.type=3;break;case"flat-rline":a.type=2;break;case"pixel-line":a.type=4;break;case"pixel-tline":a.type=5}if(a.color=this.convertColor(e.color),a.zIndex=e["z-index"]+256,a.clickEvent=e["click-event"],a.hoverEvent=e["hover-event"],a.hitable=e.hitable,a.eventInfo=e.eventInfo,a.enterEvent=e["enter-event"],a.leaveEvent=e["leave-event"],a.advancedHit=e.advancedHit,a.widthByRatio="ratio"==e["width-units"],a.state=e.state,a.center=e.center,a.lod=e.lod,a.lineWidth=e["line-width"],a.zbufferOffset=e["zbuffer-offset"],a.reduced=!1,a.ready=!0,null!=e.texture){var s=e.texture,n=s[0];a.texture=[this.renderer.getBitmap(n.url,n.filter||"linear",n.tiled||!1),s[1],s[2],s[3],s[4]];var o=this.convertColor(e.background);0!=o[3]&&(a.background=o)}switch(a.type){case 3:a.program=0!=o[3]?this.renderer.progTBLine:this.renderer.progTLine;break;case 2:a.program=this.renderer.progRLine;break;case 4:a.program=this.renderer.progLine3;break;case 5:a.program=0!=o[3]?this.renderer.progTPBLine:this.renderer.progTPLine}if(a.program.isReady()){if(a.advancedHit){switch(a.type){case 3:a.program2=this.renderer.progETLine;break;case 2:a.program2=this.renderer.progERLine;break;case 4:a.program2=this.renderer.progELine3;break;case 5:a.program2=this.renderer.progETPLine}if(!a.program2.isReady())return}if(a.vertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a.vertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),a.vertexPositionBuffer.itemSize=4,a.vertexPositionBuffer.numItems=r.length/4,a.vertexNormalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a.vertexNormalBuffer),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),a.vertexNormalBuffer.itemSize=4,a.vertexNormalBuffer.numItems=i.length/4,a.advancedHit){var h=e.elementBuffer;a.vertexElementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a.vertexElementBuffer),t.bufferData(t.ARRAY_BUFFER,h,t.STATIC_DRAW),a.vertexElementBuffer.itemSize=1,a.vertexElementBuffer.numItems=h.length}this.jobs.push(a),this.size+=4*r.length+4*i.length,this.polygons+=r.length/12}},u.prototype.addLineLabelJob=function(e){var t=this.gl,r=e.vertexBuffer,i=e.texcoordsBuffer,a={};a.type=6,a.program=this.renderer.progText,a.color=this.convertColor(e.color),a.color2=this.convertColor(e.color2),a.outline=e.outline,a.zIndex=e["z-index"]+256,a.clickEvent=e["click-event"],a.hoverEvent=e["hover-event"],a.enterEvent=e["enter-event"],a.leaveEvent=e["leave-event"],a.hitable=e.hitable,a.eventInfo=e.eventInfo,a.state=e.state,a.center=e.center,a.lod=e.lod,a.zbufferOffset=e["zbuffer-offset"],a.reduced=!1,a.ready=!0,a.files=e.files||[];var s=e.fonts||["#default"];a.fonts=s;for(var n=0,o=s.length;n<o;n++)s[n]=this.renderer.fonts[s[n]];a.program=this.renderer.progText2,a.program.isReady()&&(a.vertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a.vertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),a.vertexPositionBuffer.itemSize=4,a.vertexPositionBuffer.numItems=r.length/4,a.vertexTexcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a.vertexTexcoordBuffer),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),a.vertexTexcoordBuffer.itemSize=4,a.vertexTexcoordBuffer.numItems=i.length/4,this.jobs.push(a),this.size+=4*r.length+4*i.length,this.polygons+=r.length/12)},u.prototype.addIconJob=function(e,t,r){var i=this.gl,a=e.vertexBuffer,s=e.texcoordsBuffer,n=e.originBuffer,o=e.singleBuffer,h=e.stick,l=1/255,u={tile:r};if(u.type=t?8:7,u.program=this.renderer.progIcon,u.color=this.convertColor(e.color),u.zIndex=e["z-index"]+256,u.visibility=e.visibility,u.culling=e.culling,u.clickEvent=e["click-event"],u.hoverEvent=e["hover-event"],u.enterEvent=e["enter-event"],u.leaveEvent=e["leave-event"],u.hitable=e.hitable,u.eventInfo=e.eventInfo,u.state=e.state,u.center=e.center,u.stick=[h[0],h[1],h[2],h[3]*l,h[4]*l,h[5]*l,h[6]*l,h[7]],u.lod=e.lod,u.zbufferOffset=e["zbuffer-offset"],u.hysteresis=e.hysteresis,u.id=u.hysteresis?u.hysteresis[2]:null,u.reduced=!1,u.ready=!0,u.reduce=e.reduce,u.reduce){switch(u.reduce[0]){case"tilt":u.reduce[0]=1;break;case"tilt-cos":u.reduce[0]=2;break;case"tilt-cos2":u.reduce[0]=3;break;case"scr-count":u.reduce[0]=4;break;case"scr-count2":u.reduce[0]=5;break;case"scr-count3":u.reduce[0]=6;break;case"scr-count4":u.reduce[0]=7;break;case"scr-count5":u.reduce[0]=8}7!=u.reduce[0]&&8!=u.reduce[0]||(u.reduce[2]=Math.abs(u.reduce[1]),1==this.renderer.config.mapFeaturesReduceFactor?u.reduce[1]=u.reduce[2]:u.reduce[1]=Math.floor(Math.log(500*u.reduce[2])/Math.log(1.0017)+5e3))}if(u.program.isReady()){if(!0!==t){var c=e.icon;u.texture=this.renderer.getBitmap(c.url,c.filter||"linear",c.tiled||!1),u.files=[]}else{u.color2=this.convertColor(e.color2),u.outline=e.outline,u.size=e.size,u.files=e.files||[],u.index=e.index||0,u.noOverlap=e.noOverlap;var d=e.fonts||["#default"];u.fonts=d;for(var p=0,f=d.length;p<f;p++)d[p]=this.renderer.fonts[d[p]];u.program=this.renderer.progIcon2}null==u.visibility||Array.isArray(u.visibility)||(u.visibility=[u.visibility]),o?(u.singleBuffer=o,this.polygons+=2):(u.vertexPositionBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,u.vertexPositionBuffer),i.bufferData(i.ARRAY_BUFFER,a,i.STATIC_DRAW),u.vertexPositionBuffer.itemSize=4,u.vertexPositionBuffer.numItems=a.length/4,u.vertexTexcoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,u.vertexTexcoordBuffer),i.bufferData(i.ARRAY_BUFFER,s,i.STATIC_DRAW),u.vertexTexcoordBuffer.itemSize=4,u.vertexTexcoordBuffer.numItems=s.length/4,u.vertexOriginBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,u.vertexOriginBuffer),i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW),u.vertexOriginBuffer.itemSize=3,u.vertexOriginBuffer.numItems=n.length/3,this.size+=4*u.vertexPositionBuffer.numItems+4*u.vertexOriginBuffer.numItems+4*u.vertexTexcoordBuffer.numItems,this.polygons+=u.vertexPositionBuffer.numItems/12),this.subjobs?this.subjobs.push(u):this.jobs.push(u)}},u.prototype.addPack=function(e){if(!this.subjobs.length)return void(this.subjobs=null);for(var t={type:9,subjobs:this.subjobs,culling:180,zIndex:0,ready:!0},r=0,i=t.subjobs.length;r<i;r++){var a=t.subjobs[r];a.noOverlap&&(t.noOverlap=a.noOverlap,a.noOverlap=null),a.culling<=t.culling&&(t.culling=a.culling,a.culling=180),a.visibility&&(t.visibility=a.visibility,a.visibility=null),a.stick&&(t.stick=a.stick,a.stick=[0,0,0,255,255,255,255,0]),a.zIndex>t.zIndex&&(t.zIndex=a.zIndex),a.center&&(t.center=a.center),t.eventInfo=a.eventInfo,t.reduce=a.reduce,t.hysteresis=a.hysteresis,t.id=a.id}this.jobs.push(t),this.subjobs=null},u.prototype.addRenderJob=function(e,t){switch(e.type){case"flat-line":this.addLineJob(e);break;case"flat-tline":case"flat-rline":case"pixel-line":case"pixel-tline":this.addExtentedLineJob(e);break;case"line-label":this.addLineLabelJob(e);break;case"icon":this.addIconJob(e);break;case"label":this.addIconJob(e,!0,t);break;case"point-geometry":case"line-geometry":this.addGeometry(e);break;case"pack-begin":this.subjobs=[];break;case"pack-end":this.addPack()}},u.prototype.draw=function(e,t,r,i,a){if(null==this.id||!1!==this.renderer.layerGroupVisible[this.id]){var s=this.renderer,h=[[s.geoRenderCounter,e,t,this]];if(r){var u=o.create(),c=o.create(),d=this.renderer.position,p=this.origin;p=[p[0]-d[0],p[1]-d[1],p[2]],o.multiply(e,l.translationMatrix(p[0],p[1],p[2]),c),o.multiply(t,c,u),e=c,t=u}for(var f=s.cameraPosition,m=s.jobZBuffer,g=s.jobZBufferSize,v=(s.jobZBuffer2,s.jobZBuffer2Size,s.onlyHitLayers),y=0,b=this.jobs.length;y<b;y++){var x=this.jobs[y];if((7==x.type||8==x.type)&&x.visibility>0){var M=x.center;if(n.length([M[0]-f[0],M[1]-f[1],M[2]-f[2]])>x.visibility)continue}if(!v||x.hitable){x.mv=e,x.mvp=t,x.renderCounter=h,x.tiltAngle=i,x.texelSize=a;var S=x.zIndex;m[S][g[S]]=x,g[S]++}}}},t.a=u},function(e,t,r){"use strict";var i=function(e,t,r,i,a,s){this.bbox=null,this.gpu=e,this.gl=e.gl,this.core=t,null!=this.gl&&(this.vertices=[],this.normals=[],this.vertexBuffer=null,this.lines=r,this.joins=a,this.joinSides=s,this.maxLines=i,this.init())};i.prototype.kill=function(){this.gl.deleteBuffer(this.vertexBuffer)},i.prototype.init=function(){var e;if(this.lines)for(this.joins&&this.addCircle(0,this.joinSides),e=0;e<this.maxLines;e++)this.addLine(e,e+1),this.joins&&this.addCircle(e+1,this.joinSides);else if(this.joins)for(e=0;e<=this.maxLines;e++)this.addCircle(e,this.joinSides);this.compile()},i.prototype.addLine=function(e,t){var r=this.vertices.length;this.vertices[r]=e,this.vertices[r+1]=t,this.vertices[r+2]=1,this.vertices[r+3]=e,this.vertices[r+4]=t,this.vertices[r+5]=-1,this.vertices[r+6]=t,this.vertices[r+7]=e,this.vertices[r+8]=1,this.vertices[r+9]=e,this.vertices[r+10]=t,this.vertices[r+11]=1,this.vertices[r+12]=t,this.vertices[r+13]=e,this.vertices[r+14]=1,this.vertices[r+15]=t,this.vertices[r+16]=e,this.vertices[r+17]=-1,this.polygons+=2},i.prototype.addCircle=function(e,t){for(var r=this.vertices.length,i=2*Math.PI/t,a=0;a<t;a++)this.vertices[r]=e,this.vertices[r+1]=-1,this.vertices[r+2]=0,this.vertices[r+3]=e,this.vertices[r+4]=-2,this.vertices[r+5]=i*a,this.vertices[r+6]=e,this.vertices[r+7]=-2,this.vertices[r+8]=i*(a+1),r+=9;this.polygons+=t},i.prototype.compile=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertices),e.STATIC_DRAW),this.vertexBuffer.itemSize=3,this.vertexBuffer.numItems=this.vertices.length/3,this.size=3*this.vertexBuffer.numItems*4*2,this.polygons=this.vertexBuffer.numItems/3},i.prototype.draw=function(e,t,r){var i=this.gl;if(!(null==i||null==this.vertexBuffer||r>this.maxLines)){var a=e.getAttribute(t);i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.vertexAttribPointer(a,this.vertexBuffer.itemSize,i.FLOAT,!1,0,0);var s=0;this.lines&&(s+=3*(r-1)*2),this.joins&&(s+=r*(3*this.joinSides)),i.drawArrays(i.TRIANGLES,0,s)}},i.prototype.size=function(){return this.size},i.prototype.bbox=function(){return this.bbox},i.prototype.getPolygons=function(){return this.polygons},t.a=i},function(e,t,r){"use strict";var i=r(158),a=r(160),s=r(57),n=r(32),o=r(163),h=r(33),l=r(58),u=r(6),c=i.a,d=a.a,p=(s.a,n.a),f=o.a,m=h.a,g=l.a,v=u.a,y=function(e){this.renderer=e,this.core=e.core,this.gpu=e.gpu,this.initShaders(),this.initHeightmap(),this.initSkydome(),this.initHitmap(),this.initTextMap(),this.initImage(),this.initTestMap(),this.initBBox(),this.initLines(),this.initBaricentricBuffer()};y.prototype.initShaders=function(){var e=g,t=this.renderer,r=this.gpu;t.progTile=new m(r,e.tileVertexShader,e.tileFragmentShader),t.progTile2=new m(r,e.tile2VertexShader,e.tile2FragmentShader.replace("__FILTER__","")),t.progTile3=new m(r,e.tile2VertexShader,e.tile3FragmentShader.replace("__FILTER__","")),t.progShadedTile=new m(r,e.tileTShadedVertexShader,e.tileShadedFragmentShader),t.progTShadedTile=new m(r,e.tileTShadedVertexShader,e.tileTShadedFragmentShader),t.progFogTile=new m(r,e.fogTileVertexShader,e.fogTileFragmentShader),t.progWireframeTile=new m(r,e.tileWireframeVertexShader,e.tileWireframeFragmentShader),t.progWireframeTile2=new m(r,e.tileWireframeVertexShader,e.tileWireframe2FragmentShader),t.progWireframeTile3=new m(r,e.tileWireframe3VertexShader,e.tileWireframeFragmentShader),t.progFlatShadeTile=new m(r,e.tileFlatShadeVertexShader,e.tileFlatShadeFragmentShader),t.progHeightmap=new m(r,e.heightmapVertexShader,e.heightmapFragmentShader),t.progPlane=new m(r,e.planeVertexShader,e.planeFragmentShader),t.progPlane2=new m(r,e.planeVertex2Shader,e.planeFragment2Shader),t.progPlane3=new m(r,e.planeVertex3Shader,e.planeFragmentShader),t.progSkydome=new m(r,e.skydomeVertexShader,e.skydomeFragmentShader),t.progStardome=new m(r,e.skydomeVertexShader,e.stardomeFragmentShader),t.progAtmo2=new m(r,e.atmoVertexShader,e.atmoFragmentShader),t.progAtmo=new m(r,e.atmoVertexShader3,e.atmoFragmentShader3),t.progDepthTile=new m(r,e.tileDepthVertexShader,e.tileDepthFragmentShader),t.progDepthHeightmap=new m(r,e.heightmapDepthVertexShader,e.heightmapDepthFragmentShader),t.progBBox=new m(r,e.bboxVertexShader,e.bboxFragmentShader),t.progBBox2=new m(r,e.bbox2VertexShader,e.bboxFragmentShader),t.progLine=new m(r,e.lineVertexShader,e.lineFragmentShader),t.progELine=new m(r,e.elineVertexShader,e.elineFragmentShader),t.progLine3=new m(r,e.line3VertexShader,e.lineFragmentShader),t.progELine3=new m(r,e.eline3VertexShader,e.elineFragmentShader),t.progLine4=new m(r,e.line4VertexShader,e.lineFragmentShader),t.progRLine=new m(r,e.rlineVertexShader,e.lineFragmentShader),t.progERLine=new m(r,e.erlineVertexShader,e.elineFragmentShader),t.progTLine=new m(r,e.tlineVertexShader,e.tlineFragmentShader),t.progTPLine=new m(r,e.tplineVertexShader,e.tlineFragmentShader),t.progTBLine=new m(r,e.tlineVertexShader,e.tblineFragmentShader),t.progTPBLine=new m(r,e.tplineVertexShader,e.tblineFragmentShader),t.progETLine=new m(r,e.etlineVertexShader,e.elineFragmentShader),t.progETPLine=new m(r,e.etplineVertexShader,e.elineFragmentShader),t.progLineWireframe=new m(r,e.lineWireframeVertexShader,e.lineWireframeFragmentShader),t.progPolygon=new m(r,e.polygonVertexShader,e.polygonFragmentShader),t.progText=new m(r,e.textVertexShader,e.textFragmentShader),t.progText2=new m(r,e.text2VertexShader,e.text2FragmentShader),t.progImage=new m(r,e.imageVertexShader,e.imageFragmentShader),t.progIcon=new m(r,e.iconVertexShader,e.textFragmentShader),t.progIcon2=new m(r,e.icon2VertexShader,e.text2FragmentShader)},y.prototype.initProceduralShaders=function(){var e=g,t=this.renderer,r=this.gpu;t.progHmapPlane=new m(r,e.planeVertex4Shader,e.planeFragmentShader2),t.progHmapPlane2=new m(r,e.planeVertex4Shader,"#define grid\n"+e.planeFragmentShader2),t.progHmapPlane3=new m(r,e.planeVertex4Shader,"#define exmap\n"+e.planeFragmentShader2),t.progHmapPlane4=new m(r,e.planeVertex4Shader,"#define flat\n"+e.planeFragmentShader2),t.progHmapPlane5=new m(r,e.planeVertex4Shader,"#define normals\n"+e.planeFragmentShader2),t.progHmapPlane6=new m(r,e.planeVertex4Shader,"#define nmix\n#define normals\n"+e.planeFragmentShader2),t.progHmapPlane7=new m(r,e.planeVertex4Shader,"#define nmix\n"+e.planeFragmentShader2),t.progHmapPlane8=new m(r,e.planeVertex4Shader,"#define exmap\n#define classmap\n"+e.planeFragmentShader2)},y.prototype.initHeightmap=function(){var e=this.renderer,t=this.gpu,r=c.buildHeightmap(5);e.heightmapMesh=new p(t,r,null,this.core),r=c.buildPlane(16),e.planeMesh=new p(t,r,null,this.core),r=c.buildPlane(128),e.planeMesh2=new p(t,r,null,this.core);for(var i=new Uint8Array(16384),a=0;a<64;a++)for(var s=0;s<64;s++){var n=4*(64*a+s);a<1||a>=63||s<1||s>=63?(i[n]=255,i[n+1]=255,i[n+2]=255):(i[n]=32,i[n+1]=32,i[n+2]=32),i[n+3]=255}e.heightmapTexture=new v(t),e.heightmapTexture.createFromData(64,64,i,"trilinear",!0)},y.prototype.initHitmap=function(){var e=this.renderer,t=e.hitmapSize,r=new Uint8Array(t*t*4);e.hitmapTexture=new v(this.gpu),e.hitmapTexture.createFromData(t,t,r),e.hitmapTexture.createFramebuffer(t,t),e.geoHitmapTexture=new v(this.gpu),e.geoHitmapTexture.createFromData(t,t,r),e.geoHitmapTexture.createFramebuffer(t,t),e.geoHitmapTexture2=new v(this.gpu),e.geoHitmapTexture2.createFromData(t,t,r),e.geoHitmapTexture2.createFramebuffer(t,t)},y.prototype.initTestMap=function(){var e,t,r,i=this.renderer,a=this.gpu,s=new Uint8Array(1024);for(e=0;e<16;e++)for(t=0;t<16;t++)r=4*(16*e+t),s[r]=255,s[r+1]=0,s[r+2]=0,s[r+3]=255;for(i.redTexture=new v(a),i.redTexture.createFromData(16,16,s),s=new Uint8Array(1024),e=0;e<16;e++)for(t=0;t<16;t++)r=4*(16*e+t),s[r]=255,s[r+1]=255,s[r+2]=255,s[r+3]=255;for(i.whiteTexture=new v(a),i.whiteTexture.createFromData(16,16,s),s=new Uint8Array(1024),e=0;e<16;e++)for(t=0;t<16;t++)r=4*(16*e+t),s[r]=0,s[r+1]=0,s[r+2]=0,s[r+3]=255;i.blackTexture=new v(a),i.blackTexture.createFromData(16,16,s)},y.prototype.initTextMap=function(){this.renderer.textTexture2=new v(this.gpu,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAACACAMAAADTa0c4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFAAAA////pdmf3QAABIFJREFUeNrsnNuyqzAIhsP7v/Se6Yxra0L4OUVNCzetVqP5DAQItrVOiLg95739NnfOaR99RDj6esBw+CKZXiMK4PiuBkAcANoHAP3J5fzzAV2jePQIt6f4Ndb/MIChlVcCEFpAACZPfN4KUAF0/ufboDW3AuBMFgBwHTCfg2ftYgDUKBuA1ABuHKvA2P+5XdONIEt7BO2o2MdlAJoTQOsV6GEAswt0Zq/bsBhdeQQkqEDMwmIAnJHzA8i3ASkWRFKBbADyLGB3mlYD6DyhA4DfBlgsBDtirUPcBgC5woStYMgVtgKATWcB6DskKUEkGFLYrGw3+l3ydR16wKbbPDlWp4Xfo9vZwR1jtOMA6GkABrdvNmt1Vluy6pyvxu4Xt62fquyTggCTsIkCoIuv8gAA08w+ATBXAdSRY56xPDFPx/VPWFZp5v65kFMPgFjP70YASMfRsDn01xLPcwkRq1HLMoK647hR8v+nId74MQBjvIbUQePra42ZVXVcBCR3mIY89mYAlNGLflqA0V1seosCQNMg80B0bsLGAIDNwvFyiqu66ngVGGMGVBwyWwIwpty2DqEr/qf0Bq+DbjYkkcr4VUoOxiRjrYn3YY5SC4BQB/cF0Lq4kD1RCJ+tN4g6Jps5zfWu+QmSz9sUABkA0BIAXocmBwCJ99MDIASATkmtLQAIft4IgE/ZDStZ59yQbOQQAGZWYMbZ3FFCAGRHnwHQznegGAE+zwxNi8kALCOgS9tzAC4jYG1Qo0myRm0Ae/z8eleqewBoZLwfUswCsbT1KgBZD6QAzAEoXUe3K+xxVf2uLf5U3nBeMPRyACW/LtrwVX989id3PRQOG5Io6vh9XwC6stHIdGdJozun03lxNlwvH4u6UgDM8/LmJyx7ak12feEebaXmUwCOYJWk1JcYKsl74HL74wAaH93NqkE1FSKXc4cv0AjaPEEPgE4ru/ieWdvzVq/4psG3AYDFHlEAioQCuEgMgPjK1VDrqlkbTABAiQBGK38B0BlBSf9xtiAJQDM4NtDqMlaeyduTtkDjHgAtEQBj5ZGK2QE0aCcMAIxLSw0WVYlGDgOQXWE+afouAM0S398O4Nej3wIQf4cIHSfz9pbWugyep4MFIAFARvspbm8BcE2DOdvWnCJQAWFhJ/hKzh4AaB2A7NxedKmLPc+6PN4cL2S8GYC1QMIEQJvmFsJfxdvkEQAoLV4AogBS8/kNvdXlWe5GKhABvQUAZASDALJffY1XfsrToFXFbvYD1gBo6wC8LR7/uvj9CwHcfWuoUJItsVl5nwWAnhxxqsXatUq0OYCcaS/fkbK61u5H8jwAuUIEZXHNL1Jmub5oSKZWiDR9FttM4HEAigqRpn8TeB2AuWNiByAXSHCGbB7/3qYCfgCgPgADEEskbjCCaJDB/+kR6wP4P1Obl8jsBwDUB4yAxqKkthaATjX0KmCtDyCxm+yIMLjCbwBgrg94FYC3h8vLPPmfAVBSUlJSUlJSUlJSUlJSUlJSUlJSUlJSUlJSUlJSUlLy9fJPgAEAvWMULbGsSjwAAAAASUVORK5CYII=",this.core,null,!0)},y.prototype.initImage=function(){var e=this.renderer,t=this.gpu.gl;e.rectVerticesBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e.rectVerticesBuffer);var r=[0,0,0,1,1,0,0,1,2,0,0,1,3,0,0,1];t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),e.rectVerticesBuffer.itemSize=4,e.rectVerticesBuffer.numItems=4,e.rectIndicesBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.rectIndicesBuffer);var i=[0,2,1,0,3,2];t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),t.STATIC_DRAW),e.rectIndicesBuffer.itemSize=1,e.rectIndicesBuffer.numItems=6},y.prototype.initSkydome=function(){var e=this.renderer,t=c.buildSkydome(32,64);e.skydomeMesh=new p(this.gpu,t,null,this.core),t=c.buildSkydome(128,256),e.atmoMesh=new p(this.gpu,t,null,this.core)},y.prototype.initBBox=function(){var e=this.renderer,t=this.gpu;e.bboxMesh=new d(t),e.bboxMesh2=new d(t,!0)},y.prototype.initLines=function(){var e=this.gpu,t=this.renderer;t.plineBuffer=new Float32Array(96),t.plines=new f(e,this.core,!0,64,!0,8),t.plineJoints=new f(e,this.core,!1,64,!0,8),t.stencilLineState=e.createState({blend:!0,stencil:!0,culling:!1}),t.lineLabelState=e.createState({blend:!0,culling:!1,zequal:!0,zwrite:!1}),t.labelState=e.createState({blend:!0,culling:!1,zequal:!0}),t.stencilLineHitState=e.createState({blend:!1,stencil:!0,culling:!1}),t.lineLabelHitState=e.createState({blend:!1,culling:!1})},y.prototype.initBaricentricBuffer=function(){for(var e=this.gpu,t=new Array(196605),r=0;r<196605;r+=9)t[r]=1,t[r+1]=0,t[r+2]=0,t[r+3]=0,t[r+4]=1,t[r+5]=0,t[r+6]=0,t[r+7]=0,t[r+8]=1;var i=e.gl;e.barycentricBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,e.barycentricBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.STATIC_DRAW),e.barycentricBuffer.itemSize=3,e.barycentricBuffer.numItems=t.length/3},t.a=y},function(e,t,r){"use strict";var i=r(6),a=r(32),s=r(33),n=r(166),o=i.a,h=a.a,l=s.a,u=n.a,c=n.b,d=function(e){this.renderer=e,this.gpu=e.gpu};d.prototype.clear=function(e){return null!=e&&this.gpu.clear(e.clearDepth||!0,e.clearColor||!1,e.color||[255,255,255,255],null!=e.depth?e.depth:1),this},d.prototype.createState=function(e){if(null==e||"object"!=typeof e)return this;var t={blend:null!=e.blend&&e.blend,stencil:null!=e.stencil&&e.stencil,zoffset:null!=e.zoffset?e.zoffset:0,zwrite:null==e.zwrite||e.zwrite,ztest:null==e.ztest||e.ztest,zequal:null==e.zequal||e.zequal,culling:null==e.culling||e.culling};return this.gpu.createState(t)},d.prototype.setState=function(e){return null!=e&&this.gpu.setState(e),this},d.prototype.createTexture=function(e){if(null==e||"object"!=typeof e)return null;var t=e.source;if(null==t)return null;var r,i=e.filter||"linear",a=e.repeat||!1;if(t instanceof Uint8Array){var s=e.width,n=e.height;if(s&&n)return r=new o(this.gpu),r.createFromData(s,n,t,i,a),r}return t instanceof Image?(r=new o(this.gpu),r.createFromImage(t,i,a),r):null},d.prototype.removeTexture=function(e){return e&&e.kill(),this},d.prototype.createMesh=function(e){if(null==e||"object"!=typeof e)return null;var t={vertices:e.vertices,uvs:e.uvs,uvs2:e.normals,vertexSize:e.vertexSize,uvSize:e.uvSize,uv2Size:e.normalSize||3,vertexAttr:e.vertexAttr,uvAttr:e.uvAttr,uv2Attr:e.normalAttr,bbox:e.bbox};return new h(this.gpu,t,0,this.renderer.core)},d.prototype.removeMesh=function(e){return e&&e.kill(),this},d.prototype.createShader=function(e){if(null==e||"object"!=typeof e)return null;var t=e.vertexShader,r=e.fragmentShader;return null!=t&&r?new l(this.gpu,t,r):void 0},d.prototype.removeResource=function(e){return null!=e&&null!=e.kill&&e.kill(),this},d.prototype.addJob=function(){return this},d.prototype.clearJobs=function(){return this},d.prototype.drawMesh=function(e){if(null==e||"object"!=typeof e)return this;if(null==!e.mesh||!e.shaderVariables)return this;var t=e.vertex||"aPosition",r=e.uv||"aTexCoord",i=e.normal||"aNormal",a=null!=e.depthOffset?e.depthOffset:null,s=e.shaderVariables,n=e.shader||"textured",o=this.renderer,h=e.mesh,l=e.texture,u=o.camera.getModelviewMatrix(),c=o.camera.getProjectionMatrix(),d=o.fogDensity;if("string"==typeof n)switch(n){case"hit":s.uMV||(s.uMV=["mat4",u]),s.uProj||(s.uProj=["mat4",c]),r=null,i=null,l=null,n=o.progDepthTile;break;case"shaded":r=null;case"textured":case"textured-and-shaded":s.uMV||(s.uMV=["mat4",u]),s.uProj||(s.uProj=["mat4",c]),s.uFogDensity||(s.uFogDensity=["float",d]),i="textured"==n?null:"aNormal",n="textured"==n?o.progTile:"shaded"==n?o.progShadedTile:o.progTShadedTile}if(n&&n.isReady()){var p=[t];r&&p.push(r),i&&p.push(i),o.gpu.useProgram(n,p);for(var f in s){var m=s[f];if(2==m.length)switch(m[0]){case"floatArray":n.setFloatArray(f,m[1]);break;case"float":n.setFloat(f,m[1]);break;case"mat3":n.setMat3(f,m[1]);break;case"mat4":a&&"uProj"==f?n.setMat4(f,m[1],o.getZoffsetFactor(a)):n.setMat4(f,m[1]);break;case"vec2":n.setVec2(f,m[1]);break;case"vec3":n.setVec3(f,m[1]);break;case"vec4":n.setVec4(f,m[1]);break;case"sampler":n.setSampler(f,m[1])}}return l&&o.gpu.bindTexture(l),h.draw(n,t,r,i,null),this}},d.prototype.drawImage=function(e){if(null==e||"object"!=typeof e)return this;if(null==e.texture||null==e.rect)return this;var t=e.rect,r=e.color||[255,255,255,255],i=null!=e.depth?e.depth:0,a=null!=e.depthOffset?e.depthOffset:null,s=null!=e.depthTest&&e.depthTest,n=null!=e.blend&&e.blend,o=null!=e.writeDepth&&e.writeDepth,h=null!=e.useState&&e.useState;return r[0]*=1/255,r[1]*=1/255,r[2]*=1/255,r[3]*=1/255,this.renderer.draw.drawImage(t[0],t[1],t[2],t[3],e.texture,r,i,a,s,n,o,h),this},d.prototype.drawBillboard=function(e){if(null==e||"object"!=typeof e)return this;if(null==e.texture||null==e.mvp)return this;var t=e.mvp,r=e.color||[255,255,255,255],i=null!=e.depthOffset?e.depthOffset:null,a=null!=e.depthTest&&e.depthTest,s=null!=e.blend&&e.blend,n=null!=e.writeDepth&&e.writeDepth,o=null!=e.useState&&e.useState;return r[0]*=1/255,r[1]*=1/255,r[2]*=1/255,r[3]*=1/255,this.renderer.draw.drawBillboard(t,e.texture,r,i,a,s,n,o),this},d.prototype.drawLineString=function(e){if(null==e||"object"!=typeof e)return this;if(null==e.points)return this;var t=e.points,r=e.color||[255,255,255,255],i=null!=e.depthOffset?e.depthOffset:null,a=e.size||2,s=null==e.screenSpace||e.screenSpace,n=null!=e.depthTest&&e.depthTest,o=null!=e.blend&&e.blend,h=null!=e.writeDepth&&e.writeDepth,l=null!=e.useState&&e.useState;return r[0]*=1/255,r[1]*=1/255,r[2]*=1/255,r[3]*=1/255,this.renderer.draw.drawLineString(t,s,a,r,i,n,o,h,l),this},d.prototype.drawJobs=function(){return this},d.prototype.drawBBox=function(){return this},d.prototype.drawDebugText=function(e){if(null==e||"object"!=typeof e)return this;var t=e.text,r=e.coords;if(!t||!r)return this;var i=e.color||[255,255,255,255],a=e.size||16,s=e.depth,n=e.useState||!1;i[0]*=1/255,i[1]*=1/255,i[2]*=1/255,i[3]*=1/255;var o=this.renderer.draw.getTextSize(a,t);return this.renderer.draw.drawText(r[0]-.5*o,r[1],a,t,i,s,n),this},d.prototype.buildOctreeFromGeometry=function(e){var t=new u;return t.buildFromGeometry(e),t},d.prototype.raycastOctreeGeometry=function(e,t,r){var i=new c,a=[];return i.intersectOctree(t,r,e,a),i.intersectOctants(t,r,a)},d.prototype.saveScreenshot=function(e,t,r){return this.renderer.saveScreenshot(e,t,r)},d.prototype.getCanvasCoords=function(e,t){return this.renderer.project2(e,t)},d.prototype.getCanvasSize=function(){return this.renderer.curSize.slice()},d.prototype.setConfigParams=function(e){return this.renderer.setConfigParams(e),this},d.prototype.setConfigParam=function(e,t){return this.renderer.setConfigParam(e,t),this},d.prototype.getConfigParam=function(e){return this.renderer.getConfigParam(e)},t.a=d},function(e,t,r){"use strict";var i=r(2);r.d(t,"a",function(){return s}),r.d(t,"b",function(){return o});var a=i.b,s=function(){this.root=null,this.maxItemsPerNode=20,this.maxDepth=20,this.depthCount=[];for(var e=0;e<1e3;e++)this.depthCount[e]=0;this.pattern=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])]};s.prototype.clear=function(){},s.prototype.buildFromGeometry=function(e){if(e){var t,r,i,a,s,o,h,l,u,c,d,p,f,m,g,v,y,b,x;for(p=f=m=Number.POSITIVE_INFINITY,g=v=y=Number.NEGATIVE_INFINITY,t=0,r=e.length;t<r;t++)if(b=e[t],"mesh"==b.type)for(l=b.submeshes,i=0,a=l.length;i<a;i++)u=l[i],c=u.bbox,c[0][0]<p&&(p=c[0][0]),c[0][1]<f&&(f=c[0][1]),c[0][2]<m&&(m=c[0][2]),c[1][0]>g&&(g=c[1][0]),c[1][1]>v&&(v=c[1][1]),c[1][2]>y&&(y=c[1][2]);for(this.root=new n([p,f,m],[g,v,y]),t=0,r=e.length;t<r;t++)if(b=e[t],"mesh"==b.type)for(l=b.submeshes,i=0,a=l.length;i<a;i++)for(u=l[i],x=u.vertices,s=0,o=x.length;s<o;s+=9){for(p=f=m=Number.POSITIVE_INFINITY,g=v=y=Number.NEGATIVE_INFINITY,h=0;h<3;h++)d=s+3*h,x[d]<p&&(p=x[d]),x[d+1]<f&&(f=x[d+1]),x[d+2]<m&&(m=x[d+2]),x[d]>g&&(g=x[d]),x[d+1]>v&&(v=x[d+1]),x[d+2]>y&&(y=x[d+2]);this.root.add([p,f,m,g,v,y,x,s],this)}}};var n=function(e,t){this.min=e,this.max=t,this.children=null,this.items=null};n.prototype.add=function(e,t,r){if(this.children){r||(r=0);for(var i=0;i<8;i++){var a=this.children[i],s=a.min,n=a.max;e[0]<n[0]&&e[3]>s[0]&&e[1]<n[1]&&e[4]>s[1]&&e[2]<n[2]&&e[5]>s[2]&&a.add(e,t,r+1)}}else this.items||(this.items=[]),this.items.push(e),r<t.maxDepth&&this.items.length>=t.maxItemsPerNode&&this.split(t,r+1)},n.prototype.split=function(e,t){var r,i,a,s=this.min,o=this.max,h=[.5*(o[0]+s[0]),.5*(o[1]+s[1]),.5*(o[2]+s[2])];for(this.children=[null,null,null,null,null,null,null,null],this.depthCount[t]++,r=0;r<8;r++){var l=e.pattern[r];this.children[r]=new n([0===l[0]?s[0]:h[0],0===l[1]?s[1]:h[1],0===l[2]?s[2]:h[2]],[0===l[0]?h[0]:o[0],0===l[1]?h[1]:o[1],0===l[2]?h[2]:o[2]])}var u=this.items;if(u)for(r=0,i=u.length;r<i;r++){var c=u[r];for(a=0;a<8;a++){var d=this.children[a];s=d.min,o=d.max,c[0]<o[0]&&c[3]>s[0]&&c[1]<o[1]&&c[4]>s[1]&&c[2]<o[2]&&c[5]>s[2]&&d.add(c,e)}}this.items=null};var o=function(){this.octantTable=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],this.flags=0};o.prototype.findEntryOctant=function(e,t,r,i,a,s){var n=0;return e>t&&e>r?(a<e&&(n|=2),s<e&&(n|=1)):t>r?(i<t&&(n|=4),s<t&&(n|=1)):(i<r&&(n|=4),a<r&&(n|=2)),n},o.prototype.findNextOctant=function(e,t,r,i){var a,s=0;return t<r?(a=t,s=0):(a=r,s=1),i<a&&(s=2),this.octantTable[e][s]},o.prototype.raycastOctant=function(e,t,r,i,a,s,n,o){var h,l,u,c,d=e.children;if(a>=0&&s>=0&&n>=0)if(d){l=.5*(t+a),u=.5*(r+s),c=.5*(i+n),h=this.findEntryOctant(t,r,i,l,u,c);do{switch(h){case 0:this.raycastOctant(d[this.flags],t,r,i,l,u,c,o),h=this.findNextOctant(h,l,u,c);break;case 1:this.raycastOctant(d[1^this.flags],t,r,c,l,u,n,o),h=this.findNextOctant(h,l,u,n);break;case 2:this.raycastOctant(d[2^this.flags],t,u,i,l,s,c,o),h=this.findNextOctant(h,l,s,c);break;case 3:this.raycastOctant(d[3^this.flags],t,u,c,l,s,n,o),h=this.findNextOctant(h,l,s,n);break;case 4:this.raycastOctant(d[4^this.flags],l,r,i,a,u,c,o),h=this.findNextOctant(h,a,u,c);break;case 5:this.raycastOctant(d[5^this.flags],l,r,c,a,u,n,o),h=this.findNextOctant(h,a,u,n);break;case 6:this.raycastOctant(d[6^this.flags],l,u,i,a,s,c,o),h=this.findNextOctant(h,a,s,c);break;case 7:this.raycastOctant(d[7^this.flags],l,u,c,a,s,n,o),h=8}}while(h<8)}else e.items&&o.push(e)},o.prototype.hitFace=function(e,t,r,i){var s,n,o,h,l,u=[i[r],i[r+1],i[r+2]],c=[i[r+3],i[r+4],i[r+5]],d=[i[r+6],i[r+7],i[r+8]],p=[0,0,0],f=[0,0,0],m=[c[0]-u[0],c[1]-u[1],c[2]-u[2]],g=[d[0]-u[0],d[1]-u[1],d[2]-u[2]];return a.cross(t,g,p),(n=a.dot(m,p))>-1e-7&&n<1e-7?[!1]:(o=1/n,s=[e[0]-u[0],e[1]-u[1],e[2]-u[2]],(h=o*a.dot(s,p))<0||h>1?[!1]:(f=a.cross(s,m),(l=o*a.dot(t,f))<0||h+l>1?[!1]:[!0,o*a.dot(g,f)]))},o.prototype.intersectOctree=function(e,t,r,i){var a,s,n,o,h,l,u,c,d,p=[0,0,0],f=[r.root.max[0]-r.root.min[0],r.root.max[1]-r.root.min[1],r.root.max[2]-r.root.min[2]],m=[f[0],f[1],f[2]],g=[.5*m[0],.5*m[1],.5*m[2]],v=[e[0],e[1],e[2]],y=[t[0],t[1],t[2]],b=[.5*(r.root.max[0]+r.root.min[0]),.5*(r.root.max[1]+r.root.min[1]),.5*(r.root.max[2]+r.root.min[2])];v[0]=v[0]-b[0]+g[0],v[1]=v[1]-b[1]+g[1],v[2]=v[2]-b[2]+g[2],this.flags=0,y[0]<0&&(v[0]=m[0]-v[0],y[0]=-y[0],this.flags|=4),y[1]<0&&(v[1]=m[1]-v[1],y[1]=-y[1],this.flags|=2),y[2]<0&&(v[2]=m[2]-v[2],y[2]=-y[2],this.flags|=1),a=1/y[0],s=1/y[1],n=1/y[2],o=(p[0]-v[0])*a,h=(f[0]-v[0])*a,l=(p[1]-v[1])*s,u=(f[1]-v[1])*s,c=(p[2]-v[2])*n,d=(f[2]-v[2])*n,Math.max(Math.max(o,l),c)<Math.min(Math.min(h,u),d)&&this.raycastOctant(r.root,o,l,c,h,u,d,i)},o.prototype.intersectOctants=function(e,t,r){for(var i=[],a=Number.POSITIVE_INFINITY,s=0,n=r.length;s<n;s++)for(var o=r[s].items,h=0,l=o.length;h<l;h++){var u=o[h],c=this.hitFace(e,t,u[7],u[6]);c[0]&&c[1]<a&&(a=c[1])}return a!==Number.POSITIVE_INFINITY&&(i=[a]),i}},function(e,t,r){"use strict";var i=r(2),a=r(161),s=r(6),n=r(57),o=r(156),h=r(164),l=r(157),u=r(168),c=i.b,d=i.e,p=a.a,f=s.a,m=n.a,g=o.a,v=h.a,y=l.a,b=u.a,x=function(e,t,r,i,a){this.config=a||{},this.core=e,this.progTile=null,this.progHeightmap=null,this.progSkydome=null,this.progWireframeTile=null,this.progWireframeTile2=null,this.progText=null,this.div=t,this.onUpdate=r,this.killed=!1,this.onlyDepth=!1,this.onlyLayers=!1,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1,this.hitmapCounter=0,this.geoRenderCounter=0,this.geoHitmapCounter=0,this.frameTime=0,this.geometries={},this.clearStencilPasses=[],this.onResizeCall=i,this.stencilLineState=null,this.drawLabelBoxes=!1,this.drawGridCells=!1,this.geodataSelection=[],this.hoverFeatureCounter=0,this.hoverFeatureList=[],this.touchSurfaceEvent=[];var s=this.div.getBoundingClientRect();this.winSize=[s.width,s.height],this.curSize=[s.width,s.height],this.oldSize=[s.width,s.height],this.dirty=!0,this.cameraVector=[0,1,0],this.gpu=new p(this,t,this.curSize,this.config.rendererAllowScreenshots,this.config.rendererAntialiasing,this.config.rendererAnisotropic),this.camera=new g(this,45,2,12e5),this.drawTileMatrix=d.create(),this.drawTileMatrix2=d.create(),this.drawTileVec=[0,0,0],this.drawTileWorldMatrix=d.create(),this.pixelTileSizeMatrix=d.create(),this.heightmapMesh=null,this.heightmapTexture=null,this.skydomeMesh=null,this.skydomeTexture=null,this.hitmapTexture=null,this.geoHitmapTexture=null,this.hitmapSize=1024,this.updateHitmap=!0,this.updateGeoHitmap=!0,this.redTexture=null,this.rectVerticesBuffer=null,this.rectIndicesBuffer=null,this.imageProjectionMatrix=null,this.font=null,this.fonts={},this.fogDensity=0,this.gmap=new Array(2048),this.gmap2=new Array(2048),this.gmap3=new Array(1e4),this.gmap3Size=new Array(1e4),this.gmapIndex=0,this.gmapTop=new Array(512),this.gmapHit=new Array(512),this.gmapStore=new Array(512),this.fmaxDist=0,this.fminDist=0,this.jobZBuffer=new Array(512),this.jobZBufferSize=new Array(512),this.jobZBuffer2=new Array(512),this.jobZBuffer2Size=new Array(512),this.jobHBuffer={},this.jobHBufferSize=0;for(var n=0,o=this.jobZBuffer.length;n<o;n++)this.jobZBuffer[n]=[],this.jobZBufferSize[n]=0,this.jobZBuffer2[n]={},this.jobZBuffer2Size[n]=0;for(n=0,o=this.gmap3.length;n<o;n++)this.gmap3[n]=[],this.gmap3Size[n]=0;this.layerGroupVisible=[],this.bitmaps={},this.cameraPosition=[0,0,0],this.cameraOrientation=[0,0,0],this.cameraTiltFator=1,this.cameraViewExtent=1,this.distanceFactor=1,this.tiltFactor=1,this.localViewExtentFactor=1,this.cameraVector=[0,0,0],this.labelVector=[0,0,0],this.drawnGeodataTiles=0,this.drawnGeodataTilesFactor=0,this.progMap={},this.updateCameraMatrix=d.create(),this.lastHitPosition=[0,0,100],this.logTilePos=null,window.addEventListener("resize",this.onResize.bind(this),!1),this.gpu.init(),this.init=new v(this),this.rmap=new b(this,50),this.draw=new y(this);this.resizeGL(Math.floor(1*this.curSize[0]),Math.floor(1*this.curSize[1]))};x.prototype.initProceduralShaders=function(){this.init.initProceduralShaders()},x.prototype.onResize=function(){if(!this.killed){var e=this.div.getBoundingClientRect();this.resizeGL(Math.floor(e.width),Math.floor(e.height)),this.onResizeCall&&this.onResizeCall()}},x.prototype.kill=function(){this.killed||(this.killed=!0,null!=this.planet&&this.planet.kill(),this.heightmapMesh&&this.heightmapMesh.kill(),this.heightmapTexture&&this.heightmapTexture.kill(),this.skydomeMesh&&this.skydomeMesh.kill(),this.skydomeTexture&&this.skydomeTexture.kill(),this.hitmapTexture&&this.hitmapTexture.kill(),this.geoHitmapTexture&&this.geoHitmapTexture.kill(),this.redTexture&&this.redTexture.kill(),this.whiteTexture&&this.whiteTexture.kill(),this.blackTexture&&this.blackTexture.kill(),this.lineTexture&&this.lineTexture.kill(),this.textTexture2&&this.textTexture2.kill(),this.atmoMesh&&this.atmoMesh.kill(),this.bboxMesh&&this.bboxMesh.kill(),this.font&&this.font.kill(),this.plines&&this.plines.kill(),this.plineJoints&&this.plineJoints.kill(),this.gpu.kill())},x.prototype.getPlanet=function(){return this.planet},x.prototype.resizeGL=function(e,t,r,i){this.camera.setAspect(e/t),this.curSize=[e,t],this.oldSize=[e,t],this.gpu.resize(this.curSize,r),!0!==i&&this.draw.paintGL();var a=[];a[0]=2/e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2/t,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=.5*-e*a[0],a[13]=.5*-t*a[5],a[14]=0,a[15]=1,this.imageProjectionMatrix=a},x.prototype.project2=function(e,t,r){var i=[0,0,0,1];if(i=r?d.multiplyVec4(t,[e[0]-r[0],e[1]-r[1],e[2]-r[2],1]):d.multiplyVec4(t,[e[0],e[1],e[2],1]),0!=i[3]){var a=[0,0,0];return a[0]=.5*(i[0]/i[3]+1)*this.curSize[0],a[1]=.5*(-i[1]/i[3]+1)*this.curSize[1],a[2]=i[2]/i[3],a}return[0,0,0]},x.prototype.project=function(e){var t=this.camera.getMvpMatrix(),r=this.camera.getPosition(),i=this.cameraPosition(),a=[e[0]-i[0]+r[0],e[1]-i[1]+r[1],e[2]-i[2]+r[2],1],s=[0,0,0,1];if(s=d.multiplyVec4(t,a),0!=s[3]){var n=[0,0,0];return n[0]=.5*(s[0]/s[3]+1)*this.curSize[0],n[1]=.5*(-s[1]/s[3]+1)*this.curSize[1],n[2]=s[2]/s[3],n}return[0,0,0]},x.prototype.getScreenRay=function(e,t){if(null==this.camera)return[0,0,1];this.camera.dirty=!0;var r=2*e/this.curSize[0]-1,i=1-2*t/this.curSize[1],a=[r,i,1],s=[a[0],a[1],-1,1],n=d.create();n=d.inverse(this.camera.getProjectionMatrix());var o=[0,0,0,0];d.multiplyVec4(n,s,o),o[2]=-1,o[3]=0;var h=d.create();h=d.inverse(this.camera.getModelviewMatrix());var l=[0,0,0,0];return d.multiplyVec4(h,o,l),l=c.normalize([l[0],l[1],l[2]])},x.prototype.hitTestGeoLayers=function(e,t,r){var i=this.gpu.gl;if(i.checkFramebufferStatus(i.FRAMEBUFFER)!=i.FRAMEBUFFER_COMPLETE)return[!1,0,0,0,0];var a,s=!1;if(e>=0&&e<this.curSize[0]&&t>=0&&t<this.curSize[1]){var n=0,o=0;n=Math.floor(e*(this.hitmapSize/this.curSize[0])),o=Math.floor(t*(this.hitmapSize/this.curSize[1])),a=r?this.geoHitmapTexture2.readFramebufferPixels(n,this.hitmapSize-o-1,1,1):this.geoHitmapTexture.readFramebufferPixels(n,this.hitmapSize-o-1,1,1),s=!(255==a[0]&&255==a[1]&&255==a[2]&&255==a[3])}return s?[!0,a[0],a[1],a[2],a[3]]:[!1,0,0,0,0]},x.prototype.switchToFramebuffer=function(e,t){var r,i,a,s=this.gpu.gl;switch(e){case"base":i=this.oldSize[0],a=this.oldSize[1],s.clearColor(0,0,0,1),this.gpu.setFramebuffer(null),this.camera.setAspect(i/a),this.curSize=[i,a],this.gpu.resize(this.curSize,!0),this.camera.update(),this.onlyDepth=!1,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1;break;case"depth":this.gpu.setFramebuffer(this.hitmapTexture),this.oldSize=[this.curSize[0],this.curSize[1]],s.clearColor(1,1,1,1),s.enable(s.DEPTH_TEST),r=this.hitmapSize,s.viewport(0,0,r,r),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),this.curSize=[r,r],this.gpu.clear(),this.camera.update(),this.onlyDepth=!0,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1;break;case"geo":case"geo2":this.hoverFeatureCounter=0,r=this.hitmapSize,this.gpu.setFramebuffer("geo"==e?this.geoHitmapTexture:this.geoHitmapTexture2),i=r,a=r,s.clearColor(1,1,1,1),s.enable(s.DEPTH_TEST),s.viewport(0,0,r,r),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),this.curSize=[i,a],this.onlyHitLayers=!0,this.advancedPassNeeded=!1,this.onlyAdvancedHitLayers="geo2"==e,this.gpu.clear(),this.camera.update();break;case"texture":this.gpu.setFramebuffer(t),this.oldSize=[this.curSize[0],this.curSize[1]],s.clearColor(0,0,0,1),s.enable(s.DEPTH_TEST),s.viewport(0,0,this.gpu.canvas.width,this.gpu.canvas.height),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),this.curSize=[this.gpu.canvas.width,this.gpu.canvas.height],this.gpu.clear(),this.camera.update(),this.onlyDepth=!1,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1}},x.prototype.hitTest=function(e,t){var r=this.gpu.gl,i=this.getScreenRay(e,t),a=this.camera.getPosition();if(r.checkFramebufferStatus(r.FRAMEBUFFER)!=r.FRAMEBUFFER_COMPLETE)return[0,0,0,null,i,Number.MAX_VALUE,a];var s=0,n=0;s=Math.floor(e*(this.hitmapSize/this.curSize[0])),n=Math.floor(t*(this.hitmapSize/this.curSize[1]));var o=this.hitmapTexture.readFramebufferPixels(s,this.hitmapSize-n-1,1,1),h=o[0]*(1/255)+o[1]+255*o[2]+65025*o[3],l=!(255==o[0]&&255==o[1]&&255==o[2]&&255==o[3]);return this.lastHitPosition=[a[0]+i[0]*h,a[1]+i[1]*h,a[2]+i[2]*h],[this.lastHitPosition[0],this.lastHitPosition[1],this.lastHitPosition[2],l,i,h,a]},x.prototype.getZoffsetFactor=function(e){return 1e-4*(e[0]+e[1]*this.distanceFactor+e[2]*this.tiltFactor)},x.prototype.saveScreenshot=function(e,t,r){var i=this.gpu.gl,a=this.curSize[0],s=this.curSize[1],n=new Uint8Array(a*s*4);i.readPixels(0,0,a,s,i.RGBA,i.UNSIGNED_BYTE,n);for(var o=new Uint8Array(a*s*4),h=0,l=0;l<s;l++)for(var u=(s-1-l)*a*4,c=0;c<a;c++)o[h]=n[u],o[h+1]=n[u+1],o[h+2]=n[u+2],o[h+3]=n[u+3],h+=4,u+=4;var d=document.createElement("canvas");d.width=a,d.height=s;var p=d.getContext("2d"),f=p.createImageData(a,s);if(f.data.set(o),p.putImageData(f,0,0),r=r||"jpg","file"==e){for(var m=document.createElement("a"),g=d.toDataURL("image/"+r),v=atob(g.split(",")[1]),y=new ArrayBuffer(v.length),b=new Uint8Array(y),x=0;x<v.length;x++)b[x]=v.charCodeAt(x);var M=new Blob([y],{type:r}),S=URL.createObjectURL(M);m.href=S,m.download=t,document.body.appendChild(m),m.click(),setTimeout(function(){document.body.removeChild(m),window.URL.revokeObjectURL(S)},0)}return"tab"==e&&window.open(d.toDataURL("image/"+r)),f},x.prototype.getBitmap=function(e,t,r){var i=e+"*"+t+"*"+r,a=this.bitmaps[i];return a||(a=new f(this.gpu,e,this.core,null,null,r,t),this.bitmaps[i]=a),a},x.prototype.getFont=function(e){var t=this.fonts[e];return t||(t=new m(this.gpu,this.core,null,null,e),this.fonts[e]=t),t},t.a=x},function(e,t,r){"use strict";var i=function(e,t,r){this.renderer=e,this.maxBlockRectangles=r||500,this.blockSize=t,this.blockSizeFactor=1/t,this.blocks=[],this.blocksRCount=[],this.allocatedBlocks=0,this.lx=1,this.ly=1,this.counter=0,this.rectangles=null,this.rectanglesCount=0,this.rectangles2=null,this.rectangles2Count=0};i.prototype.clear=function(){this.slx=this.renderer.curSize[0],this.sly=this.renderer.curSize[1],this.sly=Math.max(1,this.sly-55),this.clx=135,this.cly=115,this.blx=245,this.bly=45,this.lx=Math.floor(this.slx*this.blockSizeFactor)+1,this.ly=Math.floor(this.sly*this.blockSizeFactor)+1;var e=this.ly*this.lx;if(this.rectangles||(this.rectangles=new Array(e*this.maxBlockRectangles*6)),this.rectangles2||(this.rectangles2=new Array(e*this.maxBlockRectangles*6)),this.rectanglesCount>0||this.allocatedBlocks!=e){this.allocatedBlocks=e;for(var t=0;t<e;t++)this.blocks[t]||(this.blocks[t]=[]),this.blocksRCount[t]=0}this.rectanglesCount=0,this.counter=this.renderer.geoRenderCounter},i.prototype.storeRemovedRectangle=function(e,t,r,i,a,s){var n=this.rectangles2,o=this.rectangles2Count;n[o]=e,n[o+1]=t,n[o+2]=r,n[o+3]=i,n[o+4]=a,n[o+5]=s,this.rectangles2Count+=6},i.prototype.checkRectangle=function(e,t,r,i,a){var s;return e>r&&(s=e,e=r,r=s),t>i&&(s=t,t=i,i=s),a+=i,!(e<0||r>this.slx||t<0||a>this.sly)&&(!(e<this.clx&&r>0&&t<=this.sly&&a>this.sly-this.cly)&&!(e<this.blx&&r>0&&t<=this.bly&&a>0))},i.prototype.addRectangle=function(e,t,r,i,a,s,n){var o,h,l,u,c,d,p,f;e>r&&(f=e,e=r,r=f),t>i&&(f=t,t=i,i=f);var m=i+s[1];if(e<0||r>this.slx||t<0||m>this.sly)return!1;if(e<this.clx&&r>0&&t<=this.sly&&m>this.sly-this.cly)return!1;if(e<this.blx&&r>0&&t<=this.bly&&m>0)return!1;var g=Math.floor(e*this.blockSizeFactor),v=Math.floor(t*this.blockSizeFactor),y=Math.floor(r*this.blockSizeFactor),b=Math.floor(i*this.blockSizeFactor);if(y<0||b<0||g>=this.lx||v>=this.ly)return!1;g<0&&(g=0),y>=this.lx&&(y=this.lx-1),v<0&&(v=0),b>=this.ly&&(b=this.ly-1);var x=y-g+1,M=b-v+1,S={},w=this.renderer.config.mapFeaturesSortByTop,A=this.rectangles;for(h=0;h<M;h++)for(o=0;o<x;o++){for(u=(v+h)*this.lx+(g+o),c=this.blocks[u],d=this.blocksRCount[u],l=0;l<d;l++)if(p=c[l],e<A[p+2]&&r>A[p+0]&&t<A[p+3]&&i>A[p+1]){if(n)return!1;if(w){if(a<A[p+4])return!1}else if(a>A[p+4])return!1;S[p]=!0}if(d+1>=this.maxBlockRectangles)return!1}for(var T in S)this.removeRectangle(parseInt(T));for(p=this.rectanglesCount,A[p]=e,A[p+1]=t,A[p+2]=r,A[p+3]=i,A[p+4]=a,A[p+5]=s,this.rectanglesCount+=6,h=0;h<M;h++)for(o=0;o<x;o++)u=(v+h)*this.lx+(g+o),this.blocks[u][this.blocksRCount[u]]=p,this.blocksRCount[u]++;return!0},i.prototype.removeRectangle=function(e){var t,r,i,a,s,n,o,h,l,u,c=this.rectangles;t=c[e],r=c[e+1],i=c[e+2],a=c[e+3];var d=this.rectangles2,p=this.rectangles2Count;d[p]=t,d[p+1]=r,d[p+2]=i,d[p+3]=a,d[p+4]=c[e+4],d[p+5]=c[e+5],this.rectangles2Count+=6,c[e+5]=null;var f=Math.floor(t*this.blockSizeFactor),m=Math.floor(r*this.blockSizeFactor),g=Math.floor(i*this.blockSizeFactor),v=Math.floor(a*this.blockSizeFactor);f<0&&(f=0),g>=this.lx&&(g=this.lx-1),m<0&&(m=0),v>=this.ly&&(v=this.ly-1);var y=g-f+1,b=v-m+1;for(n=0;n<b;n++)for(s=0;s<y;s++)for(h=(m+n)*this.lx+(f+s),l=this.blocks[h],u=this.blocksRCount[h],o=0;o<u;o++)if(l[o]==e){l[o]=l[u-1],this.blocksRCount[h]--;break}},i.prototype.processRectangles=function(e,t,r,i){for(var a=this.rectangles,s=this.rectangles2,n=r.draw,o=0,h=this.rectangles2Count;o<h;o+=6){var l=s[o],u=s[o+1],c=s[o+2],d=s[o+3],p=s[o+4],f=s[o+5];this.addRectangle(l,u,c,d,p,f)}for(this.rectangles2Count=0,o=0,h=this.rectanglesCount;o<h;o+=6){var f=a[o+5];f&&(f[0].hysteresis?r.jobHBuffer[f[0].id]=f[0]:(r.drawnJobs++,n.drawGpuSubJob(e,t,r,i,f,null)))}this.clear()},t.a=i},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";function i(e,t){return e="string"!=typeof e?e:document.getElementById(e),f()?new m(e,t):null}Object.defineProperty(t,"__esModule",{value:!0});var a=r(21),s=r(34),n=r.n(s),o=r(13),h=r(59),l=r(2),u=r(4),c=r(3),d=r(22);r.d(t,"earcut",function(){return n.a}),r.d(t,"vec2",function(){return g}),r.d(t,"vec3",function(){return v}),r.d(t,"vec4",function(){return y}),r.d(t,"mat3",function(){return b}),r.d(t,"mat4",function(){return x}),r.d(t,"math",function(){return S}),r.d(t,"utils",function(){return M}),r.d(t,"getCoreVersion",function(){return p}),r.d(t,"checkSupport",function(){return f}),r.d(t,"core",function(){return i}),r.d(t,"proj4",function(){return w}),r.d(t,"platform",function(){return A});var p=o.a,f=o.b,m=h.a,g=l.a,v=l.b,y=l.c,b=l.d,x=l.e,M=u.a,S=c.a,w=a.a,A=d.a}]);